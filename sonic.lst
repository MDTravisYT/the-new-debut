00000000 =00000000                  EnableSRAM:	equ 0	; change to 1 to enable SRAM
00000000 =00000001                  BackupSRAM:	equ 1
00000000 =00000003                  AddressSRAM:	equ 3	; 0 = odd+even; 2 = even only; 3 = odd only
00000000                            
00000000                            ; Change to 0 to build the original version of the game, dubbed REV00
00000000                            ; Change to 1 to build the later vesion, dubbed REV01, which includes various bugfixes and enhancements
00000000                            ; Change to 2 to build the version from Sonic Mega Collection, dubbed REVXB, which fixes the infamous "spike bug"
00000000 =00000000                  Revision:	equ 0
00000000                            
00000000 =00000006                  ZoneCount:	equ 6	; discrete zones are: GHZ, MZ, SYZ, LZ, SLZ, and SBZ
00000000                            
00000000 =00000000                  OptimiseSound:	equ 0	; change to 1 to optimise sound queuing
00000000                            
00000000                            ; 0 is full game
00000000                            ; 1 is demo mode
00000000 =00000000                  IsDemo:	equ 0
00000000                            
00000000                                include "sonic.asm"
00000000                            ;  =========================================================================
00000000                            ; |           Sonic Debut for Sega Mega Drive                              |
00000000                            ;  =========================================================================
00000000                            ;
00000000                            ; Disassembly created by Hivebrain
00000000                            ; thanks to drx, Stealth and Esrael L.G. Neto
00000000                            
00000000                            ; ===========================================================================
00000000                            
00000000                                include "Debugger.asm"
00000000                            
00000000                            ; ===============================================================
00000000                            ; ---------------------------------------------------------------
00000000                            ; Error handling and debugging modules
00000000                            ; 2016-2017, Vladikcomper
00000000                            ; ---------------------------------------------------------------
00000000                            ; Debugging macros definitions file
00000000                            ; ---------------------------------------------------------------
00000000                            
00000000                            
00000000                            ; ===============================================================
00000000                            ; ---------------------------------------------------------------
00000000                            ; Constants
00000000                            ; ---------------------------------------------------------------
00000000                            
00000000                            ; ----------------------------
00000000                            ; Arguments formatting flags
00000000                            ; ----------------------------
00000000                            
00000000                            ; General arguments format flags
00000000 =00000080                  hex		equ		$80				; flag to display as hexadecimal number
00000000 =00000090                  dec		equ		$90				; flag to display as decimal number
00000000 =000000A0                  bin		equ		$A0				; flag to display as binary number
00000000 =000000B0                  sym		equ		$B0				; flag to display as symbol (treat as offset, decode into symbol +displacement, if present)
00000000 =000000C0                  symdisp	equ		$C0				; flag to display as symbol's displacement alone (DO NOT USE, unless complex formatting is required, see notes below)
00000000 =000000D0                  str		equ		$D0				; flag to display as string (treat as offset, insert string from that offset)
00000000                            
00000000                            ; NOTES:
00000000                            ;	* By default, the "sym" flag displays both symbol and displacement (e.g.: "Map_Sonic+$2E")
00000000                            ;		In case, you need a different formatting for the displacement part (different text color and such),
00000000                            ;		use "sym|split", so the displacement won't be displayed until symdisp is met
00000000                            ;	* The "symdisp" can only be used after the "sym|split" instance, which decodes offset, otherwise, it'll
00000000                            ;		display a garbage offset.
00000000                            ;	* No other argument format flags (hex, dec, bin, str) are allowed between "sym|split" and "symdisp",
00000000                            ;		otherwise, the "symdisp" results are undefined.
00000000                            ;	* When using "str" flag, the argument should point to string offset that will be inserted.
00000000                            ;		Arguments format flags CAN NOT be used in the string (as no arguments are meant to be here),
00000000                            ;		only console control flags (see below).
00000000                            
00000000                            
00000000                            ; Additional flags ...
00000000                            ; ... for number formatters (hex, dec, bin)
00000000 =00000008                  signed	equ		8				; treat number as signed (display + or - before the number depending on sign)
00000000                            
00000000                            ; ... for symbol formatter (sym)
00000000 =00000008                  split	equ		8				; DO NOT write displacement (if present), skip and wait for "symdisp" flag to write it later (optional)
00000000 =00000004                  forced	equ		4				; display "<unknown>" if symbol was not found, otherwise, plain offset is displayed by the displacement formatter
00000000                            
00000000                            ; ... for symbol displacement formatter (symdisp)
00000000 =00000008                  weak	equ		8				; DO NOT write plain offset if symbol is displayed as "<unknown>"
00000000                            
00000000                            ; Argument type flags:
00000000                            ; - DO NOT USE in formatted strings processed by macros, as these are included automatically
00000000                            ; - ONLY USE when writting down strings manually with DC.B
00000000 =00000000                  byte	equ		0
00000000 =00000001                  word	equ		1
00000000 =00000003                  long	equ		3
00000000                            
00000000                            ; -----------------------
00000000                            ; Console control flags
00000000                            ; -----------------------
00000000                            
00000000                            ; Plain control flags: no arguments following
00000000 =000000E0                  endl	equ		$E0				; "End of line": flag for line break
00000000 =000000E6                  cr		equ		$E6				; "Carriage return": jump to the beginning of the line
00000000 =000000E8                  pal0	equ		$E8				; use palette line #0
00000000 =000000EA                  pal1	equ		$EA				; use palette line #1
00000000 =000000EC                  pal2	equ		$EC				; use palette line #2
00000000 =000000EE                  pal3	equ		$EE				; use palette line #3
00000000                            
00000000                            ; Parametrized control flags: followed by 1-byte argument
00000000 =000000F0                  setw	equ		$F0				; set line width: number of characters before automatic line break
00000000 =000000F4                  setoff	equ		$F4				; set tile offset: lower byte of base pattern, which points to tile index of ASCII character 00
00000000 =000000F8                  setpat	equ		$F8				; set tile pattern: high byte of base pattern, which determines palette flags and $100-tile section id
00000000 =000000FA                  setx	equ		$FA				; set x-position
00000000                            
00000000                            
00000000                            
00000000                            ; ---------------------------------------------------------------
00000000                            ; Macros
00000000                            ; ---------------------------------------------------------------
00000000                            
00000000                            RaiseError &
00000000                            
00000000                            	pea		*(pc)
00000000                            	move.w	sr, -(sp)
00000000                            	__FSTRING_GenerateArgumentsCode \string
00000000                            	jsr		ErrorHandler
00000000                            	__FSTRING_GenerateDecodedString \string
00000000                            	if strlen("\console_program")			; if console program offset is specified ...
00000000                            		dc.b	\opts+_eh_enter_console|(((*&1)^1)*_eh_align_offset)	; add flag "_eh_align_offset" if the next byte is at odd offset ...
00000000                            		even															; ... to tell Error handler to skip this byte, so it'll jump to ...
00000000                            		jmp		\console_program										; ... an aligned "jmp" instruction that calls console program itself
00000000                            	else
00000000                            		dc.b	\opts+0						; otherwise, just specify \opts for error handler, +0 will generate dc.b 0 ...
00000000                            		even								; ... in case \opts argument is empty or skipped
00000000                            	endc
00000000                            	even
00000000                            
00000000                            	endm
00000000                            
00000000                            ; ---------------------------------------------------------------
00000000                            Console &
00000000                            
00000000                            	if strcmp("\0","write")|strcmp("\0","writeline")
00000000                            		move.w	sr, -(sp)
00000000                            		__FSTRING_GenerateArgumentsCode \1
00000000                            		movem.l	a0-a2/d7, -(sp)
00000000                            		if (__sp>0)
00000000                            			lea		4*4(sp), a2
00000000                            		endc
00000000                            		lea		@str\@(pc), a1
00000000                            		jsr		ErrorHandler.__global__console_\0\_formatted
00000000                            		movem.l	(sp)+, a0-a2/d7
00000000                            		if (__sp>8)
00000000                            			lea		__sp(sp), sp
00000000                            		elseif (__sp>0)
00000000                            			addq.w	#__sp, sp
00000000                            		endc
00000000                            		move.w	(sp)+, sr
00000000                            		bra.w	@instr_end\@
00000000                            	@str\@:
00000000                            		__FSTRING_GenerateDecodedString \1
00000000                            		even
00000000                            	@instr_end\@:
00000000                            
00000000                            	elseif strcmp("\0","run")
00000000                            		jsr		ErrorHandler.__extern__console_only
00000000                            		jsr		\1
00000000                            		bra.s	*
00000000                            
00000000                            	elseif strcmp("\0","setxy")
00000000                            		move.w	sr, -(sp)
00000000                            		movem.l	d0-d1, -(sp)
00000000                            		move.w	\2, -(sp)
00000000                            		move.w	\1, -(sp)
00000000                            		jsr		ErrorHandler.__global__console_setposasxy_stack
00000000                            		addq.w	#4, sp
00000000                            		movem.l	(sp)+, d0-d1
00000000                            		move.w	(sp)+, sr
00000000                            
00000000                            	elseif strcmp("\0","breakline")
00000000                            		move.w	sr, -(sp)
00000000                            		jsr		ErrorHandler.__global__console_startnewline
00000000                            		move.w	(sp)+, sr
00000000                            
00000000                            	else
00000000                            		inform	2,"""\0"" isn't a member of ""Console"""
00000000                            
00000000                            	endc
00000000                            	endm
00000000                            
00000000                            ; ---------------------------------------------------------------
00000000                            __ErrorMessage &
00000000                            		__FSTRING_GenerateArgumentsCode \string
00000000                            		jsr		ErrorHandler
00000000                            		__FSTRING_GenerateDecodedString \string
00000000                            		dc.b	\opts+0
00000000                            		even
00000000                            
00000000                            	endm
00000000                            
00000000                            ; ---------------------------------------------------------------
00000000                            __FSTRING_GenerateArgumentsCode &
00000000                            
00000000                            	__pos:	set 	instr(\string,'%<')		; token position
00000000                            	__stack:set		0						; size of actual stack
00000000                            	__sp:	set		0						; stack displacement
00000000                            
00000000                            	; Parse string itself
00000000                            	while (__pos)
00000000                            
00000000                            		; Retrive expression in brackets following % char
00000000                                	__endpos:	set		instr(__pos+1,\string,'>')
00000000                                	__midpos:	set		instr(__pos+5,\string,' ')
00000000                                	if (__midpos<1)|(__midpos>__endpos)
00000000                            			__midpos: = __endpos
00000000                                	endc
00000000                            		__substr:	substr	__pos+1+1,__endpos-1,\string			; .type ea param
00000000                            		__type:		substr	__pos+1+1,__pos+1+1+1,\string			; .type
00000000                            
00000000                            		; Expression is an effective address (e.g. %(.w d0 hex) )
00000000                            		if "\__type">>8="."
00000000                            			__operand:	substr	__pos+1+1,__midpos-1,\string			; .type ea
00000000                            			__param:	substr	__midpos+1,__endpos-1,\string			; param
00000000                            
00000000                            			if "\__type"=".b"
00000000                            				pushp	"move\__operand\,1(sp)"
00000000                            				pushp	"subq.w	#2, sp"
00000000                            				__stack: = __stack+2
00000000                            				__sp: = __sp+2
00000000                            
00000000                            			elseif "\__type"=".w"
00000000                            				pushp	"move\__operand\,-(sp)"
00000000                            				__stack: = __stack+1
00000000                            				__sp: = __sp+2
00000000                            
00000000                            			elseif "\__type"=".l"
00000000                            				pushp	"move\__operand\,-(sp)"
00000000                            				__stack: = __stack+1
00000000                            				__sp: = __sp+4
00000000                            
00000000                            			else
00000000                            				fatal 'Unrecognized type in string operand: %<\__substr>'
00000000                            			endc
00000000                            		endc
00000000                            
00000000                            		__pos:	set		instr(__pos+1,\string,'%<')
00000000                            	endw
00000000                            
00000000                            	; Generate stack code
00000000                            	rept __stack
00000000                            		popp	__command
00000000                            		\__command
00000000                            	endr
00000000                            
00000000                            	endm
00000000                            
00000000                            ; ---------------------------------------------------------------
00000000                            __FSTRING_GenerateDecodedString &
00000000                            
00000000                            	__lpos:	set		1						; start position
00000000                            	__pos:	set 	instr(\string,'%<')		; token position
00000000                            
00000000                            	while (__pos)
00000000                            
00000000                            		; Write part of string before % token
00000000                            		__substr:	substr	__lpos,__pos-1,\string
00000000                            		dc.b	"\__substr"
00000000                            
00000000                            		; Retrive expression in brakets following % char
00000000                                	__endpos:	set		instr(__pos+1,\string,'>')
00000000                                	__midpos:	set		instr(__pos+5,\string,' ')
00000000                                	if (__midpos<1)|(__midpos>__endpos)
00000000                            			__midpos: = __endpos
00000000                                	endc
00000000                            		__type:		substr	__pos+1+1,__pos+1+1+1,\string			; .type
00000000                            
00000000                            		; Expression is an effective address (e.g. %<.w d0 hex> )
00000000                            		if "\__type">>8="."    
00000000                            			__param:	substr	__midpos+1,__endpos-1,\string			; param
00000000                            			if strlen("\__param")<1
00000000                            				__param: substr ,,"hex"			; if param is ommited, set it to "hex"
00000000                            			endc
00000000                            			if "\__type"=".b"
00000000                            				dc.b	\__param
00000000                            			elseif "\__type"=".w"
00000000                            				dc.b	\__param|1
00000000                            			else
00000000                            				dc.b	\__param|3
00000000                            			endc
00000000                            
00000000                            		; Expression is an inline constant (e.g. %<endl> )
00000000                            		else
00000000                            			__substr:	substr	__pos+1+1,__endpos-1,\string
00000000                            			dc.b	\__substr
00000000                            		endc
00000000                            
00000000                            		__lpos:	set		__endpos+1
00000000                            		__pos:	set		instr(__pos+1,\string,'%<')
00000000                            	endw
00000000                            
00000000                            	; Write part of string before the end
00000000                            	__substr:	substr	__lpos,,\string
00000000                            	dc.b	"\__substr"
00000000                            	dc.b	0
00000000                            
00000000                            	endm
00000000                            	endm
00000000                            	include	"Constants.asm"
00000000                            ; ---------------------------------------------------------------------------
00000000                            ; Constants
00000000                            ; ---------------------------------------------------------------------------
00000000                            
00000000 =00006978                  Size_of_SegaPCM:		equ $6978
00000000                            
00000000                            ; VDP addressses
00000000 =00C00000                  vdp_data_port:		equ $C00000
00000000 =00C00004                  vdp_control_port:	equ $C00004
00000000 =00C00008                  vdp_counter:		equ $C00008
00000000                            
00000000 =00C00011                  psg_input:		equ $C00011
00000000                            
00000000                            ; Z80 addresses
00000000 =00A00000                  z80_ram:		equ $A00000	; start of Z80 RAM
00000000 =00A000EA                  z80_dac3_pitch:		equ $A000EA
00000000 =00A01FFD                  z80_dac_status:		equ $A01FFD
00000000 =00A01FFF                  z80_dac_sample:		equ $A01FFF
00000000 =00A02000                  z80_ram_end:		equ $A02000	; end of non-reserved Z80 RAM
00000000 =00A10001                  z80_version:		equ $A10001
00000000 =00A10002                  z80_port_1_data:	equ $A10002
00000000 =00A10008                  z80_port_1_control:	equ $A10008
00000000 =00A1000A                  z80_port_2_control:	equ $A1000A
00000000 =00A1000C                  z80_expansion_control:	equ $A1000C
00000000 =00A11100                  z80_bus_request:	equ $A11100
00000000 =00A11200                  z80_reset:		equ $A11200
00000000 =00A04000                  ym2612_a0:		equ $A04000
00000000 =00A04001                  ym2612_d0:		equ $A04001
00000000 =00A04002                  ym2612_a1:		equ $A04002
00000000 =00A04003                  ym2612_d1:		equ $A04003
00000000                            
00000000 =00A14000                  security_addr:		equ $A14000
00000000                            
00000000                            ; Sound driver constants
00000000 =00000000                  TrackPlaybackControl:	equ 0		; All tracks
00000000 =00000001                  TrackVoiceControl:	equ 1		; All tracks
00000000 =00000002                  TrackTempoDivider:	equ 2		; All tracks
00000000 =00000004                  TrackDataPointer:	equ 4		; All tracks (4 bytes)
00000000 =00000008                  TrackTranspose:		equ 8		; FM/PSG only (sometimes written to as a word, to include TrackVolume)
00000000 =00000009                  TrackVolume:		equ 9		; FM/PSG only
00000000 =0000000A                  TrackAMSFMSPan:		equ $A		; FM/DAC only
00000000 =0000000B                  TrackVoiceIndex:	equ $B		; FM/PSG only
00000000 =0000000C                  TrackVolEnvIndex:	equ $C		; PSG only
00000000 =0000000D                  TrackStackPointer:	equ $D		; All tracks
00000000 =0000000E                  TrackDurationTimeout:	equ $E		; All tracks
00000000 =0000000F                  TrackSavedDuration:	equ $F		; All tracks
00000000 =00000010                  TrackSavedDAC:		equ $10		; DAC only
00000000 =00000010                  TrackFreq:		equ $10		; FM/PSG only (2 bytes)
00000000 =00000012                  TrackNoteTimeout:	equ $12		; FM/PSG only
00000000 =00000013                  TrackNoteTimeoutMaster:equ $13		; FM/PSG only
00000000 =00000014                  TrackModulationPtr:	equ $14		; FM/PSG only (4 bytes)
00000000 =00000018                  TrackModulationWait:	equ $18		; FM/PSG only
00000000 =00000019                  TrackModulationSpeed:	equ $19		; FM/PSG only
00000000 =0000001A                  TrackModulationDelta:	equ $1A		; FM/PSG only
00000000 =0000001B                  TrackModulationSteps:	equ $1B		; FM/PSG only
00000000 =0000001C                  TrackModulationVal:	equ $1C		; FM/PSG only (2 bytes)
00000000 =0000001E                  TrackDetune:		equ $1E		; FM/PSG only
00000000 =0000001F                  TrackPSGNoise:		equ $1F		; PSG only
00000000 =0000001F                  TrackFeedbackAlgo:	equ $1F		; FM only
00000000 =00000020                  TrackVoicePtr:		equ $20		; FM SFX only (4 bytes)
00000000 =00000024                  TrackLoopCounters:	equ $24		; All tracks (multiple bytes)
00000000                            TrackGoSubStack:	equ TrackSz	; All tracks (multiple bytes. This constant won't get to be used because of an optimisation that just uses zTrackSz)
00000000                            
00000000 =00000030                  TrackSz:	equ $30
00000000                            
00000000                            ; VRAM data
00000000 =0000A000                  vram_win:	equ $A000	; window namespace
00000000 =0000C000                  vram_fg:	equ $C000	; foreground namespace
00000000 =0000E000                  vram_bg:	equ $E000	; background namespace
00000000 =0000F000                  vram_sonic:	equ $F000	; Sonic graphics
00000000 =0000F800                  vram_sprites:	equ $F800	; sprite table
00000000 =0000FC00                  vram_hscroll:	equ $FC00	; horizontal scroll table
00000000                            
00000000                            ; Game modes
00000000                            id_Sega:	equ ptr_GM_Sega-GameModeArray	; $00
00000000                            id_Title:	equ ptr_GM_Title-GameModeArray	; $04
00000000                            id_Demo:	equ ptr_GM_Demo-GameModeArray	; $08
00000000                            id_Level:	equ ptr_GM_Level-GameModeArray	; $0C
00000000                            id_Special:	equ ptr_GM_Special-GameModeArray; $10
00000000                            id_Continue:	equ ptr_GM_Cont-GameModeArray	; $14
00000000                            id_Ending:	equ ptr_GM_Ending-GameModeArray	; $18
00000000                            id_Credits:	equ ptr_GM_Credits-GameModeArray; $1C
00000000                            
00000000                            ; Levels
00000000 =00000000                  id_GHZ:		equ 0
00000000 =00000001                  id_LZ:		equ 1
00000000 =00000002                  id_MZ:		equ 2
00000000 =00000003                  id_SLZ:		equ 3
00000000 =00000004                  id_SZ:		equ 4
00000000 =00000005                  id_CWZ:		equ 5
00000000 =00000006                  id_EndZ:	equ 6
00000000 =00000007                  id_IMZ:		equ 7
00000000 =00000008                  id_CSZ:		equ 8
00000000                            
00000000                            ; Colours
00000000 =00000000                  cBlack:		equ $000		; colour black
00000000 =00000EEE                  cWhite:		equ $EEE		; colour white
00000000 =00000E00                  cBlue:		equ $E00		; colour blue
00000000 =000000E0                  cGreen:		equ $0E0		; colour green
00000000 =0000000E                  cRed:		equ $00E		; colour red
00000000 =000000EE                  cYellow:	equ cGreen+cRed		; colour yellow
00000000 =00000EE0                  cAqua:		equ cGreen+cBlue	; colour aqua
00000000 =00000E0E                  cMagenta:	equ cBlue+cRed		; colour magenta
00000000                            
00000000                            ; Joypad input
00000000 =00000080                  btnStart:	equ %10000000 ; Start button	($80)
00000000 =00000040                  btnA:		equ %01000000 ; A		($40)
00000000 =00000020                  btnC:		equ %00100000 ; C		($20)
00000000 =00000010                  btnB:		equ %00010000 ; B		($10)
00000000 =00000008                  btnR:		equ %00001000 ; Right		($08)
00000000 =00000004                  btnL:		equ %00000100 ; Left		($04)
00000000 =00000002                  btnDn:		equ %00000010 ; Down		($02)
00000000 =00000001                  btnUp:		equ %00000001 ; Up		($01)
00000000 =0000000F                  btnDir:		equ %00001111 ; Any direction	($0F)
00000000 =00000070                  btnABC:		equ %01110000 ; A, B or C	($70)
00000000 =00000007                  bitStart:	equ 7
00000000 =00000006                  bitA:		equ 6
00000000 =00000005                  bitC:		equ 5
00000000 =00000004                  bitB:		equ 4
00000000 =00000003                  bitR:		equ 3
00000000 =00000002                  bitL:		equ 2
00000000 =00000001                  bitDn:		equ 1
00000000 =00000000                  bitUp:		equ 0
00000000                            
00000000                            ; Object variables
00000000 =00000001                  obRender:	equ 1	; bitfield for x/y flip, display mode
00000000 =00000002                  obGfx:		equ 2	; palette line & VRAM setting (2 bytes)
00000000 =00000004                  obMap:		equ 4	; mappings address (4 bytes)
00000000 =00000008                  obX:		equ 8	; x-axis position (2-4 bytes)
00000000 =0000000A                  obScreenY:	equ $A	; y-axis position for screen-fixed items (2 bytes)
00000000 =0000000C                  obY:		equ $C	; y-axis position (2-4 bytes)
00000000 =00000010                  obVelX:		equ $10	; x-axis velocity (2 bytes)
00000000 =00000012                  obVelY:		equ $12	; y-axis velocity (2 bytes)
00000000 =00000014                  obInertia:	equ $14	; potential speed (2 bytes)
00000000 =00000016                  obHeight:	equ $16	; height/2
00000000 =00000017                  obWidth:	equ $17	; width/2
00000000 =00000018                  obPriority:	equ $18	; sprite stack priority -- 0 is front
00000000 =00000019                  obActWid:	equ $19	; action width
00000000 =0000001A                  obFrame:	equ $1A	; current frame displayed
00000000 =0000001B                  obAniFrame:	equ $1B	; current frame in animation script
00000000 =0000001C                  obAnim:		equ $1C	; current animation
00000000 =0000001D                  obNextAni:	equ $1D	; next animation
00000000 =0000001E                  obTimeFrame:	equ $1E	; time to next frame
00000000 =0000001F                  obDelayAni:	equ $1F	; time to delay animation
00000000 =00000020                  obColType:	equ $20	; collision response type
00000000 =00000021                  obColProp:	equ $21	; collision extra property
00000000 =00000022                  obStatus:	equ $22	; orientation or mode
00000000 =00000023                  obRespawnNo:	equ $23	; respawn list index number
00000000 =00000024                  obRoutine:	equ $24	; routine number
00000000 =00000025                  ob2ndRout:	equ $25	; secondary routine number
00000000 =00000026                  obAngle:	equ $26	; angle
00000000 =00000028                  obSubtype:	equ $28	; object subtype
00000000 =00000025                  obSolid:	equ ob2ndRout ; solid status flag
00000000                            
00000000                            ; Object variables used by Sonic
00000000 =00000030                  flashtime:	equ $30	; time between flashes after getting hit
00000000 =00000032                  invtime:	equ $32	; time left for invincibility
00000000 =00000034                  shoetime:	equ $34	; time left for speed shoes
00000000                            
00000000                            ; Object variables (Sonic 2 disassembly nomenclature)
00000000 =00000001                  render_flags:	equ 1	; bitfield for x/y flip, display mode
00000000 =00000002                  art_tile:	equ 2	; palette line & VRAM setting (2 bytes)
00000000 =00000004                  mappings:	equ 4	; mappings address (4 bytes)
00000000 =00000008                  x_pos:		equ 8	; x-axis position (2-4 bytes)
00000000 =0000000C                  y_pos:		equ $C	; y-axis position (2-4 bytes)
00000000 =00000010                  x_vel:		equ $10	; x-axis velocity (2 bytes)
00000000 =00000012                  y_vel:		equ $12	; y-axis velocity (2 bytes)
00000000 =00000016                  y_radius:	equ $16	; height/2
00000000 =00000017                  x_radius:	equ $17	; width/2
00000000 =00000018                  priority:	equ $18	; sprite stack priority -- 0 is front
00000000 =00000019                  width_pixels:	equ $19	; action width
00000000 =0000001A                  mapping_frame:	equ $1A	; current frame displayed
00000000 =0000001B                  anim_frame:	equ $1B	; current frame in animation script
00000000 =0000001C                  anim:		equ $1C	; current animation
00000000 =0000001D                  next_anim:	equ $1D	; next animation
00000000 =0000001E                  anim_frame_duration: equ $1E ; time to next frame
00000000 =00000020                  collision_flags: equ $20 ; collision response type
00000000 =00000021                  collision_property: equ $21 ; collision extra property
00000000 =00000022                  status:		equ $22	; orientation or mode
00000000 =00000023                  respawn_index:	equ $23	; respawn list index number
00000000 =00000024                  routine:	equ $24	; routine number
00000000 =00000025                  routine_secondary: equ $25 ; secondary routine number
00000000 =00000026                  angle:		equ $26	; angle
00000000 =00000028                  subtype:	equ $28	; object subtype
00000000                            
00000000                            ; Animation flags
00000000 =000000FF                  afEnd:		equ $FF	; return to beginning of animation
00000000 =000000FE                  afBack:		equ $FE	; go back (specified number) bytes
00000000 =000000FD                  afChange:	equ $FD	; run specified animation
00000000 =000000FC                  afRoutine:	equ $FC	; increment routine counter
00000000 =000000FB                  afReset:	equ $FB	; reset animation and 2nd object routine counter
00000000 =000000FA                  af2ndRoutine:	equ $FA	; increment 2nd routine counter
00000000                            
00000000                            ; Background music
00000000 =00000081                  bgm__First:	equ $81
00000000                            bgm_GHZ:	equ ((ptr_mus81-MusicIndex)/4)+bgm__First
00000000                            bgm_LZ:		equ ((ptr_mus82-MusicIndex)/4)+bgm__First
00000000                            bgm_MZ:		equ ((ptr_mus83-MusicIndex)/4)+bgm__First
00000000                            bgm_SLZ:	equ ((ptr_mus84-MusicIndex)/4)+bgm__First
00000000                            bgm_SYZ:	equ ((ptr_mus85-MusicIndex)/4)+bgm__First
00000000                            bgm_SBZ:	equ ((ptr_mus86-MusicIndex)/4)+bgm__First
00000000                            bgm_Invincible:	equ ((ptr_mus87-MusicIndex)/4)+bgm__First
00000000                            bgm_ExtraLife:	equ ((ptr_mus88-MusicIndex)/4)+bgm__First
00000000                            bgm_SS:		equ ((ptr_mus89-MusicIndex)/4)+bgm__First
00000000                            bgm_Title:	equ ((ptr_mus8A-MusicIndex)/4)+bgm__First
00000000                            bgm_Ending:	equ ((ptr_mus8B-MusicIndex)/4)+bgm__First
00000000                            bgm_Boss:	equ ((ptr_mus8C-MusicIndex)/4)+bgm__First
00000000                            bgm_FZ:		equ ((ptr_mus8D-MusicIndex)/4)+bgm__First
00000000                            bgm_GotThrough:	equ ((ptr_mus8E-MusicIndex)/4)+bgm__First
00000000                            bgm_GameOver:	equ ((ptr_mus8F-MusicIndex)/4)+bgm__First
00000000                            bgm_Continue:	equ ((ptr_mus90-MusicIndex)/4)+bgm__First
00000000                            bgm_Credits:	equ ((ptr_mus91-MusicIndex)/4)+bgm__First
00000000                            bgm_IMZ:	equ ((ptr_mus92-MusicIndex)/4)+bgm__First
00000000                            bgm_CSZ:	equ ((ptr_mus93-MusicIndex)/4)+bgm__First
00000000                            bgm__Last:	equ ((ptr_musend-MusicIndex-4)/4)+bgm__First
00000000                            
00000000                            ; Sound effects
00000000 =000000A0                  sfx__First:	equ $A0
00000000                            sfx_Jump:	equ ((ptr_sndA0-SoundIndex)/4)+sfx__First
00000000                            sfx_Lamppost:	equ ((ptr_sndA1-SoundIndex)/4)+sfx__First
00000000                            sfx_A2:		equ ((ptr_sndA2-SoundIndex)/4)+sfx__First
00000000                            sfx_Death:	equ ((ptr_sndA3-SoundIndex)/4)+sfx__First
00000000                            sfx_Skid:	equ ((ptr_sndA4-SoundIndex)/4)+sfx__First
00000000                            sfx_A5:		equ ((ptr_sndA5-SoundIndex)/4)+sfx__First
00000000                            sfx_HitSpikes:	equ ((ptr_sndA6-SoundIndex)/4)+sfx__First
00000000                            sfx_Push:	equ ((ptr_sndA7-SoundIndex)/4)+sfx__First
00000000                            sfx_SSGoal:	equ ((ptr_sndA8-SoundIndex)/4)+sfx__First
00000000                            sfx_SSItem:	equ ((ptr_sndA9-SoundIndex)/4)+sfx__First
00000000                            sfx_Splash:	equ ((ptr_sndAA-SoundIndex)/4)+sfx__First
00000000                            sfx_AB:		equ ((ptr_sndAB-SoundIndex)/4)+sfx__First
00000000                            sfx_HitBoss:	equ ((ptr_sndAC-SoundIndex)/4)+sfx__First
00000000                            sfx_Bubble:	equ ((ptr_sndAD-SoundIndex)/4)+sfx__First
00000000                            sfx_Fireball:	equ ((ptr_sndAE-SoundIndex)/4)+sfx__First
00000000                            sfx_Shield:	equ ((ptr_sndAF-SoundIndex)/4)+sfx__First
00000000                            sfx_Saw:	equ ((ptr_sndB0-SoundIndex)/4)+sfx__First
00000000                            sfx_Electric:	equ ((ptr_sndB1-SoundIndex)/4)+sfx__First
00000000                            sfx_Drown:	equ ((ptr_sndB2-SoundIndex)/4)+sfx__First
00000000                            sfx_Flamethrower:equ ((ptr_sndB3-SoundIndex)/4)+sfx__First
00000000                            sfx_Bumper:	equ ((ptr_sndB4-SoundIndex)/4)+sfx__First
00000000                            sfx_Ring:	equ ((ptr_sndB5-SoundIndex)/4)+sfx__First
00000000                            sfx_SpikesMove:	equ ((ptr_sndB6-SoundIndex)/4)+sfx__First
00000000                            sfx_Rumbling:	equ ((ptr_sndB7-SoundIndex)/4)+sfx__First
00000000                            sfx_B8:		equ ((ptr_sndB8-SoundIndex)/4)+sfx__First
00000000                            sfx_Collapse:	equ ((ptr_sndB9-SoundIndex)/4)+sfx__First
00000000                            sfx_SSGlass:	equ ((ptr_sndBA-SoundIndex)/4)+sfx__First
00000000                            sfx_Door:	equ ((ptr_sndBB-SoundIndex)/4)+sfx__First
00000000                            sfx_Teleport:	equ ((ptr_sndBC-SoundIndex)/4)+sfx__First
00000000                            sfx_ChainStomp:	equ ((ptr_sndBD-SoundIndex)/4)+sfx__First
00000000                            sfx_Roll:	equ ((ptr_sndBE-SoundIndex)/4)+sfx__First
00000000                            sfx_Continue:	equ ((ptr_sndBF-SoundIndex)/4)+sfx__First
00000000                            sfx_Basaran:	equ ((ptr_sndC0-SoundIndex)/4)+sfx__First
00000000                            sfx_BreakItem:	equ ((ptr_sndC1-SoundIndex)/4)+sfx__First
00000000                            sfx_Warning:	equ ((ptr_sndC2-SoundIndex)/4)+sfx__First
00000000                            sfx_GiantRing:	equ ((ptr_sndC3-SoundIndex)/4)+sfx__First
00000000                            sfx_Bomb:	equ ((ptr_sndC4-SoundIndex)/4)+sfx__First
00000000                            sfx_Cash:	equ ((ptr_sndC5-SoundIndex)/4)+sfx__First
00000000                            sfx_RingLoss:	equ ((ptr_sndC6-SoundIndex)/4)+sfx__First
00000000                            sfx_ChainRise:	equ ((ptr_sndC7-SoundIndex)/4)+sfx__First
00000000                            sfx_Burning:	equ ((ptr_sndC8-SoundIndex)/4)+sfx__First
00000000                            sfx_Bonus:	equ ((ptr_sndC9-SoundIndex)/4)+sfx__First
00000000                            sfx_EnterSS:	equ ((ptr_sndCA-SoundIndex)/4)+sfx__First
00000000                            sfx_WallSmash:	equ ((ptr_sndCB-SoundIndex)/4)+sfx__First
00000000                            sfx_Spring:	equ ((ptr_sndCC-SoundIndex)/4)+sfx__First
00000000                            sfx_Switch:	equ ((ptr_sndCD-SoundIndex)/4)+sfx__First
00000000                            sfx_RingLeft:	equ ((ptr_sndCE-SoundIndex)/4)+sfx__First
00000000                            sfx_Signpost:	equ ((ptr_sndCF-SoundIndex)/4)+sfx__First
00000000                            sfx__Last:	equ ((ptr_sndend-SoundIndex-4)/4)+sfx__First
00000000                            
00000000                            ; Special sound effects
00000000 =000000D0                  spec__First:	equ $D0
00000000                            sfx_Waterfall:	equ ((ptr_sndD0-SpecSoundIndex)/4)+spec__First
00000000                            spec__Last:	equ ((ptr_specend-SpecSoundIndex-4)/4)+spec__First
00000000                            
00000000 =000000E0                  flg__First:	equ $E0
00000000                            bgm_Fade:	equ ((ptr_flgE0-Sound_ExIndex)/4)+flg__First
00000000                            sfx_Sega:	equ ((ptr_flgE1-Sound_ExIndex)/4)+flg__First
00000000                            bgm_Speedup:	equ ((ptr_flgE2-Sound_ExIndex)/4)+flg__First
00000000                            bgm_Slowdown:	equ ((ptr_flgE3-Sound_ExIndex)/4)+flg__First
00000000                            bgm_Stop:	equ ((ptr_flgE4-Sound_ExIndex)/4)+flg__First
00000000                            flg__Last:	equ ((ptr_flgend-Sound_ExIndex-4)/4)+flg__First
00000000                            
00000000                            ; Sonic frame IDs
00000000 =00000000                  fr_Null:	equ 0
00000000 =00000001                  fr_Stand:	equ 1
00000000 =00000002                  fr_Wait1:	equ 2
00000000 =00000003                  fr_Wait2:	equ 3
00000000 =00000004                  fr_Wait3:	equ 4
00000000 =00000005                  fr_LookUp:	equ 5
00000000 =00000006                  fr_Walk11:	equ 6
00000000 =00000007                  fr_Walk12:	equ 7
00000000 =00000008                  fr_Walk13:	equ 8
00000000 =00000009                  fr_Walk14:	equ 9
00000000 =0000000A                  fr_Walk15:	equ $A
00000000 =0000000B                  fr_Walk16:	equ $B
00000000 =0000000C                  fr_Walk21:	equ $C
00000000 =0000000D                  fr_Walk22:	equ $D
00000000 =0000000E                  fr_Walk23:	equ $E
00000000 =0000000F                  fr_Walk24:	equ $F
00000000 =00000010                  fr_Walk25:	equ $10
00000000 =00000011                  fr_Walk26:	equ $11
00000000 =00000012                  fr_Walk31:	equ $12
00000000 =00000013                  fr_Walk32:	equ $13
00000000 =00000014                  fr_Walk33:	equ $14
00000000 =00000015                  fr_Walk34:	equ $15
00000000 =00000016                  fr_Walk35:	equ $16
00000000 =00000017                  fr_Walk36:	equ $17
00000000 =00000018                  fr_Walk41:	equ $18
00000000 =00000019                  fr_Walk42:	equ $19
00000000 =0000001A                  fr_Walk43:	equ $1A
00000000 =0000001B                  fr_Walk44:	equ $1B
00000000 =0000001C                  fr_Walk45:	equ $1C
00000000 =0000001D                  fr_Walk46:	equ $1D
00000000 =0000001E                  fr_Run11:	equ $1E
00000000 =0000001F                  fr_Run12:	equ $1F
00000000 =00000020                  fr_Run13:	equ $20
00000000 =00000021                  fr_Run14:	equ $21
00000000 =00000022                  fr_Run21:	equ $22
00000000 =00000023                  fr_Run22:	equ $23
00000000 =00000024                  fr_Run23:	equ $24
00000000 =00000025                  fr_Run24:	equ $25
00000000 =00000026                  fr_Run31:	equ $26
00000000 =00000027                  fr_Run32:	equ $27
00000000 =00000028                  fr_Run33:	equ $28
00000000 =00000029                  fr_Run34:	equ $29
00000000 =0000002A                  fr_Run41:	equ $2A
00000000 =0000002B                  fr_Run42:	equ $2B
00000000 =0000002C                  fr_Run43:	equ $2C
00000000 =0000002D                  fr_Run44:	equ $2D
00000000 =0000002E                  fr_Roll1:	equ $2E
00000000 =0000002F                  fr_Roll2:	equ $2F
00000000 =00000030                  fr_Roll3:	equ $30
00000000 =00000031                  fr_Roll4:	equ $31
00000000 =00000032                  fr_Roll5:	equ $32
00000000 =00000033                  fr_Warp1:	equ $33
00000000 =00000034                  fr_Warp2:	equ $34
00000000 =00000035                  fr_Warp3:	equ $35
00000000 =00000036                  fr_Warp4:	equ $36
00000000 =00000037                  fr_Stop1:	equ $37
00000000 =00000038                  fr_Stop2:	equ $38
00000000 =00000039                  fr_Duck:	equ $39
00000000 =0000003A                  fr_Balance1:	equ $3A
00000000 =0000003B                  fr_Balance2:	equ $3B
00000000 =0000003C                  fr_Float1:	equ $3C
00000000 =0000003D                  fr_Float2:	equ $3D
00000000 =0000003E                  fr_Float3:	equ $3E
00000000 =0000003F                  fr_Float4:	equ $3F
00000000 =00000040                  fr_Spring:	equ $40
00000000 =00000041                  fr_Hang1:	equ $41
00000000 =00000042                  fr_Hang2:	equ $42
00000000 =00000043                  fr_Leap1:	equ $43
00000000 =00000044                  fr_Leap2:	equ $44
00000000 =00000045                  fr_Push1:	equ $45
00000000 =00000046                  fr_Push2:	equ $46
00000000 =00000047                  fr_Push3:	equ $47
00000000 =00000048                  fr_Push4:	equ $48
00000000 =00000049                  fr_Surf:	equ $49
00000000 =0000004A                  fr_BubStand:	equ $4A
00000000 =0000004B                  fr_Burnt:	equ $4B
00000000 =0000004C                  fr_Drown:	equ $4C
00000000 =0000004D                  fr_Death:	equ $4D
00000000 =0000004E                  fr_Shrink1:	equ $4E
00000000 =0000004F                  fr_Shrink2:	equ $4F
00000000 =00000050                  fr_Shrink3:	equ $50
00000000 =00000051                  fr_Shrink4:	equ $51
00000000 =00000052                  fr_Shrink5:	equ $52
00000000 =00000053                  fr_Float5:	equ $53
00000000 =00000054                  fr_Float6:	equ $54
00000000 =00000055                  fr_Injury:	equ $55
00000000 =00000056                  fr_GetAir:	equ $56
00000000 =00000057                  fr_WaterSlide:	equ $57
00000000                            
00000000 =00000000                  _0 = $00
00000000 =00000001                  _1 = $01
00000000 =00000002                  _2 = $02                
00000000 =00000003                  _3 = $03                
00000000 =00000004                  _4 = $04                
00000000 =00000005                  _5 = $05                
00000000 =00000006                  _6 = $06                
00000000 =00000007                  _7 = $07                
00000000 =00000008                  _8 = $08                
00000000 =00000009                  _9 = $09                
00000000 =00000011                  _A = $11
00000000 =00000012                  _B = $12
00000000 =00000013                  _C = $13
00000000 =00000014                  _D = $14                
00000000 =00000015                  _E = $15
00000000 =00000016                  _F = $16
00000000 =00000017                  _G = $17
00000000 =00000018                  _H = $18
00000000 =00000019                  _I = $19
00000000 =0000001A                  _J = $1A
00000000 =0000001B                  _K = $1B
00000000 =0000001C                  _L = $1C
00000000 =0000001D                  _M = $1D
00000000 =0000001E                  _N = $1E
00000000 =0000001F                  _O = $1F
00000000 =00000020                  _P = $20
00000000 =00000021                  _Q = $21
00000000 =00000022                  _R = $22
00000000 =00000023                  _S = $23
00000000 =00000024                  _T = $24
00000000 =00000025                  _U = $25
00000000 =00000026                  _V = $26
00000000 =00000027                  _W = $27
00000000 =00000028                  _X = $28
00000000 =0000000F                  _Y = $0F
00000000 =00000010                  _Z = $10
00000000 =000000FF                  __ = $FF 
00000000 =000000FF                  __ = $FF 
00000000                            	include	"Variables.asm"
00000000                            ; Variables (v) and Flags (f)
00000000                            
00000000 =FFFFFC00                  v_regbuffer:	equ $FFFFFC00	; stores registers d0-a7 during an error event ($40 bytes)
00000000 =FFFFFC40                  v_spbuffer:	equ $FFFFFC40	; stores most recent sp address (4 bytes)
00000000 =FFFFFC44                  v_errortype:	equ $FFFFFC44	; error type
00000000                            
00000000 =00FF0000                  v_256x256:	equ   $FF0000	; 256x256 tile mappings ($A400 bytes)
00000000 =FFFFA400                  v_lvllayout:	equ $FFFFA400	; level and background layouts ($400 bytes)
00000000 =FFFFA800                  v_bgscroll_buffer:	equ	$FFFFA800	; background scroll buffer ($200 bytes)
00000000 =FFFFAA00                  v_ngfx_buffer:	equ $FFFFAA00	; Nemesis graphics decompression buffer ($200 bytes)
00000000 =FFFFAC00                  v_spritequeue:	equ $FFFFAC00	; sprite display queue, in order of priority ($400 bytes)
00000000 =FFFFB000                  v_16x16:		equ $FFFFB000	; 16x16 tile mappings
00000000                            
00000000 =FFFFC800                  v_sgfx_buffer:	equ $FFFFC800	; buffered Sonic graphics ($17 cells) ($2E0 bytes)
00000000 =FFFFCB00                  v_tracksonic:	equ $FFFFCB00	; position tracking data for Sonic ($100 bytes)
00000000 =FFFFCC00                  v_hscrolltablebuffer:	equ $FFFFCC00 ; scrolling table data (actually $380 bytes, but $400 is reserved for it)
00000000 =FFFFD000                  v_objspace:	equ $FFFFD000	; object variable space ($40 bytes per object) ($2000 bytes)
00000000 =FFFFD000                  v_player:	equ v_objspace	; object variable space for Sonic ($40 bytes)
00000000 =FFFFD800                  v_lvlobjspace:	equ $FFFFD800	; level object variable space ($1800 bytes)
00000000                            
00000000 =FFFFF000                  v_snddriver_ram:	equ $FFFFF000 ; start of RAM for the sound driver data ($5C0 bytes)
00000000                            
00000000                            ; =================================================================================
00000000                            ; From here on, until otherwise stated, all offsets are relative to v_snddriver_ram
00000000                            ; =================================================================================
00000000 =00000000                  v_startofvariables:	equ $000
00000000 =00000000                  v_sndprio:		equ $000	; sound priority (priority of new music/SFX must be higher or equal to this value or it won't play; bit 7 of priority being set prevents this value from changing)
00000000 =00000001                  v_main_tempo_timeout:	equ $001	; Counts down to zero; when zero, resets to next value and delays song by 1 frame
00000000 =00000002                  v_main_tempo:		equ $002	; Used for music only
00000000 =00000003                  f_pausemusic:		equ $003	; flag set to stop music when paused
00000000 =00000004                  v_fadeout_counter:	equ $004
00000000                            
00000000 =00000006                  v_fadeout_delay:	equ $006
00000000 =00000007                  v_communication_byte:	equ $007	; used in Ristar to sync with a boss' attacks; unused here
00000000 =00000008                  f_updating_dac:		equ $008	; $80 if updating DAC, $00 otherwise
00000000 =00000009                  v_sound_id:		equ $009	; sound or music copied from below
00000000 =0000000A                  v_soundqueue0:		equ $00A	; sound or music to play
00000000 =0000000B                  v_soundqueue1:		equ $00B	; special sound to play
00000000 =0000000C                  v_soundqueue2:		equ $00C	; unused sound to play
00000000                            
00000000 =0000000E                  f_voice_selector:	equ $00E	; $00 = use music voice pointer; $40 = use special voice pointer; $80 = use track voice pointer
00000000                            
00000000 =00000018                  v_voice_ptr:		equ $018	; voice data pointer (4 bytes)
00000000                            
00000000 =00000020                  v_special_voice_ptr:	equ $020	; voice data pointer for special SFX ($D0-$DF) (4 bytes)
00000000                            
00000000 =00000024                  f_fadein_flag:		equ $024	; Flag for fade in
00000000 =00000025                  v_fadein_delay:		equ $025
00000000 =00000026                  v_fadein_counter:	equ $026	; Timer for fade in/out
00000000 =00000027                  f_1up_playing:		equ $027	; flag indicating 1-up song is playing
00000000 =00000028                  v_tempo_mod:		equ $028	; music - tempo modifier
00000000 =00000029                  v_speeduptempo:		equ $029	; music - tempo modifier with speed shoes
00000000 =0000002A                  f_speedup:		equ $02A	; flag indicating whether speed shoes tempo is on ($80) or off ($00)
00000000 =0000002B                  v_ring_speaker:		equ $02B	; which speaker the "ring" sound is played in (00 = right; 01 = left)
00000000 =0000002C                  f_push_playing:		equ $02C	; if set, prevents further push sounds from playing
00000000                            
00000000 =00000040                  v_music_track_ram:	equ $040	; Start of music RAM
00000000                            
00000000 =00000040                  v_music_fmdac_tracks:	equ v_music_track_ram+TrackSz*0
00000000 =00000040                  v_music_dac_track:	equ v_music_fmdac_tracks+TrackSz*0
00000000 =00000070                  v_music_fm_tracks:	equ v_music_fmdac_tracks+TrackSz*1
00000000 =00000070                  v_music_fm1_track:	equ v_music_fm_tracks+TrackSz*0
00000000 =000000A0                  v_music_fm2_track:	equ v_music_fm_tracks+TrackSz*1
00000000 =000000D0                  v_music_fm3_track:	equ v_music_fm_tracks+TrackSz*2
00000000 =00000100                  v_music_fm4_track:	equ v_music_fm_tracks+TrackSz*3
00000000 =00000130                  v_music_fm5_track:	equ v_music_fm_tracks+TrackSz*4
00000000 =00000160                  v_music_fm6_track:	equ v_music_fm_tracks+TrackSz*5
00000000 =00000190                  v_music_fm_tracks_end:	equ v_music_fm_tracks+TrackSz*6
00000000 =00000190                  v_music_fmdac_tracks_end:	equ v_music_fm_tracks_end
00000000 =00000190                  v_music_psg_tracks:	equ v_music_fmdac_tracks_end
00000000 =00000190                  v_music_psg1_track:	equ v_music_psg_tracks+TrackSz*0
00000000 =000001C0                  v_music_psg2_track:	equ v_music_psg_tracks+TrackSz*1
00000000 =000001F0                  v_music_psg3_track:	equ v_music_psg_tracks+TrackSz*2
00000000 =00000220                  v_music_psg_tracks_end:	equ v_music_psg_tracks+TrackSz*3
00000000 =00000220                  v_music_track_ram_end:	equ v_music_psg_tracks_end
00000000                            
00000000 =00000220                  v_sfx_track_ram:	equ v_music_track_ram_end	; Start of SFX RAM, straight after the end of music RAM
00000000                            
00000000 =00000220                  v_sfx_fm_tracks:	equ v_sfx_track_ram+TrackSz*0
00000000 =00000220                  v_sfx_fm3_track:	equ v_sfx_fm_tracks+TrackSz*0
00000000 =00000250                  v_sfx_fm4_track:	equ v_sfx_fm_tracks+TrackSz*1
00000000 =00000280                  v_sfx_fm5_track:	equ v_sfx_fm_tracks+TrackSz*2
00000000 =000002B0                  v_sfx_fm_tracks_end:	equ v_sfx_fm_tracks+TrackSz*3
00000000 =000002B0                  v_sfx_psg_tracks:	equ v_sfx_fm_tracks_end
00000000 =000002B0                  v_sfx_psg1_track:	equ v_sfx_psg_tracks+TrackSz*0
00000000 =000002E0                  v_sfx_psg2_track:	equ v_sfx_psg_tracks+TrackSz*1
00000000 =00000310                  v_sfx_psg3_track:	equ v_sfx_psg_tracks+TrackSz*2
00000000 =00000340                  v_sfx_psg_tracks_end:	equ v_sfx_psg_tracks+TrackSz*3
00000000 =00000340                  v_sfx_track_ram_end:	equ v_sfx_psg_tracks_end
00000000                            
00000000 =00000340                  v_spcsfx_track_ram:	equ v_sfx_track_ram_end	; Start of special SFX RAM, straight after the end of SFX RAM
00000000                            
00000000 =00000340                  v_spcsfx_fm4_track:	equ v_spcsfx_track_ram+TrackSz*0
00000000 =00000370                  v_spcsfx_psg3_track:	equ v_spcsfx_track_ram+TrackSz*1
00000000 =000003A0                  v_spcsfx_track_ram_end:	equ v_spcsfx_track_ram+TrackSz*2
00000000                            
00000000 =000003A0                  v_1up_ram_copy:		equ v_spcsfx_track_ram_end
00000000                            
00000000                            ; =================================================================================
00000000                            ; From here on, no longer relative to sound driver RAM
00000000                            ; =================================================================================
00000000                            
00000000 =FFFFF600                  v_gamemode:	equ $FFFFF600	; game mode (00=Sega; 04=Title; 08=Demo; 0C=Level; 10=SS; 14=Cont; 18=End; 1C=Credit; +8C=PreLevel)
00000000 =FFFFF602                  v_jpadhold2:	equ $FFFFF602	; joypad input - held, duplicate
00000000 =FFFFF603                  v_jpadpress2:	equ $FFFFF603	; joypad input - pressed, duplicate
00000000 =FFFFF604                  v_jpadhold1:	equ $FFFFF604	; joypad input - held
00000000 =FFFFF605                  v_jpadpress1:	equ $FFFFF605	; joypad input - pressed
00000000                            
00000000 =FFFFF60C                  v_vdp_buffer1:	equ $FFFFF60C	; VDP instruction buffer (2 bytes)
00000000                            
00000000 =FFFFF614                  v_demolength:	equ $FFFFF614	; the length of a demo in frames (2 bytes)
00000000 =FFFFF616                  v_scrposy_dup:	equ $FFFFF616	; screen position y (duplicate) (2 bytes)
00000000 =FFFFF618                  v_bgscrposy_dup:	equ $FFFFF618	; background screen position y (duplicate) (2 bytes)
00000000 =FFFFF61A                  v_scrposx_dup:	equ $FFFFF61A	; screen position x (duplicate) (2 bytes)
00000000 =FFFFF61C                  v_bgscreenposx_dup_unused:	equ $FFFFF61C	; background screen position x (duplicate) (2 bytes)
00000000 =FFFFF61E                  v_bg3screenposy_dup_unused:	equ $FFFFF61E	; (2 bytes)
00000000 =FFFFF620                  v_bg3screenposx_dup_unused:	equ $FFFFF620	; (2 bytes)
00000000                            
00000000 =FFFFF624                  v_hbla_hreg:	equ $FFFFF624	; VDP H.interrupt register buffer (8Axx) (2 bytes)
00000000 =FFFFF625                  v_hbla_line:	equ $FFFFF625	; screen line where water starts and palette is changed by HBlank
00000000 =FFFFF626                  v_pfade_start:	equ $FFFFF626	; palette fading - start position in bytes
00000000 =FFFFF627                  v_pfade_size:	equ $FFFFF627	; palette fading - number of colours
00000000 =FFFFF62A                  v_vbla_routine:	equ $FFFFF62A	; VBlank - routine counter
00000000 =FFFFF62C                  v_spritecount:	equ $FFFFF62C	; number of sprites on-screen
00000000 =FFFFF632                  v_pcyc_num:	equ $FFFFF632	; palette cycling - current reference number (2 bytes)
00000000 =FFFFF634                  v_pcyc_time:	equ $FFFFF634	; palette cycling - time until the next change (2 bytes)
00000000 =FFFFF636                  v_random:	equ $FFFFF636	; pseudo random number buffer (4 bytes)
00000000 =FFFFF63A                  f_pause:		equ $FFFFF63A	; flag set to pause the game (2 bytes)
00000000 =FFFFF640                  v_vdp_buffer2:	equ $FFFFF640	; VDP instruction buffer (2 bytes)
00000000 =FFFFF644                  f_hbla_pal:	equ $FFFFF644	; flag set to change palette during HBlank (0000 = no; 0001 = change) (2 bytes)
00000000 =FFFFF646                  v_waterpos1:	equ $FFFFF646	; water height, actual (2 bytes)
00000000 =FFFFF648                  v_waterpos2:	equ $FFFFF648	; water height, ignoring sway (2 bytes)
00000000 =FFFFF64A                  v_waterpos3:	equ $FFFFF64A	; water height, next target (2 bytes)
00000000 =FFFFF64C                  f_water:		equ $FFFFF64C	; flag set for water
00000000 =FFFFF64D                  v_wtr_routine:	equ $FFFFF64D	; water event - routine counter
00000000 =FFFFF64E                  f_wtr_state:	equ $FFFFF64E	; water palette state when water is above/below the screen (00 = partly/all dry; 01 = all underwater)
00000000                            
00000000 =FFFFF650                  v_pal_buffer:	equ $FFFFF650	; palette data buffer (used for palette cycling) ($30 bytes)
00000000 =FFFFF680                  v_plc_buffer:	equ $FFFFF680	; pattern load cues buffer (maximum $10 PLCs) ($60 bytes)
00000000 =FFFFF6E0                  v_ptrnemcode:	equ $FFFFF6E0	; pointer for nemesis decompression code ($1502 or $150C) (4 bytes)
00000000                            
00000000 =FFFFF6F8                  f_plc_execute:	equ $FFFFF6F8	; flag set for pattern load cue execution (2 bytes)
00000000                            
00000000 =FFFFF700                  v_screenposx:	equ $FFFFF700	; screen position x (2 bytes)
00000000 =FFFFF704                  v_screenposy:	equ $FFFFF704	; screen position y (2 bytes)
00000000 =FFFFF708                  v_bgscreenposx:	equ $FFFFF708	; background screen position x (2 bytes)
00000000 =FFFFF70C                  v_bgscreenposy:	equ $FFFFF70C	; background screen position y (2 bytes)
00000000 =FFFFF710                  v_bg2screenposx:	equ $FFFFF710	; 2 bytes
00000000 =FFFFF714                  v_bg2screenposy:	equ $FFFFF714	; 2 bytes
00000000 =FFFFF718                  v_bg3screenposx:	equ $FFFFF718	; 2 bytes
00000000 =FFFFF71C                  v_bg3screenposy:	equ $FFFFF71C	; 2 bytes
00000000                            
00000000 =FFFFF720                  v_limitleft1:	equ $FFFFF720	; left level boundary (2 bytes)
00000000 =FFFFF722                  v_limitright1:	equ $FFFFF722	; right level boundary (2 bytes)
00000000 =FFFFF724                  v_limittop1:	equ $FFFFF724	; top level boundary (2 bytes)
00000000 =FFFFF726                  v_limitbtm1:	equ $FFFFF726	; bottom level boundary (2 bytes)
00000000 =FFFFF728                  v_limitleft2:	equ $FFFFF728	; left level boundary (2 bytes)
00000000 =FFFFF72A                  v_limitright2:	equ $FFFFF72A	; right level boundary (2 bytes)
00000000 =FFFFF72C                  v_limittop2:	equ $FFFFF72C	; top level boundary (2 bytes)
00000000 =FFFFF72E                  v_limitbtm2:	equ $FFFFF72E	; bottom level boundary (2 bytes)
00000000                            
00000000 =FFFFF732                  v_limitleft3:	equ $FFFFF732	; left level boundary, at the end of an act (2 bytes)
00000000                            
00000000 =FFFFF73A                  v_scrshiftx:	equ $FFFFF73A	; x-screen shift (new - last) * $100
00000000 =FFFFF73C                  v_scrshifty:	equ $FFFFF73C	; y-screen shift (new - last) * $100
00000000                            
00000000 =FFFFF73E                  v_lookshift:	equ $FFFFF73E	; screen shift when Sonic looks up/down (2 bytes)
00000000 =FFFFF742                  v_dle_routine:	equ $FFFFF742	; dynamic level event - routine counter
00000000 =FFFFF744                  f_nobgscroll:	equ $FFFFF744	; flag set to cancel background scrolling
00000000                            
00000000 =FFFFF74A                  v_fg_xblock:	equ	$FFFFF74A	; foreground x-block parity (for redraw)
00000000 =FFFFF74B                  v_fg_yblock:	equ	$FFFFF74B	; foreground y-block parity (for redraw)
00000000 =FFFFF74C                  v_bg1_xblock:	equ	$FFFFF74C	; background x-block parity (for redraw)
00000000 =FFFFF74D                  v_bg1_yblock:	equ	$FFFFF74D	; background y-block parity (for redraw)
00000000 =FFFFF74E                  v_bg2_xblock:	equ	$FFFFF74E	; secondary background x-block parity (for redraw)
00000000 =FFFFF74F                  v_bg2_yblock:	equ	$FFFFF74F	; secondary background y-block parity (unused)
00000000 =FFFFF750                  v_bg3_xblock:	equ	$FFFFF750	; teritary background x-block parity (for redraw)
00000000 =FFFFF751                  v_bg3_yblock:	equ	$FFFFF751	; teritary background y-block parity (unused)
00000000                            
00000000 =FFFFF754                  v_fg_scroll_flags:	equ $FFFFF754	; screen redraw flags for foreground
00000000 =FFFFF756                  v_bg1_scroll_flags:	equ $FFFFF756	; screen redraw flags for background 1
00000000 =FFFFF758                  v_bg2_scroll_flags:	equ $FFFFF758	; screen redraw flags for background 2
00000000 =FFFFF75A                  v_bg3_scroll_flags:	equ $FFFFF75A	; screen redraw flags for background 3
00000000 =FFFFF75C                  f_bgscrollvert:	equ $FFFFF75C	; flag for vertical background scrolling
00000000 =FFFFF760                  v_sonspeedmax:	equ $FFFFF760	; Sonic's maximum speed (2 bytes)
00000000 =FFFFF762                  v_sonspeedacc:	equ $FFFFF762	; Sonic's acceleration (2 bytes)
00000000 =FFFFF764                  v_sonspeeddec:	equ $FFFFF764	; Sonic's deceleration (2 bytes)
00000000 =FFFFF766                  v_sonframenum:	equ $FFFFF766	; frame to display for Sonic
00000000 =FFFFF767                  f_sonframechg:	equ $FFFFF767	; flag set to update Sonic's sprite frame
00000000 =FFFFF768                  v_anglebuffer:	equ $FFFFF768	; angle of collision block that Sonic or object is standing on
00000000                            
00000000 =FFFFF76C                  v_opl_routine:	equ $FFFFF76C	; ObjPosLoad - routine counter
00000000 =FFFFF76E                  v_opl_screen:	equ $FFFFF76E	; ObjPosLoad - screen variable
00000000 =FFFFF770                  v_opl_data:	equ $FFFFF770	; ObjPosLoad - data buffer ($10 bytes)
00000000                            
00000000 =FFFFF780                  v_ssangle:	equ $FFFFF780	; Special Stage angle (2 bytes)
00000000 =FFFFF782                  v_ssrotate:	equ $FFFFF782	; Special Stage rotation speed (2 bytes)
00000000 =FFFFF790                  v_btnpushtime1:	equ $FFFFF790	; button push duration - in level (2 bytes)
00000000 =FFFFF792                  v_btnpushtime2:	equ $FFFFF792	; button push duration - in demo (2 bytes)
00000000 =FFFFF794                  v_palchgspeed:	equ $FFFFF794	; palette fade/transition speed (0 is fastest) (2 bytes)
00000000 =FFFFF796                  v_collindex:	equ $FFFFF796	; ROM address for collision index of current level (4 bytes)
00000000 =FFFFF79A                  v_palss_num:	equ $FFFFF79A	; palette cycling in Special Stage - reference number (2 bytes)
00000000 =FFFFF79C                  v_palss_time:	equ $FFFFF79C	; palette cycling in Special Stage - time until next change (2 bytes)
00000000                            
00000000 =FFFFF7A4                  v_obj31ypos:	equ $FFFFF7A4	; y-position of object 31 (MZ stomper) (2 bytes)
00000000 =FFFFF7A7                  v_bossstatus:	equ $FFFFF7A7	; status of boss and prison capsule (01 = boss defeated; 02 = prison opened)
00000000 =FFFFF7A8                  v_trackpos:	equ $FFFFF7A8	; position tracking reference number (2 bytes)
00000000 =FFFFF7A9                  v_trackbyte:	equ $FFFFF7A9	; low byte for position tracking
00000000 =FFFFF7AA                  f_lockscreen:	equ $FFFFF7AA	; flag set to lock screen during bosses
00000000 =FFFFF7AC                  v_256loop1:	equ $FFFFF7AC	; 256x256 level tile which contains a loop (GHZ/SLZ)
00000000 =FFFFF7AD                  v_256loop2:	equ $FFFFF7AD	; 256x256 level tile which contains a loop (GHZ/SLZ)
00000000 =FFFFF7AE                  v_256roll1:	equ $FFFFF7AE	; 256x256 level tile which contains a roll tunnel (GHZ)
00000000 =FFFFF7AF                  v_256roll2:	equ $FFFFF7AF	; 256x256 level tile which contains a roll tunnel (GHZ)
00000000 =FFFFF7B0                  v_lani0_frame:	equ $FFFFF7B0	; level graphics animation 0 - current frame
00000000 =FFFFF7B1                  v_lani0_time:	equ $FFFFF7B1	; level graphics animation 0 - time until next frame
00000000 =FFFFF7B2                  v_lani1_frame:	equ $FFFFF7B2	; level graphics animation 1 - current frame
00000000 =FFFFF7B3                  v_lani1_time:	equ $FFFFF7B3	; level graphics animation 1 - time until next frame
00000000 =FFFFF7B4                  v_lani2_frame:	equ $FFFFF7B4	; level graphics animation 2 - current frame
00000000 =FFFFF7B5                  v_lani2_time:	equ $FFFFF7B5	; level graphics animation 2 - time until next frame
00000000 =FFFFF7B6                  v_lani3_frame:	equ $FFFFF7B6	; level graphics animation 3 - current frame
00000000 =FFFFF7B7                  v_lani3_time:	equ $FFFFF7B7	; level graphics animation 3 - time until next frame
00000000 =FFFFF7B8                  v_lani4_frame:	equ $FFFFF7B8	; level graphics animation 4 - current frame
00000000 =FFFFF7B9                  v_lani4_time:	equ $FFFFF7B9	; level graphics animation 4 - time until next frame
00000000 =FFFFF7BA                  v_lani5_frame:	equ $FFFFF7BA	; level graphics animation 5 - current frame
00000000 =FFFFF7BB                  v_lani5_time:	equ $FFFFF7BB	; level graphics animation 5 - time until next frame
00000000 =FFFFF7BE                  v_gfxbigring:	equ $FFFFF7BE	; settings for giant ring graphics loading (2 bytes)
00000000 =FFFFF7C0                  f_conveyrev:	equ $FFFFF7C0	; flag set to reverse conveyor belts in LZ/SBZ
00000000 =FFFFF7C1                  v_obj63:		equ $FFFFF7C1	; object 63 (LZ/SBZ platforms) variables (6 bytes)
00000000 =FFFFF7C7                  f_wtunnelmode:	equ $FFFFF7C7	; LZ water tunnel mode
00000000 =FFFFF7C8                  f_lockmulti:	equ $FFFFF7C8	; flag set to lock controls, lock Sonic's position & animation
00000000 =FFFFF7C9                  f_wtunnelallow:	equ $FFFFF7C9	; LZ water tunnels (00 = enabled; 01 = disabled)
00000000 =FFFFF7CA                  f_jumponly:	equ $FFFFF7CA	; flag set to lock controls apart from jumping
00000000 =FFFFF7CB                  v_obj6B:		equ $FFFFF7CB	; object 6B (SBZ stomper) variable
00000000 =FFFFF7CC                  f_lockctrl:	equ $FFFFF7CC	; flag set to lock controls during ending sequence
00000000 =FFFFF7CD                  f_bigring:	equ $FFFFF7CD	; flag set when Sonic collects the giant ring
00000000 =FFFFF7D0                  v_itembonus:	equ $FFFFF7D0	; item bonus from broken enemies, blocks etc. (2 bytes)
00000000 =FFFFF7D2                  v_timebonus:	equ $FFFFF7D2	; time bonus at the end of an act (2 bytes)
00000000 =FFFFF7D4                  v_ringbonus:	equ $FFFFF7D4	; ring bonus at the end of an act (2 bytes)
00000000 =FFFFF7D6                  f_endactbonus:	equ $FFFFF7D6	; time/ring bonus update flag at the end of an act
00000000 =FFFFF7D7                  v_sonicend:	equ $FFFFF7D7	; routine counter for Sonic in the ending sequence
00000000 =FFFFF7D8                  v_lz_deform:	equ	$FFFFF7D8	; LZ deformtaion offset, in units of $80 (2 bytes)
00000000 =FFFFF7E0                  f_switch:	equ $FFFFF7E0	; flags set when Sonic stands on a switch ($10 bytes)
00000000 =FFFFF7F0                  v_scroll_block_1_size:	equ $FFFFF7F0	; (2 bytes)
00000000 =FFFFF7F2                  v_scroll_block_2_size:	equ $FFFFF7F2	; unused (2 bytes)
00000000 =FFFFF7F4                  v_scroll_block_3_size:	equ $FFFFF7F4	; unused (2 bytes)
00000000 =FFFFF7F6                  v_scroll_block_4_size:	equ $FFFFF7F6	; unused (2 bytes)
00000000                            
00000000 =FFFFF800                  v_spritetablebuffer:	equ $FFFFF800 ; sprite table ($280 bytes, last $80 bytes are overwritten by v_pal_water_dup)
00000000 =FFFFFA00                  v_pal_water_dup:	equ $FFFFFA00 ; duplicate underwater palette, used for transitions ($80 bytes)
00000000 =FFFFFA80                  v_pal_water:	equ $FFFFFA80	; main underwater palette ($80 bytes)
00000000 =FFFFFB00                  v_pal_dry:	equ $FFFFFB00	; main palette ($80 bytes)
00000000 =FFFFFB80                  v_pal_dry_dup:	equ $FFFFFB80	; duplicate palette, used for transitions ($80 bytes)
00000000 =FFFFFC00                  v_objstate:	equ $FFFFFC00	; object state list ($200 bytes)
00000000                            
00000000                            
00000000 =FFFFFE00                  v_systemstack:	equ $FFFFFE00
00000000 =FFFFFE02                  f_restart:	equ $FFFFFE02	; restart level flag (2 bytes)
00000000 =FFFFFE04                  v_framecount:	equ $FFFFFE04	; frame counter (adds 1 every frame) (2 bytes)
00000000 =FFFFFE05                  v_framebyte:	equ v_framecount+1; low byte for frame counter
00000000 =FFFFFE06                  v_debugitem:	equ $FFFFFE06	; debug item currently selected (NOT the object number of the item)
00000000 =FFFFFE08                  v_debuguse:	equ $FFFFFE08	; debug mode use & routine counter (when Sonic is a ring/item) (2 bytes)
00000000 =FFFFFE0A                  v_debugxspeed:	equ $FFFFFE0A	; debug mode - horizontal speed
00000000 =FFFFFE0B                  v_debugyspeed:	equ $FFFFFE0B	; debug mode - vertical speed
00000000 =FFFFFE0C                  v_vbla_count:	equ $FFFFFE0C	; vertical interrupt counter (adds 1 every VBlank) (4 bytes)
00000000 =FFFFFE0E                  v_vbla_word:	equ v_vbla_count+2 ; low word for vertical interrupt counter (2 bytes)
00000000 =FFFFFE0F                  v_vbla_byte:	equ v_vbla_word+1	; low byte for vertical interrupt counter
00000000 =FFFFFE10                  v_zone:		equ $FFFFFE10	; current zone number
00000000 =FFFFFE11                  v_act:		equ $FFFFFE11	; current act number
00000000 =FFFFFE12                  v_lives:		equ $FFFFFE12	; number of lives
00000000 =FFFFFE14                  v_air:		equ $FFFFFE14	; air remaining while underwater (2 bytes)
00000000 =FFFFFE15                  v_airbyte:	equ v_air+1	; low byte for air
00000000 =FFFFFE16                  v_lastspecial:	equ $FFFFFE16	; last special stage number
00000000 =FFFFFE18                  v_continues:	equ $FFFFFE18	; number of continues
00000000 =FFFFFE1A                  f_timeover:	equ $FFFFFE1A	; time over flag
00000000 =FFFFFE1B                  v_lifecount:	equ $FFFFFE1B	; lives counter value (for actual number, see "v_lives")
00000000 =FFFFFE1C                  f_lifecount:	equ $FFFFFE1C	; lives counter update flag
00000000 =FFFFFE1D                  f_ringcount:	equ $FFFFFE1D	; ring counter update flag
00000000 =FFFFFE1E                  f_timecount:	equ $FFFFFE1E	; time counter update flag
00000000 =FFFFFE1F                  f_scorecount:	equ $FFFFFE1F	; score counter update flag
00000000 =FFFFFE20                  v_rings:		equ $FFFFFE20	; rings (2 bytes)
00000000 =FFFFFE21                  v_ringbyte:	equ v_rings+1	; low byte for rings
00000000 =FFFFFE22                  v_time:		equ $FFFFFE22	; time (4 bytes)
00000000 =FFFFFE23                  v_timemin:	equ $FFFFFE23	; time - minutes
00000000 =FFFFFE24                  v_timesec:	equ $FFFFFE24	; time - seconds
00000000 =FFFFFE25                  v_timecent:	equ $FFFFFE25	; time - centiseconds
00000000 =FFFFFE26                  v_score:		equ $FFFFFE26	; score (4 bytes)
00000000 =FFFFFE2C                  v_shield:	equ $FFFFFE2C	; shield status (00 = no; 01 = yes)
00000000 =FFFFFE2D                  v_invinc:	equ $FFFFFE2D	; invinciblity status (00 = no; 01 = yes)
00000000 =FFFFFE2E                  v_shoes:		equ $FFFFFE2E	; speed shoes status (00 = no; 01 = yes)
00000000 =FFFFFE30                  v_lastlamp:	equ $FFFFFE30	; number of the last lamppost you hit
00000000 =FFFFFE32                  v_lamp_xpos:	equ v_lastlamp+2	; x-axis for Sonic to respawn at lamppost (2 bytes)
00000000 =FFFFFE34                  v_lamp_ypos:	equ v_lastlamp+4	; y-axis for Sonic to respawn at lamppost (2 bytes)
00000000 =FFFFFE36                  v_lamp_rings:	equ v_lastlamp+6	; rings stored at lamppost (2 bytes)
00000000 =FFFFFE38                  v_lamp_time:	equ v_lastlamp+8	; time stored at lamppost (2 bytes)
00000000 =FFFFFE3C                  v_lamp_dle:	equ v_lastlamp+$C	; dynamic level event routine counter at lamppost
00000000 =FFFFFE3E                  v_lamp_limitbtm:	equ v_lastlamp+$E	; level bottom boundary at lamppost (2 bytes)
00000000 =FFFFFE40                  v_lamp_scrx:	equ v_lastlamp+$10 ; x-axis screen at lamppost (2 bytes)
00000000 =FFFFFE42                  v_lamp_scry:	equ v_lastlamp+$12 ; y-axis screen at lamppost (2 bytes)
00000000                            
00000000 =FFFFFE50                  v_lamp_wtrpos:	equ v_lastlamp+$20 ; water position at lamppost (2 bytes)
00000000 =FFFFFE52                  v_lamp_wtrrout:	equ v_lastlamp+$22 ; water routine at lamppost
00000000 =FFFFFE53                  v_lamp_wtrstat:	equ v_lastlamp+$23 ; water state at lamppost
00000000 =FFFFFE54                  v_lamp_lives:	equ v_lastlamp+$24 ; lives counter at lamppost
00000000 =FFFFFE57                  v_emeralds:	equ $FFFFFE57	; number of chaos emeralds
00000000 =FFFFFE58                  v_emldlist:	equ $FFFFFE58	; which individual emeralds you have (00 = no; 01 = yes) (6 bytes)
00000000 =FFFFFE5E                  v_oscillate:	equ $FFFFFE5E	; values which oscillate - for swinging platforms, et al ($42 bytes)
00000000 =FFFFFEC0                  v_ani0_time:	equ $FFFFFEC0	; synchronised sprite animation 0 - time until next frame (used for synchronised animations)
00000000 =FFFFFEC1                  v_ani0_frame:	equ $FFFFFEC1	; synchronised sprite animation 0 - current frame
00000000 =FFFFFEC2                  v_ani1_time:	equ $FFFFFEC2	; synchronised sprite animation 1 - time until next frame
00000000 =FFFFFEC3                  v_ani1_frame:	equ $FFFFFEC3	; synchronised sprite animation 1 - current frame
00000000 =FFFFFEC4                  v_ani2_time:	equ $FFFFFEC4	; synchronised sprite animation 2 - time until next frame
00000000 =FFFFFEC5                  v_ani2_frame:	equ $FFFFFEC5	; synchronised sprite animation 2 - current frame
00000000 =FFFFFEC6                  v_ani3_time:	equ $FFFFFEC6	; synchronised sprite animation 3 - time until next frame
00000000 =FFFFFEC7                  v_ani3_frame:	equ $FFFFFEC7	; synchronised sprite animation 3 - current frame
00000000 =FFFFFEC8                  v_ani3_buf:	equ $FFFFFEC8	; synchronised sprite animation 3 - info buffer (2 bytes)
00000000 =FFFFFEF0                  v_limittopdb:	equ $FFFFFEF0	; level upper boundary, buffered for debug mode (2 bytes)
00000000 =FFFFFEF2                  v_limitbtmdb:	equ $FFFFFEF2	; level bottom boundary, buffered for debug mode (2 bytes)
00000000                            
00000000 =FFFFFF10                  v_screenposx_dup:	equ $FFFFFF10	; screen position x (duplicate) (2 bytes)
00000000 =FFFFFF14                  v_screenposy_dup:	equ $FFFFFF14	; screen position y (duplicate) (2 bytes)
00000000 =FFFFFF18                  v_bgscreenposx_dup:	equ $FFFFFF18	; background screen position x (duplicate) (2 bytes)
00000000 =FFFFFF1C                  v_bgscreenposy_dup:	equ $FFFFFF1C	; background screen position y (duplicate) (2 bytes)
00000000 =FFFFFF20                  v_bg2screenposx_dup:	equ $FFFFFF20	; 2 bytes
00000000 =FFFFFF24                  v_bg2screenposy_dup:	equ $FFFFFF24	; 2 bytes
00000000 =FFFFFF28                  v_bg3screenposx_dup:	equ $FFFFFF28	; 2 bytes
00000000 =FFFFFF2C                  v_bg3screenposy_dup:	equ $FFFFFF2C	; 2 bytes
00000000 =FFFFFF30                  v_fg_scroll_flags_dup:	equ $FFFFFF30
00000000 =FFFFFF32                  v_bg1_scroll_flags_dup:	equ $FFFFFF32
00000000 =FFFFFF34                  v_bg2_scroll_flags_dup:	equ $FFFFFF34
00000000 =FFFFFF36                  v_bg3_scroll_flags_dup:	equ $FFFFFF36
00000000                            
00000000 =FFFFFF80                  v_levseldelay:	equ $FFFFFF80	; level select - time until change when up/down is held (2 bytes)
00000000 =FFFFFF82                  v_levselitem:	equ $FFFFFF82	; level select - item selected (2 bytes)
00000000 =FFFFFF84                  v_levselsound:	equ $FFFFFF84	; level select - sound selected (2 bytes)
00000000 =FFFFFFC0                  v_scorecopy:	equ $FFFFFFC0	; score, duplicate (4 bytes)
00000000 =FFFFFFC0                  v_scorelife:	equ $FFFFFFC0	; points required for an extra life (4 bytes) (JP1 only)
00000000 =FFFFFFC4                  v_health:	equ $FFFFFFC4 ; health variable ; upon 0, you hit death. Default is 3. Max is 5.
00000000 =FFFFFFC6                  f_healthcount:	equ $FFFFFFC6 ; health counter flag
00000000 =FFFFF608                  f_levselcheat:	equ $FFFFF608	; level select cheat flag
00000000 =FFFFFFE1                  f_slomocheat:	equ $FFFFFFE1	; slow motion & frame advance cheat flag
00000000 =FFFFFFE2                  f_debugcheat:	equ $FFFFFFE2	; debug mode cheat flag
00000000 =FFFFFFE3                  f_creditscheat:	equ $FFFFFFE3	; hidden credits & press start cheat flag
00000000 =FFFFFFE4                  v_title_dcount:	equ $FFFFFFE4	; number of times the d-pad is pressed on title screen (2 bytes)
00000000 =FFFFFFE6                  v_title_ccount:	equ $FFFFFFE6	; number of times C is pressed on title screen (2 bytes)
00000000                            
00000000 =FFFFFFF0                  f_demo:		equ $FFFFFFF0	; demo mode flag (0 = no; 1 = yes; $8001 = ending) (2 bytes)
00000000 =FFFFFFF2                  v_demonum:	equ $FFFFFFF2	; demo level number (not the same as the level number) (2 bytes)
00000000 =FFFFFFF4                  v_creditsnum:	equ $FFFFFFF4	; credits index number (2 bytes)
00000000 =FFFFFFF8                  v_megadrive:	equ $FFFFFFF8	; Megadrive machine type
00000000 =FFFFFFFA                  f_debugmode:	equ $FFFFFFFA	; debug mode flag (sometimes 2 bytes)
00000000 =FFFFFFFC                  v_init:		equ $FFFFFFFC	; 'init' text string (4 bytes)
00000000 =FFFFFF39                  f_dash:		equ $FFFFFF39
00000000 =FFFFFF39                  f_dash:		equ $FFFFFF39
00000000                            	include	"Macros.asm"
00000000                            ; ---------------------------------------------------------------------------
00000000                            ; Align and pad
00000000                            ; input: length to align to, value to use as padding (default is 0)
00000000                            ; ---------------------------------------------------------------------------
00000000                            
00000000                            align:	macro
00000000                            	if (narg=1)
00000000                            	dcb.b \1-(*%\1),0
00000000                            	else
00000000                            	dcb.b \1-(*%\1),\2
00000000                            	endc
00000000                            	endm
00000000                            
00000000                            ; ---------------------------------------------------------------------------
00000000                            ; Set a VRAM address via the VDP control port.
00000000                            ; input: 16-bit VRAM address, control port (default is ($C00004).l)
00000000                            ; ---------------------------------------------------------------------------
00000000                            
00000000                            locVRAM:	macro loc,controlport
00000000                            		if (narg=1)
00000000                            		move.l	#($40000000+((loc&$3FFF)<<16)+((loc&$C000)>>14)),(vdp_control_port).l
00000000                            		else
00000000                            		move.l	#($40000000+((loc&$3FFF)<<16)+((loc&$C000)>>14)),controlport
00000000                            		endc
00000000                            		endm
00000000                            
00000000                            ; ---------------------------------------------------------------------------
00000000                            ; DMA copy data from 68K (ROM/RAM) to the VRAM
00000000                            ; input: source, length, destination
00000000                            ; ---------------------------------------------------------------------------
00000000                            
00000000                            writeVRAM:	macro
00000000                            		lea	(vdp_control_port).l,a5
00000000                            		move.l	#$94000000+(((\2>>1)&$FF00)<<8)+$9300+((\2>>1)&$FF),(a5)
00000000                            		move.l	#$96000000+(((\1>>1)&$FF00)<<8)+$9500+((\1>>1)&$FF),(a5)
00000000                            		move.w	#$9700+((((\1>>1)&$FF0000)>>16)&$7F),(a5)
00000000                            		move.w	#$4000+(\3&$3FFF),(a5)
00000000                            		move.w	#$80+((\3&$C000)>>14),(v_vdp_buffer2).w
00000000                            		move.w	(v_vdp_buffer2).w,(a5)
00000000                            		endm
00000000                            
00000000                            ; ---------------------------------------------------------------------------
00000000                            ; DMA copy data from 68K (ROM/RAM) to the CRAM
00000000                            ; input: source, length, destination
00000000                            ; ---------------------------------------------------------------------------
00000000                            
00000000                            writeCRAM:	macro
00000000                            		lea	(vdp_control_port).l,a5
00000000                            		move.l	#$94000000+(((\2>>1)&$FF00)<<8)+$9300+((\2>>1)&$FF),(a5)
00000000                            		move.l	#$96000000+(((\1>>1)&$FF00)<<8)+$9500+((\1>>1)&$FF),(a5)
00000000                            		move.w	#$9700+((((\1>>1)&$FF0000)>>16)&$7F),(a5)
00000000                            		move.w	#$C000+(\3&$3FFF),(a5)
00000000                            		move.w	#$80+((\3&$C000)>>14),(v_vdp_buffer2).w
00000000                            		move.w	(v_vdp_buffer2).w,(a5)
00000000                            		endm
00000000                            
00000000                            ; ---------------------------------------------------------------------------
00000000                            ; DMA fill VRAM with a value
00000000                            ; input: value, length, destination
00000000                            ; ---------------------------------------------------------------------------
00000000                            
00000000                            fillVRAM:	macro value,length,loc
00000000                            		lea	(vdp_control_port).l,a5
00000000                            		move.w	#$8F01,(a5)
00000000                            		move.l	#$94000000+((length&$FF00)<<8)+$9300+(length&$FF),(a5)
00000000                            		move.w	#$9780,(a5)
00000000                            		move.l	#$40000080+((loc&$3FFF)<<16)+((loc&$C000)>>14),(a5)
00000000                            		move.w	#value,(vdp_data_port).l
00000000                            		endm
00000000                            
00000000                            ; ---------------------------------------------------------------------------
00000000                            ; Copy a tilemap from 68K (ROM/RAM) to the VRAM without using DMA
00000000                            ; input: source, destination, width [cells], height [cells]
00000000                            ; ---------------------------------------------------------------------------
00000000                            
00000000                            copyTilemap:	macro source,loc,width,height
00000000                            		lea	(source).l,a1
00000000                            		move.l	#$40000000+((loc&$3FFF)<<16)+((loc&$C000)>>14),d0
00000000                            		moveq	#width,d1
00000000                            		moveq	#height,d2
00000000                            		bsr.w	TilemapToVRAM
00000000                            		endm
00000000                            
00000000                            ; ---------------------------------------------------------------------------
00000000                            ; stop the Z80
00000000                            ; ---------------------------------------------------------------------------
00000000                            
00000000                            stopZ80:	macro
00000000                            		move.w	#$100,(z80_bus_request).l
00000000                            		endm
00000000                            
00000000                            ; ---------------------------------------------------------------------------
00000000                            ; wait for Z80 to stop
00000000                            ; ---------------------------------------------------------------------------
00000000                            
00000000                            waitZ80:	macro
00000000                            	@wait:	btst	#0,(z80_bus_request).l
00000000                            		bne.s	@wait
00000000                            		endm
00000000                            
00000000                            ; ---------------------------------------------------------------------------
00000000                            ; reset the Z80
00000000                            ; ---------------------------------------------------------------------------
00000000                            
00000000                            resetZ80:	macro
00000000                            		move.w	#$100,(z80_reset).l
00000000                            		endm
00000000                            
00000000                            resetZ80a:	macro
00000000                            		move.w	#0,(z80_reset).l
00000000                            		endm
00000000                            
00000000                            ; ---------------------------------------------------------------------------
00000000                            ; start the Z80
00000000                            ; ---------------------------------------------------------------------------
00000000                            
00000000                            startZ80:	macro
00000000                            		move.w	#0,(z80_bus_request).l
00000000                            		endm
00000000                            
00000000                            ; ---------------------------------------------------------------------------
00000000                            ; disable interrupts
00000000                            ; ---------------------------------------------------------------------------
00000000                            
00000000                            disable_ints:	macro
00000000                            		move	#$2700,sr
00000000                            		endm
00000000                            
00000000                            ; ---------------------------------------------------------------------------
00000000                            ; enable interrupts
00000000                            ; ---------------------------------------------------------------------------
00000000                            
00000000                            enable_ints:	macro
00000000                            		move	#$2300,sr
00000000                            		endm
00000000                            
00000000                            ; ---------------------------------------------------------------------------
00000000                            ; long conditional jumps
00000000                            ; ---------------------------------------------------------------------------
00000000                            
00000000                            jhi:		macro loc
00000000                            		bls.s	@nojump
00000000                            		jmp	loc
00000000                            	@nojump:
00000000                            		endm
00000000                            
00000000                            jcc:		macro loc
00000000                            		bcs.s	@nojump
00000000                            		jmp	loc
00000000                            	@nojump:
00000000                            		endm
00000000                            
00000000                            jhs:		macro loc
00000000                            		jcc	loc
00000000                            		endm
00000000                            
00000000                            jls:		macro loc
00000000                            		bhi.s	@nojump
00000000                            		jmp	loc
00000000                            	@nojump:
00000000                            		endm
00000000                            
00000000                            jcs:		macro loc
00000000                            		bcc.s	@nojump
00000000                            		jmp	loc
00000000                            	@nojump:
00000000                            		endm
00000000                            
00000000                            jlo:		macro loc
00000000                            		jcs	loc
00000000                            		endm
00000000                            
00000000                            jeq:		macro loc
00000000                            		bne.s	@nojump
00000000                            		jmp	loc
00000000                            	@nojump:
00000000                            		endm
00000000                            
00000000                            jne:		macro loc
00000000                            		beq.s	@nojump
00000000                            		jmp	loc
00000000                            	@nojump:
00000000                            		endm
00000000                            
00000000                            jgt:		macro loc
00000000                            		ble.s	@nojump
00000000                            		jmp	loc
00000000                            	@nojump:
00000000                            		endm
00000000                            
00000000                            jge:		macro loc
00000000                            		blt.s	@nojump
00000000                            		jmp	loc
00000000                            	@nojump:
00000000                            		endm
00000000                            
00000000                            jle:		macro loc
00000000                            		bgt.s	@nojump
00000000                            		jmp	loc
00000000                            	@nojump:
00000000                            		endm
00000000                            
00000000                            jlt:		macro loc
00000000                            		bge.s	@nojump
00000000                            		jmp	loc
00000000                            	@nojump:
00000000                            		endm
00000000                            
00000000                            jpl:		macro loc
00000000                            		bmi.s	@nojump
00000000                            		jmp	loc
00000000                            	@nojump:
00000000                            		endm
00000000                            
00000000                            jmi:		macro loc
00000000                            		bpl.s	@nojump
00000000                            		jmp	loc
00000000                            	@nojump:
00000000                            		endm
00000000                            
00000000                            ; ---------------------------------------------------------------------------
00000000                            ; check if object moves out of range
00000000                            ; input: location to jump to if out of range, x-axis pos (obX(a0) by default)
00000000                            ; ---------------------------------------------------------------------------
00000000                            
00000000                            out_of_range:	macro exit,pos
00000000                            		if (narg=2)
00000000                            		move.w	pos,d0		; get object position (if specified as not obX)
00000000                            		else
00000000                            		move.w	obX(a0),d0	; get object position
00000000                            		endc
00000000                            		andi.w	#$FF80,d0	; round down to nearest $80
00000000                            		move.w	(v_screenposx).w,d1 ; get screen position
00000000                            		subi.w	#128,d1
00000000                            		andi.w	#$FF80,d1
00000000                            		sub.w	d1,d0		; approx distance between object and screen
00000000                            		cmpi.w	#128+320+192,d0
00000000                            		bhi.\0	exit
00000000                            		endm
00000000                            
00000000                            ; ---------------------------------------------------------------------------
00000000                            ; play a sound effect or music
00000000                            ; input: track, terminate routine, branch or jump, move operand size
00000000                            ; ---------------------------------------------------------------------------
00000000                            
00000000                            music:		macro track,terminate,branch,byte
00000000                            		  if OptimiseSound=1
00000000                            			move.b	#track,(v_snddriver_ram+v_playsnd1).l
00000000                            		    if terminate=1
00000000                            			rts
00000000                            		    endc
00000000                            		  else
00000000                            	 	    if byte=1
00000000                            			move.b	#track,d0
00000000                            		    else
00000000                            			move.w	#track,d0
00000000                            		    endc
00000000                            		    if branch=1
00000000                            		      if terminate=0
00000000                            			bsr.w	PlaySound
00000000                            		      else
00000000                            			bra.w	PlaySound
00000000                            		      endc
00000000                            		    else
00000000                            		      if terminate=0
00000000                            			jsr	(PlaySound).l
00000000                            		      else
00000000                            			jmp	(PlaySound).l
00000000                            		      endc
00000000                            		    endc
00000000                            		  endc
00000000                            		endm
00000000                            
00000000                            sfx:		macro track,terminate,branch,byte
00000000                            		  if OptimiseSound=1
00000000                            			move.b	#track,(v_snddriver_ram+v_playsnd2).l
00000000                            		    if terminate=1
00000000                            			rts
00000000                            		    endc
00000000                            		  else
00000000                            	 	    if byte=1
00000000                            			move.b	#track,d0
00000000                            		    else
00000000                            			move.w	#track,d0
00000000                            		    endc
00000000                            		    if branch=1
00000000                            		      if terminate=0
00000000                            			bsr.w	PlaySound_Special
00000000                            		      else
00000000                            			bra.w	PlaySound_Special
00000000                            		      endc
00000000                            		    else
00000000                            		      if terminate=0
00000000                            			jsr	(PlaySound_Special).l
00000000                            		      else
00000000                            			jmp	(PlaySound_Special).l
00000000                            		      endc
00000000                            		    endc
00000000                            		  endc
00000000                            		endm
00000000                            
00000000                            ; ---------------------------------------------------------------------------
00000000                            ; bankswitch between SRAM and ROM
00000000                            ; (remember to enable SRAM in the header first!)
00000000                            ; ---------------------------------------------------------------------------
00000000                            
00000000                            gotoSRAM:	macro
00000000                            		move.b  #1,($A130F1).l
00000000                            		endm
00000000                            
00000000                            gotoROM:	macro
00000000                            		move.b  #0,($A130F1).l
00000000                            		endm
00000000                            
00000000                            ; ---------------------------------------------------------------------------
00000000                            ; compare the size of an index with ZoneCount constant
00000000                            ; (should be used immediately after the index)
00000000                            ; input: index address, element size
00000000                            ; ---------------------------------------------------------------------------
00000000                            
00000000                            zonewarning:	macro loc,elementsize
00000000                            	@end:
00000000                            		if (@end-loc)-(ZoneCount*elementsize)<>0
00000000                            		inform 1,"Size of \loc ($%h) does not match ZoneCount ($\#ZoneCount).",(@end-loc)/elementsize
00000000                            		endc
00000000                            		endm
00000000                            		endm
00000000                            	include "_smps2asm_inc.asm"
00000000                            ; =============================================================================================
00000000                            ; Created by Flamewing, based on S1SMPS2ASM version 1.1 by Marc Gordon (AKA Cinossu)
00000000                            ; =============================================================================================
00000000 =00000005                  SonicDriverVer:	equ	5
00000000                            align0	macro	val
00000000                            	cnop	0,\val
00000000                                endm
00000000                            	
00000000                            smpsWeirdD1LRR macro
00000000                            		dc.b	$F9
00000000                            	endm
00000000                            ; ---------------------------------------------------------------------------------------------
00000000                            ; Standard Octave Pitch Equates
00000000 =FFFFFF88                  smpsPitch10lo:	EQU -120	; $88
00000000 =FFFFFF94                  smpsPitch09lo:	EQU -108	; $94
00000000 =FFFFFFA0                  smpsPitch08lo:	EQU  -96	; $A0
00000000 =FFFFFFAC                  smpsPitch07lo:	EQU  -84	; $AC
00000000 =FFFFFFB8                  smpsPitch06lo:	EQU  -72	; $B8
00000000 =FFFFFFC4                  smpsPitch05lo:	EQU  -60	; $C4
00000000 =FFFFFFD0                  smpsPitch04lo:	EQU  -48	; $D0
00000000 =FFFFFFDC                  smpsPitch03lo:	EQU  -36	; $DC
00000000 =FFFFFFE8                  smpsPitch02lo:	EQU  -24	; $E8
00000000 =FFFFFFF4                  smpsPitch01lo:	EQU  -12	; $F4
00000000 =00000000                  smpsPitch00:	EQU    0	; $00
00000000 =0000000C                  smpsPitch01hi:	EQU  +12	; $0C
00000000 =00000018                  smpsPitch02hi:	EQU  +24	; $18
00000000 =00000024                  smpsPitch03hi:	EQU  +36	; $24
00000000 =00000030                  smpsPitch04hi:	EQU  +48	; $30
00000000 =0000003C                  smpsPitch05hi:	EQU  +60	; $3C
00000000 =00000048                  smpsPitch06hi:	EQU  +72	; $48
00000000 =00000054                  smpsPitch07hi:	EQU  +84	; $54
00000000 =00000060                  smpsPitch08hi:	EQU  +96	; $60
00000000 =0000006C                  smpsPitch09hi:	EQU +108	; $6C
00000000 =00000078                  smpsPitch10hi:	EQU +120	; $78
00000000                            
00000000                            ; ---------------------------------------------------------------------------------------------
00000000                            ; Note Equates
00000000 =00000080                  nRst:	EQU $80		; $80
00000000 =00000081                  nC0:	EQU $81		; $81
00000000 =00000082                  nCs0:	EQU nC0+1	; $82
00000000 =00000083                  nD0:	EQU nCs0+1	; $83
00000000 =00000084                  nEb0:	EQU nD0+1	; $84
00000000 =00000085                  nE0:	EQU nEb0+1	; $85
00000000 =00000086                  nF0:	EQU nE0+1	; $86
00000000 =00000087                  nFs0:	EQU nF0+1	; $87
00000000 =00000088                  nG0:	EQU nFs0+1	; $88
00000000 =00000089                  nAb0:	EQU nG0+1	; $89
00000000 =0000008A                  nA0:	EQU nAb0+1	; $8A
00000000 =0000008B                  nBb0:	EQU nA0+1	; $8B
00000000 =0000008C                  nB0:	EQU nBb0+1	; $8C
00000000 =0000008D                  nC1:	EQU nB0+1	; $8D
00000000 =0000008E                  nCs1:	EQU nC1+1	; $8E
00000000 =0000008F                  nD1:	EQU nCs1+1	; $8F
00000000 =00000090                  nEb1:	EQU nD1+1	; $90
00000000 =00000091                  nE1:	EQU nEb1+1	; $91
00000000 =00000092                  nF1:	EQU nE1+1	; $92
00000000 =00000093                  nFs1:	EQU nF1+1	; $93
00000000 =00000094                  nG1:	EQU nFs1+1	; $94
00000000 =00000095                  nAb1:	EQU nG1+1	; $95
00000000 =00000096                  nA1:	EQU nAb1+1	; $96 g6
00000000 =00000097                  nBb1:	EQU nA1+1	; $97
00000000 =00000098                  nB1:	EQU nBb1+1	; $98 a6
00000000 =00000099                  nC2:	EQU nB1+1	; $99
00000000 =0000009A                  nCs2:	EQU nC2+1	; $9A b6
00000000 =0000009B                  nD2:	EQU nCs2+1	; $9B c7
00000000 =0000009C                  nEb2:	EQU nD2+1	; $9C
00000000 =0000009D                  nE2:	EQU nEb2+1	; $9D
00000000 =0000009E                  nF2:	EQU nE2+1	; $9E
00000000 =0000009F                  nFs2:	EQU nF2+1	; $9F
00000000 =000000A0                  nG2:	EQU nFs2+1	; $A0
00000000 =000000A1                  nAb2:	EQU nG2+1	; $A1
00000000 =000000A2                  nA2:	EQU nAb2+1	; $A2
00000000 =000000A3                  nBb2:	EQU nA2+1	; $A3
00000000 =000000A4                  nB2:	EQU nBb2+1	; $A4
00000000 =000000A5                  nC3:	EQU nB2+1	; $A5
00000000 =000000A6                  nCs3:	EQU nC3+1	; $A6
00000000 =000000A7                  nD3:	EQU nCs3+1	; $A7
00000000 =000000A8                  nEb3:	EQU nD3+1	; $A8
00000000 =000000A9                  nE3:	EQU nEb3+1	; $A9
00000000 =000000AA                  nF3:	EQU nE3+1	; $AA
00000000 =000000AB                  nFs3:	EQU nF3+1	; $AB
00000000 =000000AC                  nG3:	EQU nFs3+1	; $AC
00000000 =000000AD                  nAb3:	EQU nG3+1	; $AD
00000000 =000000AE                  nA3:	EQU nAb3+1	; $AE
00000000 =000000AF                  nBb3:	EQU nA3+1	; $AF
00000000 =000000B0                  nB3:	EQU nBb3+1	; $B0
00000000 =000000B1                  nC4:	EQU nB3+1	; $B1
00000000 =000000B2                  nCs4:	EQU nC4+1	; $B2
00000000 =000000B3                  nD4:	EQU nCs4+1	; $B3
00000000 =000000B4                  nEb4:	EQU nD4+1	; $B4
00000000 =000000B5                  nE4:	EQU nEb4+1	; $B5
00000000 =000000B6                  nF4:	EQU nE4+1	; $B6
00000000 =000000B7                  nFs4:	EQU nF4+1	; $B7
00000000 =000000B8                  nG4:	EQU nFs4+1	; $B8
00000000 =000000B9                  nAb4:	EQU nG4+1	; $B9
00000000 =000000BA                  nA4:	EQU nAb4+1	; $BA
00000000 =000000BB                  nBb4:	EQU nA4+1	; $BB
00000000 =000000BC                  nB4:	EQU nBb4+1	; $BC
00000000 =000000BD                  nC5:	EQU nB4+1	; $BD
00000000 =000000BE                  nCs5:	EQU nC5+1	; $BE
00000000 =000000BF                  nD5:	EQU nCs5+1	; $BF
00000000 =000000C0                  nEb5:	EQU nD5+1	; $C0
00000000 =000000C1                  nE5:	EQU nEb5+1	; $C1
00000000 =000000C2                  nF5:	EQU nE5+1	; $C2
00000000 =000000C3                  nFs5:	EQU nF5+1	; $C3
00000000 =000000C4                  nG5:	EQU nFs5+1	; $C4
00000000 =000000C5                  nAb5:	EQU nG5+1	; $C5
00000000 =000000C6                  nA5:	EQU nAb5+1	; $C6
00000000 =000000C7                  nBb5:	EQU nA5+1	; $C7
00000000 =000000C8                  nB5:	EQU nBb5+1	; $C8
00000000 =000000C9                  nC6:	EQU nB5+1	; $C9
00000000 =000000CA                  nCs6:	EQU nC6+1	; $CA s
00000000 =000000CB                  nD6:	EQU nCs6+1	; $CB 2
00000000 =000000CC                  nEb6:	EQU nD6+1	; $CC 3
00000000 =000000CD                  nE6:	EQU nEb6+1	; $CD 4
00000000 =000000CE                  nF6:	EQU nE6+1	; $CE e5
00000000 =000000CF                  nFs6:	EQU nF6+1	; $CF
00000000 =000000D0                  nG6:	EQU nFs6+1	; $D0
00000000 =000000D1                  nAb6:	EQU nG6+1	; $D1
00000000 =000000D2                  nA6:	EQU nAb6+1	; $D2
00000000 =000000D3                  nBb6:	EQU nA6+1	; $D3
00000000 =000000D4                  nB6:	EQU nBb6+1	; $D4
00000000 =000000D5                  nC7:	EQU nB6+1	; $D5
00000000 =000000D6                  nCs7:	EQU nC7+1	; $D6
00000000 =000000D7                  nD7:	EQU nCs7+1	; $D7
00000000 =000000D8                  nEb7:	EQU nD7+1	; $D8
00000000 =000000D9                  nE7:	EQU nEb7+1	; $D9
00000000 =000000DA                  nF7:	EQU nE7+1	; $DA
00000000 =000000DB                  nFs7:	EQU nF7+1	; $DB
00000000 =000000DC                  nG7:	EQU nFs7+1	; $DC
00000000 =000000DD                  nAb7:	EQU nG7+1	; $DD
00000000 =000000DE                  nA7:	EQU nAb7+1	; $DE
00000000 =000000DF                  nBb7:	EQU nA7+1	; $DF
00000000                            
00000000                            																		
00000000                            																		
00000000                            																	  
00000000                            							
00000000                            				   
00000000                            				  
00000000                            ; ---------------------------------------------------------------------------------------------
00000000                            ; PSG envelope equates
00000000 =00000000                  fTone_00:	EQU $00
00000000 =00000001                  fTone_01:	EQU fTone_00+1
00000000                            				
00000000 =00000002                  fTone_02:	EQU fTone_01+1
00000000                            				
00000000 =00000003                  fTone_03:	EQU fTone_02+1
00000000                            				
00000000 =00000004                  fTone_04:	EQU fTone_03+1
00000000                            				
00000000 =00000005                  fTone_05:	EQU fTone_04+1
00000000 =00000006                  fTone_06:	EQU fTone_05+1
00000000 =00000007                  fTone_07:	EQU fTone_06+1
00000000 =00000008                  fTone_08:	EQU fTone_07+1
00000000 =00000009                  fTone_09:	EQU fTone_08+1
00000000 =0000000A                  fTone_0A:	EQU fTone_09+1
00000000 =0000000B                  fTone_0B:	EQU fTone_0A+1
00000000 =0000000C                  fTone_0C:	EQU fTone_0B+1
00000000                            				
00000000                            				
00000000                            				
00000000                            													   
00000000                            				
00000000                            				
00000000                            				
00000000                            										  
00000000                            				
00000000                            											
00000000                            								  
00000000                            								  
00000000                            				
00000000                            				
00000000                            								  
00000000                            								  
00000000                            													   
00000000                            								  
00000000                            								  
00000000                            								  
00000000                            										  
00000000                            								  
00000000                            				
00000000                            								  
00000000                            				
00000000                            				
00000000                            				
00000000                            				
00000000                            											
00000000                            				
00000000                            				
00000000                            				
00000000                            				
00000000                            				
00000000                            				
00000000                            				
00000000                            				 
00000000                            ; ---------------------------------------------------------------------------------------------
00000000                            ; DAC Equates
00000000 =00000081                  dKick			EQU	$81
00000000 =00000082                  dSnare			EQU	$82
00000000 =00000083                  dTimpani		EQU	$83
00000000 =00000088                  dHiTimpani		EQU	$88
00000000 =00000089                  dMidTimpani		EQU	$89
00000000                            					 
00000000                            				 
00000000                            					 
00000000                            				   
00000000                            			   
00000000                            				 
00000000                            					 
00000000                            								
00000000                            				   
00000000                            					
00000000                            				 
00000000                            					 
00000000                            								   
00000000                            					
00000000                            			 
00000000                            						
00000000                            									  
00000000                            					   
00000000                            						 
00000000                            								   
00000000                            					  
00000000                            				   
00000000                            					
00000000                            							   
00000000                            						   
00000000                            					 
00000000 =0000008A                  dLowTimpani		EQU	$8A
00000000 =0000008B                  dVLowTimpani		EQU	$8B
00000000                            
00000000                            							
00000000                            							 
00000000                            				  
00000000                            						
00000000                            									   
00000000                            				   
00000000                            					   
00000000                            						
00000000                            									
00000000                            						  
00000000                            			   
00000000                            				   
00000000                            				  
00000000                            							  
00000000                            			
00000000                            		   
00000000                            				
00000000                            				 
00000000                            					
00000000                            					 
00000000                            							  
00000000                            				   
00000000                            					  
00000000                            					  
00000000                            									
00000000                            										
00000000                            											  
00000000                            					  
00000000                            						   
00000000                            								  
00000000                            					   
00000000                            					   
00000000                            					   
00000000                            										
00000000                            				  
00000000                            						
00000000                            				   
00000000                            								   
00000000                            				 
00000000                            				
00000000                            					 
00000000                            									
00000000                            						  
00000000                            						   
00000000                            			   
00000000                            				
00000000                            				  
00000000                            					
00000000                            					 
00000000                            					 
00000000                            					
00000000                            				 
00000000                            				  
00000000                            ; ---------------------------------------------------------------------------------------------
00000000                            ; Channel IDs for SFX
00000000 =00000080                  cPSG1				EQU $80
00000000 =000000A0                  cPSG2				EQU $A0
00000000 =000000C0                  cPSG3				EQU $C0
00000000 =000000E0                  cNoise				EQU $E0	; Not for use in S3/S&K/S3D
00000000 =00000002                  cFM3				EQU $02
00000000 =00000004                  cFM4				EQU $04
00000000 =00000005                  cFM5				EQU $05
00000000 =00000006                  cFM6				EQU $06	; Only in S3/S&K/S3D, overrides DAC
00000000                            
00000000                            ; ---------------------------------------------------------------------------------------------
00000000                            ;---------------------------------------------
00000000                            ; SMPS F_Tone Equates 
00000000                            ;---------------------------------------------	
00000000 =00000000                  fTone_00:	EQU $00
00000000 =00000001                  fTone_01:	EQU fTone_00+1
00000000 =00000002                  fTone_02:	EQU fTone_01+1
00000000 =00000003                  fTone_03:	EQU fTone_02+1
00000000 =00000004                  fTone_04:	EQU fTone_03+1
00000000 =00000005                  fTone_05:	EQU fTone_04+1
00000000 =00000006                  fTone_06:	EQU fTone_05+1
00000000 =00000007                  fTone_07:	EQU fTone_06+1
00000000 =00000008                  fTone_08:	EQU fTone_07+1
00000000 =00000009                  fTone_09:	EQU fTone_08+1
00000000 =0000000A                  fTone_0A:	EQU fTone_09+1
00000000 =0000000B                  fTone_0B:	EQU fTone_0A+1
00000000 =0000000C                  fTone_0C:	EQU fTone_0B+1
00000000 =0000000D                  fTone_0D:	EQU fTone_0C+1
00000000 =0000000E                  fTone_0E:	EQU fTone_0D+1
00000000 =0000000F                  fTone_0F:	EQU fTone_0E+1
00000000 =00000010                  fTone_10:	EQU fTone_0F+1
00000000 =00000011                  fTone_11:	EQU fTone_10+1
00000000 =00000012                  fTone_12:	EQU fTone_11+1
00000000 =00000013                  fTone_13:	EQU fTone_12+1
00000000 =00000014                  fTone_14:	EQU fTone_13+1
00000000 =00000015                  fTone_15:	EQU fTone_14+1
00000000 =00000016                  fTone_16:	EQU fTone_15+1
00000000 =00000017                  fTone_17:	EQU fTone_16+1
00000000 =00000018                  fTone_18:	EQU fTone_17+1
00000000 =00000019                  fTone_19:	EQU fTone_18+1
00000000 =0000001A                  fTone_1A:	EQU fTone_19+1
00000000 =0000001B                  fTone_1B:	EQU fTone_1A+1
00000000 =0000001C                  fTone_1C:	EQU fTone_1B+1
00000000 =0000001D                  fTone_1D:	EQU fTone_1C+1
00000000 =0000001E                  fTone_1E:	EQU fTone_1D+1
00000000 =0000001F                  fTone_1F:	EQU fTone_1E+1
00000000 =00000020                  fTone_20:	EQU fTone_1F+1
00000000 =00000021                  fTone_21:	EQU fTone_20+1
00000000 =00000022                  fTone_22:	EQU fTone_21+1
00000000 =00000023                  fTone_23:	EQU fTone_22+1
00000000 =00000024                  fTone_24:	EQU fTone_23+1
00000000 =00000025                  fTone_25:	EQU fTone_24+1
00000000 =00000026                  fTone_26:	EQU fTone_25+1
00000000                            
00000000                            					   
00000000                            			
00000000                            						 
00000000                            	   
00000000                            					  
00000000                            	  
00000000                            	  
00000000                            ; ---------------------------------------------------------------------------------------------
00000000                            ; PSG conversion to S3/S&K/S3D drivers require a tone shift of 12 semi-tones.
00000000                            conv0To256  macro val 
00000000                            	if val<$01
00000000                            		dc.b (256-val+$FF)&$FF
00000000                            	else	
00000000                            		dc.b (256-val)&$FF	
00000000                            	endc
00000000                            	endm
00000000                            SMPSModFix:	macro steps
00000000                            	dc.b (steps/(speed-1))
00000000                            	endm	
00000000 =0000000C                  psgdelta	EQU $0C
00000000                            PSGPitch macro pitch
00000000                            		dc.b	(pitch+psgdelta)&$FF
00000000                            	endm
00000000                            
00000000                            s1TempotoS2 macro tmod
00000000                            	if tmod<$01
00000000                            		dc.b ((($FF+tmod-1)*256+($FF+tmod/2))/$FF+tmod)&$FF 	
00000000                            	else
00000000                            		dc.b (((tmod-1)*256+(tmod/2))/tmod)&$FF
00000000                            	endc
00000000                            	endm
00000000                            	
00000000                            s3TempotoS2 macro tmod
00000000                            	if tmod<$01
00000000                            		dc.b (256-tmod+$FF)&$FF
00000000                            	else	
00000000                            		dc.b (256-tmod)&$FF	
00000000                            	endc
00000000                            	endm
00000000                            	
00000000                            convertMainTempoMod	macro tmod
00000000                            	if 		smpsHeaderStartSong=2
00000000                            		dc.b tmod
00000000                            	elseif 		smpsHeaderStartSong<2
00000000                            		s1TempotoS2 	\tmod
00000000                            	elseif	smpsHeaderStartSong>2
00000000                            		s3TempotoS2  	\tmod
00000000                            	endc
00000000                            	endm	
00000000                            ; ---------------------------------------------------------------------------------------------
00000000                            ; Header Macros
00000000 =00000000                  smpsHeaderStartSong = 0
00000000                            
00000000                            smpsHeaderVoiceNull macro
00000000                            				
00000000                            																   
00000000                            	  
00000000                            	dc.w	$0000
00000000                            	endm
00000000                            
00000000                            ; Header - Set up Voice Location
00000000                            ; Common to music and SFX
00000000                            smpsHeaderVoice macro loc
00000000                            songStart set *
00000000                            	dc.w	loc-songStart
00000000                            	endm
00000000                            
00000000                            ; Header - Set up Voice Location as S3's Universal Voice Bank
00000000                            ; Common to music and SFX
00000000                            smpsHeaderVoiceUVB macro
00000000                            	if songStart<>*
00000000                            		fail "Missing smpsHeaderStartSong or smpsHeaderStartSongConvert"
00000000                            	endc
00000000                            	;dc.w	little_endian(z80_UniVoiceBank)
00000000                            	z80_ptr	z80_UniVoiceBank
00000000                            	endm
00000000                            
00000000                            ; Header macros for music (not for SFX)
00000000                            ; Header - Set up Channel Usage
00000000                            smpsHeaderChan macro fm,psg
00000000                            	dc.b	fm,psg
00000000                            	endm
00000000                            
00000000                            ; Header - Set up Tempo
00000000                            smpsHeaderTempo macro tdiv,tmod
00000000                            	dc.b	tdiv,tmod
00000000                            					
00000000                            			
00000000                            	endm
00000000                            
00000000                            ; Header - Set up DAC Channel
00000000                            smpsHeaderDAC macro loc,pitch,vol
00000000                            	dc.w	loc-songStart
00000000                            	if narg>=2
00000000                            		dc.b	\pitch
00000000                            	else
00000000                            		dc.b	$00
00000000                            	endc
00000000                            	if narg>=3
00000000                            		dc.b	\vol
00000000                            	  
00000000                            		   
00000000                            	   
00000000                            	else
00000000                            		dc.b	$00
00000000                            	endc
00000000                            	endm
00000000                            
00000000                            ; Header - Set up FM Channel
00000000                            smpsHeaderFM macro loc,pitch,vol
00000000                            	dc.w	loc-songStart
00000000                            	dc.b	pitch,vol
00000000                            	endm
00000000                            
00000000                            ; Header - Set up PSG Channel
00000000                            smpsHeaderPSG macro loc,pitch,vol,mod,voice
00000000                            	dc.w	loc-songStart
00000000                            				   
00000000                            						   
00000000                            	 
00000000                            			
00000000                            	  
00000000                            	dc.b	pitch,vol,mod,voice
00000000                            	endm
00000000                            
00000000                            ; Header macros for SFX (not for music)
00000000                            ; Header - Set up Tempo
00000000                            smpsHeaderTempoSFX macro div
00000000                            	dc.b	div
00000000                            	endm
00000000                            
00000000                            ; Header - Set up Channel Usage
00000000                            smpsHeaderChanSFX macro chan
00000000                            	dc.b	chan
00000000                            	endm
00000000                            
00000000                            ; Header - Set up FM Channel
00000000                            smpsHeaderSFXChannel macro chanid,loc,pitch,vol
00000000                            	if (chanid=cNoise)
00000000                            		fail "Using channel ID of cNoise ($E0) in Sonic 3 driver is dangerous. Fix the song so that it turns into a noise channel instead."
00000000                            	endc
00000000                            	dc.b	$80,chanid
00000000                            	dc.w	loc-songStart
00000000                            				   
00000000                            				   
00000000                            	dc.b	pitch, vol
00000000                            	 
00000000                            			
00000000                            	  
00000000                            	 
00000000                            			
00000000                            	  
00000000                            		 
00000000                            	endm
00000000                            
00000000                            ; ---------------------------------------------------------------------------------------------
00000000                            ; Co-ord Flag Macros and Equates
00000000                            ; E0xx - Panning, AMS, FMS
00000000                            smpsPan macro direction,amsfms
00000000                            panNone set $00
00000000                            panRight set $40
00000000                            panLeft set $80
00000000                            panCentre set $C0
00000000                            panCenter set $C0 ; silly Americans :U
00000000                            	dc.b $E0,direction+amsfms
00000000                            	endm
00000000                            
00000000                            ; E1xx - Set channel frequency displacement to xx
00000000                            smpsAlterNote macro val
00000000                            	dc.b	$E1,val
00000000                            	endm
00000000                            
00000000                            					
00000000                            			  
00000000                            	 
00000000                            
00000000                            ; E2xx - Useless
00000000                            smpsNop macro val
00000000                            	dc.b	$E2,val
00000000                            	endm
00000000                            
00000000                            ; Return (used after smpsCall)
00000000                            smpsReturn macro val
00000000                            	dc.b	$E3
00000000                            	endm
00000000                            
00000000                            ; Fade in previous song (ie. 1-Up)
00000000                            smpsFade macro val
00000000                            	dc.b	$E4
00000000                            	endm
00000000                            
00000000                            ; E5xx - Set channel tempo divider to xx
00000000                            smpsChanTempoDiv macro val
00000000                            	dc.b	$E5,val
00000000                            ;	endc
00000000                            	endm
00000000                            
00000000                            ; E6xx - Alter Volume by xx
00000000                            smpsAlterVol macro val
00000000                            	dc.b	$E6,val
00000000                            	endm
00000000                            			
00000000                            
00000000                            sVol  macro val
00000000                            	$E6,val
00000000                            	endm
00000000                            ; E7 - Prevent attack of next note
00000000 =000000E7                  smpsNoAttack	EQU $E7
00000000                            					   
00000000                            					
00000000                            
00000000                            ; E8xx - Set note fill to xx
00000000                            smpsNoteFill macro val
00000000                            		dc.b	$E8,val
00000000                            ;	endc
00000000                            	endm
00000000                            
00000000                            						 
00000000                            smpsAlterPitch 	macro	value
00000000                            	dc.b $E9,value
00000000                            	endm
00000000                            
00000000                            								 
00000000                            				   
00000000                            			  
00000000                            	 
00000000                            			  
00000000                            	  
00000000                            	 
00000000                            
00000000                            ; Set music tempo modifier to xx
00000000                            smpsSetTempoMod macro mod
00000000                            	dc.b	$EA,mod
00000000                            			
00000000                            	endm
00000000                            
00000000                            ; Set music tempo divider to xx
00000000                            smpsSetTempoDiv macro val
00000000                            	dc.b	$EB,val
00000000                            	endm
00000000                            
00000000                            ; ECxx - Set Volume to xx
00000000                            smpsSetVol macro val
00000000                            	dc.b	$EC,val
00000000                            	endm
00000000                            
00000000                            ; Works on all drivers
00000000                            smpsPSGAlterVol macro vol
00000000                            	dc.b	$EC,vol
00000000                            	endm
00000000                            			 
00000000                            
00000000                            ; Clears pushing sound flag in S1
00000000                            smpsClearPush macro	
00000000                            	dc.b	$ED
00000000                            	endm
00000000                            
00000000                            ; Stops special SFX (S1 only) and restarts overridden music track
00000000                            smpsStopSpecial macro
00000000                            		dc.b	$EE
00000000                            	endm
00000000                            
00000000                            ; EFxx[yy] - Set Voice of FM channel to xx; xx < 0 means yy present
00000000                            smpsSetvoice macro voice,songID
00000000                            	if narg<=1
00000000                            		dc.b	$EF,voice
00000000                            	else
00000000                            		dc.b	$EF,voice|$80,songID+$81
00000000                            	endc
00000000                            	endm
00000000                            
00000000                            									  
00000000                            					   
00000000                            			   
00000000                            	 
00000000                            
00000000                            ; F0wwxxyyzz - Modulation - ww: wait time - xx: modulation speed - yy: change per step - zz: number of steps
00000000                            smpsModSet macro wait,speed,change,step
00000000                            	dc.b	$F0
00000000                            				   
00000000                            	dc.b	wait,speed,change,step
00000000                            	 
00000000                            							 
00000000                            	  
00000000                            						
00000000                            	endm
00000000                            
00000000                            ; Turn on Modulation
00000000                            smpsModOn macro
00000000                            	dc.b	$F1
00000000                            	endm
00000000                            
00000000                            ; F2 - End of channel
00000000                            smpsStop macro
00000000                            	dc.b	$F2
00000000                            	endm
00000000                            
00000000                            ; F3xx - PSG waveform to xx
00000000                            smpsPSGform macro form
00000000                            	dc.b	$F3,form
00000000                            	endm
00000000                            
00000000                            ; Turn off Modulation
00000000                            smpsModOff macro
00000000                            	dc.b	$F4
00000000                            	endm
00000000                            
00000000                            				
00000000                            					   
00000000                            			 
00000000                            	  
00000000                            
00000000                            ; F5xx - PSG voice to xx
00000000                            smpsPSGvoice macro voice
00000000                            	dc.b	$F5,voice
00000000                            	endm
00000000                            
00000000                            ; F6xxxx - Jump to xxxx
00000000                            smpsJump macro loc
00000000                            	dc.b	$F6
00000000                            	dc.w	loc-*-1
00000000                            	endm
00000000                            
00000000                            ; F7xxyyzzzz - Loop back to zzzz yy times, xx being the loop index for loop recursion fixing
00000000                            smpsLoop macro index,loops,loc
00000000                            	dc.b	$F7
00000000                            	dc.b	index,loops
00000000                            	dc.w	loc-*-1
00000000                            	endm
00000000                            
00000000                            					   
00000000                            							
00000000                            		 
00000000                            			 
00000000                            	  
00000000                            
00000000                            ; F8xxxx - Call pattern at xxxx, saving return point
00000000                            smpsCall macro loc
00000000                            	dc.b	$F8
00000000                            	dc.w	loc-*-1
00000000                            	endm
00000000                            
00000000                            ; ---------------------------------------------------------------------------------------------
00000000                            ; Alter Volume
00000000                            smpsFMAlterVol macro val1,val2
00000000                            	if narg<=1
00000000                            		dc.b	$E6,val1
00000000                            	else
00000000                            		dc.b	$E5,val1,val2
00000000                            	endc
00000000                            	endm
00000000                            
00000000                            ; S3/S&K/S3D-only coordination flags
00000000                            ; Silences FM channel then stops as per smpsStop
00000000                            smpsStopFM macro
00000000                            	dc.b	$E3
00000000                            	endm
00000000                            
00000000                            ; Spindash Rev
00000000                            smpsSpindashRev macro
00000000                            	dc.b	$E9
00000000                            	endm
00000000                            	
00000000                            smpsPlayDACSample macro sample
00000000                            	dc.b	$EA,sample
00000000                            	endm
00000000                            	
00000000                            smpsConditionalJump macro index,loc
00000000                            	dc.b	$EB
00000000                            	dc.b	index
00000000                            	dc.w	loc-songStart
00000000                            	endm
00000000                            
00000000                            ; Set note values to xx-$40
00000000                            smpsSetNote macro val
00000000                            	dc.b	$ED,val
00000000                            	endm
00000000                            
00000000                            smpsFMICommand macro reg,val
00000000                            	dc.b	$EE,reg,val
00000000                            	endm
00000000                            
00000000                            ; Set Modulation
00000000                            smpsModChange2 macro fmmod,psgmod
00000000                            	dc.b	$F1,fmmod,psgmod
00000000                            	endm
00000000                            
00000000                            ; Set Modulation
00000000                            smpsModChange macro val
00000000                            	dc.b	$F4,val
00000000                            	endm
00000000                            
00000000                            ; FCxxxx - Jump to xxxx
00000000                            smpsContinuousLoop macro loc
00000000                            	dc.b	$FC
00000000                            	dc.w	loc-songStart
00000000                            	endm
00000000                            
00000000                            smpsAlternateSMPS macro flag
00000000                            	dc.b	$FD,flag
00000000                            	endm
00000000                            
00000000                            smpsFM3SpecialMode macro ind1,ind2,ind3,ind4
00000000                            	dc.b	$FE,ind1,ind2,ind3,ind4
00000000                            	endm
00000000                            
00000000                            smpsPlaySound macro index
00000000                            	dc.b	$FF,$01,index
00000000                            	endm
00000000                            
00000000                            smpsHaltMusic macro flag
00000000                            	dc.b	$FF,$02,flag
00000000                            	endm
00000000                            
00000000                            smpsCopyData macro data,len
00000000                            	fail "Coord. Flag to copy data should not be used. Complain to Flamewing if any music uses it."
00000000                            	dc.b	$FF,$03
00000000                            	;dc.w	little_endian(data)
00000000                            	z80_ptr	data
00000000                            	dc.b	len
00000000                            	endm
00000000                            
00000000                            smpsSSGEG macro op1,op2,op3,op4
00000000                            	dc.b	$FF,$05,op1,op2,op3,op4
00000000                            	endm
00000000                            
00000000                            smpsFMFlutter macro tone,mask
00000000                            	dc.b	$FF,$06,tone,mask
00000000                            	endm
00000000                            
00000000                            smpsResetSpindashRev macro val
00000000                            							  
00000000                            																								 
00000000                            					
00000000                            	dc.b	$FF,$07
00000000                            	endm
00000000                            
00000000                            ; ---------------------------------------------------------------------------------------------
00000000                            ; Macros for FM instruments
00000000                            ; Voices - Feedback
00000000                            smpsVcFeedback macro val
00000000                            vcFeedback set \val
00000000                            	endm
00000000                            
00000000                            ; Voices - Algorithm
00000000                            smpsVcAlgorithm macro val
00000000                            vcAlgorithm set \val
00000000                            	endm
00000000                            
00000000                            smpsVcUnusedBits macro val
00000000                            vcUnusedBits set \val
00000000                            	endm
00000000                            
00000000                            ; Voices - Detune
00000000                            smpsVcDetune macro op1,op2,op3,op4
00000000                            vcDT1 set \op1
00000000                            vcDT2 set \op2
00000000                            vcDT3 set \op3
00000000                            vcDT4 set \op4
00000000                            	endm
00000000                            
00000000                            ; Voices - Coarse-Frequency
00000000                            smpsVcCoarseFreq macro op1,op2,op3,op4
00000000                            vcCF1 set \op1
00000000                            vcCF2 set \op2
00000000                            vcCF3 set \op3
00000000                            vcCF4 set \op4
00000000                            	endm
00000000                            
00000000                            ; Voices - Rate Scale
00000000                            smpsVcRateScale macro op1,op2,op3,op4
00000000                            vcRS1 set \op1
00000000                            vcRS2 set \op2
00000000                            vcRS3 set \op3
00000000                            vcRS4 set \op4
00000000                            	endm
00000000                            
00000000                            ; Voices - Attack Rate
00000000                            smpsVcAttackRate macro op1,op2,op3,op4
00000000                            vcAR1 set \op1
00000000                            vcAR2 set \op2
00000000                            vcAR3 set \op3
00000000                            vcAR4 set \op4
00000000                            	endm
00000000                            
00000000                            ; Voices - Amplitude Modulation
00000000                            smpsVcAmpMod macro op1,op2,op3,op4
00000000                            vcAM1 set \op1
00000000                            vcAM2 set \op2
00000000                            vcAM3 set \op3
00000000                            vcAM4 set \op4
00000000                            	endm
00000000                            
00000000                            ; Voices - First Decay Rate
00000000                            smpsVcDecayRate1 macro op1,op2,op3,op4
00000000                            vcD1R1 set \op1
00000000                            vcD1R2 set \op2
00000000                            vcD1R3 set \op3
00000000                            vcD1R4 set \op4
00000000                            	endm
00000000                            
00000000                            ; Voices - Second Decay Rate
00000000                            smpsVcDecayRate2 macro op1,op2,op3,op4
00000000                            vcD2R1 set \op1
00000000                            vcD2R2 set \op2
00000000                            vcD2R3 set \op3
00000000                            vcD2R4 set \op4
00000000                            	endm
00000000                            
00000000                            ; Voices - Decay Level
00000000                            smpsVcDecayLevel macro op1,op2,op3,op4
00000000                            vcDL1 set \op1
00000000                            vcDL2 set \op2
00000000                            vcDL3 set \op3
00000000                            vcDL4 set \op4
00000000                            	endm
00000000                            
00000000                            ; Voices - Release Rate
00000000                            smpsVcReleaseRate macro op1,op2,op3,op4
00000000                            vcRR1 set \op1
00000000                            vcRR2 set \op2
00000000                            vcRR3 set \op3
00000000                            vcRR4 set \op4
00000000                            	endm
00000000                            
00000000                            ; Voices - Total Level
00000000                            smpsVcTotalLevel macro op1,op2,op3,op4
00000000                            vcTL1 set \op1
00000000                            vcTL2 set \op2
00000000                            vcTL3 set \op3
00000000                            vcTL4 set \op4
00000000                            	dc.b	(vcUnusedBits<<6)+(vcFeedback<<3)+vcAlgorithm
00000000                            ;   0     1     2     3     4     5     6     7
00000000                            ;%1000,%1000,%1000,%1000,%1010,%1110,%1110,%1111
00000000                            vcTLMask4 set ((vcAlgorithm=7)<<7)
00000000                            vcTLMask3 set ((vcAlgorithm>=4)<<7)
00000000                            vcTLMask2 set ((vcAlgorithm>=5)<<7)
00000000                            vcTLMask1 set $80
00000000                            ;	dc.b	(vcDT4<<4)+vcCF4 ,(vcDT3<<4)+vcCF3 ,(vcDT2<<4)+vcCF2 ,(vcDT1<<4)+vcCF1
00000000                            ;	dc.b	(vcRS4<<6)+vcAR4 ,(vcRS3<<6)+vcAR3 ,(vcRS2<<6)+vcAR2 ,(vcRS1<<6)+vcAR1
00000000                            ;	dc.b	(vcAM4<<5)+vcD1R4,(vcAM3<<5)+vcD1R3,(vcAM2<<5)+vcD1R2,(vcAM1<<5)+vcD1R1
00000000                            ;	dc.b	vcD2R4           ,vcD2R3           ,vcD2R2           ,vcD2R1
00000000                            ;	dc.b	(vcDL4<<4)+vcRR4 ,(vcDL3<<4)+vcRR3 ,(vcDL2<<4)+vcRR2 ,(vcDL1<<4)+vcRR1
00000000                            ;	dc.b	vcTL4|vcTLMask4  ,vcTL3|vcTLMask3  ,vcTL2|vcTLMask2  ,vcTL1|vcTLMask1
00000000                            	dc.b	(vcDT4<<4)+vcCF4,(vcDT3<<4)+vcCF3,(vcDT2<<4)+vcCF2,(vcDT1<<4)+vcCF1
00000000                            	dc.b	(vcRS4<<6)+vcAR4,(vcRS3<<6)+vcAR3,(vcRS2<<6)+vcAR2,(vcRS1<<6)+vcAR1
00000000                            	dc.b	(vcAM4<<5)+vcD1R4,(vcAM3<<5)+vcD1R3,(vcAM2<<5)+vcD1R2,(vcAM1<<5)+vcD1R1
00000000                            	dc.b	vcD2R4,vcD2R3,vcD2R2,vcD2R1
00000000                            	dc.b	(vcDL4<<4)+vcRR4,(vcDL3<<4)+vcRR3,(vcDL2<<4)+vcRR2,(vcDL1<<4)+vcRR1
00000000                            	dc.b	vcTL4|vcTLMask4,vcTL3|vcTLMask3,vcTL2|vcTLMask2,vcTL1|vcTLMask1
00000000                            				  
00000000                            				 
00000000                            	 
00000000                            			 
00000000                            	  
00000000                            				  
00000000                            				 
00000000                            	 
00000000                            			 
00000000                            	  
00000000                            				 
00000000                            	endm
00000000                            
00000000                            
00000000                            
00000000                            ; ===========================================================================
00000000                            
00000000                            StartOfRom:
00000000 00FF FE00                  Vectors:	dc.l v_systemstack&$FFFFFF	; Initial stack pointer value
00000004 0000 0000                  		dc.l EntryPoint			; Start of program
00000008 0000 0000                  		dc.l BusError			; Bus error
0000000C 0000 0000                  		dc.l AddressError		; Address error (4)
00000010 0000 0000                  		dc.l IllegalInstr		; Illegal instruction
00000014 0000 0000                  		dc.l ZeroDivide			; Division by zero
00000018 0000 0000                  		dc.l ChkInstr			; CHK exception
0000001C 0000 0000                  		dc.l TrapvInstr			; TRAPV exception (8)
00000020 0000 0000                  		dc.l PrivilegeViol		; Privilege violation
00000024 0000 0000                  		dc.l Trace				; TRACE exception
00000028 0000 0000                  		dc.l Line1010Emu		; Line-A emulator
0000002C 0000 0000                  		dc.l Line1111Emu		; Line-F emulator (12)
00000030 0000 0000                  		dc.l ErrorExcept		; Unused (reserved)
00000034 0000 0000                  		dc.l ErrorExcept		; Unused (reserved)
00000038 0000 0000                  		dc.l ErrorExcept		; Unused (reserved)
0000003C 0000 0000                  		dc.l ErrorExcept		; Unused (reserved) (16)
00000040 0000 0000                  		dc.l ErrorExcept		; Unused (reserved)
00000044 0000 0000                  		dc.l ErrorExcept		; Unused (reserved)
00000048 0000 0000                  		dc.l ErrorExcept		; Unused (reserved)
0000004C 0000 0000                  		dc.l ErrorExcept		; Unused (reserved) (20)
00000050 0000 0000                  		dc.l ErrorExcept		; Unused (reserved)
00000054 0000 0000                  		dc.l ErrorExcept		; Unused (reserved)
00000058 0000 0000                  		dc.l ErrorExcept		; Unused (reserved)
0000005C 0000 0000                  		dc.l ErrorExcept		; Unused (reserved) (24)
00000060 0000 0000                  		dc.l ErrorExcept		; Spurious exception
00000064 0000 0000                  		dc.l ErrorTrap			; IRQ level 1
00000068 0000 0000                  		dc.l ErrorTrap			; IRQ level 2
0000006C 0000 0000                  		dc.l ErrorTrap			; IRQ level 3 (28)
00000070 0000 0000                  		dc.l HBlank				; IRQ level 4 (horizontal retrace interrupt)
00000074 0000 0000                  		dc.l ErrorTrap			; IRQ level 5
00000078 0000 0000                  		dc.l VBlank				; IRQ level 6 (vertical retrace interrupt)
0000007C 0000 0000                  		dc.l ErrorTrap			; IRQ level 7 (32)
00000080 0000 0000                  		dc.l ErrorTrap			; TRAP #00 exception
00000084 0000 0000                  		dc.l ErrorTrap			; TRAP #01 exception
00000088 0000 0000                  		dc.l ErrorTrap			; TRAP #02 exception
0000008C 0000 0000                  		dc.l ErrorTrap			; TRAP #03 exception (36)
00000090 0000 0000                  		dc.l ErrorTrap			; TRAP #04 exception
00000094 0000 0000                  		dc.l ErrorTrap			; TRAP #05 exception
00000098 0000 0000                  		dc.l ErrorTrap			; TRAP #06 exception
0000009C 0000 0000                  		dc.l ErrorTrap			; TRAP #07 exception (40)
000000A0 0000 0000                  		dc.l ErrorTrap			; TRAP #08 exception
000000A4 0000 0000                  		dc.l ErrorTrap			; TRAP #09 exception
000000A8 0000 0000                  		dc.l ErrorTrap			; TRAP #10 exception
000000AC 0000 0000                  		dc.l ErrorTrap			; TRAP #11 exception (44)
000000B0 0000 0000                  		dc.l ErrorTrap			; TRAP #12 exception
000000B4 0000 0000                  		dc.l ErrorTrap			; TRAP #13 exception
000000B8 0000 0000                  		dc.l ErrorTrap			; TRAP #14 exception
000000BC 0000 0000                  		dc.l ErrorTrap			; TRAP #15 exception (48)
000000C0 0000 0000                  		dc.l ErrorTrap			; Unused (reserved)
000000C4 0000 0000                  		dc.l ErrorTrap			; Unused (reserved)
000000C8 0000 0000                  		dc.l ErrorTrap			; Unused (reserved)
000000CC 0000 0000                  		dc.l ErrorTrap			; Unused (reserved)
000000D0 0000 0000                  		dc.l ErrorTrap			; Unused (reserved)
000000D4 0000 0000                  		dc.l ErrorTrap			; Unused (reserved)
000000D8 0000 0000                  		dc.l ErrorTrap			; Unused (reserved)
000000DC 0000 0000                  		dc.l ErrorTrap			; Unused (reserved)
000000E0 0000 0000                  		dc.l ErrorTrap			; Unused (reserved)
000000E4 0000 0000                  		dc.l ErrorTrap			; Unused (reserved)
000000E8 0000 0000                  		dc.l ErrorTrap			; Unused (reserved)
000000EC 0000 0000                  		dc.l ErrorTrap			; Unused (reserved)
000000F0 0000 0000                  		dc.l ErrorTrap			; Unused (reserved)
000000F4 0000 0000                  		dc.l ErrorTrap			; Unused (reserved)
000000F8 0000 0000                  		dc.l ErrorTrap			; Unused (reserved)
000000FC 0000 0000                  		dc.l ErrorTrap			; Unused (reserved)
00000100 5345 4741 204D 4547 4120+  ConsoleName:	dc.b "SEGA MEGA DRIVE " ; Hardware system ID (Console name)
00000110 4D43 542F 5348 4332 3220+  Date:		dc.b "MCT/SHC22 SEP'22" ; Copyright holder and release date (generally year)
00000120 534F 4E49 4320 4445 4255+  Title_Local:	dc.b "SONIC DEBUT BY MCTRAVISYT - DEV BUILD -         " ; Domestic name
00000150 534F 4E49 4320 4445 4255+  Title_Int:	dc.b "SONIC DEBUT BY MCTRAVISYT - DEV BUILD -         " ; International name
00000180 474D 2058 5858 5858 5858+  		dc.b "GM XXXXXXXX-XX"   ; Serial/version number (Rev 0)
0000018E 0000                       Checksum: dc.w $0
00000190 4A20 2020 2020 2020 2020+  		dc.b "J               " ; I/O support
000001A0 0000 0000                  RomStartLoc:	dc.l StartOfRom		; Start address of ROM
000001A4 0000 0000                  RomEndLoc:	dc.l EndOfRom-1		; End address of ROM
000001A8 00FF 0000                  RamStartLoc:	dc.l $FF0000		; Start address of RAM
000001AC 00FF FFFF                  RamEndLoc:	dc.l $FFFFFF		; End address of RAM
000001B0 2020 2020                  		dc.l $20202020
000001B4 2020 2020                  		dc.l $20202020		; SRAM start ($200001)
000001B8 2020 2020                  		dc.l $20202020		; SRAM end ($20xxxx)
000001BC 436F 6D70 696C 6564 206F+  Notes:		dc.b 'Compiled on GET OUT at WHY ARE YOU IN HERE          ' ; Notes (unused, anything can be put in this space, but it has to be 52 bytes.)
000001F0 4A55 4520 2020 2020 2020+  Region:		dc.b "JUE             " ; Region (Country code)
00000200                            EndOfHeader:
00000200                            
00000200                            ; ===========================================================================
00000200                            ; Crash/Freeze the 68000. Unlike Sonic 2, Sonic 1 uses the 68000 for playing music, so it stops too
00000200                            
00000200                            	include "ErrorHandler.asm"
00000200                            
00000200                            ; ===============================================================
00000200                            ; ---------------------------------------------------------------
00000200                            ; Error handling and debugging modules
00000200                            ; 2016-2017, Vladikcomper
00000200                            ; ---------------------------------------------------------------
00000200                            ; Error handler functions and calls
00000200                            ; ---------------------------------------------------------------
00000200                            
00000200                            ; ---------------------------------------------------------------
00000200                            ; Error handler control flags
00000200                            ; ---------------------------------------------------------------
00000200                            
00000200                            ; Screen appearence flags
00000200 =00000001                  _eh_address_error	equ	$01		; use for address and bus errors only (tells error handler to display additional "Address" field)
00000200 =00000002                  _eh_show_sr_usp		equ	$02		; displays SR and USP registers content on error screen
00000200                            
00000200                            ; Advanced execution flags
00000200                            ; WARNING! For experts only, DO NOT USES them unless you know what you're doing
00000200 =00000020                  _eh_return			equ	$20
00000200 =00000040                  _eh_enter_console	equ	$40
00000200 =00000080                  _eh_align_offset	equ	$80
00000200                            
00000200                            ; ---------------------------------------------------------------
00000200                            ; Errors vector table
00000200                            ; ---------------------------------------------------------------
00000200                            
00000200                            ; Default screen configuration
00000200 =00000000                  _eh_default			equ	0 ;_eh_show_sr_usp
00000200                            
00000200                            ; ---------------------------------------------------------------
00000200                            
00000200                            BusError:
00000200 4EB9 0000 0000 4255 5320+  	__ErrorMessage "BUS ERROR", _eh_default|_eh_address_error
00000212                            
00000212                            AddressError:
00000212 4EB9 0000 0000 4144 4452+  	__ErrorMessage "ADDRESS ERROR", _eh_default|_eh_address_error
00000228                            
00000228                            IllegalInstr:
00000228 4EB9 0000 0000 494C 4C45+  	__ErrorMessage "ILLEGAL INSTRUCTION", _eh_default
00000244                            
00000244                            ZeroDivide:
00000244 4EB9 0000 0000 5A45 524F+  	__ErrorMessage "ZERO DIVIDE", _eh_default
00000258                            
00000258                            ChkInstr:
00000258 4EB9 0000 0000 4348 4B20+  	__ErrorMessage "CHK INSTRUCTION", _eh_default
00000270                            
00000270                            TrapvInstr:
00000270 4EB9 0000 0000 5452 4150+  	__ErrorMessage "TRAPV INSTRUCTION", _eh_default
0000028A                            
0000028A                            PrivilegeViol:
0000028A 4EB9 0000 0000 5052 4956+  	__ErrorMessage "PRIVILEGE VIOLATION", _eh_default
000002A6                            
000002A6                            Trace:
000002A6 4EB9 0000 0000 5452 4143+  	__ErrorMessage "TRACE", _eh_default
000002B4                            
000002B4                            Line1010Emu:
000002B4 4EB9 0000 0000 4C49 4E45+  	__ErrorMessage "LINE 1010 EMULATOR", _eh_default
000002CE                            
000002CE                            Line1111Emu:
000002CE 4EB9 0000 0000 4C49 4E45+  	__ErrorMessage "LINE 1111 EMULATOR", _eh_default
000002E8                            
000002E8                            ErrorExcept:
000002E8 4EB9 0000 0000 4552 524F+  	__ErrorMessage "ERROR EXCEPTION", _eh_default
00000300                            	
00000300                            WrongComb:
00000300                            ;	__ErrorMessage "%<pal2>You didn't enter the right code.                                            %<pal3>Please refer to the pinned message in the test DM for the right combination.                                      %<pal0>If you're not apart of the tester     group, %<pal1>good luck%<pal0>.", _eh_default
00000300                            
00000300                            
00000300                            
00000300                            ; ---------------------------------------------------------------
00000300                            ; Import error handler global functions
00000300                            ; ---------------------------------------------------------------
00000300                            
00000300                            ErrorHandler.__global__error_initconsole equ ErrorHandler+$146
00000300                            ErrorHandler.__global__errorhandler_setupvdp equ ErrorHandler+$234
00000300                            ErrorHandler.__global__console_loadpalette equ ErrorHandler+$A1C
00000300                            ErrorHandler.__global__console_setposasxy_stack equ ErrorHandler+$A58
00000300                            ErrorHandler.__global__console_setposasxy equ ErrorHandler+$A5E
00000300                            ErrorHandler.__global__console_getposasxy equ ErrorHandler+$A8A
00000300                            ErrorHandler.__global__console_startnewline equ ErrorHandler+$AAC
00000300                            ErrorHandler.__global__console_setbasepattern equ ErrorHandler+$AD4
00000300                            ErrorHandler.__global__console_setwidth equ ErrorHandler+$AE8
00000300                            ErrorHandler.__global__console_writeline_withpattern equ ErrorHandler+$AFE
00000300                            ErrorHandler.__global__console_writeline equ ErrorHandler+$B00
00000300                            ErrorHandler.__global__console_write equ ErrorHandler+$B04
00000300                            ErrorHandler.__global__console_writeline_formatted equ ErrorHandler+$BB0
00000300                            ErrorHandler.__global__console_write_formatted equ ErrorHandler+$BB4
00000300                            
00000300                            
00000300                            ; ---------------------------------------------------------------
00000300                            ; Error handler external functions (compiled only when used)
00000300                            ; ---------------------------------------------------------------
00000300                            
00000300                            
00000300                            
00000300                            
00000300                            
00000300                            ; ---------------------------------------------------------------
00000300                            ; Include error handler binary module
00000300                            ; ---------------------------------------------------------------
00000300                            
00000300                            ErrorHandler:
00000300                            	incbin	ErrorHandler.bin
00002300                            
00002300                            ; ---------------------------------------------------------------
00002300                            ; WARNING!
00002300                            ;	DO NOT put any data from now on! DO NOT use ROM padding!
00002300                            ;	Symbol data should be appended here after ROM is compiled
00002300                            ;	by ConvSym utility, otherwise debugger modules won't be able
00002300                            ;	to resolve symbol names.
00002300                            ; ---------------------------------------------------------------
00002300                            ; ---------------------------------------------------------------
00002300                            
00002300                            ErrorTrap:
00002300 4E71                       		nop	
00002302 4E71                       		nop	
00002304 60FA                       		bra.s	ErrorTrap
00002306                            ; ===========================================================================
00002306                            
00002306                            EntryPoint:
00002306 4AB9 00A1 0008             		tst.l	(z80_port_1_control).l ; test port A & B control registers
0000230C 6600                       		bne.s	PortA_Ok
0000230E 4A79 00A1 000C             		tst.w	(z80_expansion_control).l ; test port C control register
00002314                            
00002314                            PortA_Ok:
00002314 6600                       		bne.s	SkipSetup ; Skip the VDP and Z80 setup code if port A, B or C is ok...?
00002316 4BFA 0000                  		lea	SetupValues(pc),a5	; Load setup values array address.
0000231A 4C9D 00E0                  		movem.w	(a5)+,d5-d7
0000231E 4CDD 1F00                  		movem.l	(a5)+,a0-a4
00002322 1029 EF01                  		move.b	-$10FF(a1),d0	; get hardware version (from $A10001)
00002326 0200 000F                  		andi.b	#$F,d0
0000232A 6700                       		beq.s	SkipSecurity	; If the console has no TMSS, skip the security stuff.
0000232C 237C 5345 4741 2F00        		move.l	#'SEGA',$2F00(a1) ; move "SEGA" to TMSS register ($A14000)
00002334                            
00002334                            SkipSecurity:
00002334 3014                       		move.w	(a4),d0	; clear write-pending flag in VDP to prevent issues if the 68k has been reset in the middle of writing a command long word to the VDP.
00002336 7000                       		moveq	#0,d0	; clear d0
00002338 2C40                       		movea.l	d0,a6	; clear a6
0000233A 4E66                       		move.l	a6,usp	; set usp to $0
0000233C                            
0000233C 7217                       		moveq	#$17,d1
0000233E                            VDPInitLoop:
0000233E 1A1D                       		move.b	(a5)+,d5	; add $8000 to value
00002340 3885                       		move.w	d5,(a4)		; move value to	VDP register
00002342 DA47                       		add.w	d7,d5		; next register
00002344 51C9 FFF8                  		dbf	d1,VDPInitLoop
00002348                            		
00002348 289D                       		move.l	(a5)+,(a4)
0000234A 3680                       		move.w	d0,(a3)		; clear	the VRAM
0000234C 3287                       		move.w	d7,(a1)		; stop the Z80
0000234E 3487                       		move.w	d7,(a2)		; reset	the Z80
00002350                            
00002350                            WaitForZ80:
00002350 0111                       		btst	d0,(a1)		; has the Z80 stopped?
00002352 66FC                       		bne.s	WaitForZ80	; if not, branch
00002354                            
00002354 7425                       		moveq	#$25,d2
00002356                            Z80InitLoop:
00002356 10DD                       		move.b	(a5)+,(a0)+
00002358 51CA FFFC                  		dbf	d2,Z80InitLoop
0000235C                            		
0000235C 3480                       		move.w	d0,(a2)
0000235E 3280                       		move.w	d0,(a1)		; start	the Z80
00002360 3487                       		move.w	d7,(a2)		; reset	the Z80
00002362                            
00002362                            ClrRAMLoop:
00002362 2D00                       		move.l	d0,-(a6)	; clear 4 bytes of RAM
00002364 51CE FFFC                  		dbf	d6,ClrRAMLoop	; repeat until the entire RAM is clear
00002368 289D                       		move.l	(a5)+,(a4)	; set VDP display mode and increment mode
0000236A 289D                       		move.l	(a5)+,(a4)	; set VDP to CRAM write
0000236C                            
0000236C 761F                       		moveq	#$1F,d3	; set repeat times
0000236E                            ClrCRAMLoop:
0000236E 2680                       		move.l	d0,(a3)	; clear 2 palettes
00002370 51CB FFFC                  		dbf	d3,ClrCRAMLoop	; repeat until the entire CRAM is clear
00002374 289D                       		move.l	(a5)+,(a4)	; set VDP to VSRAM write
00002376                            
00002376 7813                       		moveq	#$13,d4
00002378                            ClrVSRAMLoop:
00002378 2680                       		move.l	d0,(a3)	; clear 4 bytes of VSRAM.
0000237A 51CC FFFC                  		dbf	d4,ClrVSRAMLoop	; repeat until the entire VSRAM is clear
0000237E 7A03                       		moveq	#3,d5
00002380                            
00002380                            PSGInitLoop:
00002380 175D 0011                  		move.b	(a5)+,$11(a3)	; reset	the PSG
00002384 51CD FFFA                  		dbf	d5,PSGInitLoop	; repeat for other channels
00002388 3480                       		move.w	d0,(a2)
0000238A 4CD6 7FFF                  		movem.l	(a6),d0-a6	; clear all registers
0000238E 46FC 2700                  		disable_ints
00002392                            
00002392                            SkipSetup:
00002392 6000                       		bra.s	GameProgram	; begin game
00002394                            
00002394                            
00002394                            ; ===========================================================================
00002394 8000                       SetupValues:	dc.w $8000		; VDP register start number
00002396 3FFF                       		dc.w $3FFF		; size of RAM/4
00002398 0100                       		dc.w $100		; VDP register diff
0000239A                            
0000239A 00A0 0000                  		dc.l z80_ram		; start	of Z80 RAM
0000239E 00A1 1100                  		dc.l z80_bus_request	; Z80 bus request
000023A2 00A1 1200                  		dc.l z80_reset		; Z80 reset
000023A6 00C0 0000                  		dc.l vdp_data_port	; VDP data
000023AA 00C0 0004                  		dc.l vdp_control_port	; VDP control
000023AE                            
000023AE 04                         		dc.b 4			; VDP $80 - 8-colour mode
000023AF 14                         		dc.b $14		; VDP $81 - Megadrive mode, DMA enable
000023B0 30                         		dc.b ($C000>>10)	; VDP $82 - foreground nametable address
000023B1 3C                         		dc.b ($F000>>10)	; VDP $83 - window nametable address
000023B2 07                         		dc.b ($E000>>13)	; VDP $84 - background nametable address
000023B3 6C                         		dc.b ($D800>>9)		; VDP $85 - sprite table address
000023B4 00                         		dc.b 0			; VDP $86 - unused
000023B5 00                         		dc.b 0			; VDP $87 - background colour
000023B6 00                         		dc.b 0			; VDP $88 - unused
000023B7 00                         		dc.b 0			; VDP $89 - unused
000023B8 FF                         		dc.b 255		; VDP $8A - HBlank register
000023B9 00                         		dc.b 0			; VDP $8B - full screen scroll
000023BA 81                         		dc.b $81		; VDP $8C - 40 cell display
000023BB 37                         		dc.b ($DC00>>10)	; VDP $8D - hscroll table address
000023BC 00                         		dc.b 0			; VDP $8E - unused
000023BD 01                         		dc.b 1			; VDP $8F - VDP increment
000023BE 01                         		dc.b 1			; VDP $90 - 64 cell hscroll size
000023BF 00                         		dc.b 0			; VDP $91 - window h position
000023C0 00                         		dc.b 0			; VDP $92 - window v position
000023C1 FFFF                       		dc.w $FFFF		; VDP $93/94 - DMA length
000023C3 0000                       		dc.w 0			; VDP $95/96 - DMA source
000023C5 80                         		dc.b $80		; VDP $97 - DMA fill VRAM
000023C6 4000 0080                  		dc.l $40000080		; VRAM address 0
000023CA                            
000023CA AF                         		dc.b $AF		; xor	a
000023CB 01D9 1F                    		dc.b $01, $D9, $1F	; ld	bc,1fd9h
000023CE 1127 00                    		dc.b $11, $27, $00	; ld	de,0027h
000023D1 2126 00                    		dc.b $21, $26, $00	; ld	hl,0026h
000023D4 F9                         		dc.b $F9		; ld	sp,hl
000023D5 77                         		dc.b $77		; ld	(hl),a
000023D6 EDB0                       		dc.b $ED, $B0		; ldir
000023D8 DDE1                       		dc.b $DD, $E1		; pop	ix
000023DA FDE1                       		dc.b $FD, $E1		; pop	iy
000023DC ED47                       		dc.b $ED, $47		; ld	i,a
000023DE ED4F                       		dc.b $ED, $4F		; ld	r,a
000023E0 D1                         		dc.b $D1		; pop	de
000023E1 E1                         		dc.b $E1		; pop	hl
000023E2 F1                         		dc.b $F1		; pop	af
000023E3 08                         		dc.b $08		; ex	af,af'
000023E4 D9                         		dc.b $D9		; exx
000023E5 C1                         		dc.b $C1		; pop	bc
000023E6 D1                         		dc.b $D1		; pop	de
000023E7 E1                         		dc.b $E1		; pop	hl
000023E8 F1                         		dc.b $F1		; pop	af
000023E9 F9                         		dc.b $F9		; ld	sp,hl
000023EA F3                         		dc.b $F3		; di
000023EB ED56                       		dc.b $ED, $56		; im1
000023ED 36E9                       		dc.b $36, $E9		; ld	(hl),e9h
000023EF E9                         		dc.b $E9		; jp	(hl)
000023F0                            
000023F0 8104                       		dc.w $8104		; VDP display mode
000023F2 8F02                       		dc.w $8F02		; VDP increment
000023F4 C000 0000                  		dc.l $C0000000		; CRAM write mode
000023F8 4000 0010                  		dc.l $40000010		; VSRAM address 0
000023FC                            
000023FC 9FBF DFFF                  		dc.b $9F, $BF, $DF, $FF	; values for PSG channel volumes
00002400                            ; ===========================================================================
00002400                            
00002400                            GameProgram:
00002400 4A79 00C0 0004             		tst.w	(vdp_control_port).l
00002406 0839 0006 00A1 000D        		btst	#6,($A1000D).l
0000240E 6700                       		beq.s	CheckSumCheck
00002410 0CB8 696E 6974 FFFC        		cmpi.l	#'init',(v_init).w ; has checksum routine already run?
00002418 6700 0000                  		beq.w	GameInit	; if yes, branch
0000241C                            
0000241C                            CheckSumCheck:
0000241C 207C 0000 0200             		movea.l	#EndOfHeader,a0	; start	checking bytes after the header	($200)
00002422 227C 0000 01A4             		movea.l	#RomEndLoc,a1	; stop at end of ROM
00002428 2011                       		move.l	(a1),d0
0000242A 7200                       		moveq	#0,d1
0000242C                            
0000242C                            	@loop:
0000242C D258                       		add.w	(a0)+,d1
0000242E B088                       		cmp.l	a0,d0
00002430 64FA                       		bhs.s	@loop
00002432 227C 0000 018E             		movea.l	#Checksum,a1	; read the checksum
00002438 B251                       		cmp.w	(a1),d1		; compare checksum in header to ROM
0000243A 6600 0000                  		bne.w	CheckSumError	; if they don't match, branch
0000243E                            
0000243E                            	CheckSumOk:
0000243E 4DF8 FE00                  		lea	($FFFFFE00).w,a6
00002442 7E00                       		moveq	#0,d7
00002444 3C3C 007F                  		move.w	#$7F,d6
00002448                            	@clearRAM:
00002448 2CC7                       		move.l	d7,(a6)+
0000244A 51CE FFFC                  		dbf	d6,@clearRAM	; clear RAM ($FE00-$FFFF)
0000244E                            
0000244E 1039 00A1 0001             		move.b	(z80_version).l,d0
00002454 0200 00C0                  		andi.b	#$C0,d0
00002458 11C0 FFF8                  		move.b	d0,(v_megadrive).w ; get region setting
0000245C 21FC 696E 6974 FFFC        		move.l	#'init',(v_init).w ; set flag so checksum won't run again
00002464                            
00002464                            GameInit:
00002464 4DF9 00FF 0000             		lea	($FF0000).l,a6
0000246A 7E00                       		moveq	#0,d7
0000246C 3C3C 3F7F                  		move.w	#$3F7F,d6
00002470                            	@clearRAM:
00002470 2CC7                       		move.l	d7,(a6)+
00002472 51CE FFFC                  		dbf	d6,@clearRAM	; clear RAM ($0000-$FDFF)
00002476                            
00002476 6100 0000                  		bsr.w	VDPSetupGame
0000247A 6100 0000                  		bsr.w	SoundDriverLoad
0000247E 6100 0000                  		bsr.w	JoypadInit
00002482 11FC 0000 F600             		move.b	#id_Sega,(v_gamemode).w ; set Game Mode to Sega Screen
00002488                            
00002488                            MainGameLoop:
00002488 1038 F600                  		move.b	(v_gamemode).w,d0 ; load Game Mode
0000248C 0240 007C                  		andi.w	#$7C,d0	; limit Game Mode value to $1C max (change to a maximum of 7C to add more game modes)
00002490 4EBB 0000                  		jsr	GameModeArray(pc,d0.w) ; jump to apt location in ROM
00002494 60F2                       		bra.s	MainGameLoop	; loop indefinitely
00002496                            ; ===========================================================================
00002496                            ; ---------------------------------------------------------------------------
00002496                            ; Main game mode array
00002496                            ; ---------------------------------------------------------------------------
00002496                            
00002496                            GameModeArray:
00002496                            
00002496 6000 0000                  ptr_GM_Sega:	bra.w	GM_Sega		; Sega Screen ($00)
0000249A                            
0000249A 6000 0000                  ptr_GM_Title:	bra.w	GM_Title	; Title	Screen ($04)
0000249E                            
0000249E 6000 0000                  ptr_GM_Demo:	bra.w	GM_Level	; Demo Mode ($08)
000024A2                            
000024A2 6000 0000                  ptr_GM_Level:	bra.w	GM_Level	; Normal Level ($0C)
000024A6                            
000024A6 6000 0000                  ptr_GM_Special:	bra.w	GM_Special	; Special Stage	($10)
000024AA                            
000024AA 6000 0000                  ptr_GM_Cont:	bra.w	GM_Continue	; Continue Screen ($14)
000024AE                            
000024AE 6000 0000                  ptr_GM_Ending:	bra.w	GM_Ending	; End of game sequence ($18)
000024B2                            
000024B2 6000 0000                  ptr_GM_Credits:	bra.w	GM_Credits	; Credits ($1C)
000024B6                            
000024B6 6000 0000                  ptr_GM_OtherSega:	bra.w	GM_RadNexAff		; Sega Screen ($20)
000024BA                            
000024BA 6000 0000                  ptr_GM_SimpleCreds:	bra.w	GM_SimpleCreds		; Credits ($24)
000024BE                            
000024BE 6000 0000                  ptr_GM_Hack:	bra.w	GM_Hack		; Credits ($28)
000024C2                            
000024C2 4E75                       		rts	
000024C4                            ; ===========================================================================
000024C4                            
000024C4                            CheckSumError:
00002570                            
00002570                            	@endlessloop:
00002570 60FE                       		bra.s	@endlessloop
00002572                            
00002572                            ; ===========================================================================
00002572                            
00002572                            Art_Text:	incbin	"artunc\menutext.bin" ; text used in level select and debug mode
00002A92                            		even
00002A92                            
00002A92                            ; ===========================================================================
00002A92                            ; ---------------------------------------------------------------------------
00002A92                            ; Vertical interrupt
00002A92                            ; ---------------------------------------------------------------------------
00002A92                            
00002A92                            VBlank:
00002A92 48E7 FFFE                  		movem.l	d0-a6,-(sp)
00002A96 4A38 F62A                  		tst.b	(v_vbla_routine).w
00002A9A 6700                       		beq.s	VBla_00
00002A9C 3039 00C0 0004             		move.w	(vdp_control_port).l,d0
00002AA2 23FC 4000 0010 00C0 0004   		move.l	#$40000010,(vdp_control_port).l
00002AAC 23F8 F616 00C0 0000        		move.l	(v_scrposy_dup).w,(vdp_data_port).l ; send screen y-axis pos. to VSRAM
00002AB4 0838 0006 FFF8             		btst	#6,(v_megadrive).w ; is Megadrive PAL?
00002ABA 6700                       		beq.s	@notPAL		; if not, branch
00002ABC                            
00002ABC 303C 0700                  		move.w	#$700,d0
00002AC0                            	@waitPAL:
00002AC0 51C8 FFFE                  		dbf	d0,@waitPAL ; wait here in a loop doing nothing for a while...
00002AC4                            
00002AC4                            	@notPAL:
00002AC4 1038 F62A                  		move.b	(v_vbla_routine).w,d0
00002AC8 11FC 0000 F62A             		move.b	#0,(v_vbla_routine).w
00002ACE 31FC 0001 F644             		move.w	#1,(f_hbla_pal).w
00002AD4 0240 003E                  		andi.w	#$3E,d0
00002AD8 303B 0000                  		move.w	VBla_Index(pc,d0.w),d0
00002ADC 4EBB 0000                  		jsr	VBla_Index(pc,d0.w)
00002AE0                            
00002AE0                            VBla_Music:
00002AE0 4EB9 0000 0000             		jsr	(UpdateMusic).l
00002AE6                            
00002AE6                            VBla_Exit:
00002AE6 52B8 FE0C                  		addq.l	#1,(v_vbla_count).w
00002AEA 4CDF 7FFF                  		movem.l	(sp)+,d0-a6
00002AEE 4E73                       		rte	
00002AF0                            ; ===========================================================================
00002AF0 0000 0000                  VBla_Index:	dc.w VBla_00-VBla_Index, VBla_02-VBla_Index
00002AF4 0000 0000                  		dc.w VBla_04-VBla_Index, VBla_06-VBla_Index
00002AF8 0000 0000                  		dc.w VBla_08-VBla_Index, VBla_0A-VBla_Index
00002AFC 0000 0000                  		dc.w VBla_0C-VBla_Index, VBla_0E-VBla_Index
00002B00 0000 0000                  		dc.w VBla_10-VBla_Index, VBla_12-VBla_Index
00002B04 0000 0000                  		dc.w VBla_14-VBla_Index, VBla_16-VBla_Index
00002B08 0000                       		dc.w VBla_0C-VBla_Index
00002B0A                            ; ===========================================================================
00002B0A                            
00002B0A                            VBla_00:
00002B0A 0C38 0000 F600             		cmpi.b	#$80+id_Level,(v_gamemode).w
00002B10 6700                       		beq.s	@islevel
00002B12 0C38 0000 F600             		cmpi.b	#id_Level,(v_gamemode).w ; is game on a level?
00002B18 6600 FFC6                  		bne.w	VBla_Music	; if not, branch
00002B1C                            
00002B1C                            	@islevel:
00002B1C 0C38 0001 FE10             		cmpi.b	#id_LZ,(v_zone).w ; is level LZ ?
00002B22 6600 FFBC                  		bne.w	VBla_Music	; if not, branch
00002B26                            
00002B26 3039 00C0 0004             		move.w	(vdp_control_port).l,d0
00002B2C 0838 0006 FFF8             		btst	#6,(v_megadrive).w ; is Megadrive PAL?
00002B32 6700                       		beq.s	@notPAL		; if not, branch
00002B34                            
00002B34 303C 0700                  		move.w	#$700,d0
00002B38                            	@waitPAL:
00002B38 51C8 FFFE                  		dbf	d0,@waitPAL
00002B3C                            
00002B3C                            	@notPAL:
00002B3C 31FC 0001 F644             		move.w	#1,(f_hbla_pal).w ; set HBlank flag
00002B42 33FC 0100 00A1 1100        		stopZ80
00002B4A 0839 0000 00A1 1100 66F6   		waitZ80
00002B54 4A38 F64E                  		tst.b	(f_wtr_state).w	; is water above top of screen?
00002B58 6600                       		bne.s	@waterabove 	; if yes, branch
00002B5A                            
00002B5A 4BF9 00C0 0004 2ABC 9400+  		writeCRAM	v_pal_dry,$80,0
00002B7E 6000                       		bra.s	@waterbelow
00002B80                            
00002B80                            @waterabove:
00002B80 4BF9 00C0 0004 2ABC 9400+  		writeCRAM	v_pal_water,$80,0
00002BA4                            
00002BA4                            	@waterbelow:
00002BA4 3AB8 F624                  		move.w	(v_hbla_hreg).w,(a5)
00002BA8 33FC 0000 00A1 1100        		startZ80
00002BB0 6000 FF2E                  		bra.w	VBla_Music
00002BB4                            ; ===========================================================================
00002BB4                            
00002BB4                            VBla_02:
00002BB4 6100 0000                  		bsr.w	sub_106E
00002BB8                            
00002BB8                            VBla_14:
00002BB8 4A78 F614                  		tst.w	(v_demolength).w
00002BBC 6700 0000                  		beq.w	@end
00002BC0 5378 F614                  		subq.w	#1,(v_demolength).w
00002BC4                            
00002BC4                            	@end:
00002BC4 4E75                       		rts	
00002BC6                            ; ===========================================================================
00002BC6                            
00002BC6                            VBla_04:
00002BC6 6100 0000                  		bsr.w	sub_106E
00002BCA 6100 0000                  		bsr.w	LoadTilesAsYouMove_BGOnly
00002BCE 6100 0000                  		bsr.w	sub_1642
00002BD2 4A78 F614                  		tst.w	(v_demolength).w
00002BD6 6700 0000                  		beq.w	@end
00002BDA 5378 F614                  		subq.w	#1,(v_demolength).w
00002BDE                            
00002BDE                            	@end:
00002BDE 4E75                       		rts	
00002BE0                            ; ===========================================================================
00002BE0                            
00002BE0                            VBla_06:
00002BE0 6100 0000                  		bsr.w	sub_106E
00002BE4 4E75                       		rts	
00002BE6                            ; ===========================================================================
00002BE6                            
00002BE6                            VBla_10:
00002BE6 0C38 0000 F600             		cmpi.b	#id_Special,(v_gamemode).w ; is game on special stage?
00002BEC 6700 0000                  		beq.w	VBla_0A		; if yes, branch
00002BF0                            
00002BF0                            VBla_08:
00002BF0 33FC 0100 00A1 1100        		stopZ80
00002BF8 0839 0000 00A1 1100 66F6   		waitZ80
00002C02 6100 0000                  		bsr.w	ReadJoypads
00002C06 4A38 F64E                  		tst.b	(f_wtr_state).w
00002C0A 6600                       		bne.s	@waterabove
00002C0C                            
00002C0C 4BF9 00C0 0004 2ABC 9400+  		writeCRAM	v_pal_dry,$80,0
00002C30 6000                       		bra.s	@waterbelow
00002C32                            
00002C32                            @waterabove:
00002C32 4BF9 00C0 0004 2ABC 9400+  		writeCRAM	v_pal_water,$80,0
00002C56                            
00002C56                            	@waterbelow:
00002C56 3AB8 F624                  		move.w	(v_hbla_hreg).w,(a5)
00002C5A                            
00002C5A 4BF9 00C0 0004 2ABC 9401+  		writeVRAM	v_hscrolltablebuffer,$380,vram_hscroll
00002C7E 4BF9 00C0 0004 2ABC 9401+  		writeVRAM	v_spritetablebuffer,$280,vram_sprites
00002CA2 4A38 F767                  		tst.b	(f_sonframechg).w ; has Sonic's sprite changed?
00002CA6 6700                       		beq.s	@nochg		; if not, branch
00002CA8                            
00002CA8 4BF9 00C0 0004 2ABC 9401+  		writeVRAM	v_sgfx_buffer,$2E0,vram_sonic ; load new Sonic gfx
00002CCC 11FC 0000 F767             		move.b	#0,(f_sonframechg).w
00002CD2                            
00002CD2                            	@nochg:
00002CD2 33FC 0000 00A1 1100        		startZ80
00002CDA 4CF8 00FF F700             		movem.l	(v_screenposx).w,d0-d7
00002CE0 48F8 00FF FF10             		movem.l	d0-d7,(v_screenposx_dup).w
00002CE6 4CF8 0003 F754             		movem.l	(v_fg_scroll_flags).w,d0-d1
00002CEC 48F8 0003 FF30             		movem.l	d0-d1,(v_fg_scroll_flags_dup).w
00002CF2 0C38 0060 F625             		cmpi.b	#96,(v_hbla_line).w
00002CF8 6400                       		bhs.s	Demo_Time
00002CFA 11FC 0001 F64F             		move.b	#1,($FFFFF64F).w
00002D00 588F                       		addq.l	#4,sp
00002D02 6000 FDE2                  		bra.w	VBla_Exit
00002D06                            
00002D06                            ; ---------------------------------------------------------------------------
00002D06                            ; Subroutine to	run a demo for an amount of time
00002D06                            ; ---------------------------------------------------------------------------
00002D06                            
00002D06                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00002D06                            
00002D06                            
00002D06                            Demo_Time:
00002D06 6100 0000                  		bsr.w	LoadTilesAsYouMove
00002D0A 4EB9 0000 0000             		jsr	(AnimateLevelGfx).l
00002D10 4EB9 0000 0000             		jsr	(HUD_Update).l
00002D16 6100 0000                  		bsr.w	ProcessDPLC2
00002D1A 4A78 F614                  		tst.w	(v_demolength).w ; is there time left on the demo?
00002D1E 6700 0000                  		beq.w	@end		; if not, branch
00002D22 5378 F614                  		subq.w	#1,(v_demolength).w ; subtract 1 from time left
00002D26                            
00002D26                            	@end:
00002D26 4E75                       		rts	
00002D28                            ; End of function Demo_Time
00002D28                            
00002D28                            ; ===========================================================================
00002D28                            
00002D28                            VBla_0A:
00002D28 33FC 0100 00A1 1100        		stopZ80
00002D30 0839 0000 00A1 1100 66F6   		waitZ80
00002D3A 6100 0000                  		bsr.w	ReadJoypads
00002D3E 4BF9 00C0 0004 2ABC 9400+  		writeCRAM	v_pal_dry,$80,0
00002D62 4BF9 00C0 0004 2ABC 9401+  		writeVRAM	v_spritetablebuffer,$280,vram_sprites
00002D86 4BF9 00C0 0004 2ABC 9401+  		writeVRAM	v_hscrolltablebuffer,$380,vram_hscroll
00002DAA 33FC 0000 00A1 1100        		startZ80
00002DB2 6100 0000                  		bsr.w	PalCycle_SS
00002DB6 4A38 F767                  		tst.b	(f_sonframechg).w ; has Sonic's sprite changed?
00002DBA 6700                       		beq.s	@nochg		; if not, branch
00002DBC                            
00002DBC 4BF9 00C0 0004 2ABC 9401+  		writeVRAM	v_sgfx_buffer,$2E0,vram_sonic ; load new Sonic gfx
00002DE0 11FC 0000 F767             		move.b	#0,(f_sonframechg).w
00002DE6                            
00002DE6                            	@nochg:
00002DE6 4A78 F614                  		tst.w	(v_demolength).w	; is there time left on the demo?
00002DEA 6700 0000                  		beq.w	@end	; if not, return
00002DEE 5378 F614                  		subq.w	#1,(v_demolength).w	; subtract 1 from time left in demo
00002DF2                            
00002DF2                            	@end:
00002DF2 4E75                       		rts	
00002DF4                            ; ===========================================================================
00002DF4                            
00002DF4                            VBla_0C:
00002DF4 33FC 0100 00A1 1100        		stopZ80
00002DFC 0839 0000 00A1 1100 66F6   		waitZ80
00002E06 6100 0000                  		bsr.w	ReadJoypads
00002E0A 4A38 F64E                  		tst.b	(f_wtr_state).w
00002E0E 6600                       		bne.s	@waterabove
00002E10                            
00002E10 4BF9 00C0 0004 2ABC 9400+  		writeCRAM	v_pal_dry,$80,0
00002E34 6000                       		bra.s	@waterbelow
00002E36                            
00002E36                            @waterabove:
00002E36 4BF9 00C0 0004 2ABC 9400+  		writeCRAM	v_pal_water,$80,0
00002E5A                            
00002E5A                            	@waterbelow:
00002E5A 3AB8 F624                  		move.w	(v_hbla_hreg).w,(a5)
00002E5E 4BF9 00C0 0004 2ABC 9401+  		writeVRAM	v_hscrolltablebuffer,$380,vram_hscroll
00002E82 4BF9 00C0 0004 2ABC 9401+  		writeVRAM	v_spritetablebuffer,$280,vram_sprites
00002EA6 4A38 F767                  		tst.b	(f_sonframechg).w
00002EAA 6700                       		beq.s	@nochg
00002EAC 4BF9 00C0 0004 2ABC 9401+  		writeVRAM	v_sgfx_buffer,$2E0,vram_sonic
00002ED0 11FC 0000 F767             		move.b	#0,(f_sonframechg).w
00002ED6                            
00002ED6                            	@nochg:
00002ED6 33FC 0000 00A1 1100        		startZ80
00002EDE 4CF8 00FF F700             		movem.l	(v_screenposx).w,d0-d7
00002EE4 48F8 00FF FF10             		movem.l	d0-d7,(v_screenposx_dup).w
00002EEA 4CF8 0003 F754             		movem.l	(v_fg_scroll_flags).w,d0-d1
00002EF0 48F8 0003 FF30             		movem.l	d0-d1,(v_fg_scroll_flags_dup).w
00002EF6 6100 0000                  		bsr.w	LoadTilesAsYouMove
00002EFA 4EB9 0000 0000             		jsr	(AnimateLevelGfx).l
00002F00 4EB9 0000 0000             		jsr	(HUD_Update).l
00002F06 6100 0000                  		bsr.w	sub_1642
00002F0A 4E75                       		rts	
00002F0C                            ; ===========================================================================
00002F0C                            
00002F0C                            VBla_0E:
00002F0C 6100 0000                  		bsr.w	sub_106E
00002F10 5238 F628                  		addq.b	#1,($FFFFF628).w
00002F14 11FC 000E F62A             		move.b	#$E,(v_vbla_routine).w
00002F1A 4E75                       		rts	
00002F1C                            ; ===========================================================================
00002F1C                            
00002F1C                            VBla_12:
00002F1C 6100 0000                  		bsr.w	sub_106E
00002F20 3AB8 F624                  		move.w	(v_hbla_hreg).w,(a5)
00002F24 6000 0000                  		bra.w	sub_1642
00002F28                            ; ===========================================================================
00002F28                            
00002F28                            VBla_16:
00002F28 33FC 0100 00A1 1100        		stopZ80
00002F30 0839 0000 00A1 1100 66F6   		waitZ80
00002F3A 6100 0000                  		bsr.w	ReadJoypads
00002F3E 4BF9 00C0 0004 2ABC 9400+  		writeCRAM	v_pal_dry,$80,0
00002F62 4BF9 00C0 0004 2ABC 9401+  		writeVRAM	v_spritetablebuffer,$280,vram_sprites
00002F86 4BF9 00C0 0004 2ABC 9401+  		writeVRAM	v_hscrolltablebuffer,$380,vram_hscroll
00002FAA 33FC 0000 00A1 1100        		startZ80
00002FB2 4A38 F767                  		tst.b	(f_sonframechg).w
00002FB6 6700                       		beq.s	@nochg
00002FB8 4BF9 00C0 0004 2ABC 9401+  		writeVRAM	v_sgfx_buffer,$2E0,vram_sonic
00002FDC 11FC 0000 F767             		move.b	#0,(f_sonframechg).w
00002FE2                            
00002FE2                            	@nochg:
00002FE2 4A78 F614                  		tst.w	(v_demolength).w
00002FE6 6700 0000                  		beq.w	@end
00002FEA 5378 F614                  		subq.w	#1,(v_demolength).w
00002FEE                            
00002FEE                            	@end:
00002FEE 4E75                       		rts	
00002FF0                            
00002FF0                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00002FF0                            
00002FF0                            
00002FF0                            sub_106E:
00002FF0 33FC 0100 00A1 1100        		stopZ80
00002FF8 0839 0000 00A1 1100 66F6   		waitZ80
00003002 6100 0000                  		bsr.w	ReadJoypads
00003006 4A38 F64E                  		tst.b	(f_wtr_state).w ; is water above top of screen?
0000300A 6600                       		bne.s	@waterabove	; if yes, branch
0000300C 4BF9 00C0 0004 2ABC 9400+  		writeCRAM	v_pal_dry,$80,0
00003030 6000                       		bra.s	@waterbelow
00003032                            
00003032                            	@waterabove:
00003032 4BF9 00C0 0004 2ABC 9400+  		writeCRAM	v_pal_water,$80,0
00003056                            
00003056                            	@waterbelow:
00003056 4BF9 00C0 0004 2ABC 9401+  		writeVRAM	v_spritetablebuffer,$280,vram_sprites
0000307A 4BF9 00C0 0004 2ABC 9401+  		writeVRAM	v_hscrolltablebuffer,$380,vram_hscroll
0000309E 33FC 0000 00A1 1100        		startZ80
000030A6 4E75                       		rts	
000030A8                            ; End of function sub_106E
000030A8                            
000030A8                            ; ---------------------------------------------------------------------------
000030A8                            ; Horizontal interrupt
000030A8                            ; ---------------------------------------------------------------------------
000030A8                            
000030A8                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
000030A8                            
000030A8                            
000030A8                            HBlank:
000030A8 46FC 2700                  		disable_ints
000030AC 4A78 F644                  		tst.w	(f_hbla_pal).w	; is palette set to change?
000030B0 6700                       		beq.s	@nochg		; if not, branch
000030B2 31FC 0000 F644             		move.w	#0,(f_hbla_pal).w
000030B8 48E7 00C0                  		movem.l	a0-a1,-(sp)
000030BC 43F9 00C0 0000             		lea	(vdp_data_port).l,a1
000030C2 41F8 FA80                  		lea	(v_pal_water).w,a0 ; get palette from RAM
000030C6 237C C000 0000 0004        		move.l	#$C0000000,4(a1) ; set VDP to CRAM write
000030CE 2298                       		move.l	(a0)+,(a1)	; move palette to CRAM
000030D0 2298                       		move.l	(a0)+,(a1)
000030D2 2298                       		move.l	(a0)+,(a1)
000030D4 2298                       		move.l	(a0)+,(a1)
000030D6 2298                       		move.l	(a0)+,(a1)
000030D8 2298                       		move.l	(a0)+,(a1)
000030DA 2298                       		move.l	(a0)+,(a1)
000030DC 2298                       		move.l	(a0)+,(a1)
000030DE 2298                       		move.l	(a0)+,(a1)
000030E0 2298                       		move.l	(a0)+,(a1)
000030E2 2298                       		move.l	(a0)+,(a1)
000030E4 2298                       		move.l	(a0)+,(a1)
000030E6 2298                       		move.l	(a0)+,(a1)
000030E8 2298                       		move.l	(a0)+,(a1)
000030EA 2298                       		move.l	(a0)+,(a1)
000030EC 2298                       		move.l	(a0)+,(a1)
000030EE 2298                       		move.l	(a0)+,(a1)
000030F0 2298                       		move.l	(a0)+,(a1)
000030F2 2298                       		move.l	(a0)+,(a1)
000030F4 2298                       		move.l	(a0)+,(a1)
000030F6 2298                       		move.l	(a0)+,(a1)
000030F8 2298                       		move.l	(a0)+,(a1)
000030FA 2298                       		move.l	(a0)+,(a1)
000030FC 2298                       		move.l	(a0)+,(a1)
000030FE 2298                       		move.l	(a0)+,(a1)
00003100 2298                       		move.l	(a0)+,(a1)
00003102 2298                       		move.l	(a0)+,(a1)
00003104 2298                       		move.l	(a0)+,(a1)
00003106 2298                       		move.l	(a0)+,(a1)
00003108 2298                       		move.l	(a0)+,(a1)
0000310A 2298                       		move.l	(a0)+,(a1)
0000310C 2298                       		move.l	(a0)+,(a1)
0000310E 337C 8ADF 0004             		move.w	#$8A00+223,4(a1) ; reset HBlank register
00003114 4CDF 0300                  		movem.l	(sp)+,a0-a1
00003118 4A38 F64F                  		tst.b	($FFFFF64F).w
0000311C 6600                       		bne.s	loc_119E
0000311E                            
0000311E                            	@nochg:
0000311E 4E73                       		rte	
00003120                            ; ===========================================================================
00003120                            
00003120                            loc_119E:
00003120 4238 F64F                  		clr.b	($FFFFF64F).w
00003124 48E7 FFFE                  		movem.l	d0-a6,-(sp)
00003128 6100 FBDC                  		bsr.w	Demo_Time
0000312C 4EB9 0000 0000             		jsr	(UpdateMusic).l
00003132 4CDF 7FFF                  		movem.l	(sp)+,d0-a6
00003136 4E73                       		rte	
00003138                            ; End of function HBlank
00003138                            
00003138                            ; ---------------------------------------------------------------------------
00003138                            ; Subroutine to	initialise joypads
00003138                            ; ---------------------------------------------------------------------------
00003138                            
00003138                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00003138                            
00003138                            
00003138                            JoypadInit:
00003138 33FC 0100 00A1 1100        		stopZ80
00003140 0839 0000 00A1 1100 66F6   		waitZ80
0000314A 7040                       		moveq	#$40,d0
0000314C 13C0 00A1 0009             		move.b	d0,($A10009).l	; init port 1 (joypad 1)
00003152 13C0 00A1 000B             		move.b	d0,($A1000B).l	; init port 2 (joypad 2)
00003158 13C0 00A1 000D             		move.b	d0,($A1000D).l	; init port 3 (expansion/extra)
0000315E 33FC 0000 00A1 1100        		startZ80
00003166 4E75                       		rts	
00003168                            ; End of function JoypadInit
00003168                            
00003168                            ; ---------------------------------------------------------------------------
00003168                            ; Subroutine to	read joypad input, and send it to the RAM
00003168                            ; ---------------------------------------------------------------------------
00003168                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00003168                            
00003168                            
00003168                            ReadJoypads:
00003168 41F8 F604                  		lea	(v_jpadhold1).w,a0 ; address where joypad states are written
0000316C 43F9 00A1 0003             		lea	($A10003).l,a1	; first	joypad port
00003172 6100                       		bsr.s	@read		; do the first joypad
00003174 5449                       		addq.w	#2,a1		; do the second	joypad
00003176                            
00003176                            	@read:
00003176 12BC 0000                  		move.b	#0,(a1)
0000317A 4E71                       		nop	
0000317C 4E71                       		nop	
0000317E 1011                       		move.b	(a1),d0
00003180 E508                       		lsl.b	#2,d0
00003182 0200 00C0                  		andi.b	#$C0,d0
00003186 12BC 0040                  		move.b	#$40,(a1)
0000318A 4E71                       		nop	
0000318C 4E71                       		nop	
0000318E 1211                       		move.b	(a1),d1
00003190 0201 003F                  		andi.b	#$3F,d1
00003194 8001                       		or.b	d1,d0
00003196 4600                       		not.b	d0
00003198 1210                       		move.b	(a0),d1
0000319A B101                       		eor.b	d0,d1
0000319C 10C0                       		move.b	d0,(a0)+
0000319E C200                       		and.b	d0,d1
000031A0 10C1                       		move.b	d1,(a0)+
000031A2 4E75                       		rts	
000031A4                            ; End of function ReadJoypads
000031A4                            
000031A4                            
000031A4                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
000031A4                            
000031A4                            
000031A4                            VDPSetupGame:
000031A4 41F9 00C0 0004             		lea	(vdp_control_port).l,a0
000031AA 43F9 00C0 0000             		lea	(vdp_data_port).l,a1
000031B0 45F9 0000 0000             		lea	(VDPSetupArray).l,a2
000031B6 7E12                       		moveq	#$12,d7
000031B8                            
000031B8                            	@setreg:
000031B8 309A                       		move.w	(a2)+,(a0)
000031BA 51CF FFFC                  		dbf	d7,@setreg	; set the VDP registers
000031BE                            
000031BE 3039 0000 0000             		move.w	(VDPSetupArray+2).l,d0
000031C4 31C0 F60C                  		move.w	d0,(v_vdp_buffer1).w
000031C8 31FC 8ADF F624             		move.w	#$8A00+223,(v_hbla_hreg).w	; H-INT every 224th scanline
000031CE 7000                       		moveq	#0,d0
000031D0 23FC C000 0000 00C0 0004   		move.l	#$C0000000,(vdp_control_port).l ; set VDP to CRAM write
000031DA 3E3C 003F                  		move.w	#$3F,d7
000031DE                            
000031DE                            	@clrCRAM:
000031DE 3280                       		move.w	d0,(a1)
000031E0 51CF FFFC                  		dbf	d7,@clrCRAM	; clear	the CRAM
000031E4                            
000031E4 42B8 F616                  		clr.l	(v_scrposy_dup).w
000031E8 42B8 F61A                  		clr.l	(v_scrposx_dup).w
000031EC 2F01                       		move.l	d1,-(sp)
000031EE 4BF9 00C0 0004 3ABC 8F01+  		fillVRAM	0,$FFFF,0
00003210                            
00003210                            	@waitforDMA:
00003210 3215                       		move.w	(a5),d1
00003212 0801 0001                  		btst	#1,d1		; is DMA (fillVRAM) still running?
00003216 66F8                       		bne.s	@waitforDMA	; if yes, branch
00003218                            
00003218 3ABC 8F02                  		move.w	#$8F02,(a5)	; set VDP increment size
0000321C 221F                       		move.l	(sp)+,d1
0000321E 4E75                       		rts	
00003220                            ; End of function VDPSetupGame
00003220                            
00003220                            ; ===========================================================================
00003220 8004                       VDPSetupArray:	dc.w $8004		; 8-colour mode
00003222 8134                       		dc.w $8134		; enable V.interrupts, enable DMA
00003224 8230                       		dc.w $8200+(vram_fg>>10) ; set foreground nametable address
00003226 8328                       		dc.w $8300+($A000>>10)	; set window nametable address
00003228 8407                       		dc.w $8400+(vram_bg>>13) ; set background nametable address
0000322A 857C                       		dc.w $8500+(vram_sprites>>9) ; set sprite table address
0000322C 8600                       		dc.w $8600		; unused
0000322E 8700                       		dc.w $8700		; set background colour (palette entry 0)
00003230 8800                       		dc.w $8800		; unused
00003232 8900                       		dc.w $8900		; unused
00003234 8A00                       		dc.w $8A00		; default H.interrupt register
00003236 8B00                       		dc.w $8B00		; full-screen vertical scrolling
00003238 8C81                       		dc.w $8C81		; 40-cell display mode
0000323A 8D3F                       		dc.w $8D00+(vram_hscroll>>10) ; set background hscroll address
0000323C 8E00                       		dc.w $8E00		; unused
0000323E 8F02                       		dc.w $8F02		; set VDP increment size
00003240 9001                       		dc.w $9001		; 64-cell hscroll size
00003242 9100                       		dc.w $9100		; window horizontal position
00003244 9200                       		dc.w $9200		; window vertical position
00003246                            
00003246                            ; ---------------------------------------------------------------------------
00003246                            ; Subroutine to	clear the screen
00003246                            ; ---------------------------------------------------------------------------
00003246                            
00003246                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00003246                            
00003246                            
00003246                            ClearScreen:
00003246 4BF9 00C0 0004 3ABC 8F01+  		fillVRAM	0,$FFF,vram_fg ; clear foreground namespace
00003268                            
00003268                            	@wait1:
00003268 3215                       		move.w	(a5),d1
0000326A 0801 0001                  		btst	#1,d1
0000326E 66F8                       		bne.s	@wait1
00003270                            
00003270 3ABC 8F02                  		move.w	#$8F02,(a5)
00003274 4BF9 00C0 0004 3ABC 8F01+  		fillVRAM	0,$FFF,vram_bg ; clear background namespace
00003296                            
00003296                            	@wait2:
00003296 3215                       		move.w	(a5),d1
00003298 0801 0001                  		btst	#1,d1
0000329C 66F8                       		bne.s	@wait2
0000329E                            
0000329E 3ABC 8F02                  		move.w	#$8F02,(a5)
000032A2 21FC 0000 0000 F616        		move.l	#0,(v_scrposy_dup).w
000032AA 21FC 0000 0000 F61A        		move.l	#0,(v_scrposx_dup).w
000032B2                            
000032B2 43F8 F800                  		lea	(v_spritetablebuffer).w,a1
000032B6 7000                       		moveq	#0,d0
000032B8 323C 00A0                  		move.w	#($280/4),d1	; This should be ($280/4)-1, leading to a slight bug (first bit of v_pal_water is cleared)
000032BC                            
000032BC                            	@clearsprites:
000032BC 22C0                       		move.l	d0,(a1)+
000032BE 51C9 FFFC                  		dbf	d1,@clearsprites ; clear sprite table (in RAM)
000032C2                            
000032C2 43F8 CC00                  		lea	(v_hscrolltablebuffer).w,a1
000032C6 7000                       		moveq	#0,d0
000032C8 323C 0100                  		move.w	#($400/4),d1	; This should be ($400/4)-1, leading to a slight bug (first bit of the Sonic object's RAM is cleared)
000032CC                            
000032CC                            	@clearhscroll:
000032CC 22C0                       		move.l	d0,(a1)+
000032CE 51C9 FFFC                  		dbf	d1,@clearhscroll ; clear hscroll table (in RAM)
000032D2 4E75                       		rts	
000032D4                            ; End of function ClearScreen
000032D4                            
000032D4                            ; ---------------------------------------------------------------------------
000032D4                            ; Subroutine to	load the sound driver
000032D4                            ; ---------------------------------------------------------------------------
000032D4                            
000032D4                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
000032D4                            
000032D4                            
000032D4                            SoundDriverLoad:
000032D4 4E71                       		nop	
000032D6 33FC 0100 00A1 1100        		stopZ80
000032DE 33FC 0100 00A1 1200        		resetZ80
000032E6 41F9 0000 0000             		lea	(Kos_Z80).l,a0	; load sound driver
000032EC 43F9 00A0 0000             		lea	(z80_ram).l,a1	; target Z80 RAM
000032F2 6100 0000                  		bsr.w	KosDec		; decompress
000032F6 33FC 0000 00A1 1200        		resetZ80a
000032FE 4E71                       		nop	
00003300 4E71                       		nop	
00003302 4E71                       		nop	
00003304 4E71                       		nop	
00003306 33FC 0100 00A1 1200        		resetZ80
0000330E 33FC 0000 00A1 1100        		startZ80
00003316 4E75                       		rts	
00003318                            ; End of function SoundDriverLoad
00003318                            
00003318                            		include	"_incObj\sub PlaySound.asm"
00003318                            ; ---------------------------------------------------------------------------
00003318                            ; Subroutine to	play a music track
00003318                            
00003318                            ; input:
00003318                            ;	d0 = track to play
00003318                            ; ---------------------------------------------------------------------------
00003318                            
00003318                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00003318                            
00003318                            
00003318                            PlaySound:
00003318 11C0 F00A                  		move.b	d0,(v_snddriver_ram+v_soundqueue0).w
0000331C 4E75                       		rts	
0000331E                            ; End of function PlaySound
0000331E                            
0000331E                            ; ---------------------------------------------------------------------------
0000331E                            ; Subroutine to	play a sound effect
0000331E                            ; ---------------------------------------------------------------------------
0000331E                            
0000331E                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
0000331E                            
0000331E                            
0000331E                            PlaySound_Special:
0000331E 11C0 F00B                  		move.b	d0,(v_snddriver_ram+v_soundqueue1).w
00003322 4E75                       		rts	
00003324                            ; End of function PlaySound_Special
00003324                            
00003324                            ; ===========================================================================
00003324                            ; ---------------------------------------------------------------------------
00003324                            ; Unused sound/music subroutine
00003324                            ; ---------------------------------------------------------------------------
00003324                            
00003324                            PlaySound_Unused:
00003324 11C0 F00C                  		move.b	d0,(v_snddriver_ram+v_soundqueue2).w
00003328 4E75                       		rts	
00003328 4E75                       		rts	
0000332A                            		include	"_inc\PauseGame.asm"
0000332A                            ; ---------------------------------------------------------------------------
0000332A                            ; Subroutine to	pause the game
0000332A                            ; ---------------------------------------------------------------------------
0000332A                            
0000332A                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
0000332A                            
0000332A                            
0000332A                            PauseGame:
0000332A 4E71                       		nop	
0000332C 4A38 FE12                  		tst.b	(v_lives).w	; do you have any lives	left?
00003330 6700                       		beq.s	Unpause		; if not, branch
00003332 4A78 F63A                  		tst.w	(f_pause).w	; is game already paused?
00003336 6600                       		bne.s	Pause_StopGame	; if yes, branch
00003338 0838 0007 F605             		btst	#bitStart,(v_jpadpress1).w ; is Start button pressed?
0000333E 6700                       		beq.s	Pause_DoNothing	; if not, branch
00003340                            
00003340                            Pause_StopGame:
00003340 31FC 0001 F63A             		move.w	#1,(f_pause).w	; freeze time
00003346 11FC 0001 F003             		move.b	#1,(v_snddriver_ram+f_pausemusic).w ; pause music
0000334C                            
0000334C                            Pause_Loop:
0000334C 11FC 0010 F62A             		move.b	#$10,(v_vbla_routine).w
00003352 6100 0000                  		bsr.w	WaitForVBla
00003356 4A38 FFE1                  		tst.b	(f_slomocheat).w ; is slow-motion cheat on?
0000335A 6700                       		beq.s	Pause_ChkStart	; if not, branch
0000335C 0838 0006 F605             		btst	#bitA,(v_jpadpress1).w ; is button A pressed?
00003362 6700                       		beq.s	Pause_ChkBC	; if not, branch
00003364 11FC 0000 F600             		move.b	#id_Title,(v_gamemode).w ; set game mode to 4 (title screen)
0000336A 4E71                       		nop	
0000336C 6000                       		bra.s	Pause_EndMusic
0000336E                            ; ===========================================================================
0000336E                            
0000336E                            Pause_ChkBC:
0000336E 0838 0004 F604             		btst	#bitB,(v_jpadhold1).w ; is button B pressed?
00003374 6600                       		bne.s	Pause_SlowMo	; if yes, branch
00003376 0838 0005 F605             		btst	#bitC,(v_jpadpress1).w ; is button C pressed?
0000337C 6600                       		bne.s	Pause_SlowMo	; if yes, branch
0000337E                            
0000337E                            Pause_ChkStart:
0000337E 0838 0007 F605             		btst	#bitStart,(v_jpadpress1).w ; is Start button pressed?
00003384 67C6                       		beq.s	Pause_Loop	; if not, branch
00003386                            
00003386                            Pause_EndMusic:
00003386 11FC 0080 F003             		move.b	#$80,(v_snddriver_ram+f_pausemusic).w	; unpause the music
0000338C                            
0000338C                            Unpause:
0000338C 31FC 0000 F63A             		move.w	#0,(f_pause).w	; unpause the game
00003392                            
00003392                            Pause_DoNothing:
00003392 4E75                       		rts	
00003394                            ; ===========================================================================
00003394                            
00003394                            Pause_SlowMo:
00003394 31FC 0001 F63A             		move.w	#1,(f_pause).w
0000339A 11FC 0080 F003             		move.b	#$80,(v_snddriver_ram+f_pausemusic).w	; Unpause the music
000033A0 4E75                       		rts	
000033A2                            ; End of function PauseGame
000033A2                            ; End of function PauseGame
000033A2                            
000033A2                            ; ---------------------------------------------------------------------------
000033A2                            ; Subroutine to	copy a tile map from RAM to VRAM namespace
000033A2                            
000033A2                            ; input:
000033A2                            ;	a1 = tile map address
000033A2                            ;	d0 = VRAM address
000033A2                            ;	d1 = width (cells)
000033A2                            ;	d2 = height (cells)
000033A2                            ; ---------------------------------------------------------------------------
000033A2                            
000033A2                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
000033A2                            
000033A2                            
000033A2                            TilemapToVRAM:
000033A2 4DF9 00C0 0000             		lea	(vdp_data_port).l,a6
000033A8 283C 0080 0000             		move.l	#$800000,d4
000033AE                            
000033AE                            	Tilemap_Line:
000033AE 2D40 0004                  		move.l	d0,4(a6)	; move d0 to VDP_control_port
000033B2 3601                       		move.w	d1,d3
000033B4                            
000033B4                            	Tilemap_Cell:
000033B4 3C99                       		move.w	(a1)+,(a6)	; write value to namespace
000033B6 51CB FFFC                  		dbf	d3,Tilemap_Cell	; next tile
000033BA D084                       		add.l	d4,d0		; goto next line
000033BC 51CA FFF0                  		dbf	d2,Tilemap_Line	; next line
000033C0 4E75                       		rts	
000033C2                            ; End of function TilemapToVRAM
000033C2                            
000033C2                            		include	"_inc\Nemesis Decompression.asm"
000033C2                            ; ==============================================================================
000033C2                            ; ------------------------------------------------------------------------------
000033C2                            ; Nemesis decompression routine
000033C2                            ; ------------------------------------------------------------------------------
000033C2                            ; Optimized by vladikcomper
000033C2                            ; ------------------------------------------------------------------------------
000033C2                            
000033C2                            NemDec_RAM:
000033C2 48E7 FFDE                      movem.l d0-a1/a3-a6,-(sp)
000033C6 47FA 0000                      lea NemDec_WriteRowToRAM(pc),a3
000033CA 6000                           bra.s   NemDec_Main
000033CC                             
000033CC                            ; ------------------------------------------------------------------------------
000033CC                            NemDec:
000033CC 48E7 FFDE                      movem.l d0-a1/a3-a6,-(sp)
000033D0 49F9 00C0 0000                 lea $C00000,a4      ; load VDP Data Port     
000033D6 47FA 0000                      lea NemPCD_WriteRowToVDP(pc),a3
000033DA                             
000033DA                            NemDec_Main:
000033DA 43F9 FFFF AA00                 lea $FFFFAA00,a1        ; load Nemesis decompression buffer
000033E0 3418                           move.w  (a0)+,d2        ; get number of patterns
000033E2 6A00                           bpl.s   @0          ; are we in Mode 0?
000033E4 47EB 000A                      lea $A(a3),a3       ; if not, use Mode 1
000033E8 E74A                       @0  lsl.w   #3,d2
000033EA 3A42                           movea.w d2,a5
000033EC 7607                           moveq   #7,d3
000033EE 7400                           moveq   #0,d2
000033F0 7800                           moveq   #0,d4
000033F2 6100 0000                      bsr.w   NemDec_BuildCodeTable
000033F6 1A18                           move.b  (a0)+,d5        ; get first byte of compressed data
000033F8 E145                           asl.w   #8,d5           ; shift up by a byte
000033FA 1A18                           move.b  (a0)+,d5        ; get second byte of compressed data
000033FC 3C3C 0010                      move.w  #$10,d6         ; set initial shift value
00003400 6100                           bsr.s   NemDec2
00003402 4CDF 7BFF                      movem.l (sp)+,d0-a1/a3-a6
00003406 4E75                           rts
00003408                             
00003408                            ; ---------------------------------------------------------------------------
00003408                            ; Part of the Nemesis decompressor, processes the actual compressed data
00003408                            ; ---------------------------------------------------------------------------
00003408                             
00003408                            NemDec2:
00003408 3E06                           move.w  d6,d7
0000340A 5147                           subq.w  #8,d7           ; get shift value
0000340C 3205                           move.w  d5,d1
0000340E EE69                           lsr.w   d7,d1           ; shift so that high bit of the code is in bit position 7
00003410 0C01 00FC                      cmpi.b  #%11111100,d1       ; are the high 6 bits set?
00003414 6400                           bcc.s   NemDec_InlineData   ; if they are, it signifies inline data
00003416 0241 00FF                      andi.w  #$FF,d1
0000341A D241                           add.w   d1,d1
0000341C 9C31 1000                      sub.b   (a1,d1.w),d6        ; ~~ subtract from shift value so that the next code is read next time around
00003420 0C46 0009                      cmpi.w  #9,d6           ; does a new byte need to be read?
00003424 6400                           bcc.s   @1          ; if not, branch
00003426 5046                           addq.w  #8,d6
00003428 E145                           asl.w   #8,d5
0000342A 1A18                           move.b  (a0)+,d5        ; read next byte
0000342C 1231 1001                  @1  move.b  1(a1,d1.w),d1
00003430 3001                           move.w  d1,d0
00003432 0241 000F                      andi.w  #$F,d1          ; get palette index for pixel
00003436 0240 00F0                      andi.w  #$F0,d0
0000343A                             
0000343A                            NemDec_GetRepeatCount:
0000343A E848                           lsr.w   #4,d0           ; get repeat count
0000343C                             
0000343C                            NemDec_WritePixel:
0000343C E98C                           lsl.l   #4,d4           ; shift up by a nybble
0000343E 8801                           or.b    d1,d4           ; write pixel
00003440 51CB 0000                      dbf d3,NemDec_WritePixelLoop; ~~
00003444 4ED3                           jmp (a3)            ; otherwise, write the row to its destination
00003446                            ; ---------------------------------------------------------------------------
00003446                             
00003446                            NemPCD_NewRow:
00003446 7800                           moveq   #0,d4           ; reset row
00003448 7607                           moveq   #7,d3           ; reset nybble counter
0000344A                             
0000344A                            NemDec_WritePixelLoop:
0000344A 51C8 FFF0                      dbf d0,NemDec_WritePixel
0000344E 60B8                           bra.s   NemDec2
00003450                            ; ---------------------------------------------------------------------------
00003450                             
00003450                            NemDec_InlineData:
00003450 5D46                           subq.w  #6,d6           ; 6 bits needed to signal inline data
00003452 0C46 0009                      cmpi.w  #9,d6
00003456 6400                           bcc.s   @2
00003458 5046                           addq.w  #8,d6
0000345A E145                           asl.w   #8,d5
0000345C 1A18                           move.b  (a0)+,d5
0000345E 5F46                       @2  subq.w  #7,d6           ; and 7 bits needed for the inline data itself
00003460 3205                           move.w  d5,d1
00003462 EC69                           lsr.w   d6,d1           ; shift so that low bit of the code is in bit position 0
00003464 3001                           move.w  d1,d0
00003466 0241 000F                      andi.w  #$F,d1          ; get palette index for pixel
0000346A 0240 0070                      andi.w  #$70,d0         ; high nybble is repeat count for pixel
0000346E 0C46 0009                      cmpi.w  #9,d6
00003472 64C6                           bcc.s   NemDec_GetRepeatCount
00003474 5046                           addq.w  #8,d6
00003476 E145                           asl.w   #8,d5
00003478 1A18                           move.b  (a0)+,d5
0000347A 60BE                           bra.s   NemDec_GetRepeatCount
0000347C                             
0000347C                            ; ---------------------------------------------------------------------------
0000347C                            ; Subroutines to output decompressed entry
0000347C                            ; Selected depending on current decompression mode
0000347C                            ; ---------------------------------------------------------------------------
0000347C                            
0000347C                            NemPCD_WriteRowToVDP:
0000347C                            loc_1502:
0000347C 2884                           move.l  d4,(a4)         ; write 8-pixel row
0000347E 534D                           subq.w  #1,a5
00003480 380D                           move.w  a5,d4           ; have all the 8-pixel rows been written?
00003482 66C2                           bne.s   NemPCD_NewRow         ; if not, branch
00003484 4E75                           rts
00003486                            ; ---------------------------------------------------------------------------
00003486                             
00003486                            NemPCD_WriteRowToVDP_XOR:
00003486 B982                           eor.l   d4,d2           ; XOR the previous row by the current row
00003488 2882                           move.l  d2,(a4)         ; and write the result
0000348A 534D                           subq.w  #1,a5
0000348C 380D                           move.w  a5,d4
0000348E 66B6                           bne.s   NemPCD_NewRow
00003490 4E75                           rts
00003492                            ; ---------------------------------------------------------------------------
00003492                            
00003492                            NemDec_WriteRowToRAM:
00003492 28C4                           move.l  d4,(a4)+        ; write 8-pixel row
00003494 534D                           subq.w  #1,a5
00003496 380D                           move.w  a5,d4           ; have all the 8-pixel rows been written?
00003498 66AC                           bne.s   NemPCD_NewRow         ; if not, branch
0000349A 4E75                           rts
0000349C                            ; ---------------------------------------------------------------------------
0000349C                             
0000349C                            NemDec_WriteRowToRAM_XOR:
0000349C B982                           eor.l   d4,d2           ; XOR the previous row by the current row
0000349E 28C2                           move.l  d2,(a4)+        ; and write the result
000034A0 534D                           subq.w  #1,a5
000034A2 380D                           move.w  a5,d4
000034A4 66A0                           bne.s   NemPCD_NewRow
000034A6 4E75                           rts
000034A8                             
000034A8                            ; ---------------------------------------------------------------------------
000034A8                            ; Part of the Nemesis decompressor, builds the code table (in RAM)
000034A8                            ; ---------------------------------------------------------------------------
000034A8                             
000034A8                            NemDec_BuildCodeTable:
000034A8 1018                           move.b  (a0)+,d0        ; read first byte
000034AA                             
000034AA                            _ChkEnd:
000034AA 0C00 00FF                      cmpi.b  #$FF,d0         ; has the end of the code table description been reached?
000034AE 6600                           bne.s   _NewPalIndex        ; if not, branch
000034B0 4E75                           rts
000034B2                            ; ---------------------------------------------------------------------------
000034B2                             
000034B2                            _NewPalIndex:
000034B2 3E00                           move.w  d0,d7
000034B4                             
000034B4                            _ItemLoop:
000034B4 1018                           move.b  (a0)+,d0        ; read next byte
000034B6 6BF2                           bmi.s   _ChkEnd         ; ~~
000034B8 1200                           move.b  d0,d1
000034BA 0247 000F                      andi.w  #$F,d7          ; get palette index
000034BE 0241 0070                      andi.w  #$70,d1         ; get repeat count for palette index
000034C2 8E41                           or.w    d1,d7           ; combine the two
000034C4 0240 000F                      andi.w  #$F,d0          ; get the length of the code in bits
000034C8 1200                           move.b  d0,d1
000034CA E149                           lsl.w   #8,d1
000034CC 8E41                           or.w    d1,d7           ; combine with palette index and repeat count to form code table entry
000034CE 7208                           moveq   #8,d1
000034D0 9240                           sub.w   d0,d1           ; is the code 8 bits long?
000034D2 6600                           bne.s   _ItemShortCode      ; if not, a bit of extra processing is needed
000034D4 1018                           move.b  (a0)+,d0        ; get code
000034D6 D040                           add.w   d0,d0           ; each code gets a word-sized entry in the table
000034D8 3387 0000                      move.w  d7,(a1,d0.w)        ; store the entry for the code
000034DC 60D6                           bra.s   _ItemLoop       ; repeat
000034DE                            ; ---------------------------------------------------------------------------
000034DE                             
000034DE                            _ItemShortCode:
000034DE 1018                           move.b  (a0)+,d0        ; get code
000034E0 E368                           lsl.w   d1,d0           ; shift so that high bit is in bit position 7
000034E2 D040                           add.w   d0,d0           ; get index into code table
000034E4 7A01                           moveq   #1,d5
000034E6 E36D                           lsl.w   d1,d5
000034E8 5345                           subq.w  #1,d5           ; d5 = 2^d1 - 1
000034EA 4DF1 0000                      lea (a1,d0.w),a6        ; ~~
000034EE                             
000034EE                            _ItemShortCodeLoop:
000034EE 3CC7                           move.w  d7,(a6)+        ; ~~ store entry
000034F0 51CD FFFC                      dbf d5,_ItemShortCodeLoop   ; repeat for required number of entries
000034F4 60BE                           bra.s   _ItemLoop
000034F4 60BE                           bra.s   _ItemLoop
000034F6                            
000034F6                            
000034F6                            ; ---------------------------------------------------------------------------
000034F6                            ; Subroutine to load pattern load cues (aka to queue pattern load requests)
000034F6                            ; ---------------------------------------------------------------------------
000034F6                            
000034F6                            ; ARGUMENTS
000034F6                            ; d0 = index of PLC list
000034F6                            ; ---------------------------------------------------------------------------
000034F6                            
000034F6                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
000034F6                            
000034F6                            ; LoadPLC:
000034F6                            AddPLC:
000034F6 48E7 0060                  		movem.l	a1-a2,-(sp)
000034FA 43F9 0000 0000             		lea	(ArtLoadCues).l,a1
00003500 D040                       		add.w	d0,d0
00003502 3031 0000                  		move.w	(a1,d0.w),d0
00003506 43F1 0000                  		lea	(a1,d0.w),a1		; jump to relevant PLC
0000350A 45F8 F680                  		lea	(v_plc_buffer).w,a2 ; PLC buffer space
0000350E                            
0000350E                            	@findspace:
0000350E 4A92                       		tst.l	(a2)		; is space available in RAM?
00003510 6700                       		beq.s	@copytoRAM	; if yes, branch
00003512 5C4A                       		addq.w	#6,a2		; if not, try next space
00003514 60F8                       		bra.s	@findspace
00003516                            ; ===========================================================================
00003516                            
00003516                            @copytoRAM:
00003516 3019                       		move.w	(a1)+,d0	; get length of PLC
00003518 6B00                       		bmi.s	@skip
0000351A                            
0000351A                            	@loop:
0000351A 24D9                       		move.l	(a1)+,(a2)+
0000351C 34D9                       		move.w	(a1)+,(a2)+	; copy PLC to RAM
0000351E 51C8 FFFA                  		dbf	d0,@loop	; repeat for length of PLC
00003522                            
00003522                            	@skip:
00003522 4CDF 0600                  		movem.l	(sp)+,a1-a2 ; a1=object
00003526 4E75                       		rts	
00003528                            ; End of function AddPLC
00003528                            
00003528                            
00003528                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00003528                            ; Queue pattern load requests, but clear the PLQ first
00003528                            
00003528                            ; ARGUMENTS
00003528                            ; d0 = index of PLC list (see ArtLoadCues)
00003528                            
00003528                            ; NOTICE: This subroutine does not check for buffer overruns. The programmer
00003528                            ;	  (or hacker) is responsible for making sure that no more than
00003528                            ;	  16 load requests are copied into the buffer.
00003528                            ;	  _________DO NOT PUT MORE THAN 16 LOAD REQUESTS IN A LIST!__________
00003528                            ;         (or if you change the size of Plc_Buffer, the limit becomes (Plc_Buffer_Only_End-Plc_Buffer)/6)
00003528                            
00003528                            ; LoadPLC2:
00003528                            NewPLC:
00003528 48E7 0060                  		movem.l	a1-a2,-(sp)
0000352C 43F9 0000 0000             		lea	(ArtLoadCues).l,a1
00003532 D040                       		add.w	d0,d0
00003534 3031 0000                  		move.w	(a1,d0.w),d0
00003538 43F1 0000                  		lea	(a1,d0.w),a1	; jump to relevant PLC
0000353C 6100                       		bsr.s	ClearPLC	; erase any data in PLC buffer space
0000353E 45F8 F680                  		lea	(v_plc_buffer).w,a2
00003542 3019                       		move.w	(a1)+,d0	; get length of PLC
00003544 6B00                       		bmi.s	@skip		; if it's negative, skip the next loop
00003546                            
00003546                            	@loop:
00003546 24D9                       		move.l	(a1)+,(a2)+
00003548 34D9                       		move.w	(a1)+,(a2)+	; copy PLC to RAM
0000354A 51C8 FFFA                  		dbf	d0,@loop		; repeat for length of PLC
0000354E                            
0000354E                            	@skip:
0000354E 4CDF 0600                  		movem.l	(sp)+,a1-a2
00003552 4E75                       		rts	
00003554                            ; End of function NewPLC
00003554                            
00003554                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00003554                            
00003554                            ; ---------------------------------------------------------------------------
00003554                            ; Subroutine to	clear the pattern load cues
00003554                            ; ---------------------------------------------------------------------------
00003554                            
00003554                            ; Clear the pattern load queue ($FFF680 - $FFF700)
00003554                            
00003554                            
00003554                            ClearPLC:
00003554 45F8 F680                  		lea	(v_plc_buffer).w,a2 ; PLC buffer space in RAM
00003558 701F                       		moveq	#$1F,d0	; bytesToLcnt(v_plc_buffer_end-v_plc_buffer)
0000355A                            
0000355A                            	@loop:
0000355A 429A                       		clr.l	(a2)+
0000355C 51C8 FFFC                  		dbf	d0,@loop
00003560 4E75                       		rts	
00003562                            ; End of function ClearPLC
00003562                            
00003562                            ; ---------------------------------------------------------------------------
00003562                            ; Subroutine to	use graphics listed in a pattern load cue
00003562                            ; ---------------------------------------------------------------------------
00003562                            
00003562                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00003562                            
00003562                            
00003562                            RunPLC:
00003562 4AB8 F680                  		tst.l	(v_plc_buffer).w
00003566 6700                       		beq.s	Rplc_Exit
00003568 4A78 F6F8                  		tst.w	(f_plc_execute).w
0000356C 6600                       		bne.s	Rplc_Exit
0000356E 2078 F680                  		movea.l	(v_plc_buffer).w,a0
00003572 47F9 0000 347C             		lea	(NemPCD_WriteRowToVDP).l,a3
00003578 43F8 AA00                  		lea	(v_ngfx_buffer).w,a1
0000357C 3418                       		move.w	(a0)+,d2
0000357E 6A00                       		bpl.s	loc_160E
00003580 D6FC 000A                  		adda.w	#$A,a3
00003584                            
00003584                            loc_160E:
00003584 0242 7FFF                  		andi.w	#$7FFF,d2
00003588 31C2 F6F8                  		move.w	d2,(f_plc_execute).w
0000358C 6100 FF1A                  		bsr.w	NemDec_BuildCodeTable
00003590 1A18                       		move.b	(a0)+,d5
00003592 E145                       		asl.w	#8,d5
00003594 1A18                       		move.b	(a0)+,d5
00003596 7C10                       		moveq	#$10,d6
00003598 7000                       		moveq	#0,d0
0000359A 21C8 F680                  		move.l	a0,(v_plc_buffer).w
0000359E 21CB F6E0                  		move.l	a3,(v_ptrnemcode).w
000035A2 21C0 F6E4                  		move.l	d0,($FFFFF6E4).w
000035A6 21C0 F6E8                  		move.l	d0,($FFFFF6E8).w
000035AA 21C0 F6EC                  		move.l	d0,($FFFFF6EC).w
000035AE 21C5 F6F0                  		move.l	d5,($FFFFF6F0).w
000035B2 21C6 F6F4                  		move.l	d6,($FFFFF6F4).w
000035B6                            
000035B6                            Rplc_Exit:
000035B6 4E75                       		rts	
000035B8                            ; End of function RunPLC
000035B8                            
000035B8                            
000035B8                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
000035B8                            
000035B8                            
000035B8                            sub_1642:
000035B8 4A78 F6F8                  		tst.w	(f_plc_execute).w
000035BC 6700 0000                  		beq.w	locret_16DA
000035C0 31FC 0009 F6FA             		move.w	#9,($FFFFF6FA).w
000035C6 7000                       		moveq	#0,d0
000035C8 3038 F684                  		move.w	($FFFFF684).w,d0
000035CC 0678 0120 F684             		addi.w	#$120,($FFFFF684).w
000035D2 6000                       		bra.s	loc_1676
000035D4                            ; End of function sub_1642
000035D4                            
000035D4                            
000035D4                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
000035D4                            
000035D4                            
000035D4                            ; sub_165E:
000035D4                            ProcessDPLC2:
000035D4 4A78 F6F8                  		tst.w	(f_plc_execute).w
000035D8 6700                       		beq.s	locret_16DA
000035DA 31FC 0003 F6FA             		move.w	#3,($FFFFF6FA).w
000035E0 7000                       		moveq	#0,d0
000035E2 3038 F684                  		move.w	($FFFFF684).w,d0
000035E6 0678 0060 F684             		addi.w	#$60,($FFFFF684).w
000035EC                            
000035EC                            loc_1676:
000035EC 49F9 00C0 0004             		lea	(vdp_control_port).l,a4
000035F2 E588                       		lsl.l	#2,d0
000035F4 E448                       		lsr.w	#2,d0
000035F6 0040 4000                  		ori.w	#$4000,d0
000035FA 4840                       		swap	d0
000035FC 2880                       		move.l	d0,(a4)
000035FE 594C                       		subq.w	#4,a4
00003600 2078 F680                  		movea.l	(v_plc_buffer).w,a0
00003604 2678 F6E0                  		movea.l	(v_ptrnemcode).w,a3
00003608 2038 F6E4                  		move.l	($FFFFF6E4).w,d0
0000360C 2238 F6E8                  		move.l	($FFFFF6E8).w,d1
00003610 2438 F6EC                  		move.l	($FFFFF6EC).w,d2
00003614 2A38 F6F0                  		move.l	($FFFFF6F0).w,d5
00003618 2C38 F6F4                  		move.l	($FFFFF6F4).w,d6
0000361C 43F8 AA00                  		lea	(v_ngfx_buffer).w,a1
00003620                            
00003620                            loc_16AA:
00003620 3A7C 0008                  		movea.w	#8,a5
00003624 6100 FE20                  		bsr.w	NemPCD_NewRow
00003628 5378 F6F8                  		subq.w	#1,(f_plc_execute).w
0000362C 6700                       		beq.s	loc_16DC
0000362E 5378 F6FA                  		subq.w	#1,($FFFFF6FA).w
00003632 66EC                       		bne.s	loc_16AA
00003634 21C8 F680                  		move.l	a0,(v_plc_buffer).w
00003638 21CB F6E0                  		move.l	a3,(v_ptrnemcode).w
0000363C 21C0 F6E4                  		move.l	d0,($FFFFF6E4).w
00003640 21C1 F6E8                  		move.l	d1,($FFFFF6E8).w
00003644 21C2 F6EC                  		move.l	d2,($FFFFF6EC).w
00003648 21C5 F6F0                  		move.l	d5,($FFFFF6F0).w
0000364C 21C6 F6F4                  		move.l	d6,($FFFFF6F4).w
00003650                            
00003650                            locret_16DA:
00003650 4E75                       		rts	
00003652                            ; ===========================================================================
00003652                            
00003652                            loc_16DC:
00003652 41F8 F680                  		lea	(v_plc_buffer).w,a0
00003656 7015                       		moveq	#$15,d0
00003658                            
00003658                            loc_16E2:
00003658 20E8 0006                  		move.l	6(a0),(a0)+
0000365C 51C8 FFFA                  		dbf	d0,loc_16E2
00003660 4E75                       		rts	
00003662                            ; End of function ProcessDPLC2
00003662                            
00003662                            ; ---------------------------------------------------------------------------
00003662                            ; Subroutine to	execute	the pattern load cue
00003662                            ; ---------------------------------------------------------------------------
00003662                            
00003662                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00003662                            
00003662                            
00003662                            QuickPLC:
00003662 43F9 0000 0000             		lea	(ArtLoadCues).l,a1 ; load the PLC index
00003668 D040                       		add.w	d0,d0
0000366A 3031 0000                  		move.w	(a1,d0.w),d0
0000366E 43F1 0000                  		lea	(a1,d0.w),a1
00003672 3219                       		move.w	(a1)+,d1	; get length of PLC
00003674                            
00003674                            	Qplc_Loop:
00003674 2059                       		movea.l	(a1)+,a0	; get art pointer
00003676 7000                       		moveq	#0,d0
00003678 3019                       		move.w	(a1)+,d0	; get VRAM address
0000367A E588                       		lsl.l	#2,d0
0000367C E448                       		lsr.w	#2,d0
0000367E 0040 4000                  		ori.w	#$4000,d0
00003682 4840                       		swap	d0
00003684 23C0 00C0 0004             		move.l	d0,(vdp_control_port).l ; converted VRAM address to VDP format
0000368A 6100 FD40                  		bsr.w	NemDec		; decompress
0000368E 51C9 FFE4                  		dbf	d1,Qplc_Loop	; repeat for length of PLC
00003692 4E75                       		rts	
00003694                            ; End of function QuickPLC
00003694                            
00003694                            		include	"_inc\Enigma Decompression.asm"
00003694                            ; ---------------------------------------------------------------------------
00003694                            ; Enigma decompression algorithm
00003694                            
00003694                            ; input:
00003694                            ;	d0 = starting art tile (added to each 8x8 before writing to destination)
00003694                            ;	a0 = source address
00003694                            ;	a1 = destination address
00003694                            
00003694                            ; usage:
00003694                            ;	lea	(source).l,a0
00003694                            ;	lea	(destination).l,a1
00003694                            ;	move.w	#arttile,d0
00003694                            ;	bsr.w	EniDec
00003694                            
00003694                            ; See http://www.segaretro.org/Enigma_compression for format description
00003694                            ; ---------------------------------------------------------------------------
00003694                            
00003694                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00003694                            
00003694                            
00003694                            EniDec:
00003694 48E7 FF7C                  		movem.l	d0-d7/a1-a5,-(sp)
00003698 3640                       		movea.w	d0,a3		; store starting art tile
0000369A 1018                       		move.b	(a0)+,d0
0000369C 4880                       		ext.w	d0
0000369E 3A40                       		movea.w	d0,a5		; store number of bits in inline copy value
000036A0 1818                       		move.b	(a0)+,d4
000036A2 E70C                       		lsl.b	#3,d4		; store PCCVH flags bitfield
000036A4 3458                       		movea.w	(a0)+,a2
000036A6 D4CB                       		adda.w	a3,a2		; store incremental copy word
000036A8 3858                       		movea.w	(a0)+,a4
000036AA D8CB                       		adda.w	a3,a4		; store literal copy word
000036AC 1A18                       		move.b	(a0)+,d5
000036AE E145                       		asl.w	#8,d5
000036B0 1A18                       		move.b	(a0)+,d5	; get first word in format list
000036B2 7C10                       		moveq	#16,d6		; initial shift value
000036B4                            ; loc_173E:
000036B4                            Eni_Loop:
000036B4 7007                       		moveq	#7,d0		; assume a format list entry is 7 bits
000036B6 3E06                       		move.w	d6,d7
000036B8 9E40                       		sub.w	d0,d7
000036BA 3205                       		move.w	d5,d1
000036BC EE69                       		lsr.w	d7,d1
000036BE 0241 007F                  		andi.w	#$7F,d1		; get format list entry
000036C2 3401                       		move.w	d1,d2		; and copy it
000036C4 0C41 0040                  		cmpi.w	#$40,d1		; is the high bit of the entry set?
000036C8 6400                       		bhs.s	@sevenbitentry
000036CA 7006                       		moveq	#6,d0		; if it isn't, the entry is actually 6 bits
000036CC E24A                       		lsr.w	#1,d2
000036CE                            ; loc_1758:
000036CE                            @sevenbitentry:
000036CE 6100 0000                  		bsr.w	EniDec_FetchByte
000036D2 0242 000F                  		andi.w	#$F,d2		; get repeat count
000036D6 E849                       		lsr.w	#4,d1
000036D8 D241                       		add.w	d1,d1
000036DA 4EFB 1000                  		jmp	EniDec_Index(pc,d1.w)
000036DE                            ; End of function EniDec
000036DE                            
000036DE                            ; ===========================================================================
000036DE                            ; loc_1768:
000036DE                            EniDec_00:
000036DE 32CA                       @loop:		move.w	a2,(a1)+	; copy incremental copy word
000036E0 524A                       		addq.w	#1,a2		; increment it
000036E2 51CA FFFA                  		dbf	d2,@loop	; repeat
000036E6 60CC                       		bra.s	Eni_Loop
000036E8                            ; ===========================================================================
000036E8                            ; loc_1772:
000036E8                            EniDec_01:
000036E8 32CC                       @loop:		move.w	a4,(a1)+	; copy literal copy word
000036EA 51CA FFFC                  		dbf	d2,@loop	; repeat
000036EE 60C4                       		bra.s	Eni_Loop
000036F0                            ; ===========================================================================
000036F0                            ; loc_177A:
000036F0                            EniDec_100:
000036F0 6100 0000                  		bsr.w	EniDec_FetchInlineValue
000036F4                            ; loc_177E:
000036F4 32C1                       @loop:		move.w	d1,(a1)+	; copy inline value
000036F6 51CA FFFC                  		dbf	d2,@loop	; repeat
000036FA                            
000036FA 60B8                       		bra.s	Eni_Loop
000036FC                            ; ===========================================================================
000036FC                            ; loc_1786:
000036FC                            EniDec_101:
000036FC 6100 0000                  		bsr.w	EniDec_FetchInlineValue
00003700                            ; loc_178A:
00003700 32C1                       @loop:		move.w	d1,(a1)+	; copy inline value
00003702 5241                       		addq.w	#1,d1		; increment
00003704 51CA FFFA                  		dbf	d2,@loop	; repeat
00003708                            
00003708 60AA                       		bra.s	Eni_Loop
0000370A                            ; ===========================================================================
0000370A                            ; loc_1794:
0000370A                            EniDec_110:
0000370A 6100 0000                  		bsr.w	EniDec_FetchInlineValue
0000370E                            ; loc_1798:
0000370E 32C1                       @loop:		move.w	d1,(a1)+	; copy inline value
00003710 5341                       		subq.w	#1,d1		; decrement
00003712 51CA FFFA                  		dbf	d2,@loop	; repeat
00003716                            
00003716 609C                       		bra.s	Eni_Loop
00003718                            ; ===========================================================================
00003718                            ; loc_17A2:
00003718                            EniDec_111:
00003718 0C42 000F                  		cmpi.w	#$F,d2
0000371C 6700                       		beq.s	EniDec_Done
0000371E                            ; loc_17A8:
0000371E 6100 0000                  @loop:		bsr.w	EniDec_FetchInlineValue	; fetch new inline value
00003722 32C1                       		move.w	d1,(a1)+	; copy it
00003724 51CA FFF8                  		dbf	d2,@loop	; and repeat
00003728                            
00003728 608A                       		bra.s	Eni_Loop
0000372A                            ; ===========================================================================
0000372A                            ; loc_17B4:
0000372A                            EniDec_Index:
0000372A 60B2                       		bra.s	EniDec_00
0000372C 60B0                       		bra.s	EniDec_00
0000372E 60B8                       		bra.s	EniDec_01
00003730 60B6                       		bra.s	EniDec_01
00003732 60BC                       		bra.s	EniDec_100
00003734 60C6                       		bra.s	EniDec_101
00003736 60D2                       		bra.s	EniDec_110
00003738 60DE                       		bra.s	EniDec_111
0000373A                            ; ===========================================================================
0000373A                            ; loc_17C4:
0000373A                            EniDec_Done:
0000373A 5348                       		subq.w	#1,a0		; go back by one byte
0000373C 0C46 0010                  		cmpi.w	#16,d6		; were we going to start on a completely new byte?
00003740 6600                       		bne.s	@notnewbyte	; if not, branch
00003742 5348                       		subq.w	#1,a0		; and another one if needed
00003744                            ; loc_17CE:
00003744                            @notnewbyte:
00003744 3008                       		move.w	a0,d0
00003746 E248                       		lsr.w	#1,d0		; are we on an odd byte?
00003748 6400                       		bcc.s	@evenbyte	; if not, branch
0000374A 5248                       		addq.w	#1,a0		; ensure we're on an even byte
0000374C                            ; loc_17D6:
0000374C                            @evenbyte:
0000374C 4CDF 3EFF                  		movem.l	(sp)+,d0-d7/a1-a5
00003750 4E75                       		rts	
00003752                            
00003752                            ; ---------------------------------------------------------------------------
00003752                            ; Part of the Enigma decompressor
00003752                            ; Fetches an inline copy value and stores it in d1
00003752                            ; ---------------------------------------------------------------------------
00003752                            
00003752                            ; =============== S U B R O U T I N E =======================================
00003752                            
00003752                            ; loc_17DC:
00003752                            EniDec_FetchInlineValue:
00003752 360B                       		move.w	a3,d3		; copy starting art tile
00003754 1204                       		move.b	d4,d1		; copy PCCVH bitfield
00003756 D201                       		add.b	d1,d1		; is the priority bit set?
00003758 6400                       		bcc.s	@skippriority	; if not, branch
0000375A 5346                       		subq.w	#1,d6
0000375C 0D05                       		btst	d6,d5		; is the priority bit set in the inline render flags?
0000375E 6700                       		beq.s	@skippriority	; if not, branch
00003760 0043 8000                  		ori.w	#$8000,d3	; otherwise set priority bit in art tile
00003764                            ; loc_17EE:
00003764                            @skippriority:
00003764 D201                       		add.b	d1,d1		; is the high palette line bit set?
00003766 6400                       		bcc.s	@skiphighpal	; if not, branch
00003768 5346                       		subq.w	#1,d6
0000376A 0D05                       		btst	d6,d5
0000376C 6700                       		beq.s	@skiphighpal
0000376E 0643 4000                  		addi.w	#$4000,d3	; set second palette line bit
00003772                            ; loc_17FC:
00003772                            @skiphighpal:
00003772 D201                       		add.b	d1,d1		; is the low palette line bit set?
00003774 6400                       		bcc.s	@skiplowpal	; if not, branch
00003776 5346                       		subq.w	#1,d6
00003778 0D05                       		btst	d6,d5
0000377A 6700                       		beq.s	@skiplowpal
0000377C 0643 2000                  		addi.w	#$2000,d3	; set first palette line bit
00003780                            ; loc_180A:
00003780                            @skiplowpal:
00003780 D201                       		add.b	d1,d1		; is the vertical flip flag set?
00003782 6400                       		bcc.s	@skipyflip	; if not, branch
00003784 5346                       		subq.w	#1,d6
00003786 0D05                       		btst	d6,d5
00003788 6700                       		beq.s	@skipyflip
0000378A 0043 1000                  		ori.w	#$1000,d3	; set Y-flip bit
0000378E                            ; loc_1818:
0000378E                            @skipyflip:
0000378E D201                       		add.b	d1,d1		; is the horizontal flip flag set?
00003790 6400                       		bcc.s	@skipxflip	; if not, branch
00003792 5346                       		subq.w	#1,d6
00003794 0D05                       		btst	d6,d5
00003796 6700                       		beq.s	@skipxflip
00003798 0043 0800                  		ori.w	#$800,d3	; set X-flip bit
0000379C                            ; loc_1826:
0000379C                            @skipxflip:
0000379C 3205                       		move.w	d5,d1
0000379E 3E06                       		move.w	d6,d7
000037A0 9E4D                       		sub.w	a5,d7		; subtract length in bits of inline copy value
000037A2 6400                       		bcc.s	@enoughbits	; branch if a new word doesn't need to be read
000037A4 3C07                       		move.w	d7,d6
000037A6 0646 0010                  		addi.w	#16,d6
000037AA 4447                       		neg.w	d7		; calculate bit deficit
000037AC EF69                       		lsl.w	d7,d1		; and make space for that many bits
000037AE 1A10                       		move.b	(a0),d5		; get next byte
000037B0 EF3D                       		rol.b	d7,d5		; and rotate the required bits into the lowest positions
000037B2 DE47                       		add.w	d7,d7
000037B4 CA7B 7000                  		and.w	EniDec_Masks-2(pc,d7.w),d5
000037B8 D245                       		add.w	d5,d1		; combine upper bits with lower bits
000037BA                            ; loc_1844:
000037BA                            @maskvalue:
000037BA 300D                       		move.w	a5,d0		; get length in bits of inline copy value
000037BC D040                       		add.w	d0,d0
000037BE C27B 0000                  		and.w	EniDec_Masks-2(pc,d0.w),d1	; mask value appropriately
000037C2 D243                       		add.w	d3,d1		; add starting art tile
000037C4 1A18                       		move.b	(a0)+,d5
000037C6 E14D                       		lsl.w	#8,d5
000037C8 1A18                       		move.b	(a0)+,d5	; get next word
000037CA 4E75                       		rts	
000037CC                            ; ===========================================================================
000037CC                            ; loc_1856:
000037CC                            @enoughbits:
000037CC 6700                       		beq.s	@justenough	; if the word has been exactly exhausted, branch
000037CE EE69                       		lsr.w	d7,d1	; get inline copy value
000037D0 300D                       		move.w	a5,d0
000037D2 D040                       		add.w	d0,d0
000037D4 C27B 0000                  		and.w	EniDec_Masks-2(pc,d0.w),d1	; and mask it appropriately
000037D8 D243                       		add.w	d3,d1	; add starting art tile
000037DA 300D                       		move.w	a5,d0
000037DC 6000                       		bra.s	EniDec_FetchByte
000037DE                            ; ===========================================================================
000037DE                            ; loc_1868:
000037DE                            @justenough:
000037DE 7C10                       		moveq	#16,d6	; reset shift value
000037E0 60D8                       		bra.s	@maskvalue
000037E2                            ; ===========================================================================
000037E2                            ; word_186C:
000037E2                            EniDec_Masks:
000037E2 0001 0003 0007 000F        		dc.w	 1,    3,    7,   $F
000037EA 001F 003F 007F 00FF        		dc.w   $1F,  $3F,  $7F,  $FF
000037F2 01FF 03FF 07FF 0FFF        		dc.w  $1FF, $3FF, $7FF, $FFF
000037FA 1FFF 3FFF 7FFF FFFF        		dc.w $1FFF,$3FFF,$7FFF,$FFFF
00003802                            
00003802                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00003802                            
00003802                            ; sub_188C:
00003802                            EniDec_FetchByte:
00003802 9C40                       		sub.w	d0,d6	; subtract length of current entry from shift value so that next entry is read next time around
00003804 0C46 0009                  		cmpi.w	#9,d6	; does a new byte need to be read?
00003808 6400                       		bhs.s	@locret	; if not, branch
0000380A 5046                       		addq.w	#8,d6
0000380C E145                       		asl.w	#8,d5
0000380E 1A18                       		move.b	(a0)+,d5
00003810                            @locret:
00003810 4E75                       		rts	
00003812                            ; End of function EniDec_FetchByte
00003812                            ; End of function EniDec_FetchByte
00003812                            		include	"_inc\Kosinski Decompression.asm"
00003812                            ; ||||||||||||||| S U B R O U T I N E |||||||||||||||||||||||||||||||||||||||
00003812                            ; ---------------------------------------------------------------------------
00003812                            ; KOSINSKI DECOMPRESSION PROCEDURE
00003812                            ; (sometimes called KOZINSKI decompression)
00003812                            ;
00003812                            ; ARGUMENTS:
00003812                            ; a0 = source address
00003812                            ; a1 = destination address
00003812                            ;
00003812                            ; For format explanation see http://info.sonicretro.org/Kosinski@compression
00003812                            ; New faster version by written by vladikcomper, with additional improvements by
00003812                            ; MarkeyJester and Flamewing
00003812                            ; Converted to ASM68K by Beta Filter.
00003812                            ; ---------------------------------------------------------------------------
00003812 =00000001                  Kos_UseLUT: equ 1
00003812 =00000003                  Kos_LoopUnroll: equ 3
00003812 =00000001                  Kos_ExtremeUnrolling: equ 1
00003812                            
00003812                            Kos_RunBitStream macro
00003812                                dbra    d2,@skip\@
00003812                                moveq   #7,d2                   ; Set repeat count to 8.
00003812                                move.b  d1,d0                   ; Use the remaining 8 bits.
00003812                                not.w   d3                      ; Have all 16 bits been used up?
00003812                                bne.s   @skip\@                   ; Branch if not.
00003812                                move.b  (a0)+,d0                ; Get desc field low-byte.
00003812                                move.b  (a0)+,d1                ; Get desc field hi-byte.
00003812                                if Kos_UseLUT=1
00003812                                move.b  (a4,d0.w),d0            ; Invert bit order...
00003812                                move.b  (a4,d1.w),d1            ; ... for both bytes.
00003812                                endif
00003812                            @skip\@
00003812                                endm
00003812                            
00003812                            Kos_ReadBit macro
00003812                                if Kos_UseLUT=1
00003812                                add.b   d0,d0                   ; Get a bit from the bitstream.
00003812                                else
00003812                                lsr.b   #1,d0                   ; Get a bit from the bitstream.
00003812                                endif
00003812                                endm
00003812                            ; ===========================================================================
00003812                            ; KozDec@193A:
00003812                            KosDec:
00003812 7E07                           moveq   #(1<<Kos_LoopUnroll)-1,d7
00003814 7000                           moveq   #0,d0
00003816 7200                           moveq   #0,d1
00003818 49FA 0000                      lea KosDec_ByteMap(pc),a4       ; Load LUT pointer.
0000381C 1018                           move.b  (a0)+,d0                ; Get desc field low-byte.
0000381E 1218                           move.b  (a0)+,d1                ; Get desc field hi-byte.
00003820 1034 0000                      move.b  (a4,d0.w),d0            ; Invert bit order...
00003824 1234 1000                      move.b  (a4,d1.w),d1            ; ... for both bytes.
00003828 7407                           moveq   #7,d2                   ; Set repeat count to 8.
0000382A 7600                           moveq   #0,d3                   ; d3 will be desc field switcher.
0000382C 6000                           bra.s   @FetchNewCode
0000382E                            ; ---------------------------------------------------------------------------
0000382E                            @FetchCodeLoop:
0000382E                                ; Code 1 (Uncompressed byte).
00003846 12D8                           move.b  (a0)+,(a1)+
00003848                            
00003848                            @FetchNewCode:
0000384A 65E2                           bcs.s   @FetchCodeLoop          ; If code = 1, branch.
0000384C                            
0000384C                                ; Codes 00 and 01.
0000384C 7AFF                           moveq   #-1,d5
0000384E 4BD1                           lea (a1),a5
0000386A 6500 0000                      bcs.w   @Code_01
0000386E                            
0000386E                                ; Code 00 (Dictionary ref. short).
00003888 6500                           bcs.s   @Copy45
000038A4 6500                           bcs.s   @Copy3
000038BE 1A18                           move.b  (a0)+,d5                ; d5 = displacement.
000038C0 DAC5                           adda.w  d5,a5
000038C2 12DD                           move.b  (a5)+,(a1)+
000038C4 12DD                           move.b  (a5)+,(a1)+
000038C6 6080                           bra.s   @FetchNewCode
000038C8                            ; ---------------------------------------------------------------------------
000038C8                            @Copy3:
000038E0 1A18                           move.b  (a0)+,d5                ; d5 = displacement.
000038E2 DAC5                           adda.w  d5,a5
000038E4 12DD                           move.b  (a5)+,(a1)+
000038E6 12DD                           move.b  (a5)+,(a1)+
000038E8 12DD                           move.b  (a5)+,(a1)+
000038EA 6000 FF5C                      bra.w   @FetchNewCode
000038EE                            ; ---------------------------------------------------------------------------
000038EE                            @Copy45:
00003908 6500                           bcs.s   @Copy5
00003922 1A18                           move.b  (a0)+,d5                ; d5 = displacement.
00003924 DAC5                           adda.w  d5,a5
00003926 12DD                           move.b  (a5)+,(a1)+
00003928 12DD                           move.b  (a5)+,(a1)+
0000392A 12DD                           move.b  (a5)+,(a1)+
0000392C 12DD                           move.b  (a5)+,(a1)+
0000392E 6000 FF18                      bra.w   @FetchNewCode
00003932                            ; ---------------------------------------------------------------------------
00003932                            @Copy5:
0000394A 1A18                           move.b  (a0)+,d5                ; d5 = displacement.
0000394C DAC5                           adda.w  d5,a5
0000394E 12DD                           move.b  (a5)+,(a1)+
00003950 12DD                           move.b  (a5)+,(a1)+
00003952 12DD                           move.b  (a5)+,(a1)+
00003954 12DD                           move.b  (a5)+,(a1)+
00003956 12DD                           move.b  (a5)+,(a1)+
00003958 6000 FEEE                      bra.w   @FetchNewCode
0000395C                            ; ---------------------------------------------------------------------------
0000395C                            ; ---------------------------------------------------------------------------
0000395C                            @Code_01:
0000395C 7800                           moveq   #0,d4                   ; d4 will contain copy count.
0000395E                                ; Code 01 (Dictionary ref. long / special).
00003976 1C18                           move.b  (a0)+,d6                ; d6 = %LLLLLLLL.
00003978 1818                           move.b  (a0)+,d4                ; d4 = %HHHHHCCC.
0000397A 1A04                           move.b  d4,d5                   ; d5 = %11111111 HHHHHCCC.
0000397C EB4D                           lsl.w   #5,d5                   ; d5 = %111HHHHH CCC00000.
0000397E 1A06                           move.b  d6,d5                   ; d5 = %111HHHHH LLLLLLLL.
00003980 C847                           and.w   d7,d4                   ; d4 = %00000CCC.
00003982 6600                           bne.s   @StreamCopy             ; if CCC=0, branch.
00003984                            
00003984                                ; special mode (extended counter)
00003984 1818                           move.b  (a0)+,d4                ; Read cnt
00003986 6700                           beq.s   @Quit                   ; If cnt=0, quit decompression.
00003988 5304                           subq.b  #1,d4
0000398A 6700 FEBC                      beq.w   @FetchNewCode           ; If cnt=1, fetch a new code.
0000398E                            
0000398E DAC5                           adda.w  d5,a5
00003990 12DD                           move.b  (a5)+,(a1)+             ; Do 1 extra copy (to compensate +1 to copy counter).
00003992 3C04                           move.w  d4,d6
00003994 4646                           not.w   d6
00003996 CC47                           and.w   d7,d6
00003998 DC46                           add.w   d6,d6
0000399A E64C                           lsr.w   #Kos_LoopUnroll,d4
0000399C 4EFB 6000                      jmp @largecopy(pc,d6.w)
000039A0                            ; ---------------------------------------------------------------------------
000039A0                            @largecopy:
000039A0                                rept (1<<Kos_LoopUnroll)
000039A0                                move.b  (a5)+,(a1)+
000039A0 12DD 12DD 12DD 12DD 12DD+      endr
000039B0 51CC FFEE                      dbra    d4,@largecopy
000039B4 6000 FE92                      bra.w   @FetchNewCode
000039B8                            ; ---------------------------------------------------------------------------
000039B8                            @StreamCopy:
000039B8 DAC5                           adda.w  d5,a5
000039BA 12DD                           move.b  (a5)+,(a1)+             ; Do 1 extra copy (to compensate +1 to copy counter).
000039BC BF44                           eor.w   d7,d4
000039BE D844                           add.w   d4,d4
000039C0 4EFB 4000                      jmp @mediumcopy(pc,d4.w)
000039C4                            ; ---------------------------------------------------------------------------
000039C4                            @mediumcopy:
000039C4                                rept 8
000039C4                                move.b  (a5)+,(a1)+
000039C4 12DD 12DD 12DD 12DD 12DD+      endr
000039D4 6000 FE72                      bra.w   @FetchNewCode
000039D8                            ; ---------------------------------------------------------------------------
000039D8                            @Quit:
000039D8 4E75                           rts                             ; End of function KosDec.
000039DA                            ; ===========================================================================
000039DA                            KosDec_ByteMap:
000039DA 0080 40C0 20A0 60E0 1090+      dc.b    $00,$80,$40,$C0,$20,$A0,$60,$E0,$10,$90,$50,$D0,$30,$B0,$70,$F0
000039EA 0888 48C8 28A8 68E8 1898+      dc.b    $08,$88,$48,$C8,$28,$A8,$68,$E8,$18,$98,$58,$D8,$38,$B8,$78,$F8
000039FA 0484 44C4 24A4 64E4 1494+      dc.b    $04,$84,$44,$C4,$24,$A4,$64,$E4,$14,$94,$54,$D4,$34,$B4,$74,$F4
00003A0A 0C8C 4CCC 2CAC 6CEC 1C9C+      dc.b    $0C,$8C,$4C,$CC,$2C,$AC,$6C,$EC,$1C,$9C,$5C,$DC,$3C,$BC,$7C,$FC
00003A1A 0282 42C2 22A2 62E2 1292+      dc.b    $02,$82,$42,$C2,$22,$A2,$62,$E2,$12,$92,$52,$D2,$32,$B2,$72,$F2
00003A2A 0A8A 4ACA 2AAA 6AEA 1A9A+      dc.b    $0A,$8A,$4A,$CA,$2A,$AA,$6A,$EA,$1A,$9A,$5A,$DA,$3A,$BA,$7A,$FA
00003A3A 0686 46C6 26A6 66E6 1696+      dc.b    $06,$86,$46,$C6,$26,$A6,$66,$E6,$16,$96,$56,$D6,$36,$B6,$76,$F6
00003A4A 0E8E 4ECE 2EAE 6EEE 1E9E+      dc.b    $0E,$8E,$4E,$CE,$2E,$AE,$6E,$EE,$1E,$9E,$5E,$DE,$3E,$BE,$7E,$FE
00003A5A 0181 41C1 21A1 61E1 1191+      dc.b    $01,$81,$41,$C1,$21,$A1,$61,$E1,$11,$91,$51,$D1,$31,$B1,$71,$F1
00003A6A 0989 49C9 29A9 69E9 1999+      dc.b    $09,$89,$49,$C9,$29,$A9,$69,$E9,$19,$99,$59,$D9,$39,$B9,$79,$F9
00003A7A 0585 45C5 25A5 65E5 1595+      dc.b    $05,$85,$45,$C5,$25,$A5,$65,$E5,$15,$95,$55,$D5,$35,$B5,$75,$F5
00003A8A 0D8D 4DCD 2DAD 6DED 1D9D+      dc.b    $0D,$8D,$4D,$CD,$2D,$AD,$6D,$ED,$1D,$9D,$5D,$DD,$3D,$BD,$7D,$FD
00003A9A 0383 43C3 23A3 63E3 1393+      dc.b    $03,$83,$43,$C3,$23,$A3,$63,$E3,$13,$93,$53,$D3,$33,$B3,$73,$F3
00003AAA 0B8B 4BCB 2BAB 6BEB 1B9B+      dc.b    $0B,$8B,$4B,$CB,$2B,$AB,$6B,$EB,$1B,$9B,$5B,$DB,$3B,$BB,$7B,$FB
00003ABA 0787 47C7 27A7 67E7 1797+      dc.b    $07,$87,$47,$C7,$27,$A7,$67,$E7,$17,$97,$57,$D7,$37,$B7,$77,$F7
00003ACA 0F8F 4FCF 2FAF 6FEF 1F9F+      dc.b    $0F,$8F,$4F,$CF,$2F,$AF,$6F,$EF,$1F,$9F,$5F,$DF,$3F,$BF,$7F,$FF
00003ADA                            ; ===========================================================================
00003ADA                            ; ===========================================================================
00003ADA                            
00003ADA                            		include	"_inc\PaletteCycle.asm"
00003ADA                            ; ---------------------------------------------------------------------------
00003ADA                            ; Palette cycling routine loading subroutine
00003ADA                            ; ---------------------------------------------------------------------------
00003ADA                            
00003ADA                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00003ADA                            
00003ADA                            
00003ADA                            PaletteCycle:
00003ADA 7400                       		moveq	#0,d2
00003ADC 7000                       		moveq	#0,d0
00003ADE 1038 FE10                  		move.b	(v_zone).w,d0	; get level number
00003AE2 D040                       		add.w	d0,d0
00003AE4 303B 0000                  		move.w	PCycle_Index(pc,d0.w),d0
00003AE8 4EFB 0000                  		jmp	PCycle_Index(pc,d0.w) ; jump to relevant palette routine
00003AEC                            ; End of function PaletteCycle
00003AEC                            
00003AEC                            ; ===========================================================================
00003AEC                            ; ---------------------------------------------------------------------------
00003AEC                            ; Palette cycling routines
00003AEC                            ; ---------------------------------------------------------------------------
00003AEC 0000                       PCycle_Index:	dc.w PCycle_GHZ-PCycle_Index
00003AEE 0000                       		dc.w PCycle_LZ-PCycle_Index
00003AF0 0000                       		dc.w PCycle_MZ-PCycle_Index
00003AF2 0000                       		dc.w PalCycle_SLZ-PCycle_Index
00003AF4 0000                       		dc.w PalCycle_SYZ-PCycle_Index
00003AF6 0000                       		dc.w PalCycle_SBZ-PCycle_Index
00003AF8 0000                       		dc.w PCycle_MZ-PCycle_Index	; Ending
00003AFA 0000                       		dc.w PCycle_MZ-PCycle_Index
00003AFC 0000                       		dc.w PCycle_MZ-PCycle_Index
00003AFE 0000                       		dc.w PCycle_MZ-PCycle_Index
00003B00 0000                       		dc.w PCycle_MZ-PCycle_Index
00003B02                            
00003B02                            
00003B02                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00003B02                            
00003B02                            
00003B02                            PCycle_Title:
00003B02 41F9 0000 0000             		lea	(Pal_TitleCyc).l,a0
00003B08 6000                       		bra.s	PCycGHZ_Go
00003B0A                            ; ===========================================================================
00003B0A                            
00003B0A                            PCycle_GHZ:
00003B0A 41F9 0000 0000             		lea	(Pal_GHZCyc).l,a0
00003B10                            
00003B10                            PCycGHZ_Go:
00003B10 5378 F634                  		subq.w	#1,(v_pcyc_time).w ; decrement timer
00003B14 6A00                       		bpl.s	PCycGHZ_Skip	; if time remains, branch
00003B16                            
00003B16 31FC 0005 F634             		move.w	#5,(v_pcyc_time).w ; reset timer to 5 frames
00003B1C 3038 F632                  		move.w	(v_pcyc_num).w,d0 ; get cycle number
00003B20 5278 F632                  		addq.w	#1,(v_pcyc_num).w ; increment cycle number
00003B24 0240 0003                  		andi.w	#3,d0		; if cycle > 3, reset to 0
00003B28 E748                       		lsl.w	#3,d0
00003B2A 43F8 FB50                  		lea	(v_pal_dry+$50).w,a1
00003B2E 22F0 0000                  		move.l	(a0,d0.w),(a1)+
00003B32 22B0 0004                  		move.l	4(a0,d0.w),(a1)	; copy palette data to RAM
00003B36                            
00003B36                            PCycGHZ_Skip:
00003B36 4E75                       		rts	
00003B38                            ; End of function PCycle_GHZ
00003B38                            
00003B38                            
00003B38                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00003B38                            
00003B38                            
00003B38                            PCycle_LZ:
00003B38                            ; Waterfalls
00003B38 5378 F634                  		subq.w	#1,(v_pcyc_time).w ; decrement timer
00003B3C 6A00                       		bpl.s	PCycLZ_Skip1	; if time remains, branch
00003B3E                            
00003B3E 31FC 0002 F634             		move.w	#2,(v_pcyc_time).w ; reset timer to 2 frames
00003B44 3038 F632                  		move.w	(v_pcyc_num).w,d0
00003B48 5278 F632                  		addq.w	#1,(v_pcyc_num).w ; increment cycle number
00003B4C 0240 0003                  		andi.w	#3,d0		; if cycle > 3, reset to 0
00003B50 E748                       		lsl.w	#3,d0
00003B52 41F9 0000 0000             		lea	(Pal_LZCyc1).l,a0
00003B58 0C38 0003 FE11             		cmpi.b	#3,(v_act).w	; check if level is SBZ3
00003B5E 6600                       		bne.s	PCycLZ_NotSBZ3
00003B60 41F9 0000 0000             		lea	(Pal_SBZ3Cyc1).l,a0 ; load SBZ3	palette instead
00003B66                            
00003B66                            	PCycLZ_NotSBZ3:
00003B66 43F8 FB56                  		lea	(v_pal_dry+$56).w,a1
00003B6A 22F0 0000                  		move.l	(a0,d0.w),(a1)+
00003B6E 22B0 0004                  		move.l	4(a0,d0.w),(a1)
00003B72 43F8 FAD6                  		lea	(v_pal_water+$56).w,a1
00003B76 22F0 0000                  		move.l	(a0,d0.w),(a1)+
00003B7A 22B0 0004                  		move.l	4(a0,d0.w),(a1)
00003B7E                            
00003B7E                            PCycLZ_Skip1:
00003B7E                            ; Conveyor belts
00003B7E 4E75                       		rts
00003B80 3038 FE04                  		move.w	(v_framecount).w,d0
00003B84 0240 0007                  		andi.w	#7,d0
00003B88 103B 0000                  		move.b	PCycLZ_Seq(pc,d0.w),d0 ; get byte from palette sequence
00003B8C 6700                       		beq.s	PCycLZ_Skip2	; if byte is 0, branch
00003B8E 7201                       		moveq	#1,d1
00003B90 4A38 F7C0                  		tst.b	(f_conveyrev).w	; have conveyor belts been reversed?
00003B94 6700                       		beq.s	PCycLZ_NoRev	; if not, branch
00003B96 4441                       		neg.w	d1
00003B98                            
00003B98                            	PCycLZ_NoRev:
00003B98 3038 F650                  		move.w	(v_pal_buffer).w,d0
00003B9C 0240 0003                  		andi.w	#3,d0
00003BA0 D041                       		add.w	d1,d0
00003BA2 0C40 0003                  		cmpi.w	#3,d0
00003BA6 6500                       		bcs.s	loc_1A0A
00003BA8 3200                       		move.w	d0,d1
00003BAA 7000                       		moveq	#0,d0
00003BAC 4A41                       		tst.w	d1
00003BAE 6A00                       		bpl.s	loc_1A0A
00003BB0 7002                       		moveq	#2,d0
00003BB2                            
00003BB2                            loc_1A0A:
00003BB2 31C0 F650                  		move.w	d0,(v_pal_buffer).w
00003BB6 D040                       		add.w	d0,d0
00003BB8 3200                       		move.w	d0,d1
00003BBA D040                       		add.w	d0,d0
00003BBC D041                       		add.w	d1,d0
00003BBE 41F9 0000 0000             		lea	(Pal_LZCyc2).l,a0
00003BC4 43F8 FB76                  		lea	(v_pal_dry+$76).w,a1
00003BC8 22F0 0000                  		move.l	(a0,d0.w),(a1)+
00003BCC 32B0 0004                  		move.w	4(a0,d0.w),(a1)
00003BD0 41F9 0000 0000             		lea	(Pal_LZCyc3).l,a0
00003BD6 43F8 FAF6                  		lea	(v_pal_water+$76).w,a1
00003BDA 22F0 0000                  		move.l	(a0,d0.w),(a1)+
00003BDE 32B0 0004                  		move.w	4(a0,d0.w),(a1)
00003BE2                            
00003BE2                            PCycLZ_Skip2:
00003BE2 4E75                       		rts	
00003BE4                            ; End of function PCycle_LZ
00003BE4                            
00003BE4                            ; ===========================================================================
00003BE4 0100 0001 0000 0100        PCycLZ_Seq:	dc.b 1,	0, 0, 1, 0, 0, 1, 0
00003BEC                            ; ===========================================================================
00003BEC                            
00003BEC                            PCycle_MZ:
00003BEC 4E75                       		rts	
00003BEE                            
00003BEE                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00003BEE                            
00003BEE                            
00003BEE                            PalCycle_SLZ:
00003BEE 5378 F634                  		subq.w	#1,(v_pcyc_time).w
00003BF2 6A00                       		bpl.s	locret_1A80
00003BF4 31FC 0007 F634             		move.w	#7,(v_pcyc_time).w
00003BFA 3038 F632                  		move.w	(v_pcyc_num).w,d0
00003BFE 5240                       		addq.w	#1,d0
00003C00 0C40 0006                  		cmpi.w	#6,d0
00003C04 6500                       		bcs.s	loc_1A60
00003C06 7000                       		moveq	#0,d0
00003C08                            
00003C08                            loc_1A60:
00003C08 31C0 F632                  		move.w	d0,(v_pcyc_num).w
00003C0C 3200                       		move.w	d0,d1
00003C0E D241                       		add.w	d1,d1
00003C10 D041                       		add.w	d1,d0
00003C12 D040                       		add.w	d0,d0
00003C14 41F9 0000 0000             		lea	(Pal_SLZCyc).l,a0
00003C1A 43F8 FB56                  		lea	(v_pal_dry+$56).w,a1
00003C1E 32B0 0000                  		move.w	(a0,d0.w),(a1)
00003C22 2370 0002 0004             		move.l	2(a0,d0.w),4(a1)
00003C28                            
00003C28                            locret_1A80:
00003C28 4E75                       		rts	
00003C2A                            ; End of function PalCycle_SLZ
00003C2A                            
00003C2A                            
00003C2A                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00003C2A                            
00003C2A                            
00003C2A                            PalCycle_SYZ:
00003C2A 5378 F634                  		subq.w	#1,(v_pcyc_time).w
00003C2E 6A00                       		bpl.s	locret_1AC6
00003C30 31FC 0005 F634             		move.w	#5,(v_pcyc_time).w
00003C36 3038 F632                  		move.w	(v_pcyc_num).w,d0
00003C3A 5278 F632                  		addq.w	#1,(v_pcyc_num).w
00003C3E 0240 0003                  		andi.w	#3,d0
00003C42 E548                       		lsl.w	#2,d0
00003C44 3200                       		move.w	d0,d1
00003C46 D040                       		add.w	d0,d0
00003C48 41F9 0000 0000             		lea	(Pal_SYZCyc1).l,a0
00003C4E 43F8 FB6E                  		lea	(v_pal_dry+$6E).w,a1
00003C52 22F0 0000                  		move.l	(a0,d0.w),(a1)+
00003C56 22B0 0004                  		move.l	4(a0,d0.w),(a1)
00003C5A 41F9 0000 0000             		lea	(Pal_SYZCyc2).l,a0
00003C60 43F8 FB76                  		lea	(v_pal_dry+$76).w,a1
00003C64 32B0 1000                  		move.w	(a0,d1.w),(a1)
00003C68 3370 1002 0004             		move.w	2(a0,d1.w),4(a1)
00003C6E                            
00003C6E                            locret_1AC6:
00003C6E 4E75                       		rts	
00003C70                            ; End of function PalCycle_SYZ
00003C70                            
00003C70                            
00003C70                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00003C70                            
00003C70                            
00003C70                            PalCycle_SBZ:
00003C70 45F9 0000 0000             		lea	(Pal_SBZCycList1).l,a2
00003C76 4A38 FE11                  		tst.b	(v_act).w
00003C7A 6700                       		beq.s	loc_1ADA
00003C7C 45F9 0000 0000             		lea	(Pal_SBZCycList2).l,a2
00003C82                            
00003C82                            loc_1ADA:
00003C82 43F8 F650                  		lea	(v_pal_buffer).w,a1
00003C86 321A                       		move.w	(a2)+,d1
00003C88                            
00003C88                            loc_1AE0:
00003C88 5311                       		subq.b	#1,(a1)
00003C8A 6B00                       		bmi.s	loc_1AEA
00003C8C 5489                       		addq.l	#2,a1
00003C8E 5C8A                       		addq.l	#6,a2
00003C90 6000                       		bra.s	loc_1B06
00003C92                            ; ===========================================================================
00003C92                            
00003C92                            loc_1AEA:
00003C92 12DA                       		move.b	(a2)+,(a1)+
00003C94 1011                       		move.b	(a1),d0
00003C96 5200                       		addq.b	#1,d0
00003C98 B01A                       		cmp.b	(a2)+,d0
00003C9A 6500                       		bcs.s	loc_1AF6
00003C9C 7000                       		moveq	#0,d0
00003C9E                            
00003C9E                            loc_1AF6:
00003C9E 12C0                       		move.b	d0,(a1)+
00003CA0 0240 000F                  		andi.w	#$F,d0
00003CA4 D040                       		add.w	d0,d0
00003CA6 305A                       		movea.w	(a2)+,a0
00003CA8 365A                       		movea.w	(a2)+,a3
00003CAA 36B0 0000                  		move.w	(a0,d0.w),(a3)
00003CAE                            
00003CAE                            loc_1B06:
00003CAE 51C9 FFD8                  		dbf	d1,loc_1AE0
00003CB2 5378 F634                  		subq.w	#1,(v_pcyc_time).w
00003CB6 6A00                       		bpl.s	locret_1B64
00003CB8 41F9 0000 0000             		lea	(Pal_SBZCyc4).l,a0
00003CBE 31FC 0001 F634             		move.w	#1,(v_pcyc_time).w
00003CC4 4A38 FE11                  		tst.b	(v_act).w
00003CC8 6700                       		beq.s	loc_1B2E
00003CCA 41F9 0000 0000             		lea	(Pal_SBZCyc10).l,a0
00003CD0 31FC 0000 F634             		move.w	#0,(v_pcyc_time).w
00003CD6                            
00003CD6                            loc_1B2E:
00003CD6 72FF                       		moveq	#-1,d1
00003CD8 4A38 F7C0                  		tst.b	(f_conveyrev).w
00003CDC 6700                       		beq.s	loc_1B38
00003CDE 4441                       		neg.w	d1
00003CE0                            
00003CE0                            loc_1B38:
00003CE0 3038 F632                  		move.w	(v_pcyc_num).w,d0
00003CE4 0240 0003                  		andi.w	#3,d0
00003CE8 D041                       		add.w	d1,d0
00003CEA 0C40 0003                  		cmpi.w	#3,d0
00003CEE 6500                       		bcs.s	loc_1B52
00003CF0 3200                       		move.w	d0,d1
00003CF2 7000                       		moveq	#0,d0
00003CF4 4A41                       		tst.w	d1
00003CF6 6A00                       		bpl.s	loc_1B52
00003CF8 7002                       		moveq	#2,d0
00003CFA                            
00003CFA                            loc_1B52:
00003CFA 31C0 F632                  		move.w	d0,(v_pcyc_num).w
00003CFE D040                       		add.w	d0,d0
00003D00 43F8 FB58                  		lea	(v_pal_dry+$58).w,a1
00003D04 22F0 0000                  		move.l	(a0,d0.w),(a1)+
00003D08 32B0 0004                  		move.w	4(a0,d0.w),(a1)
00003D0C                            
00003D0C                            locret_1B64:
00003D0C 4E75                       		rts	
00003D0E                            ; End of function PalCycle_SBZ
00003D0E                            ; End of function PalCycle_SBZ
00003D0E                            
00003D0E                            Pal_TitleCyc:	incbin	"palette\Cycle - Title Screen Water.bin"
00003D2E                            Pal_GHZCyc:	incbin	"palette\Cycle - GHZ.bin"
00003D4E                            Pal_LZCyc1:	incbin	"palette\Cycle - LZ Waterfall.bin"
00003D6E                            Pal_LZCyc2:	incbin	"palette\Cycle - LZ Conveyor Belt.bin"
00003D80                            Pal_LZCyc3:	incbin	"palette\Cycle - LZ Conveyor Belt Underwater.bin"
00003D92                            Pal_SBZ3Cyc1:	incbin	"palette\Cycle - SBZ3 Waterfall.bin"
00003DFA                            Pal_SLZCyc:	incbin	"palette\Cycle - SLZ.bin"
00003E1E                            Pal_SYZCyc1:	incbin	"palette\Cycle - SYZ1.bin"
00003E3E                            Pal_SYZCyc2:	incbin	"palette\Cycle - SYZ2.bin"
00003E4E                            
00003E4E                            		include	"_inc\SBZ Palette Scripts.asm"
00003E4E                            ; ---------------------------------------------------------------------------
00003E4E                            ; Scrap Brain Zone palette cycling script
00003E4E                            ; ---------------------------------------------------------------------------
00003E4E                            
00003E4E                            mSBZp:	macro duration,colours,paladdress,ramaddress
00003E4E                            	dc.b duration, colours
00003E4E                            	dc.w paladdress, ramaddress
00003E4E                            	endm
00003E4E                            
00003E4E                            ; duration in frames, number of colours, palette address, RAM address
00003E4E                            
00003E4E                            Pal_SBZCycList1:
00003E4E 0000                       	dc.w ((end_SBZCycList1-Pal_SBZCycList1-2)/6)-1
00003E50 0708 0000 FB50             	mSBZp	7,8,Pal_SBZCyc1,v_pal_dry+$50
00003E56 0D08 0000 FB52             	mSBZp	$D,8,Pal_SBZCyc2,v_pal_dry+$52
00003E5C 0E08 0000 FB6E             	mSBZp	$E,8,Pal_SBZCyc3,v_pal_dry+$6E
00003E62 0B08 0000 FB70             	mSBZp	$B,8,Pal_SBZCyc5,v_pal_dry+$70
00003E68 0708 0000 FB72             	mSBZp	7,8,Pal_SBZCyc6,v_pal_dry+$72
00003E6E 1C10 0000 FB7E             	mSBZp	$1C,$10,Pal_SBZCyc7,v_pal_dry+$7E
00003E74 0303 0000 FB78             	mSBZp	3,3,Pal_SBZCyc8,v_pal_dry+$78
00003E7A 0303 0000 FB7A             	mSBZp	3,3,Pal_SBZCyc8+2,v_pal_dry+$7A
00003E80 0303 0000 FB7C             	mSBZp	3,3,Pal_SBZCyc8+4,v_pal_dry+$7C
00003E86                            end_SBZCycList1:
00003E86                            	even
00003E86                            
00003E86                            Pal_SBZCycList2:
00003E86 0000                       	dc.w ((end_SBZCycList2-Pal_SBZCycList2-2)/6)-1
00003E88 0708 0000 FB50             	mSBZp	7,8,Pal_SBZCyc1,v_pal_dry+$50
00003E8E 0D08 0000 FB52             	mSBZp	$D,8,Pal_SBZCyc2,v_pal_dry+$52
00003E94 0908 0000 FB70             	mSBZp	9,8,Pal_SBZCyc9,v_pal_dry+$70
00003E9A 0708 0000 FB72             	mSBZp	7,8,Pal_SBZCyc6,v_pal_dry+$72
00003EA0 0303 0000 FB78             	mSBZp	3,3,Pal_SBZCyc8,v_pal_dry+$78
00003EA6 0303 0000 FB7A             	mSBZp	3,3,Pal_SBZCyc8+2,v_pal_dry+$7A
00003EAC 0303 0000 FB7C             	mSBZp	3,3,Pal_SBZCyc8+4,v_pal_dry+$7C
00003EB2                            end_SBZCycList2:
00003EB2                            	even
00003EB2                            	even
00003EB2                            
00003EB2                            Pal_SBZCyc1:	incbin	"palette\Cycle - SBZ 1.bin"
00003EC2                            Pal_SBZCyc2:	incbin	"palette\Cycle - SBZ 2.bin"
00003ED2                            Pal_SBZCyc3:	incbin	"palette\Cycle - SBZ 3.bin"
00003EE2                            Pal_SBZCyc4:	incbin	"palette\Cycle - SBZ 4.bin"
00003EEE                            Pal_SBZCyc5:	incbin	"palette\Cycle - SBZ 5.bin"
00003EFE                            Pal_SBZCyc6:	incbin	"palette\Cycle - SBZ 6.bin"
00003F0E                            Pal_SBZCyc7:	incbin	"palette\Cycle - SBZ 7.bin"
00003F2E                            Pal_SBZCyc8:	incbin	"palette\Cycle - SBZ 8.bin"
00003F38                            Pal_SBZCyc9:	incbin	"palette\Cycle - SBZ 9.bin"
00003F48                            Pal_SBZCyc10:	incbin	"palette\Cycle - SBZ 10.bin"
00003F54                            ; ---------------------------------------------------------------------------
00003F54                            ; Subroutine to	fade in from black
00003F54                            ; ---------------------------------------------------------------------------
00003F54                            
00003F54                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00003F54                            
00003F54                            
00003F54                            PaletteFadeIn:
00003F54 31FC 003F F626             		move.w	#$003F,(v_pfade_start).w ; set start position = 0; size = $40
00003F5A                            
00003F5A                            PalFadeIn_Alt:				; start position and size are already set
00003F5A 7000                       		moveq	#0,d0
00003F5C 41F8 FB00                  		lea	(v_pal_dry).w,a0
00003F60 1038 F626                  		move.b	(v_pfade_start).w,d0
00003F64 D0C0                       		adda.w	d0,a0
00003F66 7200                       		moveq	#cBlack,d1
00003F68 1038 F627                  		move.b	(v_pfade_size).w,d0
00003F6C                            
00003F6C                            	@fill:
00003F6C 30C1                       		move.w	d1,(a0)+
00003F6E 51C8 FFFC                  		dbf	d0,@fill 	; fill palette with black
00003F72                            
00003F72 383C 0015                  		move.w	#$15,d4
00003F76                            
00003F76                            	@mainloop:
00003F76 11FC 0012 F62A             		move.b	#$12,(v_vbla_routine).w
00003F7C 6100 0000                  		bsr.w	WaitForVBla
00003F80 6100                       		bsr.s	FadeIn_FromBlack
00003F82 6100 F5DE                  		bsr.w	RunPLC
00003F86 51CC FFEE                  		dbf	d4,@mainloop
00003F8A 4E75                       		rts	
00003F8C                            ; End of function PaletteFadeIn
00003F8C                            
00003F8C                            
00003F8C                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00003F8C                            
00003F8C                            
00003F8C                            FadeIn_FromBlack:
00003F8C 7000                       		moveq	#0,d0
00003F8E 41F8 FB00                  		lea	(v_pal_dry).w,a0
00003F92 43F8 FB80                  		lea	(v_pal_dry_dup).w,a1
00003F96 1038 F626                  		move.b	(v_pfade_start).w,d0
00003F9A D0C0                       		adda.w	d0,a0
00003F9C D2C0                       		adda.w	d0,a1
00003F9E 1038 F627                  		move.b	(v_pfade_size).w,d0
00003FA2                            
00003FA2                            	@addcolour:
00003FA2 6100                       		bsr.s	FadeIn_AddColour ; increase colour
00003FA4 51C8 FFFC                  		dbf	d0,@addcolour	; repeat for size of palette
00003FA8                            
00003FA8 0C38 0001 FE10             		cmpi.b	#id_LZ,(v_zone).w	; is level Labyrinth?
00003FAE 6600                       		bne.s	@exit		; if not, branch
00003FB0                            
00003FB0 7000                       		moveq	#0,d0
00003FB2 41F8 FA80                  		lea	(v_pal_water).w,a0
00003FB6 43F8 FA00                  		lea	(v_pal_water_dup).w,a1
00003FBA 1038 F626                  		move.b	(v_pfade_start).w,d0
00003FBE D0C0                       		adda.w	d0,a0
00003FC0 D2C0                       		adda.w	d0,a1
00003FC2 1038 F627                  		move.b	(v_pfade_size).w,d0
00003FC6                            
00003FC6                            	@addcolour2:
00003FC6 6100                       		bsr.s	FadeIn_AddColour ; increase colour again
00003FC8 51C8 FFFC                  		dbf	d0,@addcolour2 ; repeat
00003FCC                            
00003FCC                            @exit:
00003FCC 4E75                       		rts	
00003FCE                            ; End of function FadeIn_FromBlack
00003FCE                            
00003FCE                            
00003FCE                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00003FCE                            
00003FCE                            
00003FCE                            FadeIn_AddColour:
00003FCE                            @addblue:
00003FCE 3419                       		move.w	(a1)+,d2
00003FD0 3610                       		move.w	(a0),d3
00003FD2 B642                       		cmp.w	d2,d3		; is colour already at threshold level?
00003FD4 6700                       		beq.s	@next		; if yes, branch
00003FD6 3203                       		move.w	d3,d1
00003FD8 0641 0200                  		addi.w	#$200,d1	; increase blue	value
00003FDC B242                       		cmp.w	d2,d1		; has blue reached threshold level?
00003FDE 6200                       		bhi.s	@addgreen	; if yes, branch
00003FE0 30C1                       		move.w	d1,(a0)+	; update palette
00003FE2 4E75                       		rts	
00003FE4                            ; ===========================================================================
00003FE4                            
00003FE4                            @addgreen:
00003FE4 3203                       		move.w	d3,d1
00003FE6 0641 0020                  		addi.w	#$20,d1		; increase green value
00003FEA B242                       		cmp.w	d2,d1
00003FEC 6200                       		bhi.s	@addred
00003FEE 30C1                       		move.w	d1,(a0)+	; update palette
00003FF0 4E75                       		rts	
00003FF2                            ; ===========================================================================
00003FF2                            
00003FF2                            @addred:
00003FF2 5458                       		addq.w	#2,(a0)+	; increase red value
00003FF4 4E75                       		rts	
00003FF6                            ; ===========================================================================
00003FF6                            
00003FF6                            @next:
00003FF6 5448                       		addq.w	#2,a0		; next colour
00003FF8 4E75                       		rts	
00003FFA                            ; End of function FadeIn_AddColour
00003FFA                            
00003FFA                            
00003FFA                            ; ---------------------------------------------------------------------------
00003FFA                            ; Subroutine to fade out to black
00003FFA                            ; ---------------------------------------------------------------------------
00003FFA                            
00003FFA                            
00003FFA                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00003FFA                            
00003FFA                            
00003FFA                            PaletteFadeOut:
00003FFA 31FC 003F F626             		move.w	#$003F,(v_pfade_start).w ; start position = 0; size = $40
00004000 383C 0015                  		move.w	#$15,d4
00004004                            
00004004                            	@mainloop:
00004004 11FC 0012 F62A             		move.b	#$12,(v_vbla_routine).w
0000400A 6100 0000                  		bsr.w	WaitForVBla
0000400E 6100                       		bsr.s	FadeOut_ToBlack
00004010 6100 F550                  		bsr.w	RunPLC
00004014 51CC FFEE                  		dbf	d4,@mainloop
00004018 4E75                       		rts	
0000401A                            ; End of function PaletteFadeOut
0000401A                            
0000401A                            
0000401A                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
0000401A                            
0000401A                            
0000401A                            FadeOut_ToBlack:
0000401A 7000                       		moveq	#0,d0
0000401C 41F8 FB00                  		lea	(v_pal_dry).w,a0
00004020 1038 F626                  		move.b	(v_pfade_start).w,d0
00004024 D0C0                       		adda.w	d0,a0
00004026 1038 F627                  		move.b	(v_pfade_size).w,d0
0000402A                            
0000402A                            	@decolour:
0000402A 6100                       		bsr.s	FadeOut_DecColour ; decrease colour
0000402C 51C8 FFFC                  		dbf	d0,@decolour	; repeat for size of palette
00004030                            
00004030 7000                       		moveq	#0,d0
00004032 41F8 FA80                  		lea	(v_pal_water).w,a0
00004036 1038 F626                  		move.b	(v_pfade_start).w,d0
0000403A D0C0                       		adda.w	d0,a0
0000403C 1038 F627                  		move.b	(v_pfade_size).w,d0
00004040                            
00004040                            	@decolour2:
00004040 6100                       		bsr.s	FadeOut_DecColour
00004042 51C8 FFFC                  		dbf	d0,@decolour2
00004046 4E75                       		rts	
00004048                            ; End of function FadeOut_ToBlack
00004048                            
00004048                            
00004048                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00004048                            
00004048                            
00004048                            FadeOut_DecColour:
00004048                            @dered:
00004048 3410                       		move.w	(a0),d2
0000404A 6700                       		beq.s	@next
0000404C 3202                       		move.w	d2,d1
0000404E 0241 000E                  		andi.w	#$E,d1
00004052 6700                       		beq.s	@degreen
00004054 5558                       		subq.w	#2,(a0)+	; decrease red value
00004056 4E75                       		rts	
00004058                            ; ===========================================================================
00004058                            
00004058                            @degreen:
00004058 3202                       		move.w	d2,d1
0000405A 0241 00E0                  		andi.w	#$E0,d1
0000405E 6700                       		beq.s	@deblue
00004060 0458 0020                  		subi.w	#$20,(a0)+	; decrease green value
00004064 4E75                       		rts	
00004066                            ; ===========================================================================
00004066                            
00004066                            @deblue:
00004066 3202                       		move.w	d2,d1
00004068 0241 0E00                  		andi.w	#$E00,d1
0000406C 6700                       		beq.s	@next
0000406E 0458 0200                  		subi.w	#$200,(a0)+	; decrease blue	value
00004072 4E75                       		rts	
00004074                            ; ===========================================================================
00004074                            
00004074                            @next:
00004074 5448                       		addq.w	#2,a0
00004076 4E75                       		rts	
00004078                            ; End of function FadeOut_DecColour
00004078                            
00004078                            ; ---------------------------------------------------------------------------
00004078                            ; Subroutine to	fade in from white (Special Stage)
00004078                            ; ---------------------------------------------------------------------------
00004078                            
00004078                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00004078                            
00004078                            
00004078                            PaletteWhiteIn:
00004078 31FC 003F F626             		move.w	#$003F,(v_pfade_start).w ; start position = 0; size = $40
0000407E                            		
0000407E                            PaletteWhiteIn_Alt:
0000407E 7000                       		moveq	#0,d0
00004080 41F8 FB00                  		lea	(v_pal_dry).w,a0
00004084 1038 F626                  		move.b	(v_pfade_start).w,d0
00004088 D0C0                       		adda.w	d0,a0
0000408A 323C 0EEE                  		move.w	#cWhite,d1
0000408E 1038 F627                  		move.b	(v_pfade_size).w,d0
00004092                            
00004092                            	@fill:
00004092 30C1                       		move.w	d1,(a0)+
00004094 51C8 FFFC                  		dbf	d0,@fill 	; fill palette with white
00004098                            
00004098 383C 0015                  		move.w	#$15,d4
0000409C                            
0000409C                            	@mainloop:
0000409C 11FC 0012 F62A             		move.b	#$12,(v_vbla_routine).w
000040A2 6100 0000                  		bsr.w	WaitForVBla
000040A6 6100                       		bsr.s	WhiteIn_FromWhite
000040A8 6100 F4B8                  		bsr.w	RunPLC
000040AC 51CC FFEE                  		dbf	d4,@mainloop
000040B0 4E75                       		rts	
000040B2                            ; End of function PaletteWhiteIn
000040B2                            
000040B2                            
000040B2                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
000040B2                            
000040B2                            
000040B2                            WhiteIn_FromWhite:
000040B2 7000                       		moveq	#0,d0
000040B4 41F8 FB00                  		lea	(v_pal_dry).w,a0
000040B8 43F8 FB80                  		lea	(v_pal_dry_dup).w,a1
000040BC 1038 F626                  		move.b	(v_pfade_start).w,d0
000040C0 D0C0                       		adda.w	d0,a0
000040C2 D2C0                       		adda.w	d0,a1
000040C4 1038 F627                  		move.b	(v_pfade_size).w,d0
000040C8                            
000040C8                            	@decolour:
000040C8 6100                       		bsr.s	WhiteIn_DecColour ; decrease colour
000040CA 51C8 FFFC                  		dbf	d0,@decolour	; repeat for size of palette
000040CE                            
000040CE 0C38 0001 FE10             		cmpi.b	#id_LZ,(v_zone).w	; is level Labyrinth?
000040D4 6600                       		bne.s	@exit		; if not, branch
000040D6 7000                       		moveq	#0,d0
000040D8 41F8 FA80                  		lea	(v_pal_water).w,a0
000040DC 43F8 FA00                  		lea	(v_pal_water_dup).w,a1
000040E0 1038 F626                  		move.b	(v_pfade_start).w,d0
000040E4 D0C0                       		adda.w	d0,a0
000040E6 D2C0                       		adda.w	d0,a1
000040E8 1038 F627                  		move.b	(v_pfade_size).w,d0
000040EC                            
000040EC                            	@decolour2:
000040EC 6100                       		bsr.s	WhiteIn_DecColour
000040EE 51C8 FFFC                  		dbf	d0,@decolour2
000040F2                            
000040F2                            	@exit:
000040F2 4E75                       		rts	
000040F4                            ; End of function WhiteIn_FromWhite
000040F4                            
000040F4                            
000040F4                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
000040F4                            
000040F4                            
000040F4                            WhiteIn_DecColour:
000040F4                            @deblue:
000040F4 3419                       		move.w	(a1)+,d2
000040F6 3610                       		move.w	(a0),d3
000040F8 B642                       		cmp.w	d2,d3
000040FA 6700                       		beq.s	@next
000040FC 3203                       		move.w	d3,d1
000040FE 0441 0200                  		subi.w	#$200,d1	; decrease blue	value
00004102 6500                       		blo.s	@degreen
00004104 B242                       		cmp.w	d2,d1
00004106 6500                       		blo.s	@degreen
00004108 30C1                       		move.w	d1,(a0)+
0000410A 4E75                       		rts	
0000410C                            ; ===========================================================================
0000410C                            
0000410C                            @degreen:
0000410C 3203                       		move.w	d3,d1
0000410E 0441 0020                  		subi.w	#$20,d1		; decrease green value
00004112 6500                       		blo.s	@dered
00004114 B242                       		cmp.w	d2,d1
00004116 6500                       		blo.s	@dered
00004118 30C1                       		move.w	d1,(a0)+
0000411A 4E75                       		rts	
0000411C                            ; ===========================================================================
0000411C                            
0000411C                            @dered:
0000411C 5558                       		subq.w	#2,(a0)+	; decrease red value
0000411E 4E75                       		rts	
00004120                            ; ===========================================================================
00004120                            
00004120                            @next:
00004120 5448                       		addq.w	#2,a0
00004122 4E75                       		rts	
00004124                            ; End of function WhiteIn_DecColour
00004124                            
00004124                            ; ---------------------------------------------------------------------------
00004124                            ; Subroutine to fade to white (Special Stage)
00004124                            ; ---------------------------------------------------------------------------
00004124                            
00004124                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00004124                            
00004124                            
00004124                            PaletteWhiteOut:
00004124 31FC 003F F626             		move.w	#$003F,(v_pfade_start).w ; start position = 0; size = $40
0000412A 383C 0015                  		move.w	#$15,d4
0000412E                            
0000412E                            	@mainloop:
0000412E 11FC 0012 F62A             		move.b	#$12,(v_vbla_routine).w
00004134 6100 0000                  		bsr.w	WaitForVBla
00004138 6100                       		bsr.s	WhiteOut_ToWhite
0000413A 6100 F426                  		bsr.w	RunPLC
0000413E 51CC FFEE                  		dbf	d4,@mainloop
00004142 4E75                       		rts	
00004144                            ; End of function PaletteWhiteOut
00004144                            
00004144                            
00004144                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00004144                            
00004144                            
00004144                            WhiteOut_ToWhite:
00004144 7000                       		moveq	#0,d0
00004146 41F8 FB00                  		lea	(v_pal_dry).w,a0
0000414A 1038 F626                  		move.b	(v_pfade_start).w,d0
0000414E D0C0                       		adda.w	d0,a0
00004150 1038 F627                  		move.b	(v_pfade_size).w,d0
00004154                            
00004154                            	@addcolour:
00004154 6100                       		bsr.s	WhiteOut_AddColour
00004156 51C8 FFFC                  		dbf	d0,@addcolour
0000415A                            
0000415A 7000                       		moveq	#0,d0
0000415C 41F8 FA80                  		lea	(v_pal_water).w,a0
00004160 1038 F626                  		move.b	(v_pfade_start).w,d0
00004164 D0C0                       		adda.w	d0,a0
00004166 1038 F627                  		move.b	(v_pfade_size).w,d0
0000416A                            
0000416A                            	@addcolour2:
0000416A 6100                       		bsr.s	WhiteOut_AddColour
0000416C 51C8 FFFC                  		dbf	d0,@addcolour2
00004170 4E75                       		rts	
00004172                            ; End of function WhiteOut_ToWhite
00004172                            
00004172                            
00004172                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00004172                            
00004172                            
00004172                            WhiteOut_AddColour:
00004172                            @addred:
00004172 3410                       		move.w	(a0),d2
00004174 0C42 0EEE                  		cmpi.w	#cWhite,d2
00004178 6700                       		beq.s	@next
0000417A 3202                       		move.w	d2,d1
0000417C 0241 000E                  		andi.w	#$E,d1
00004180 0C41 000E                  		cmpi.w	#cRed,d1
00004184 6700                       		beq.s	@addgreen
00004186 5458                       		addq.w	#2,(a0)+	; increase red value
00004188 4E75                       		rts	
0000418A                            ; ===========================================================================
0000418A                            
0000418A                            @addgreen:
0000418A 3202                       		move.w	d2,d1
0000418C 0241 00E0                  		andi.w	#$E0,d1
00004190 0C41 00E0                  		cmpi.w	#cGreen,d1
00004194 6700                       		beq.s	@addblue
00004196 0658 0020                  		addi.w	#$20,(a0)+	; increase green value
0000419A 4E75                       		rts	
0000419C                            ; ===========================================================================
0000419C                            
0000419C                            @addblue:
0000419C 3202                       		move.w	d2,d1
0000419E 0241 0E00                  		andi.w	#$E00,d1
000041A2 0C41 0E00                  		cmpi.w	#cBlue,d1
000041A6 6700                       		beq.s	@next
000041A8 0658 0200                  		addi.w	#$200,(a0)+	; increase blue	value
000041AC 4E75                       		rts	
000041AE                            ; ===========================================================================
000041AE                            
000041AE                            @next:
000041AE 5448                       		addq.w	#2,a0
000041B0 4E75                       		rts	
000041B2                            ; End of function WhiteOut_AddColour
000041B2                            
000041B2                            ; ---------------------------------------------------------------------------
000041B2                            ; Palette cycling routine - Sega logo
000041B2                            ; ---------------------------------------------------------------------------
000041B2                            
000041B2                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
000041B2                            
000041B2                            
000041B2                            
000041B2                            Pal_Sega1:	incbin	"palette\Sega1.bin"
000041D2                            Pal_Sega2:	incbin	"palette\Sega2.bin"
000041F2                            
000041F2                            ; ---------------------------------------------------------------------------
000041F2                            ; Subroutines to load palettes
000041F2                            
000041F2                            ; input:
000041F2                            ;	d0 = index number for palette
000041F2                            ; ---------------------------------------------------------------------------
000041F2                            
000041F2                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
000041F2                            
000041F2                            
000041F2                            PalLoad1:
000041F2 43F9 0000 0000             		lea	(PalPointers).l,a1
000041F8 E748                       		lsl.w	#3,d0
000041FA D2C0                       		adda.w	d0,a1
000041FC 2459                       		movea.l	(a1)+,a2	; get palette data address
000041FE 3659                       		movea.w	(a1)+,a3	; get target RAM address
00004200 D6FC 0080                  		adda.w	#v_pal_dry_dup-v_pal_dry,a3		; skip to "main" RAM address
00004204 3E19                       		move.w	(a1)+,d7	; get length of palette data
00004206                            
00004206                            	@loop:
00004206 26DA                       		move.l	(a2)+,(a3)+	; move data to RAM
00004208 51CF FFFC                  		dbf	d7,@loop
0000420C 4E75                       		rts	
0000420E                            ; End of function PalLoad1
0000420E                            
0000420E                            
0000420E                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
0000420E                            
0000420E                            
0000420E                            PalLoad2:
0000420E 43F9 0000 0000             		lea	(PalPointers).l,a1
00004214 E748                       		lsl.w	#3,d0
00004216 D2C0                       		adda.w	d0,a1
00004218 2459                       		movea.l	(a1)+,a2	; get palette data address
0000421A 3659                       		movea.w	(a1)+,a3	; get target RAM address
0000421C 3E19                       		move.w	(a1)+,d7	; get length of palette
0000421E                            
0000421E                            	@loop:
0000421E 26DA                       		move.l	(a2)+,(a3)+	; move data to RAM
00004220 51CF FFFC                  		dbf	d7,@loop
00004224 4E75                       		rts	
00004226                            ; End of function PalLoad2
00004226                            
00004226                            ; ---------------------------------------------------------------------------
00004226                            ; Underwater palette loading subroutine
00004226                            ; ---------------------------------------------------------------------------
00004226                            
00004226                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00004226                            
00004226                            
00004226                            PalLoad3_Water:
00004226 43F9 0000 0000             		lea	(PalPointers).l,a1
0000422C E748                       		lsl.w	#3,d0
0000422E D2C0                       		adda.w	d0,a1
00004230 2459                       		movea.l	(a1)+,a2	; get palette data address
00004232 3659                       		movea.w	(a1)+,a3	; get target RAM address
00004234 96FC 0080                  		suba.w	#v_pal_dry-v_pal_water,a3		; skip to "main" RAM address
00004238 3E19                       		move.w	(a1)+,d7	; get length of palette data
0000423A                            
0000423A                            	@loop:
0000423A 26DA                       		move.l	(a2)+,(a3)+	; move data to RAM
0000423C 51CF FFFC                  		dbf	d7,@loop
00004240 4E75                       		rts	
00004242                            ; End of function PalLoad3_Water
00004242                            
00004242                            
00004242                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00004242                            
00004242                            
00004242                            PalLoad4_Water:
00004242 43F9 0000 0000             		lea	(PalPointers).l,a1
00004248 E748                       		lsl.w	#3,d0
0000424A D2C0                       		adda.w	d0,a1
0000424C 2459                       		movea.l	(a1)+,a2	; get palette data address
0000424E 3659                       		movea.w	(a1)+,a3	; get target RAM address
00004250 96FC 0100                  		suba.w	#v_pal_dry-v_pal_water_dup,a3
00004254 3E19                       		move.w	(a1)+,d7	; get length of palette data
00004256                            
00004256                            	@loop:
00004256 26DA                       		move.l	(a2)+,(a3)+	; move data to RAM
00004258 51CF FFFC                  		dbf	d7,@loop
0000425C 4E75                       		rts	
0000425E                            ; End of function PalLoad4_Water
0000425E                            
0000425E                            ; ===========================================================================
0000425E                            
0000425E                            		include	"_inc\Palette Pointers.asm"
0000425E                            ; ---------------------------------------------------------------------------
0000425E                            ; Palette pointers
0000425E                            ; ---------------------------------------------------------------------------
0000425E                            
0000425E                            palp:	macro paladdress,ramaddress,colours
0000425E                            	dc.l paladdress
0000425E                            	dc.w ramaddress, (colours>>1)-1
0000425E                            	endm
0000425E                            
0000425E                            PalPointers:
0000425E                            
0000425E                            ; palette address, RAM address, colours
0000425E                            
0000425E 0000 0000 FB00 001F        ptr_Pal_SegaBG:		palp	Pal_SegaBG,v_pal_dry,$40		; 0 - Sega logo
00004266 0000 0000 FB00 001F        ptr_Pal_Title:		palp	Pal_Title,v_pal_dry,$40		; 1 - title screen
0000426E 0000 0000 FB00 001F        ptr_Pal_LevelSel:	palp	Pal_LevelSel,v_pal_dry,$40		; 2 - level select
00004276 0000 0000 FB00 0007        ptr_Pal_Sonic:		palp	Pal_Sonic,v_pal_dry,$10		; 3 - Sonic
0000427E                            Pal_Levels:
0000427E 0000 0000 FB20 0017        ptr_Pal_GHZ:		palp	Pal_GHZ,v_pal_dry+$20, $30		; 4 - GHZ
00004286 0000 0000 FB20 0017        ptr_Pal_LZ:		palp	Pal_LZ,v_pal_dry+$20,$30		; 5 - LZ
0000428E 0000 0000 FB20 0017        ptr_Pal_MZ:		palp	Pal_MZ,v_pal_dry+$20,$30		; 6 - MZ
00004296 0000 0000 FB20 0017        ptr_Pal_IMZ:		palp	Pal_IMZ,v_pal_dry+$20,$30		
0000429E 0000 0000 FB20 0017        ptr_Pal_SLZ:		palp	Pal_SLZ,v_pal_dry+$20,$30		; 7 - SLZ
000042A6 0000 0000 FB20 0017        ptr_Pal_SYZ:		palp	Pal_SYZ,v_pal_dry+$20,$30		; 8 - SYZ
000042AE 0000 0000 FB20 0017        ptr_Pal_SBZ1:		palp	Pal_SBZ1,v_pal_dry+$20,$30		; 9 - SBZ1
000042B6 0000 0000 FB00 001F        ptr_Pal_Special:	palp	Pal_Special,v_pal_dry,$40		; $A (10) - special stage
000042BE 0000 0000 FB00 001F        ptr_Pal_LZWater:	palp	Pal_LZWater,v_pal_dry,$40		; $B (11) - LZ underwater
000042C6 0000 0000 FB20 0017        ptr_Pal_SBZ3:		palp	Pal_SBZ3,v_pal_dry+$20,$30		; $C (12) - SBZ3
000042CE 0000 0000 FB00 001F        ptr_Pal_SBZ3Water:	palp	Pal_SBZ3Water,v_pal_dry,$40		; $D (13) - SBZ3 underwater
000042D6 0000 0000 FB20 0017        ptr_Pal_SBZ2:		palp	Pal_SBZ2,v_pal_dry+$20,$30		; $E (14) - SBZ2
000042DE 0000 0000 FB00 0007        ptr_Pal_LZSonWater:	palp	Pal_LZSonWater,v_pal_dry,$10	; $F (15) - LZ Sonic underwater
000042E6 0000 0000 FB00 0007        ptr_Pal_SBZ3SonWat:	palp	Pal_SBZ3SonWat,v_pal_dry,$10	; $10 (16) - SBZ3 Sonic underwater
000042EE 0000 0000 FB00 001F        ptr_Pal_SSResult:	palp	Pal_SSResult,v_pal_dry,$40		; $11 (17) - special stage results
000042F6 0000 0000 FB00 000F        ptr_Pal_Continue:	palp	Pal_Continue,v_pal_dry,$20		; $12 (18) - special stage results continue
000042FE 0000 0000 FB00 001F        ptr_Pal_Ending:		palp	Pal_Ending,v_pal_dry,$40		; $13 (19) - ending sequence
00004306 0000 0000 FB20 0017        ptr_Pal_CSZ:		palp	Pal_CSZ,v_pal_dry+$20,$30		; 8 - SYZ
0000430E 0000 0000 FB20 0017        ptr_Pal_FUN:		palp	Pal_FUN,v_pal_dry+$20,$30		; 8 - SYZ
00004316 0000 0000 FB00 000F        ptr_Pal_Temp:		palp	Pal_Temp,v_pal_dry,$20		; 3 - Sonic
0000431E                            			even
0000431E                            
0000431E                            
0000431E =00000000                  palid_SegaBG:		equ (ptr_Pal_SegaBG-PalPointers)/8
0000431E =00000001                  palid_Title:		equ (ptr_Pal_Title-PalPointers)/8
0000431E =00000002                  palid_LevelSel:		equ (ptr_Pal_LevelSel-PalPointers)/8
0000431E =00000003                  palid_Sonic:		equ (ptr_Pal_Sonic-PalPointers)/8
0000431E =00000004                  palid_GHZ:		equ (ptr_Pal_GHZ-PalPointers)/8
0000431E =00000005                  palid_LZ:		equ (ptr_Pal_LZ-PalPointers)/8
0000431E =00000006                  palid_MZ:		equ (ptr_Pal_MZ-PalPointers)/8
0000431E =00000007                  palid_IMZ:		equ (ptr_Pal_IMZ-PalPointers)/8
0000431E =00000008                  palid_SLZ:		equ (ptr_Pal_SLZ-PalPointers)/8
0000431E =00000009                  palid_SZ:		equ (ptr_Pal_SYZ-PalPointers)/8
0000431E =0000000A                  palid_CWZ1:		equ (ptr_Pal_SBZ1-PalPointers)/8
0000431E =0000000B                  palid_Special:		equ (ptr_Pal_Special-PalPointers)/8
0000431E =0000000C                  palid_LZWater:		equ (ptr_Pal_LZWater-PalPointers)/8
0000431E =0000000D                  palid_CWZ3:		equ (ptr_Pal_SBZ3-PalPointers)/8
0000431E =0000000E                  palid_CWZ3Water:	equ (ptr_Pal_SBZ3Water-PalPointers)/8
0000431E =0000000F                  palid_CWZ2:		equ (ptr_Pal_SBZ2-PalPointers)/8
0000431E =00000010                  palid_LZSonWater:	equ (ptr_Pal_LZSonWater-PalPointers)/8
0000431E =00000011                  palid_CWZ3SonWat:	equ (ptr_Pal_SBZ3SonWat-PalPointers)/8
0000431E =00000012                  palid_SSResult:		equ (ptr_Pal_SSResult-PalPointers)/8
0000431E =00000013                  palid_Continue:		equ (ptr_Pal_Continue-PalPointers)/8
0000431E =00000014                  palid_Ending:		equ (ptr_Pal_Ending-PalPointers)/8
0000431E =00000015                  palid_CSZ:		equ (ptr_Pal_CSZ-PalPointers)/8
0000431E =00000016                  palid_FUN:		equ (ptr_Pal_FUN-PalPointers)/8
0000431E =00000017                  palid_Temp:		equ (ptr_Pal_Temp-PalPointers)/8
0000431E =00000017                  palid_Temp:		equ (ptr_Pal_Temp-PalPointers)/8
0000431E                            
0000431E                            ; ---------------------------------------------------------------------------
0000431E                            ; Palette data
0000431E                            ; ---------------------------------------------------------------------------
0000431E                            Pal_SegaBG:	incbin	"palette\Sega Background.bin"
0000439E                            Pal_Title:	incbin	"palette\Title Screen.bin"
0000441E                            Pal_LevelSel:	incbin	"palette\Level Select.bin"
0000449E                            Pal_Sonic:	incbin	"palette\Sonic.bin"
000044BE                            Pal_GHZ:	incbin	"palette\Green Hill Zone.bin"
0000451E                            Pal_LZ:		incbin	"palette\Labyrinth Zone.bin"
0000457E                            Pal_LZWater:	incbin	"palette\Labyrinth Zone Underwater.bin"
000045FE                            Pal_MZ:		incbin	"palette\Marble Zone.bin"
0000465E                            Pal_IMZ:	incbin	"palette\Ice Mountain Zone.bin"
000046BE                            Pal_SLZ:	incbin	"palette\Star Light Zone.bin"
0000471E                            Pal_SYZ:	incbin	"palette\Spring Yard Zone.bin"
0000477E                            Pal_SBZ1:	incbin	"palette\Clock Work Zone.bin"
000047DE                            Pal_SBZ2:	incbin	"palette\Clock Work Zone.bin"
0000483E                            Pal_Special:	incbin	"palette\Special Stage.bin"
000048BE                            Pal_SBZ3:	incbin	"palette\SBZ Act 3.bin"
0000491E                            Pal_SBZ3Water:	incbin	"palette\SBZ Act 3 Underwater.bin"
0000499E                            Pal_LZSonWater:	incbin	"palette\Sonic - LZ Underwater.bin"
000049BE                            Pal_SBZ3SonWat:	incbin	"palette\Sonic - SBZ3 Underwater.bin"
000049DE                            Pal_SSResult:	incbin	"palette\Special Stage Results.bin"
00004A5E                            Pal_Continue:	incbin	"palette\Special Stage Continue Bonus.bin"
00004A9E                            Pal_Ending:	incbin	"palette\Ending.bin"
00004B1E                            Pal_CSZ:	incbin	"palette\Cosmic Space Zone.bin"
00004B7E                            Pal_FUN:	incbin	"palette\Fun Zone.bin"
00004BDE                            Pal_Temp:	incbin	"palette\blank hacky workaround.bin"
00004C1E                            
00004C1E                            ; ---------------------------------------------------------------------------
00004C1E                            ; Subroutine to	wait for VBlank routines to complete
00004C1E                            ; ---------------------------------------------------------------------------
00004C1E                            
00004C1E                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00004C1E                            
00004C1E                            WaitForVBla:
00004C1E 46FC 2300                  		enable_ints
00004C22                            
00004C22                            	@wait:
00004C22 4A38 F62A                  		tst.b	(v_vbla_routine).w ; has VBlank routine finished?
00004C26 66FA                       		bne.s	@wait		; if not, branch
00004C28 4E75                       		rts	
00004C2A                            ; End of function WaitForVBla
00004C2A                            
00004C2A                            		include	"_incObj\sub RandomNumber.asm"
00004C2A                            ; ---------------------------------------------------------------------------
00004C2A                            ; Subroutine to	generate a pseudo-random number	in d0
00004C2A                            ; ---------------------------------------------------------------------------
00004C2A                            
00004C2A                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00004C2A                            
00004C2A                            
00004C2A                            RandomNumber:
00004C2A 2238 F636                  		move.l	(v_random).w,d1
00004C2E 6600                       		bne.s	@scramble	; if d1 is not 0, branch
00004C30 223C 2A6D 365A             		move.l	#$2A6D365A,d1	; if d1 is 0, use seed number
00004C36                            
00004C36                            	@scramble:
00004C36 2001                       		move.l	d1,d0
00004C38 E581                       		asl.l	#2,d1
00004C3A D280                       		add.l	d0,d1
00004C3C E781                       		asl.l	#3,d1
00004C3E D280                       		add.l	d0,d1
00004C40 3001                       		move.w	d1,d0
00004C42 4841                       		swap	d1
00004C44 D041                       		add.w	d1,d0
00004C46 3200                       		move.w	d0,d1
00004C48 4841                       		swap	d1
00004C4A 21C1 F636                  		move.l	d1,(v_random).w
00004C4E 4E75                       		rts	
00004C4E 4E75                       		rts	
00004C50                            		include	"_incObj\sub CalcSine.asm"
00004C50                            ; ---------------------------------------------------------------------------
00004C50                            ; Subroutine calculate a sine
00004C50                            
00004C50                            ; input:
00004C50                            ;	d0 = angle
00004C50                            
00004C50                            ; output:
00004C50                            ;	d0 = sine
00004C50                            ;	d1 = cosine
00004C50                            ; ---------------------------------------------------------------------------
00004C50                            
00004C50                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00004C50                            
00004C50                            
00004C50                            CalcSine:
00004C50 0240 00FF                  		andi.w	#$FF,d0
00004C54 D040                       		add.w	d0,d0
00004C56 0640 0080                  		addi.w	#$80,d0
00004C5A 323B 0000                  		move.w	Sine_Data(pc,d0.w),d1
00004C5E 0440 0080                  		subi.w	#$80,d0
00004C62 303B 0000                  		move.w	Sine_Data(pc,d0.w),d0
00004C66 4E75                       		rts	
00004C68                            ; End of function CalcSine
00004C68                            
00004C68                            ; ===========================================================================
00004C68                            
00004C68                            Sine_Data:	incbin	"misc\sinewave.bin"	; values for a 360 sine wave
00004EE8                            
00004EE8                            ; ===========================================================================
00004EE8                            
00004EE8                            ; The following code is unused garbage.
00004EE8                            
00004EE8 48E7 6000                  		movem.l	d1-d2,-(sp)
00004EEC 3200                       		move.w	d0,d1
00004EEE 4841                       		swap	d1
00004EF0 7000                       		moveq	#0,d0
00004EF2 3200                       		move.w	d0,d1
00004EF4 7407                       		moveq	#7,d2
00004EF6                            
00004EF6                            	loc_2C80:
00004EF6 E599                       		rol.l	#2,d1
00004EF8 D040                       		add.w	d0,d0
00004EFA 5240                       		addq.w	#1,d0
00004EFC 9240                       		sub.w	d0,d1
00004EFE 6400                       		bcc.s	loc_2C9A
00004F00 D240                       		add.w	d0,d1
00004F02 5340                       		subq.w	#1,d0
00004F04 51CA FFF0                  		dbf	d2,loc_2C80
00004F08 E248                       		lsr.w	#1,d0
00004F0A 4CDF 0006                  		movem.l	(sp)+,d1-d2
00004F0E 4E75                       		rts	
00004F10                            ; ===========================================================================
00004F10                            
00004F10                            	loc_2C9A:
00004F10 5240                       		addq.w	#1,d0
00004F12 51CA FFE2                  		dbf	d2,loc_2C80
00004F16 E248                       		lsr.w	#1,d0
00004F18 4CDF 0006                  		movem.l	(sp)+,d1-d2
00004F1C 4E75                       		rts	
00004F1E                            		include	"_incObj\sub CalcAngle.asm"
00004F1E                            ; ---------------------------------------------------------------------------
00004F1E                            ; Subroutine calculate an angle
00004F1E                            
00004F1E                            ; input:
00004F1E                            ;	d1 = x-axis distance
00004F1E                            ;	d2 = y-axis distance
00004F1E                            
00004F1E                            ; output:
00004F1E                            ;	d0 = angle
00004F1E                            ; ---------------------------------------------------------------------------
00004F1E                            
00004F1E                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00004F1E                            
00004F1E                            
00004F1E                            CalcAngle:
00004F1E 48E7 1800                  		movem.l	d3-d4,-(sp)
00004F22 7600                       		moveq	#0,d3
00004F24 7800                       		moveq	#0,d4
00004F26 3601                       		move.w	d1,d3
00004F28 3802                       		move.w	d2,d4
00004F2A 8843                       		or.w	d3,d4
00004F2C 6700                       		beq.s	loc_2D04
00004F2E 3802                       		move.w	d2,d4
00004F30 4A43                       		tst.w	d3
00004F32 6A00 0000                  		bpl.w	loc_2CC2
00004F36 4443                       		neg.w	d3
00004F38                            
00004F38                            loc_2CC2:
00004F38 4A44                       		tst.w	d4
00004F3A 6A00 0000                  		bpl.w	loc_2CCA
00004F3E 4444                       		neg.w	d4
00004F40                            
00004F40                            loc_2CCA:
00004F40 B843                       		cmp.w	d3,d4
00004F42 6400 0000                  		bcc.w	loc_2CDC
00004F46 E18C                       		lsl.l	#8,d4
00004F48 88C3                       		divu.w	d3,d4
00004F4A 7000                       		moveq	#0,d0
00004F4C 103B 4000                  		move.b	Angle_Data(pc,d4.w),d0
00004F50 6000                       		bra.s	loc_2CE6
00004F52                            ; ===========================================================================
00004F52                            
00004F52                            loc_2CDC:
00004F52 E18B                       		lsl.l	#8,d3
00004F54 86C4                       		divu.w	d4,d3
00004F56 7040                       		moveq	#$40,d0
00004F58 903B 3000                  		sub.b	Angle_Data(pc,d3.w),d0
00004F5C                            
00004F5C                            loc_2CE6:
00004F5C 4A41                       		tst.w	d1
00004F5E 6A00 0000                  		bpl.w	loc_2CF2
00004F62 4440                       		neg.w	d0
00004F64 0640 0080                  		addi.w	#$80,d0
00004F68                            
00004F68                            loc_2CF2:
00004F68 4A42                       		tst.w	d2
00004F6A 6A00 0000                  		bpl.w	loc_2CFE
00004F6E 4440                       		neg.w	d0
00004F70 0640 0100                  		addi.w	#$100,d0
00004F74                            
00004F74                            loc_2CFE:
00004F74 4CDF 0018                  		movem.l	(sp)+,d3-d4
00004F78 4E75                       		rts	
00004F7A                            ; ===========================================================================
00004F7A                            
00004F7A                            loc_2D04:
00004F7A 303C 0040                  		move.w	#$40,d0
00004F7E 4CDF 0018                  		movem.l	(sp)+,d3-d4
00004F82 4E75                       		rts	
00004F84                            ; End of function CalcAngle
00004F84                            
00004F84                            ; ===========================================================================
00004F84                            
00004F84                            Angle_Data:	incbin	"misc\angles.bin"
00005086                            
00005086                            ; ===========================================================================
00005086                            ; ===========================================================================
00005086                            
00005086                            GM_Hack:
00005086 103C 008F                      move.b  #$8F,d0             ; set music ID 
0000508A 4EB8 331E                      jsr     Playsound_Special.w     ; play ID
0000508E 4EB9 0000 3FFA                 jsr     PaletteFadeOut          ; fade palettes out
00005094 4EB8 3246                      jsr     ClearScreen.w           ; clear the plane mappings
00005098                                ; load art, mappings and the palette
00005098 43F9 00FF 0000                 lea     ($FF0000).l,a1          ; load dump location
0000509E 41F9 0000 0000                 lea     MAPS_HACK.l,a0          ; load compressed mappings address
000050A4 303C 0140                      move.w #320,d0                  ; prepare pattern index value to patch to mappings
000050A8 4EB8 3694                      jsr    EniDec.w                 ; decompress and dump
000050AC 203C 6000 0003                 move.l #$60000003,d0            ; prepare VRAM write mode address (Plane B E000)
000050B2 7227                           moveq  #$28-$01,d1              ; set map box draw width
000050B4 741D                           moveq  #$1E-$01,d2              ; set map box draw height
000050B6 6100 E2EA                      bsr.w   TilemapToVRAM         ; flush mappings to VRAM
000050BA 4DF9 FFC0 0004                 lea    ($FFC00004).l,a6         ; load VDP control port
000050C0 2CBC 6800 0000                 move.l #$68000000,(a6)          ; set VDP to VRAM write mode (Address 2800)
000050C6 41F9 0000 0000                 lea     ART_HACK.l,a0           ; load background art
000050CC 4EB9 0000 33CC                 jsr     NemDec              ; run NemDec to decompress art for display
000050D2 41F9 0000 0000                 lea Pal_HACK.l,a0        ; load this palette
000050D8 43F9 FFFF FB80                 lea ($FFFFFB80).l,a1        ; set as line 2
000050DE 303C 000F                      move.w  #$F,d0
000050E2                             
000050E2                            Hack_PalLoop:
000050E2 22D8                           move.l  (a0)+,(a1)+         ; copy colours to buffer
000050E4 22D8                           move.l  (a0)+,(a1)+         ; ''
000050E6 51C8 FFFA                      dbf d0,Hack_PalLoop      ; repeat until done
000050EA 4EB9 0000 3F54                 jsr PaletteFadeIn          ; fade palette in
000050F0 31FC 2274 F614                 move.w  #147*60,($FFFFF614).w     ; set delay time (3 seconds on a 60hz system)
000050F6                             
000050F6                            Hack_MainLoop:
000050F6 11FC 0002 F62A                 move.b  #2,($FFFFF62A).w        ; set V-blank routine to run
000050FC 4EB9 0000 4C1E                 jsr WaitForVBla          ; wait for V-blank (decreases "Demo_Time_left")
00005102 4A38 F605                      tst.b   ($FFFFF605).w           ; has player 1 pressed start button?
00005106 6B00                           bmi.s   Hack_GotoTitle         ; if so, branch
00005108 4A78 F614                      tst.w   ($FFFFF614).w           ; has the delay time finished?
0000510C 66E8                           bne.s   Hack_MainLoop          ; if not, branch
0000510E                             
0000510E                            Hack_GotoTitle:
0000510E 11FC 0004 F600                 move.b  #$04,($FFFFF600).w      ; set the screen mode to Title Screen
00005114 4E75                           rts                     ; return
00005116                            
00005116                            GM_Sega:
0000511E 6100 E434                  		bsr.w	ClearPLC
00005122 6100 EED6                  		bsr.w	PaletteFadeOut
00005126 4DF9 00C0 0004             		lea	($C00004).l,a6
0000512C 3CBC 8004                  		move.w	#$8004,(a6)
00005130 3CBC 8230                  		move.w	#$8230,(a6)
00005134 3CBC 8407                  		move.w	#$8407,(a6)
00005138 3CBC 8700                  		move.w	#$8700,(a6)
0000513C 3CBC 8B00                  		move.w	#$8B00,(a6)
00005140 3038 F60C                  		move.w	(v_vdp_buffer1).w,d0
00005144 0200 00BF                  		andi.b	#$BF,d0
00005148 33C0 00C0 0004             		move.w	d0,($C00004).l
0000514E                            
0000514E                            Sega_Main:
0000514E 6100 E0F6                  		bsr.w	ClearScreen
00005152                            		
00005152 23FC 4000 0000 00C0 0004   		move.l	#$40000000,($C00004).l		;Beginning of VRAM
0000515C 41F9 0000 0000             		lea		(Nem_OtherSegaLogo).l,a0
00005162 6100 E268                  		bsr.w	NemDec
00005166                            		
00005170 41F9 0000 0000             		lea		(Nem_SegaSonic).l,a0 		;load Sonic's tiles
00005176 6100 E254                  		bsr.w	NemDec
0000517A                            		
0000517A 43F9 00FF 0000             		lea		($FF0000).l,a1	;Where to decompress the tilemap
00005180 41F9 0000 0000             		lea		(Eni_OtherSegaLogo).l,a0	;Tilemap to decompress
00005186 303C 0000                  		move.w	#0,d0
0000518A 6100 E508                  		bsr.w	EniDec
0000518E                            		
0000518E 43F9 00FF 0000 203C 4404+  		copyTilemap $FF0000,(vram_fg+$404),((320/8)-1),((320/8)-1) ;not found
000051A2 203C 4000 0003             		move.l	#$40000003,d0				;Position in Plane A
000051A8 720B                       		moveq	#$B,d1						;Width (I think)
000051AA 7403                       		moveq	#3,d2						;Height (I think)
000051AC 6100 E1F4                  		bsr.w	TilemapToVRAM
000051B0                            		
000051B0 43F9 00FF 1000             		lea		($FF1000).l,a1	;Where to decompress the tilemap
000051B6 41F9 0000 0000             		lea		(Eni_SegaLogo).l,a0	;Tilemap to decompress
000051BC 303C 0000                  		move.w	#0,d0
000051C0 6100 E4D2                  		bsr.w	EniDec
000051C4                            		
000051C4 43F9 00FF 1000 203C 6404+  		copyTilemap $FF1000,(vram_bg+$404),((320/8)-1),((320/8)-1) ;not found
000051D8 203C 6000 0003             		move.l	#$60000003,d0				;Position in Plane B
000051DE 720B                       		moveq	#$B,d1						;Width (I think)
000051E0 7403                       		moveq	#3,d2						;Height (I think)
000051E2 6100 E1BE                  		bsr.w	TilemapToVRAM
000051E6                            		
000051E6 7000                       		moveq	#0,d0
000051E8 6100 F008                  		bsr.w	PalLoad1
000051EC 7017                       		moveq	#palid_Temp,d0
000051EE 6100 F01E                  		bsr.w	PalLoad2    ; load Sega logo palette
000051F2                            		
000051F2 31FC 0080 F632             		move.w	#$80,(v_pcyc_num).w
000051F8 31FC 0000 F662             		move.w	#0,($FFFFF662).w
000051FE 31FC 0000 F660             		move.w	#0,($FFFFF660).w
00005204 31FC 014A F614             		move.w	#11*30,(v_demolength).w
0000520A 3038 F60C                  		move.w	(v_vdp_buffer1).w,d0
0000520E 33FC 0EEE FFFF FB02        		move.w	#$EEE,v_pal_dry+$02
00005216 0000 0040                  		ori.b	#$40,d0
0000521A 33C0 00C0 0004             		move.w	d0,($C00004).l
00005228 11FC 0006 D1C0             		move.b    #$6,(v_objspace+$1C0).w ; load HUD object 2 <----- object
0000522E                            
0000522E                            Sega_Loop:
0000522E 4EB9 0000 0000                     jsr    (ExecuteObjects).l
00005234 4EB9 0000 0000                     jsr    (BuildSprites).l
0000523A 31FC 0200 F704             		move.w	#$200,(v_screenposy).w ; move Sonic to the right
00005240 31FC 0200 000C             		move.w	#$200,(obY).w ; move Sonic to the right
00005246 11FC 0002 F62A             		move.b	#2,(v_vbla_routine).w
0000524C 6100 F9D0                  		bsr.w	WaitForVBla
00005250 6100 0000                  		bsr.w	Sega_CyclePal
00005254 4A78 F614                  		tst.w	(v_demolength).w
00005258 6700                       		beq.s	Sega_GotoTitle
0000525A 0238 0080 F605             		andi.b	#$80,(v_jpadpress1).w
00005260 67CC                       		beq.s	Sega_Loop
00005262                            
00005262                            Sega_GotoTitle:
00005262 11FC 0020 F600             		move.b	#$20,(v_gamemode).w
00005268 4E75                       		rts
0000526A                            		
0000526A                            Sega_CyclePal:
0000526A 5378 F634                  		subq.w	#1,($FFFFF634).w
0000526E 6A00                       		bpl.s	locret_1A68
00005270 31FC 0003 F634             		move.w	#3,($FFFFF634).w
00005276 3038 F632                  		move.w	($FFFFF632).w,d0
0000527A 6B00                       		bmi.s	locret_1A68
0000527C 5578 F632                  		subq.w	#2,($FFFFF632).w
00005280 41F9 0000 0000             		lea	(word_1A6A).l,a0
00005286 43F8 FB04                  		lea	((v_pal_dry+4)).w,a1
0000528A D0C0                       		adda.w	d0,a0
0000528C 22D8                       		move.l	(a0)+,(a1)+
0000528E 22D8                       		move.l	(a0)+,(a1)+
00005290 22D8                       		move.l	(a0)+,(a1)+
00005292 22D8                       		move.l	(a0)+,(a1)+
00005294 22D8                       		move.l	(a0)+,(a1)+
00005296 32D8                       		move.w	(a0)+,(a1)+
00005298                            
00005298                            locret_1A68:
00005298 4E75                       		rts
0000529A                            ; ---------------------------------------------------------------------------
0000529A                            word_1A6A:	incbin "palette/Sega.pal"
00005350                            		even
00005350                            ; ===========================================================================
00005350                            
00005350                            GM_RadNexAff:
00005358 4EB9 0000 3FFA                 jsr     PaletteFadeOut          ; fade palettes out
0000535E 4EB8 3246                      jsr     ClearScreen.w           ; clear the plane mappings
00005362                                ; load art, mappings and the palette
00005362 43F9 00FF 0000                 lea     ($FF0000).l,a1          ; load dump location
00005368 41F9 0000 0000                 lea     MAPS_RAD.l,a0          ; load compressed mappings address
0000536E 303C 0140                      move.w #320,d0                  ; prepare pattern index value to patch to mappings
00005372 4EB8 3694                      jsr    EniDec.w                 ; decompress and dump
00005376 203C 6000 0003                 move.l #$60000003,d0            ; prepare VRAM write mode address (Plane B E000)
0000537C 7227                           moveq  #$28-$01,d1              ; set map box draw width
0000537E 741D                           moveq  #$1E-$01,d2              ; set map box draw height
00005380 6100 E020                      bsr.w   TilemapToVRAM         ; flush mappings to VRAM
00005384 4DF9 FFC0 0004                 lea    ($FFC00004).l,a6         ; load VDP control port
0000538A 2CBC 6800 0000                 move.l #$68000000,(a6)          ; set VDP to VRAM write mode (Address 2800)
00005390 41F9 0000 0000                 lea     ART_RAD.l,a0           ; load background art
00005396 4EB9 0000 33CC                 jsr     NemDec              ; run NemDec to decompress art for display
0000539C 103C 00AC                      move.b  #$AC,d0             ; set music ID 
000053A0 4EB8 331E                      jsr     Playsound_Special.w     ; play ID
000053A4 41F9 0000 0000                 lea Pal_RAD.l,a0        ; load this palette
000053AA 43F9 FFFF FB80                 lea ($FFFFFB80).l,a1        ; set as line 2
000053B0 303C 000F                      move.w  #$F,d0
000053B4                             
000053B4                            RadNexAff_PalLoop:
000053B4 22D8                           move.l  (a0)+,(a1)+         ; copy colours to buffer
000053B6 22D8                           move.l  (a0)+,(a1)+         ; ''
000053B8 51C8 FFFA                      dbf d0,RadNexAff_PalLoop      ; repeat until done
000053BC 4EB9 0000 3F54                 jsr PaletteFadeIn          ; fade palette in
000053C2 31FC 001E F614                 move.w  #30,($FFFFF614).w     ; set delay time (3 seconds on a 60hz system)
000053C8                             
000053C8                            Rad_MainLoop:
000053C8 11FC 0002 F62A                 move.b  #2,($FFFFF62A).w        ; set V-blank routine to run
000053CE 4EB9 0000 4C1E                 jsr WaitForVBla          ; wait for V-blank (decreases "Demo_Time_left")
000053D4 4A38 F605                      tst.b   ($FFFFF605).w           ; has player 1 pressed start button?
000053D8 6B00                           bmi.s   Rad_GotoTitle         ; if so, branch
000053DA 4A78 F614                      tst.w   ($FFFFF614).w           ; has the delay time finished?
000053DE 66E8                           bne.s   Rad_MainLoop          ; if not, branch
000053E0                             
000053E0                            Rad_GotoTitle:
000053E0 11FC 0004 F600                 move.b  #$04,($FFFFF600).w      ; set the screen mode to Title Screen
000053E6 4E75                           rts                     ; return
000053E8                            	
000053E8                            GM_SimpleCreds:
000053E8 103C 0090                      move.b  #$90,d0             ; set music ID 
000053EC 4EB8 331E                      jsr     Playsound_Special.w     ; play ID
000053F0 4EB9 0000 3FFA                 jsr     PaletteFadeOut          ; fade palettes out
000053F6 4EB8 3246                      jsr     ClearScreen.w           ; clear the plane mappings
000053FA                                ; load art, mappings and the palette
000053FA 43F9 00FF 0000                 lea     ($FF0000).l,a1          ; load dump location
00005400 41F9 0000 0000                 lea     MAPS_CRED.l,a0          ; load compressed mappings address
00005406 303C 0140                      move.w #320,d0                  ; prepare pattern index value to patch to mappings
0000540A 4EB8 3694                      jsr    EniDec.w                 ; decompress and dump
0000540E 203C 6000 0003                 move.l #$60000003,d0            ; prepare VRAM write mode address (Plane B E000)
00005414 7227                           moveq  #$28-$01,d1              ; set map box draw width
00005416 741D                           moveq  #$1E-$01,d2              ; set map box draw height
00005418 6100 DF88                      bsr.w   TilemapToVRAM         ; flush mappings to VRAM
0000541C 4DF9 FFC0 0004                 lea    ($FFC00004).l,a6         ; load VDP control port
00005422 2CBC 6800 0000                 move.l #$68000000,(a6)          ; set VDP to VRAM write mode (Address 2800)
00005428 41F9 0000 0000                 lea     ART_CRED.l,a0           ; load background art
0000542E 4EB9 0000 33CC                 jsr     NemDec              ; run NemDec to decompress art for display
00005434 41F9 0000 0000                 lea Pal_CRED.l,a0        ; load this palette
0000543A 43F9 FFFF FB80                 lea ($FFFFFB80).l,a1        ; set as line 2
00005440 303C 000F                      move.w  #$F,d0
00005444                             
00005444                            Creds_PalLoop:
00005444 22D8                           move.l  (a0)+,(a1)+         ; copy colours to buffer
00005446 22D8                           move.l  (a0)+,(a1)+         ; ''
00005448 51C8 FFFA                      dbf d0,Creds_PalLoop      ; repeat until done
0000544C 4EB9 0000 3F54                 jsr PaletteFadeIn          ; fade palette in
00005452 31FC 2274 F614                 move.w  #147*60,($FFFFF614).w     ; set delay time (3 seconds on a 60hz system)
00005458                             
00005458                            Creds_MainLoop:
00005458 11FC 0002 F62A                 move.b  #2,($FFFFF62A).w        ; set V-blank routine to run
0000545E 4EB9 0000 4C1E                 jsr WaitForVBla          ; wait for V-blank (decreases "Demo_Time_left")
00005464 4A38 F605                      tst.b   ($FFFFF605).w           ; has player 1 pressed start button?
00005468 6B00                           bmi.s   Creds_GotoTitle         ; if so, branch
0000546A 4A78 F614                      tst.w   ($FFFFF614).w           ; has the delay time finished?
0000546E 66E8                           bne.s   Creds_MainLoop          ; if not, branch
00005470                             
00005470                            Creds_GotoTitle:
00005470 11FC 0004 F600                 move.b  #$04,($FFFFF600).w      ; set the screen mode to Title Screen
00005476 4E75                           rts                     ; return
00005478                            
00005478                            ; ===========================================================================
00005478                            
00005478                            ; ---------------------------------------------------------------------------
00005478                            ; Title	screen
00005478                            ; ---------------------------------------------------------------------------
00005478                            
00005478                            GM_Title:
00005480 6100 E0D2                  		bsr.w	ClearPLC
00005484 6100 EB74                  		bsr.w	PaletteFadeOut
00005488 46FC 2700                  		disable_ints
0000548C 4DF9 00C0 0004             		lea	(vdp_control_port).l,a6
00005492 6100 DE40                  		bsr.w	SoundDriverLoad
00005496 4DF9 00C0 0004             		lea	(vdp_control_port).l,a6
0000549C 3CBC 8004                  		move.w	#$8004,(a6)	; 8-colour mode
000054A0 3CBC 8200                  		move.w	#$8200+($0000>>10),(a6) ; set foreground nametable address
000054A4 3CBC 8407                  		move.w	#$8400+(vram_bg>>13),(a6) ; set background nametable address
000054A8 3CBC 9011                  		move.w	#$9011,(a6)	; 64-cell hscroll size
000054AC 3CBC 9200                  		move.w	#$9200,(a6)	; window vertical position
000054B0 3CBC 8B03                  		move.w	#$8B03,(a6)
000054B4 3CBC 8720                  		move.w	#$8720,(a6)	; set background colour (palette line 2, entry 0)
000054B8 4238 F64E                  		clr.b	(f_wtr_state).w
000054BC 6100 DD88                  		bsr.w	ClearScreen
000054C0                            
000054C0 43F8 D000                  		lea	(v_objspace).w,a1
000054C4 7000                       		moveq	#0,d0
000054C6 323C 07FF                  		move.w	#$7FF,d1
000054CA                            
000054CA                            	Tit_ClrObj1:
000054CA 22C0                       		move.l	d0,(a1)+
000054CC 51C9 FFFC                  		dbf	d1,Tit_ClrObj1	; fill object space ($D000-$EFFF) with 0
000054D0                            
000054D0 43F8 FB80                  		lea	(v_pal_dry_dup).w,a1
000054D4 7000                       		moveq	#cBlack,d0
000054D6 323C 001F                  		move.w	#$1F,d1
000054DA                            
000054DA                            	Tit_ClrPal:
000054DA 22C0                       		move.l	d0,(a1)+
000054DC 51C9 FFFC                  		dbf	d1,Tit_ClrPal	; fill palette with 0 (black)
000054E0                            
000054E0                            	;	moveq	#palid_Ending,d0	; load Sonic's palette
000054E0                            	;	bsr.w	PalLoad1
000054E0 11FC 0000 D080             		move.b	#id_CreditsText,(v_objspace+$80).w ; load "SONIC TEAM PRESENTS" object
000054E6 4EB9 0000 0000             		jsr	(ExecuteObjects).l
000054EC 4EB9 0000 0000             		jsr	(BuildSprites).l
000054F2 6100 EA60                  		bsr.w	PaletteFadeIn
000054F6 46FC 2700                  		disable_ints
00005504 41F9 0000 0000             		lea	(Nem_TitleSonic).l,a0 ;	load Sonic title screen	patterns
0000550A 6100 DEC0                  		bsr.w	NemDec
00005518 41F9 0000 0000             		lea	(Nem_TitleBlank).l,a0 ; load "TM" patterns
0000551E 6100 DEAC                  		bsr.w	NemDec
00005522 4DF9 00C0 0000             		lea	(vdp_data_port).l,a6
00005530 4BF9 0000 2572             		lea	(Art_Text).l,a5	; load level select font
00005536 323C 028F                  		move.w	#$28F,d1
0000553A                            
0000553A                            	Tit_LoadText:
0000553A 3C9D                       		move.w	(a5)+,(a6)
0000553C 51C9 FFFC                  		dbf	d1,Tit_LoadText	; load level select font
00005540                            
00005540 11FC 0000 FE30             		move.b	#0,(v_lastlamp).w ; clear lamppost counter
00005546 31FC 0000 FE08             		move.w	#0,(v_debuguse).w ; disable debug item placement mode
0000554C 31FC 0000 FFF0             		move.w	#0,(f_demo).w	; disable debug mode
00005552 31FC 0000 FFEA             		move.w	#0,($FFFFFFEA).w ; unused variable
00005558 31FC 0900 FE10             		move.w	#(9<<8),(v_zone).w	; set level to GHZ (00)
0000555E 31FC 0000 F634             		move.w	#0,(v_pcyc_time).w ; disable palette cycling
00005564 6100 0000                  		bsr.w	LevelSizeLoad
00005568 6100 EA90                  		bsr.w	PaletteFadeOut
0000556C 46FC 2700                  		disable_ints
00005570 6100 DCD4                  		bsr.w	ClearScreen
00005574 4BF9 00C0 0004             		lea	(vdp_control_port).l,a5
0000557A 4DF9 00C0 0000             		lea	(vdp_data_port).l,a6
00005580 47F8 F708                  		lea	(v_bgscreenposx).w,a3
00005584 49F8 A440                  		lea	(v_lvllayout+$40).w,a4
00005588 343C 6000                  		move.w	#$6000,d2
0000558C 6100 0000                  		bsr.w	DrawChunks
00005590                            		
00005590                            	TitMap_ChkRegion:
00005590 4A38 FFF8                  		tst.b	(v_megadrive).w
00005594 6A00                       		bpl.s	TitMap_JP
00005596                            		
00005596 43F9 00FF 0000             		lea	($FF0000).l,a1
0000559C 41F9 0000 0000             		lea	(Eni_Title).l,a0 ; load	title screen mappings
000055A2 303C 0000                  		move.w	#0,d0
000055A6 6100 E0EC                  		bsr.w	EniDec
000055AA 6000                       		bra.s	TitMap_Cont
000055AC                            		
000055AC                            	TitMap_JP:
000055AC 43F9 00FF 0000             		lea	($FF0000).l,a1
000055B2 41F9 0000 0000             		lea	(Eni_TitleJP).l,a0 ; load	title screen mappings
000055B8 303C 0000                  		move.w	#0,d0
000055BC 6100 E0D6                  		bsr.w	EniDec
000055C0                            		
000055C0                            	TitMap_Cont:
000055C0 43F9 00FF 0000 203C 4208+  		copyTilemap	$FF0000,$0208,$21,$47
000055D4                            		
000055DE 41F9 0000 0000             		lea	(Nem_JapNames).l,a0 ; load Japanese credits
000055E4 6100 DDE6                  		bsr.w	NemDec
000055F2 41F9 0000 0000             		lea	(Eni_JapNames).l,a0 ; load mappings for	Japanese credits
000055F8 303C 0000                  		move.w	#0,d0
000055FC 6100 E096                  		bsr.w	EniDec
00005600 203C 6000 0003                             move.l  #$60000003,d0
00005606 7227                       		moveq	#39,d1
00005608 7421                       		moveq	#33,d2
0000560A 6100 DD96                  		bsr.w	TilemapToVRAM
0000560E 6100 DDBC                  		bsr.w	NemDec
00005612 7001                       		moveq	#palid_Title,d0	; load title screen palette
00005614 6100 EBDC                  		bsr.w	PalLoad1
00005618                            		
00005618                            	TitFG_ChkRegion:
00005618 4A38 FFF8                  		tst.b	(v_megadrive).w
0000561C 6A00                       		bpl.s	TitFG_JP
0000561E                            		
00005628 41F9 0000 0000             		lea	(Nem_TitleFg).l,a0 ; load title	screen patterns
0000562E 6100 DD9C                  		bsr.w	NemDec
00005632 6000                       		bra.s	TitFG_Cont
00005634                            		
00005634                            	TitFG_JP:
0000563E 41F9 0000 0000             		lea	(Nem_TitleFgJP).l,a0 ; load title	screen patterns
00005644 6100 DD86                  		bsr.w	NemDec
00005648                            		
00005648                            	TitFG_Cont:
00005648 41F9 0000 0000             		lea	(Kos_TitleText).l,a0 ;	load extra flower patterns
0000564E 43F9 00FF 0000             		lea	(v_256x256).l,a1 ; RAM address to buffer the patterns
00005654 6100 E1BC                  		bsr.w	KosDec
00005660 11FC 0000 FFFA             		move.b	#0,(f_debugmode).w ; disable debug mode
00005666 31FC 04B9 F614             		move.w	#$4B9,(v_demolength).w ; run title screen for $4B9 frames
0000566C 43F8 D080                  		lea	(v_objspace+$80).w,a1
00005670 7000                       		moveq	#0,d0
00005672 323C 000F                  		move.w	#$F,d1
00005676                            
00005676                            	Tit_ClrObj2:
00005676 22C0                       		move.l	d0,(a1)+
00005678 51C9 FFFC                  		dbf	d1,Tit_ClrObj2
0000567C                            
0000567C 11FC 0000 D040             		move.b	#id_TitleSonic,(v_objspace+$40).w ; load big Sonic object
00005682 11FC 0000 D080             		move.b	#id_PSBTM,(v_objspace+$80).w ; load "PRESS START BUTTON" object
00005688                            
00005688                            
00005688 11FC 0000 D0C0             		move.b	#id_PSBTM,(v_objspace+$C0).w ; load "TM" object
0000568E 11FC 0003 D0DA             		move.b	#3,(v_objspace+$C0+obFrame).w
00005694                            	@isjap:
00005694 11FC 0000 D100             		move.b	#id_PSBTM,(v_objspace+$100).w ; load object which hides part of Sonic
0000569A 11FC 0002 D11A             		move.b	#2,(v_objspace+$100+obFrame).w
000056A0 4EB9 0000 0000             		jsr	(ExecuteObjects).l
000056A6 6100 0000                  		bsr.w	DeformLayers
000056AA 4EB9 0000 0000             		jsr	(BuildSprites).l
000056B0 7000                       		moveq	#plcid_Main,d0
000056B2 6100 DE74                  		bsr.w	NewPLC
000056B6 31FC 0000 FFE4             		move.w	#0,(v_title_dcount).w
000056BC 31FC 0000 FFE6             		move.w	#0,(v_title_ccount).w
000056C2 3038 F60C                  		move.w	(v_vdp_buffer1).w,d0
000056C6 0000 0040                  		ori.b	#$40,d0
000056CA 33C0 00C0 0004             		move.w	d0,(vdp_control_port).l
000056D0 6100 E882                  		bsr.w	PaletteFadeIn
000056D4                            
000056D4                            Tit_MainLoop:
000056D4 11FC 0004 F62A             		move.b	#4,(v_vbla_routine).w
000056DA 6100 F542                  		bsr.w	WaitForVBla
000056DE 4EB9 0000 0000             		jsr	(ExecuteObjects).l
000056E4 6100 0000                  		bsr.w	DeformLayers
000056E8 4EB9 0000 0000             		jsr	(BuildSprites).l
000056EE                            	;	bsr.w	PCycle_Title
000056EE 6100 DE72                  		bsr.w	RunPLC
000056F2 3038 D008                  		move.w	(v_objspace+obX).w,d0
000056F6 5240                       		addq.w	#1,d0
000056F8 31C0 D00C                  		move.w	d0,(v_objspace+obY).w ; move Sonic to the right
000056FC 0C40 1C00                  		cmpi.w	#$1C00,d0	; has Sonic object passed $1C00 on x-axis?
00005700 6500                       		blo.s	Tit_ChkRegion	; if not, branch
00005702                            
00005702 11FC 0000 F600             		move.b	#id_Sega,(v_gamemode).w ; go to Sega screen
00005708 4E75                       		rts	
0000570A                            ; ===========================================================================
0000570A                            
0000570A                            Tit_ChkRegion:
0000570A 4A38 FFF8                  		tst.b	(v_megadrive).w	; check	if the machine is US or	Japanese
0000570E 6A00                       		bpl.s	Tit_RegionJap	; if Japanese, branch
00005710                            
00005710 41F9 0000 0000             		lea	(LevSelCode_US).l,a0 ; load US code
00005716 6000                       		bra.s	Tit_EnterCheat
00005718                            
00005718                            	Tit_RegionJap:
00005718 41F9 0000 0000             		lea	(LevSelCode_J).l,a0 ; load J code
0000571E                            
0000571E                            Tit_EnterCheat:
0000571E 3038 FFE4                  		move.w	(v_title_dcount).w,d0
00005722 D0C0                       		adda.w	d0,a0
00005724 1038 F605                  		move.b	(v_jpadpress1).w,d0 ; get button press
00005728 0200 000F                  		andi.b	#btnDir,d0	; read only UDLR buttons
0000572C B010                       		cmp.b	(a0),d0		; does button press match the cheat code?
0000572E 6600                       		bne.s	Tit_ResetCheat	; if not, branch
00005730 5278 FFE4                  		addq.w	#1,(v_title_dcount).w ; next button press
00005734 4A00                       		tst.b	d0
00005736 6600                       		bne.s	Tit_CountC
00005738 41F8 F608                  		lea	(f_levselcheat).w,a0
0000573C 3238 FFE6                  		move.w	(v_title_ccount).w,d1
00005740 E249                       		lsr.w	#1,d1
00005742 0241 0003                  		andi.w	#3,d1
00005746 6700                       		beq.s	Tit_PlayRing
00005748 4A38 FFF8                  		tst.b	(v_megadrive).w
0000574C 6A00                       		bpl.s	Tit_PlayRing
0000574E 7201                       		moveq	#1,d1
00005750 1181 1001                  		move.b	d1,1(a0,d1.w)	; cheat depends on how many times C is pressed
00005754                            
00005754                            	Tit_PlayRing:
00005754 11BC 0001 1000             		move.b	#1,(a0,d1.w)	; activate cheat
00005762 6000                       		bra.s	Tit_CountC
00005764                            ; ===========================================================================
00005764                            
00005764                            Tit_ResetCheat:
00005764 4A00                       		tst.b	d0
00005766 6700                       		beq.s	Tit_CountC
00005768 0C78 0009 FFE4             		cmpi.w	#9,(v_title_dcount).w
0000576E 6700                       		beq.s	Tit_CountC
00005770 31FC 0000 FFE4             		move.w	#0,(v_title_dcount).w ; reset UDLR counter
00005776                            
00005776                            Tit_CountC:
00005776 1038 F605                  		move.b	(v_jpadpress1).w,d0
0000577A 0200 0020                  		andi.b	#btnC,d0	; is C button pressed?
0000577E 6700                       		beq.s	loc_3230	; if not, branch
00005780 5278 FFE6                  		addq.w	#1,(v_title_ccount).w ; increment C counter
00005784                            
00005784                            loc_3230:
00005784 4A78 F614                  		tst.w	(v_demolength).w
00005788 6700 0000                  		beq.w	GotoDemo
0000578C 0238 0080 F605             		andi.b	#btnStart,(v_jpadpress1).w ; check if Start is pressed
00005792 6700 FF40                  		beq.w	Tit_MainLoop	; if not, branch
00005796                            
00005796                            Tit_ChkLevSel:
00005796 4A38 F608                  		tst.b	(f_levselcheat).w ; check if level select code is on
0000579A 6700 0000                  		beq.w	PlayLevelC	; if not, play level
0000579E 0838 0006 F604             		btst	#bitA,(v_jpadhold1).w ; check if A is pressed
000057A4 6700 0000                  		beq.w	PlayLevelC	; if not, play level
000057A8 11FC 0001 FFE2             		move.b	#1,(f_debugcheat).w ; enable debug mode
000057B6 7002                       		moveq	#palid_LevelSel,d0
000057B8 6100 EA54                  		bsr.w	PalLoad2	; load level select palette
000057BC 43F8 CC00                  		lea	(v_hscrolltablebuffer).w,a1
000057C0 7000                       		moveq	#0,d0
000057C2 323C 00DF                  		move.w	#$DF,d1
000057C6                            
000057C6                            	Tit_ClrScroll1:
000057C6 22C0                       		move.l	d0,(a1)+
000057C8 51C9 FFFC                  		dbf	d1,Tit_ClrScroll1 ; clear scroll data (in RAM)
000057CC                            
000057CC 21C0 F616                  		move.l	d0,(v_scrposy_dup).w
000057D0 46FC 2700                  		disable_ints
000057D4 4DF9 00C0 0000             		lea	(vdp_data_port).l,a6
000057E4 323C 03FF                  		move.w	#$3FF,d1
000057E8                            
000057E8                            	Tit_ClrScroll2:
000057E8 2C80                       		move.l	d0,(a6)
000057EA 51C9 FFFC                  		dbf	d1,Tit_ClrScroll2 ; clear scroll data (in VRAM)
000057EE                            
000057EE 6100 0000                  		bsr.w	LevSelTextLoad
000057F2                            
000057F2                            ; ---------------------------------------------------------------------------
000057F2                            ; Level	Select
000057F2                            ; ---------------------------------------------------------------------------
000057F2                            
000057F2                            LevelSelect:
000057F2 11FC 0004 F62A             		move.b	#4,(v_vbla_routine).w
000057F8 6100 F424                  		bsr.w	WaitForVBla
000057FC 6100 0000                  		bsr.w	LevSelControls
00005800 6100 DD60                  		bsr.w	RunPLC
00005804 4AB8 F680                  		tst.l	(v_plc_buffer).w
00005808 66E8                       		bne.s	LevelSelect
0000580A 0238 00F0 F605             		andi.b	#btnABC+btnStart,(v_jpadpress1).w ; is A, B, C, or Start pressed?
00005810 67E0                       		beq.s	LevelSelect	; if not, branch
00005812 3038 FF82                  		move.w	(v_levselitem).w,d0
00005816 0C40 001A                  		cmpi.w	#$1A,d0		; have you selected item $1A (sound test)?
0000581A 6600                       		bne.s	LevSel_Level_SS	; if not, go to	Level/SS subroutine
0000581C 3038 FF84                  		move.w	(v_levselsound).w,d0
00005820 0640 0080                  		addi.w	#$80,d0
00005824                            	;	tst.b	(f_creditscheat).w ; is Japanese Credits cheat on?
00005824                            	;	beq.s	LevSel_NoCheat	; if not, branch
00005824 0C40 009F                  		cmpi.w	#$9F,d0		; is sound $9F being played?
00005828 6700                       		beq.s	LevSel_Ending	; if yes, branch
0000582A 0C40 009E                  		cmpi.w	#$9E,d0		; is sound $9E being played?
0000582E 6700                       		beq.s	LevSel_Credits	; if yes, branch
00005830                            
00005830                            LevSel_NoCheat:
00005830                            		; This is a workaround for a bug, see Sound_ChkValue for more.
00005830                            		; Once you've fixed the bugs there, comment these four instructions out
00005830                            	;	cmpi.w	#bgm__Last+1,d0	; is sound $80-$93 being played?
00005830                            	;	blo.s	LevSel_PlaySnd	; if yes, branch
00005830                            	;	cmpi.w	#sfx__First,d0	; is sound $94-$9F being played?
00005830                            	;	blo.s	LevelSelect	; if yes, branch
00005830                            
00005830                            LevSel_PlaySnd:
00005830 6100 DAEC                  		bsr.w	PlaySound_Special
00005834 60BC                       		bra.s	LevelSelect
00005836                            ; ===========================================================================
00005836                            
00005836                            LevSel_Ending:
00005836 11FC 0000 F600             		move.b	#id_Ending,(v_gamemode).w ; set screen mode to $18 (Ending)
0000583C 31FC 0000 FE10             		move.w	#(00<<8),(v_zone).w ; set level to 0600 (Ending)
00005842 4E75                       		rts	
00005844                            ; ===========================================================================
00005844                            
00005844                            LevSel_Credits:
00005844 11FC 0000 F600             		move.b	#id_Credits,(v_gamemode).w ; set screen mode to $1C (Credits)
00005852 31FC 0000 FFF4             		move.w	#0,(v_creditsnum).w
00005858 4E75                       		rts	
0000585A                            ; ===========================================================================
0000585A                            
0000585A                            LevSel_Level_SS:
0000585A D040                       		add.w	d0,d0
0000585C 303B 0000                  		move.w	LevSel_Ptrs(pc,d0.w),d0 ; load level number
00005860 6B00 FF90                  		bmi.w	LevelSelect
00005864 0C40 0900                  		cmpi.w	#$09*$100,d0	; check	if level is 0700 (Special Stage)
00005868 6600                       		bne.s	LevSel_Level	; if not, branch
0000586A 11FC 0000 F600             		move.b	#id_Special,(v_gamemode).w ; set screen mode to $10 (Special Stage)
00005870 4278 FE10                  		clr.w	(v_zone).w	; clear	level
00005874 11FC 0003 FE12             		move.b	#3,(v_lives).w	; set lives to 3
0000587A 7000                       		moveq	#0,d0
0000587C 31C0 FE20                  		move.w	d0,(v_rings).w	; clear rings
00005880 21C0 FE22                  		move.l	d0,(v_time).w	; clear time
00005884 21C0 FE26                  		move.l	d0,(v_score).w	; clear score
00005888 4E75                       		rts	
0000588A                            ; ===========================================================================
0000588A                            
0000588A                            DemoStart:
0000588A 31FC 0000 FE10             		move.w	#0,(v_zone).w	; set level to GHZ
00005890 6000                       		bra.s	PlayLevel
00005892                            
00005892                            LevSel_Level:
00005892 0240 3FFF                  		andi.w	#$3FFF,d0
00005896 31C0 FE10                  		move.w	d0,(v_zone).w	; set level number
0000589A                            
0000589A                            PlayLevel:
0000589A 11FC 0000 F600             		move.b	#id_Level,(v_gamemode).w ; set screen mode to $0C (level)
000058A0 11FC 0003 FE12             		move.b	#3,(v_lives).w	; set lives to 3
000058A6 7000                       		moveq	#0,d0
000058A8 31C0 FE20                  		move.w	d0,(v_rings).w	; clear rings
000058AC 21C0 FE22                  		move.l	d0,(v_time).w	; clear time
000058B0 21C0 FE26                  		move.l	d0,(v_score).w	; clear score
000058B4 11C0 FE16                  		move.b	d0,(v_lastspecial).w ; clear special stage number
000058B8 11C0 FE57                  		move.b	d0,(v_emeralds).w ; clear emeralds
000058BC 21C0 FE58                  		move.l	d0,(v_emldlist).w ; clear emeralds
000058C0 21C0 FE5C                  		move.l	d0,(v_emldlist+4).w ; clear emeralds
000058C4 11C0 FE18                  		move.b	d0,(v_continues).w ; clear continues
000058D0 4E75                       		rts	
000058D2                            
000058D2                            ; ===========================================================================
000058D2                            ; ---------------------------------------------------------------------------
000058D2                            ; Level	select - level pointers
000058D2                            ; ---------------------------------------------------------------------------
000058D2                            LevSel_Ptrs:	
000058D2 0000                       		dc.b id_GHZ, 0
000058D4 0001                       		dc.b id_GHZ, 1
000058D6 0002                       		dc.b id_GHZ, 2
000058D8 0100                       		dc.b id_LZ, 0
000058DA 0101                       		dc.b id_LZ, 1
000058DC 0102                       		dc.b id_LZ, 2
000058DE 0200                       		dc.b id_MZ, 0
000058E0 0201                       		dc.b id_MZ, 1
000058E2 0202                       		dc.b id_MZ, 2
000058E4 0700                       		dc.b $07, 0
000058E6 0701                       		dc.b $07, 1
000058E8 0702                       		dc.b $07, 2
000058EA 0300                       		dc.b id_SLZ, 0
000058EC 0301                       		dc.b id_SLZ, 1
000058EE 0302                       		dc.b id_SLZ, 2
000058F0 0400                       		dc.b id_SZ, 0
000058F2 0401                       		dc.b id_SZ, 1
000058F4 0402                       		dc.b id_SZ, 2
000058F6 0500                       		dc.b id_CWZ, 0
000058F8 0501                       		dc.b id_CWZ, 1
000058FA 0502                       		dc.b id_CWZ, 2
000058FC 0800                       		dc.b $08, 0
000058FE 0801                       		dc.b $08, 1
00005900 0802                       		dc.b $08, 2
00005902 0600                       		dc.b $06, 0
00005904 0900                       		dc.b $09, 0
00005906 8000                       		dc.w $8000
00005908                            		even
00005908                            ; ---------------------------------------------------------------------------
00005908                            ; Level	select codes
00005908                            ; ---------------------------------------------------------------------------
00005908 0101 0102 0202 0802 0400+  		dc.b btnUp,btnUp,btnUp,btnDn,btnDn,btnDn,btnR,btnDn,btnL,0,$FF
00005914 00                         		even
00005914                            
00005914 0101 0102 0202 0802 0400+  		dc.b btnUp,btnUp,btnUp,btnDn,btnDn,btnDn,btnR,btnDn,btnL,0,$FF
00005920 00                         		even
00005920                            ; ===========================================================================
00005920                            
00005920                            PlayLevelC:
00005920                            
00005920 4EB9 0000 3246             		jsr	ClearScreen
000059F6 4E75                       		rts
000059F8                            
000059F8                            ; ---------------------------------------------------------------------------
000059F8                            ; Demo mode
000059F8                            ; ---------------------------------------------------------------------------
000059F8                            
000059F8                            GotoDemo:
000059F8 31FC 001E F614             		move.w	#$1E,(v_demolength).w
000059FE                            
000059FE                            loc_33B6:
000059FE 11FC 0004 F62A             		move.b	#4,(v_vbla_routine).w
00005A04 6100 F218                  		bsr.w	WaitForVBla
00005A08 6100 0000                  		bsr.w	DeformLayers
00005A0C 6100 E0CC                  		bsr.w	PaletteCycle
00005A10 6100 DB50                  		bsr.w	RunPLC
00005A14 3038 D008                  		move.w	(v_objspace+obX).w,d0
00005A18 5440                       		addq.w	#2,d0
00005A1A 31C0 D008                  		move.w	d0,(v_objspace+obX).w
00005A1E 0C40 1C00                  		cmpi.w	#$1C00,d0
00005A22 6500                       		blo.s	loc_33E4
00005A24 11FC 0000 F600             		move.b	#id_Sega,(v_gamemode).w
00005A2A 4E75                       		rts	
00005A2C                            ; ===========================================================================
00005A2C                            
00005A2C                            loc_33E4:
00005A2C 0238 0080 F605             		andi.b	#btnStart,(v_jpadpress1).w ; is Start button pressed?
00005A32 6600 FD62                  		bne.w	Tit_ChkLevSel	; if yes, branch
00005A36 4A78 F614                  		tst.w	(v_demolength).w
00005A3A 6600 FFC2                  		bne.w	loc_33B6
00005A46 3038 FFF2                  		move.w	(v_demonum).w,d0 ; load	demo number
00005A4A 0240 0007                  		andi.w	#7,d0
00005A4E D040                       		add.w	d0,d0
00005A50 303B 0000                  		move.w	Demo_Levels(pc,d0.w),d0	; load level number for	demo
00005A54 31C0 FE10                  		move.w	d0,(v_zone).w
00005A58 5278 FFF2                  		addq.w	#1,(v_demonum).w ; add 1 to demo number
00005A5C 0C78 0004 FFF2             		cmpi.w	#4,(v_demonum).w ; is demo number less than 4?
00005A62 6500                       		blo.s	loc_3422	; if yes, branch
00005A64 31FC 0000 FFF2             		move.w	#0,(v_demonum).w ; reset demo number to	0
00005A6A                            
00005A6A                            loc_3422:
00005A6A 0C39 0000 FFFF F608        		cmp.b	#0, (f_levselcheat)
00005A72 6700 FEAC                  		beq	PlayLevelC
00005A76                            
00005A76 31FC 0001 FFF0             		move.w	#1,(f_demo).w	; turn demo mode on
00005A7C 11FC 0000 F600             		move.b	#id_Demo,(v_gamemode).w ; set screen mode to 08 (demo)
00005A82 0C40 0600                  		cmpi.w	#$600,d0	; is level number 0600 (special	stage)?
00005A86 6600                       		bne.s	Demo_Level	; if not, branch
00005A88 11FC 0000 F600             		move.b	#id_Special,(v_gamemode).w ; set screen mode to $10 (Special Stage)
00005A8E 4278 FE10                  		clr.w	(v_zone).w	; clear	level number
00005A92 4238 FE16                  		clr.b	(v_lastspecial).w ; clear special stage number
00005A96                            
00005A96                            Demo_Level:
00005A96 11FC 0003 FE12             		move.b	#3,(v_lives).w	; set lives to 3
00005A9C 7000                       		moveq	#0,d0
00005A9E 31C0 FE20                  		move.w	d0,(v_rings).w	; clear rings
00005AA2 21C0 FE22                  		move.l	d0,(v_time).w	; clear time
00005AA6 21C0 FE26                  		move.l	d0,(v_score).w	; clear score
00005AAA 4E75                       		rts	
00005AAC                            ; ===========================================================================
00005AAC                            ; ---------------------------------------------------------------------------
00005AAC                            ; Levels used in demos
00005AAC                            ; ---------------------------------------------------------------------------
00005AAC                            Demo_Levels:	incbin	"misc\Demo Level Order - Intro.bin"
00005AB4                            		even
00005AB4                            
00005AB4                            ; ---------------------------------------------------------------------------
00005AB4                            ; Subroutine to	change what you're selecting in the level select
00005AB4                            ; ---------------------------------------------------------------------------
00005AB4                            
00005AB4                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00005AB4                            
00005AB4                            
00005AB4                            LevSelControls:
00005AB4 1238 F605                  		move.b	(v_jpadpress1).w,d1
00005AB8 0201 0003                  		andi.b	#btnUp+btnDn,d1	; is up/down pressed and held?
00005ABC 6600                       		bne.s	LevSel_UpDown	; if yes, branch
00005ABE 5378 FF80                  		subq.w	#1,(v_levseldelay).w ; subtract 1 from time to next move
00005AC2 6A00                       		bpl.s	LevSel_SndTest	; if time remains, branch
00005AC4                            
00005AC4                            LevSel_UpDown:
00005AC4 31FC 000B FF80             		move.w	#$B,(v_levseldelay).w ; reset time delay
00005ACA 1238 F604                  		move.b	(v_jpadhold1).w,d1
00005ACE 0201 0003                  		andi.b	#btnUp+btnDn,d1	; is up/down pressed?
00005AD2 6700                       		beq.s	LevSel_SndTest	; if not, branch
00005AD4 3038 FF82                  		move.w	(v_levselitem).w,d0
00005AD8 0801 0000                  		btst	#bitUp,d1	; is up	pressed?
00005ADC 6700                       		beq.s	LevSel_Down	; if not, branch
00005ADE 5340                       		subq.w	#1,d0		; move up 1 selection
00005AE0 6400                       		bhs.s	LevSel_Down
00005AE2 701A                       		moveq	#$1A,d0		; if selection moves below 0, jump to selection	$14
00005AE4                            
00005AE4                            LevSel_Down:
00005AE4 0801 0001                  		btst	#bitDn,d1	; is down pressed?
00005AE8 6700                       		beq.s	LevSel_Refresh	; if not, branch
00005AEA 5240                       		addq.w	#1,d0		; move down 1 selection
00005AEC 0C40 001B                  		cmpi.w	#$1B,d0
00005AF0 6500                       		blo.s	LevSel_Refresh
00005AF2 7000                       		moveq	#0,d0		; if selection moves above $1A,	jump to	selection 0
00005AF4                            
00005AF4                            LevSel_Refresh:
00005AF4 31C0 FF82                  		move.w	d0,(v_levselitem).w ; set new selection
00005AF8 6100 0000                  		bsr.w	LevSelTextLoad	; refresh text
00005AFC 4E75                       		rts	
00005AFE                            ; ===========================================================================
00005AFE                            
00005AFE                            LevSel_SndTest:
00005AFE 0C78 001A FF82                     cmpi.w  #$1A,($FFFFFF82).w
00005B04 6600                               bne.s   loc_3CC2
00005B06 3038 FF84                          move.w  ($FFFFFF84).w,d0
00005B0A 1238 F605                          move.b  ($FFFFF605).w,d1
00005B0E 0201 000C                          andi.b  #$C,d1
00005B12 6700                               beq.s   loc_3CAA
00005B14 0801 0002                          btst    #$2,d1
00005B18 6700                               beq.s   loc_3C9A
00005B1A 5300                               subq.b  #$1,d0
00005B1C 6400                               bcc.s   loc_3C9A
00005B1E 707F                               moveq   #$7F,d0
00005B20                            loc_3C9A:
00005B20 0801 0003                          btst    #$3,d1
00005B24 6700                               beq.s   loc_3CAA
00005B26 5200                               addq.b  #$1,d0
00005B28 0C40 0080                          cmpi.w  #$80,d0
00005B2C 6500                               bcs.s   loc_3CAA
00005B2E 7000                               moveq	#0,d0
00005B30                            loc_3CAA:
00005B30 0838 0006 F605                     btst    #$6,($FFFFF605).w
00005B36 6700                               beq.s   loc_3CBA
00005B38 0600 0010                          addi.b  #$10,d0
00005B3C 0200 007F                          andi.b  #$7F,d0
00005B40                            loc_3CBA:
00005B40 31C0 FF84                          move.w  d0,($FFFFFF84).w
00005B44 6100 0000                          bsr     LevSelTextLoad    ; loc_3CC4
00005B48                            loc_3CC2:        
00005B48 4E75                               rts
00005B4A                            ; End of function LevSelControls
00005B4A                            
00005B4A                            ; ---------------------------------------------------------------------------
00005B4A                            ; Subroutine to load level select text
00005B4A                            ; ---------------------------------------------------------------------------
00005B4A                            
00005B4A                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00005B4A                            
00005B4A                            
00005B4A                            LevSelTextLoad:
00005B4A                            
00005B4A =62100003                  	textpos:	= ($40000000+(($E210&$3FFF)<<16)+(($E210&$C000)>>14))
00005B4A                            					; $E210 is a VRAM address
00005B4A                            
00005B4A 43F9 0000 0000             		lea	(LevelMenuText).l,a1
00005B50 4DF9 00C0 0000             		lea	(vdp_data_port).l,a6
00005B56 283C 608C 0003             		move.l	#$608C0003,d4	; text position on screen
00005B5C 363C E447                  		move.w	#$E447,d3	; VRAM setting (4th palette, $680th tile)
00005B60 721A                       		moveq	#$1A,d1		; number of lines of text
00005B62                            
00005B62                            	LevSel_DrawAll:
00005B62 2D44 0004                  		move.l	d4,4(a6)
00005B66 6100 0000                  		bsr.w	LevSel_ChgLine	; draw line of text
00005B6A 0684 0080 0000             		addi.l	#$800000,d4	; jump to next line
00005B70 51C9 FFF0                  		dbf	d1,LevSel_DrawAll
00005B74                            
00005B74 7000                       		moveq	#0,d0
00005B76 3038 FF82                  		move.w	(v_levselitem).w,d0
00005B7A 3200                       		move.w	d0,d1
00005B7C 283C 608C 0003             		move.l	#$608C0003,d4
00005B82 EF48                       		lsl.w	#7,d0
00005B84 4840                       		swap	d0
00005B86 D880                       		add.l	d0,d4
00005B88 43F9 0000 0000             		lea	(LevelMenuText).l,a1
00005B8E E749                       		lsl.w	#3,d1
00005B90 3001                       		move.w	d1,d0
00005B92 D241                       		add.w	d1,d1
00005B94 D240                       		add.w	d0,d1
00005B96 D2C1                       		adda.w	d1,a1
00005B98 363C C447                  		move.w	#$C447,d3	; VRAM setting (3rd palette, $680th tile)
00005B9C 2D44 0004                  		move.l	d4,4(a6)
00005BA0 6100 0000                  		bsr.w	LevSel_ChgLine	; recolour selected line
00005BA4 363C E447                  		move.w	#$E447,d3
00005BA8 0C78 001A FF82             		cmpi.w	#$1A,(v_levselitem).w
00005BAE 6600                       		bne.s	LevSel_DrawSnd
00005BB0 363C C447                  		move.w	#$C447,d3
00005BB4                            
00005BB4                            LevSel_DrawSnd:
00005BB4 23FC 6DB0 0003 00C0 0004           move.l  #$6DB00003, ($C00004)		; sound test position on screen
00005BBE 3038 FF84                  		move.w	(v_levselsound).w,d0
00005BC2 0640 0080                  		addi.w	#$80,d0
00005BC6 1400                       		move.b	d0,d2
00005BC8 E808                       		lsr.b	#4,d0
00005BCA 6100 0000                  		bsr.w	LevSel_ChgSnd	; draw 1st digit
00005BCE 1002                       		move.b	d2,d0
00005BD0 6100 0000                  		bsr.w	LevSel_ChgSnd	; draw 2nd digit
00005BD4 4E75                       		rts	
00005BD6                            ; End of function LevSelTextLoad
00005BD6                            
00005BD6                            
00005BD6                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00005BD6                            
00005BD6                            
00005BD6                            LevSel_ChgSnd:
00005BD6 0240 000F                  		andi.w	#$F,d0
00005BDA 0C00 000A                  		cmpi.b	#$A,d0		; is digit $A-$F?
00005BDE 6500                       		blo.s	LevSel_Numb	; if not, branch
00005BE0 0600 0007                  		addi.b	#7,d0		; use alpha characters
00005BE4                            
00005BE4                            	LevSel_Numb:
00005BE4 D043                       		add.w	d3,d0
00005BE6 3C80                       		move.w	d0,(a6)
00005BE8 4E75                       		rts	
00005BEA                            ; End of function LevSel_ChgSnd
00005BEA                            
00005BEA                            
00005BEA                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00005BEA                            
00005BEA                            
00005BEA                            LevSel_ChgLine:
00005BEA 7417                       		moveq	#$17,d2		; number of characters per line
00005BEC                            
00005BEC                            	LevSel_LineLoop:
00005BEC 7000                       		moveq	#0,d0
00005BEE 1019                       		move.b	(a1)+,d0	; get character
00005BF0 6A00                       		bpl.s	LevSel_CharOk	; branch if valid
00005BF2 3CBC 0000                  		move.w	#0,(a6)		; use blank character
00005BF6 51CA FFF4                  		dbf	d2,LevSel_LineLoop
00005BFA 4E75                       		rts	
00005BFC                            
00005BFC                            
00005BFC                            	LevSel_CharOk:
00005BFC D043                       		add.w	d3,d0		; combine char with VRAM setting
00005BFE 3C80                       		move.w	d0,(a6)		; send to VRAM
00005C00 51CA FFEA                  		dbf	d2,LevSel_LineLoop
00005C04 4E75                       		rts	
00005C06                            ; End of function LevSel_ChgLine
00005C06                            
00005C06                            ; ===========================================================================
00005C06                            ; ---------------------------------------------------------------------------
00005C06                            ; Level	select menu text
00005C06                            ; ---------------------------------------------------------------------------
00005C06 1722 1515 1EFF 1819 1C1C+  	dc.b    _G,_R,_E,_E,_N,__,_H,_I,_L,_L,__,__,__,__,__,__,__,__,_Z,_O,_N,_E,__,_1  
00005C1E FFFF FFFF FFFF FFFF FFFF+  	dc.b    __,__,__,__,__,__,__,__,__,__,__,__,__,__,__,__,__,__,_Z,_O,_N,_E,__,_2  
00005C36 FFFF FFFF FFFF FFFF FFFF+  	dc.b    __,__,__,__,__,__,__,__,__,__,__,__,__,__,__,__,__,__,_Z,_O,_N,_E,__,_3  
00005C4E 1C11 120F 2219 1E24 18FF+  	dc.b    _L,_A,_B,_Y,_R,_I,_N,_T,_H,__,__,__,__,__,__,__,__,__,_Z,_O,_N,_E,__,_1  
00005C66 FFFF FFFF FFFF FFFF FFFF+  	dc.b    __,__,__,__,__,__,__,__,__,__,__,__,__,__,__,__,__,__,_Z,_O,_N,_E,__,_2  
00005C7E FFFF FFFF FFFF FFFF FFFF+  	dc.b    __,__,__,__,__,__,__,__,__,__,__,__,__,__,__,__,__,__,_Z,_O,_N,_E,__,_3 
00005C96 1D11 2212 1C15 FFFF FFFF+  	dc.b    _M,_A,_R,_B,_L,_E,__,__,__,__,__,__,__,__,__,__,__,__,_Z,_O,_N,_E,__,_1  
00005CAE FFFF FFFF FFFF FFFF FFFF+  	dc.b    __,__,__,__,__,__,__,__,__,__,__,__,__,__,__,__,_X,__,_Z,_O,_N,_E,__,_2  
00005CC6 FFFF FFFF FFFF FFFF FFFF+  	dc.b    __,__,__,__,__,__,__,__,__,__,__,__,__,__,__,__,__,__,_Z,_O,_N,_E,__,_3 
00005CDE 1913 15FF 1D1F 251E 2411+  	dc.b    _I,_C,_E,__,_M,_O,_U,_N,_T,_A,_I,_N,__,__,__,__,__,__,_Z,_O,_N,_E,__,_1 
00005CF6 FFFF FFFF FFFF FFFF FFFF+  	dc.b    __,__,__,__,__,__,__,__,__,__,__,__,__,__,__,__,_X,__,_Z,_O,_N,_E,__,_2  
00005D0E FFFF FFFF FFFF FFFF FFFF+  	dc.b    __,__,__,__,__,__,__,__,__,__,__,__,__,__,__,__,_X,__,_Z,_O,_N,_E,__,_3 
00005D26 2324 1122 FF1C 1917 1824+  	dc.b    _S,_T,_A,_R,__,_L,_I,_G,_H,_T,__,__,__,__,__,__,__,__,_Z,_O,_N,_E,__,_1  
00005D3E FFFF FFFF FFFF FFFF FFFF+  	dc.b    __,__,__,__,__,__,__,__,__,__,__,__,__,__,__,__,_X,__,_Z,_O,_N,_E,__,_2  
00005D56 FFFF FFFF FFFF FFFF FFFF+  	dc.b    __,__,__,__,__,__,__,__,__,__,__,__,__,__,__,__,_X,__,_Z,_O,_N,_E,__,_3 
00005D6E 2320 1122 1B1C 191E 17FF+  	dc.b    _S,_P,_A,_R,_K,_L,_I,_N,_G,__,__,__,__,__,__,__,__,__,_Z,_O,_N,_E,__,_1 
00005D86 FFFF FFFF FFFF FFFF FFFF+  	dc.b    __,__,__,__,__,__,__,__,__,__,__,__,__,__,__,__,_X,__,_Z,_O,_N,_E,__,_2  
00005D9E FFFF FFFF FFFF FFFF FFFF+  	dc.b    __,__,__,__,__,__,__,__,__,__,__,__,__,__,__,__,_X,__,_Z,_O,_N,_E,__,_3 
00005DB6 131C 1F13 1BFF 271F 221B+  	dc.b    _C,_L,_O,_C,_K,__,_W,_O,_R,_K,__,__,__,__,__,__,__,__,_Z,_O,_N,_E,__,_1  
00005DCE FFFF FFFF FFFF FFFF FFFF+  	dc.b    __,__,__,__,__,__,__,__,__,__,__,__,__,__,__,__,__,__,_Z,_O,_N,_E,__,_2  
00005DE6 FFFF FFFF FFFF FFFF FFFF+  	dc.b    __,__,__,__,__,__,__,__,__,__,__,__,__,__,__,__,_X,__,_Z,_O,_N,_E,__,_3 
00005DFE 131F 231D 1913 2320 1113+  	dc.b    _C,_O,_S,_M,_I,_C,_S,_P,_A,_C,_E,__,_O,_R,__,_S,_K,_Y,_Z,_O,_N,_E,__,_1  
00005E16 FFFF FFFF FFFF FFFF FFFF+  	dc.b    __,__,__,__,__,__,__,__,__,__,__,__,__,__,__,__,_X,__,_Z,_O,_N,_E,__,_2  
00005E2E FFFF FFFF FFFF FFFF FFFF+  	dc.b    __,__,__,__,__,__,__,__,__,__,__,__,__,__,__,__,_X,__,_Z,_O,_N,_E,__,_3 
00005E46 2418 15FF 121C 111E 1BFF+  	dc.b    _T,_H,_E,__,_B,_L,_A,_N,_K,__,_S,_L,_O,_T,__,__,__,__,__,__,__,__,__,__
00005E5E 121F 1E25 23FF 2324 1117+  	dc.b    _B,_O,_N,_U,_S,__,_S,_T,_A,_G,_E,__,__,__,__,__,__,__,__,__,__,__,__,__
00005E76 231F 251E 14FF 2315 1C15+  	dc.b    _S,_O,_U,_N,_D,__,_S,_E,_L,_E,_C,_T,__,__,__,__,__,__,__,__,__,__,__,__
00005E8E 00                         	dc.b    $00 ; alinhamento
00005E90 00                         		even
00005E90                            ; ---------------------------------------------------------------------------
00005E90                            ; Music	playlist
00005E90                            ; ---------------------------------------------------------------------------
00005E90                            MusicList:
00005E90 00                         		dc.b bgm_GHZ	; GHZ
00005E91 00                         		dc.b bgm_LZ	; LZ
00005E92 00                         		dc.b bgm_MZ	; MZ
00005E93 00                         		dc.b bgm_SLZ	; SLZ
00005E94 00                         		dc.b bgm_SYZ	; SYZ
00005E95 00                         		dc.b bgm_SBZ	; SBZ
00005E96 96                         		dc.b $96	; Ending
00005E97 00                         		dc.b bgm_IMZ	; IMZ
00005E98 00                         		dc.b bgm_CSZ	; CSZ
00005E99 8D                         		dc.b $8D	; CWZ3
00005E9A 8D                         		dc.b $8D	; CWZ3
00005E9C 00                         		even
00005E9C                            ; ===========================================================================
00005E9C                            
00005E9C                            ; ---------------------------------------------------------------------------
00005E9C                            ; Level
00005E9C                            ; ---------------------------------------------------------------------------
00005E9C                            
00005E9C                            GM_Level:
00005E9C 11FC 0000 F5C0             		move.b  #0,($FFFFF5C0).w ; Unset victory animation flag
00005EA2 08F8 0007 F600             		bset	#7,(v_gamemode).w ; add $80 to screen mode (for pre level sequence)
00005EA8 4A78 FFF0                  		tst.w	(f_demo).w
00005EAC 6B00                       		bmi.s	Level_NoMusicFade
00005EB6                            
00005EB6                            	Level_NoMusicFade:
00005EB6 6100 D69C                  		bsr.w	ClearPLC
00005EBA 5378 F794                  		subq.w	#1,(v_palchgspeed).w
00005EBE 31FC 0002 F794             		move.w	#2,(v_palchgspeed).w
00005EC4 6100 E134                  		bsr.w	PaletteFadeOut
00005EC8 4A78 FFF0                  		tst.w	(f_demo).w	; is an ending sequence demo running?
00005ECC 6B00                       		bmi.s	Level_ClrRam	; if yes, branch
00005ECE 46FC 2700                  		disable_ints
00005EDC                            		
00005EDC                            	@CheckCWZ:
00005EDC 0C38 0005 FE10             		cmpi.b	#(id_CWZ),(v_zone).w ; check if level is CWZ
00005EE2 6600                       		bne.s	@NotCWZ
00005EE4 41F9 0000 0000             		lea	(Nem_TitleCard_Spec).l,a0 ; load title card patterns
00005EEA 6000 0000                  		bra		@cont
00005EEE                            	@NotCWZ:
00005EEE 41F9 0000 0000             		lea	(Nem_TitleCard).l,a0 ; load title card patterns
00005EF4                            	
00005EF4                            	@cont:	
00005EF4 6100 D4D6                  		bsr.w	NemDec
00005EF8 46FC 2300                  		enable_ints
00005EFC 7000                       		moveq	#0,d0
00005EFE 1038 FE10                  		move.b	(v_zone).w,d0
00005F02 E948                       		lsl.w	#4,d0
00005F04 45F9 0000 0000             		lea	(LevelHeaders).l,a2
00005F0A 45F2 0000                  		lea	(a2,d0.w),a2
00005F0E 7000                       		moveq	#0,d0
00005F10 1012                       		move.b	(a2),d0
00005F12 6700                       		beq.s	loc_37FC
00005F14 6100 D5E0                  		bsr.w	AddPLC		; load level patterns
00005F18                            
00005F18                            loc_37FC:
00005F18 7000                       		moveq	#plcid_Main2,d0
00005F1A 6100 D5DA                  		bsr.w	AddPLC		; load standard	patterns
00005F1E                            
00005F1E                            Level_ClrRam:
00005F1E 43F8 D000                  		lea	(v_objspace).w,a1
00005F22 7000                       		moveq	#0,d0
00005F24 323C 07FF                  		move.w	#$7FF,d1
00005F28                            
00005F28                            	Level_ClrObjRam:
00005F28 22C0                       		move.l	d0,(a1)+
00005F2A 51C9 FFFC                  		dbf	d1,Level_ClrObjRam ; clear object RAM
00005F2E                            
00005F2E 43F8 F628                  		lea	($FFFFF628).w,a1
00005F32 7000                       		moveq	#0,d0
00005F34 323C 0015                  		move.w	#$15,d1
00005F38                            
00005F38                            	Level_ClrVars1:
00005F38 22C0                       		move.l	d0,(a1)+
00005F3A 51C9 FFFC                  		dbf	d1,Level_ClrVars1 ; clear misc variables
00005F3E                            
00005F3E 43F8 F700                  		lea	(v_screenposx).w,a1
00005F42 7000                       		moveq	#0,d0
00005F44 323C 003F                  		move.w	#$3F,d1
00005F48                            
00005F48                            	Level_ClrVars2:
00005F48 22C0                       		move.l	d0,(a1)+
00005F4A 51C9 FFFC                  		dbf	d1,Level_ClrVars2 ; clear misc variables
00005F4E                            
00005F4E 43F8 FE60                  		lea	(v_oscillate+2).w,a1
00005F52 7000                       		moveq	#0,d0
00005F54 323C 0047                  		move.w	#$47,d1
00005F58                            
00005F58                            	Level_ClrVars3:
00005F58 22C0                       		move.l	d0,(a1)+
00005F5A 51C9 FFFC                  		dbf	d1,Level_ClrVars3 ; clear object variables
00005F5E                            
00005F5E 46FC 2700                  		disable_ints
00005F62 6100 D2E2                  		bsr.w	ClearScreen
00005F66 4DF9 00C0 0004             		lea	(vdp_control_port).l,a6
00005F6C 3CBC 8B03                  		move.w	#$8B03,(a6)	; line scroll mode
00005F70 3CBC 8230                  		move.w	#$8200+(vram_fg>>10),(a6) ; set foreground nametable address
00005F74 3CBC 8407                  		move.w	#$8400+(vram_bg>>13),(a6) ; set background nametable address
00005F78 3CBC 857C                  		move.w	#$8500+(vram_sprites>>9),(a6) ; set sprite table address
00005F7C 3CBC 9001                  		move.w	#$9001,(a6)		; 64-cell hscroll size
00005F80 3CBC 8004                  		move.w	#$8004,(a6)		; 8-colour mode
00005F84 3CBC 8720                  		move.w	#$8720,(a6)		; set background colour (line 3; colour 0)
00005F88 31FC 8ADF F624             		move.w	#$8A00+223,(v_hbla_hreg).w ; set palette change position (for water)
00005F8E 3CB8 F624                  		move.w	(v_hbla_hreg).w,(a6)
00005F92 0C38 0001 FE10             		cmpi.b	#id_LZ,(v_zone).w ; is level LZ?
00005F98 6600                       		bne.s	Level_LoadPal	; if not, branch
00005F9A                            
00005F9A 3CBC 8014                  		move.w	#$8014,(a6)	; enable H-interrupts
00005F9E 7000                       		moveq	#0,d0
00005FA0 1038 FE11                  		move.b	(v_act).w,d0
00005FA4 D040                       		add.w	d0,d0
00005FA6 43F9 0000 0000             		lea	(WaterHeight).l,a1 ; load water	height array
00005FAC 3031 0000                  		move.w	(a1,d0.w),d0
00005FB0 31C0 F646                  		move.w	d0,(v_waterpos1).w ; set water heights
00005FB4 31C0 F648                  		move.w	d0,(v_waterpos2).w
00005FB8 31C0 F64A                  		move.w	d0,(v_waterpos3).w
00005FBC 4238 F64D                  		clr.b	(v_wtr_routine).w ; clear water routine counter
00005FC0 4238 F64E                  		clr.b	(f_wtr_state).w	; clear	water state
00005FC4 11FC 0001 F64C             		move.b	#1,(f_water).w	; enable water
00005FCA                            
00005FCA                            Level_LoadPal:
00005FCA 31FC 001E FE14             		move.w	#30,(v_air).w
00005FD0 46FC 2300                  		enable_ints
00005FD4 7003                       		moveq	#palid_Sonic,d0
00005FD6 6100 E236                  		bsr.w	PalLoad2	; load Sonic's palette
00005FDA 0C38 0001 FE10             		cmpi.b	#id_LZ,(v_zone).w ; is level LZ?
00005FE0 6600                       		bne.s	Level_GetBgm	; if not, branch
00005FE2                            
00005FE2 7010                       		moveq	#palid_LZSonWater,d0 ; palette number $F (LZ)
00005FE4 0C38 0003 FE11             		cmpi.b	#3,(v_act).w	; is act number 3?
00005FEA 6600                       		bne.s	Level_WaterPal	; if not, branch
00005FEC 7011                       		moveq	#palid_CWZ3SonWat,d0 ; palette number $10 (SBZ3)
00005FEE                            
00005FEE                            	Level_WaterPal:
00005FEE 6100 E236                  		bsr.w	PalLoad3_Water	; load underwater palette
00005FF2 4A38 FE30                  		tst.b	(v_lastlamp).w
00005FF6 6700                       		beq.s	Level_GetBgm
00005FF8 11F8 FE53 F64E             		move.b	($FFFFFE53).w,(f_wtr_state).w
00005FFE                            
00005FFE                            Level_GetBgm:
00005FFE 4A78 FFF0                  		tst.w	(f_demo).w
00006002 6B00                       		bmi.s	Level_SkipTtlCard
00006004 7000                       		moveq	#0,d0
00006006 1038 FE10                  		move.b	(v_zone).w,d0
0000600A 0C78 0103 FE10             		cmpi.w	#(id_LZ<<8)+3,(v_zone).w ; is level SBZ3?
00006010 6600                       		bne.s	Level_BgmNotLZ4	; if not, branch
00006012 7005                       		moveq	#5,d0		; use 5th music (SBZ)
00006014                            
00006014                            	Level_BgmNotLZ4:
00006014 0C78 0502 FE10             		cmpi.w	#(id_CWZ<<8)+2,(v_zone).w ; is level FZ?
0000601A 6600                       		bne.s	Level_PlayBgm	; if not, branch
0000601C 7009                       		moveq	#9,d0		; use 6th music (FZ)
0000601E                            
0000601E                            	Level_PlayBgm:
0000601E 43F9 0000 5E90             		lea	(MusicList).l,a1 ; load	music playlist
00006024 1031 0000                  		move.b	(a1,d0.w),d0
00006028 6100 D2EE                  		bsr.w	PlaySound	; play music
0000602C 11FC 0000 D080             		move.b	#id_TitleCard,(v_objspace+$80).w ; load title card object
00006032                            
00006032                            Level_TtlCardLoop:
00006032 11FC 000C F62A             		move.b	#$C,(v_vbla_routine).w
00006038 6100 EBE4                  		bsr.w	WaitForVBla
0000603C 4EB9 0000 0000             		jsr	(ExecuteObjects).l
00006042 4EB9 0000 0000             		jsr	(BuildSprites).l
00006048 6100 D518                  		bsr.w	RunPLC
0000604C 3038 D108                  		move.w	(v_objspace+$108).w,d0
00006050 B078 D130                  		cmp.w	(v_objspace+$130).w,d0 ; has title card sequence finished?
00006054 66DC                       		bne.s	Level_TtlCardLoop ; if not, branch
00006056 4AB8 F680                  		tst.l	(v_plc_buffer).w ; are there any items in the pattern load cue?
0000605A 66D6                       		bne.s	Level_TtlCardLoop ; if yes, branch
0000605C 4EB9 0000 0000             		jsr	(Hud_Base).l	; load basic HUD gfx
00006062                            
00006062                            	Level_SkipTtlCard:
00006062 7003                       		moveq	#palid_Sonic,d0
00006064 6100 E18C                  		bsr.w	PalLoad1	; load Sonic's palette
00006068 6100 0000                  		bsr.w	LevelSizeLoad
0000606C 6100 0000                  		bsr.w	DeformLayers
00006070 08F8 0002 F754             		bset	#2,(v_fg_scroll_flags).w
00006076 6100 0000                  		bsr.w	LevelDataLoad ; load block mappings and palettes
0000607A 6100 0000                  		bsr.w	LoadTilesFromStart
0000607E 4EB9 0000 0000             		jsr	(FloorLog_Unk).l
00006084 6100 0000                  		bsr.w	ColIndexLoad
00006088 6100 0000                  		bsr.w	LZWaterFeatures
0000608C 11FC 0000 D000             		move.b	#id_SonicPlayer,(v_player).w ; load Sonic object
00006092 4A78 FFF0                  		tst.w	(f_demo).w
00006096 6600                       		bne.s	Level_ChkDebug
00006098 11FC 0000 D040             		move.b	#id_HUD,(v_objspace+$40).w ; load HUD object
0000609E                            
0000609E                            Level_ChkDebug:
0000609E 4A38 FFE2                  		tst.b	(f_debugcheat).w ; has debug cheat been entered?
000060A2 6700                       		beq.s	Level_ChkWater	; if not, branch
000060A4 0838 0006 F604             		btst	#bitA,(v_jpadhold1).w ; is A button held?
000060AA 6700                       		beq.s	Level_ChkWater	; if not, branch
000060AC 11FC 0001 FFFA             		move.b	#1,(f_debugmode).w ; enable debug mode
000060B2                            
000060B2                            Level_ChkWater:
000060B2 31FC 0000 F602             		move.w	#0,(v_jpadhold2).w
000060B8 31FC 0000 F604             		move.w	#0,(v_jpadhold1).w
000060BE 0C38 0001 FE10             		cmpi.b	#id_LZ,(v_zone).w ; is level LZ?
000060C4 6600                       		bne.s	Level_LoadObj	; if not, branch
000060C6 11FC 0000 D780             		move.b	#id_WaterSurface,(v_objspace+$780).w ; load water surface object
000060CC 31FC 0060 D788             		move.w	#$60,(v_objspace+$780+obX).w
000060D2 11FC 0000 D7C0             		move.b	#id_WaterSurface,(v_objspace+$7C0).w
000060D8 31FC 0120 D7C8             		move.w	#$120,(v_objspace+$7C0+obX).w
000060DE                            
000060DE                            Level_LoadObj:
000060DE 4EB9 0000 0000             		jsr	(ObjPosLoad).l
000060E4 4EB9 0000 0000             		jsr	(ExecuteObjects).l
000060EA 4EB9 0000 0000             		jsr	(BuildSprites).l
000060F0 7000                       		moveq	#0,d0
000060F2 4A38 FE30                  		tst.b	(v_lastlamp).w	; are you starting from	a lamppost?
000060F6 6600                       		bne.s	Level_SkipClr	; if yes, branch
000060F8 31C0 FE20                  		move.w	d0,(v_rings).w	; clear rings
000060FC 21C0 FE22                  		move.l	d0,(v_time).w	; clear time
00006100 11C0 FE1B                  		move.b	d0,(v_lifecount).w ; clear lives counter
00006104                            
00006104                            	Level_SkipClr:
00006104 11C0 FE1A                  		move.b	d0,(f_timeover).w
00006108 11C0 FE2C                  		move.b	d0,(v_shield).w	; clear shield
0000610C 11C0 FE2D                  		move.b	d0,(v_invinc).w	; clear invincibility
00006110 11C0 FE2E                  		move.b	d0,(v_shoes).w	; clear speed shoes
00006114 11C0 FE2F                  		move.b	d0,($FFFFFE2F).w
00006118 31C0 FE08                  		move.w	d0,(v_debuguse).w
0000611C 31C0 FE02                  		move.w	d0,(f_restart).w
00006120 31C0 FE04                  		move.w	d0,(v_framecount).w
00006124 0C38 0004 FFC4             		cmpi.b  #4,(v_health).w
0000612A 6E00                       		bgt.s   @skip
0000612C                            		
0000612C 11FC 0004 FFC4             		move.b  #4,(v_health).w
00006132 11FC 0001 FFC6             		move.b  #1,(f_healthcount).w
00006138                            	@skip:
00006138 0C38 0009 FFC4             		cmpi.b  #9,(v_health).w
0000613E 6D00                       		blt.s   @skipahead
00006140                            		
00006140 11FC 0009 FFC4             		move.b  #9,(v_health).w
00006146 11FC 0001 FFC6             		move.b  #1,(f_healthcount).w
0000614C                            		
0000614C                            	@skipahead:
0000614C 6100 0000                  		bsr.w	OscillateNumInit
00006150 11FC 0001 FE1F             		move.b	#1,(f_scorecount).w ; update score counter
00006156 11FC 0001 FE1D             		move.b	#1,(f_ringcount).w ; update rings counter
0000615C 11FC 0001 FE1E             		move.b	#1,(f_timecount).w ; update time counter
00006162 31FC 0000 F790             		move.w	#0,(v_btnpushtime1).w
00006168 43F9 0000 0000             		lea	(DemoDataPtr).l,a1 ; load demo data
0000616E 7000                       		moveq	#0,d0
00006170 1038 FE10                  		move.b	(v_zone).w,d0
00006174 E548                       		lsl.w	#2,d0
00006176 2271 0000                  		movea.l	(a1,d0.w),a1
0000617A 4A78 FFF0                  		tst.w	(f_demo).w	; is demo mode on?
0000617E 6A00                       		bpl.s	Level_Demo	; if yes, branch
00006180 43F9 0000 0000             		lea	(DemoEndDataPtr).l,a1 ; load ending demo data
00006186 3038 FFF4                  		move.w	(v_creditsnum).w,d0
0000618A 5340                       		subq.w	#1,d0
0000618C E548                       		lsl.w	#2,d0
0000618E 2271 0000                  		movea.l	(a1,d0.w),a1
00006192                            
00006192                            Level_Demo:
00006192 11E9 0001 F792             		move.b	1(a1),(v_btnpushtime2).w ; load key press duration
00006198 5338 F792                  		subq.b	#1,(v_btnpushtime2).w ; subtract 1 from duration
0000619C 31FC 0708 F614             		move.w	#1800,(v_demolength).w
000061A2 4A78 FFF0                  		tst.w	(f_demo).w
000061A6 6A00                       		bpl.s	Level_ChkWaterPal
000061A8 31FC 021C F614             		move.w	#540,(v_demolength).w
000061AE 0C78 0004 FFF4             		cmpi.w	#4,(v_creditsnum).w
000061B4 6600                       		bne.s	Level_ChkWaterPal
000061B6 31FC 01FE F614             		move.w	#510,(v_demolength).w
000061BC                            
000061BC                            Level_ChkWaterPal:
000061BC 0C38 0001 FE10             		cmpi.b	#id_LZ,(v_zone).w ; is level LZ/SBZ3?
000061C2 6600                       		bne.s	Level_Delay	; if not, branch
000061C4 700C                       		moveq	#palid_LZWater,d0 ; palette $B (LZ underwater)
000061C6 0C38 0003 FE11             		cmpi.b	#3,(v_act).w	; is level SBZ3?
000061CC 6600                       		bne.s	Level_WtrNotSbz	; if not, branch
000061CE 700E                       		moveq	#palid_CWZ3Water,d0 ; palette $D (SBZ3 underwater)
000061D0                            
000061D0                            	Level_WtrNotSbz:
000061D0 6100 E070                  		bsr.w	PalLoad4_Water
000061D4                            
000061D4                            Level_Delay:
000061D4 323C 0003                  		move.w	#3,d1
000061D8                            
000061D8                            	Level_DelayLoop:
000061D8 11FC 0008 F62A             		move.b	#8,(v_vbla_routine).w
000061DE 6100 EA3E                  		bsr.w	WaitForVBla
000061E2 51C9 FFF4                  		dbf	d1,Level_DelayLoop
000061E6                            		
000061E6 0C39 0008 FFFF FE10        		cmp.b	#8, (v_zone)
000061EE 6700 0000                  		beq		@CSZTitle
000061F2                            
000061F2 31FC 202F F626             		move.w	#$202F,(v_pfade_start).w ; fade in 2nd, 3rd & 4th palette lines
000061F8 6100 DD60                  		bsr.w	PalFadeIn_Alt
000061FC                            	@cont:
000061FC 4A78 FFF0                  		tst.w	(f_demo).w	; is an ending sequence demo running?
00006200 6B00                       		bmi.s	Level_ClrCardArt ; if yes, branch
00006202 5438 D0A4                  		addq.b	#2,(v_objspace+$80+obRoutine).w ; make title card move
00006206 5838 D0E4                  		addq.b	#4,(v_objspace+$C0+obRoutine).w
0000620A 5838 D124                  		addq.b	#4,(v_objspace+$100+obRoutine).w
0000620E 5838 D164                  		addq.b	#4,(v_objspace+$140+obRoutine).w
00006212 6000                       		bra.s	Level_StartGame
00006214 4E75                       		rts
00006216                            		
00006216                            	@CSZTitle:
00006216 31FC 202F F626             		move.w	#$202F,(v_pfade_start).w ; fade in 2nd, 3rd & 4th palette lines
0000621C 6100 DE60                  		bsr.w	PaletteWhiteIn_Alt
00006220 4EB9 0000 61FC             		jsr @cont
00006226 4E75                       		rts
00006228                            ; ===========================================================================
00006228                            
00006228                            Level_ClrCardArt:
00006228 7000                       		moveq	#plcid_Explode,d0
0000622A 4EB9 0000 34F6             		jsr	(AddPLC).l	; load explosion gfx
00006230 7000                       		moveq	#0,d0
00006232 1038 FE10                  		move.b	(v_zone).w,d0
00006236 0640 0000                  		addi.w	#plcid_GHZAnimals,d0
0000623A 4EB9 0000 34F6             		jsr	(AddPLC).l	; load animal gfx (level no. + $15)
00006240                            
00006240                            Level_StartGame:
00006240 08B8 0007 F600             		bclr	#7,(v_gamemode).w ; subtract $80 from mode to end pre-level stuff
00006246                            
00006246                            ; ---------------------------------------------------------------------------
00006246                            ; Main level loop (when	all title card and loading sequences are finished)
00006246                            ; ---------------------------------------------------------------------------
00006246                            
00006246                            Level_MainLoop:
00006246 6100 D0E2                  		bsr.w	PauseGame
0000624A 11FC 0008 F62A             		move.b	#8,(v_vbla_routine).w
00006250 6100 E9CC                  		bsr.w	WaitForVBla
00006254 5278 FE04                  		addq.w	#1,(v_framecount).w ; add 1 to level timer
00006258 6100 0000                  		bsr.w	MoveSonicInDemo
0000625C 6100 0000                  		bsr.w	LZWaterFeatures
00006260 4EB9 0000 0000             		jsr	(ExecuteObjects).l
00006266 4A78 FE08                  		tst.w	(v_debuguse).w	; is debug mode being used?
0000626A 6600                       		bne.s	Level_DoScroll	; if yes, branch
0000626C 0C38 0006 D024             		cmpi.b	#6,(v_player+obRoutine).w ; has Sonic just died?
00006272 6400                       		bhs.s	Level_SkipScroll ; if yes, branch
00006274                            
00006274                            	Level_DoScroll:
00006274 6100 0000                  		bsr.w	DeformLayers
00006278                            
00006278                            	Level_SkipScroll:
00006278 4EB9 0000 0000             		jsr	(BuildSprites).l
0000627E 4EB9 0000 0000             		jsr	(ObjPosLoad).l
00006284 6100 D854                  		bsr.w	PaletteCycle
00006288 6100 D2D8                  		bsr.w	RunPLC
0000628C 6100 0000                  		bsr.w	OscillateNumDo
00006290 6100 0000                  		bsr.w	SynchroAnimate
00006294 6100 0000                  		bsr.w	SignpostArtLoad
00006298                            
00006298 0C38 0000 F600             		cmpi.b	#id_Demo,(v_gamemode).w
0000629E 6700                       		beq.s	Level_ChkDemo	; if mode is 8 (demo), branch
000062A0 4A78 FE02                  		tst.w	(f_restart).w	; is the level set to restart?
000062A4 6600 FBF6                  		bne.w	GM_Level	; if yes, branch
000062A8 0C38 0000 F600             		cmpi.b	#id_Level,(v_gamemode).w
000062AE 6700 FF96                  		beq.w	Level_MainLoop	; if mode is $C (level), branch
000062B2 4E75                       		rts	
000062B4                            ; ===========================================================================
000062B4                            
000062B4                            Level_ChkDemo:
000062B4 4A78 FE02                  		tst.w	(f_restart).w	; is level set to restart?
000062B8 6600                       		bne.s	Level_EndDemo	; if yes, branch
000062BA 4A78 F614                  		tst.w	(v_demolength).w ; is there time left on the demo?
000062BE 6700                       		beq.s	Level_EndDemo	; if not, branch
000062C0 0C38 0000 F600             		cmpi.b	#id_Demo,(v_gamemode).w
000062C6 6700 FF7E                  		beq.w	Level_MainLoop	; if mode is 8 (demo), branch
000062CA 11FC 0000 F600             		move.b	#id_Sega,(v_gamemode).w ; go to Sega screen
000062D0 4E75                       		rts	
000062D2                            ; ===========================================================================
000062D2                            
000062D2                            Level_EndDemo:
000062D2 0C38 0000 F600             		cmpi.b	#id_Demo,(v_gamemode).w
000062D8 6600                       		bne.s	Level_FadeDemo	; if mode is 8 (demo), branch
000062DA 11FC 0000 F600             		move.b	#id_Sega,(v_gamemode).w ; go to Sega screen
000062E0 4A78 FFF0                  		tst.w	(f_demo).w	; is demo mode on & not ending sequence?
000062E4 6A00                       		bpl.s	Level_FadeDemo	; if yes, branch
000062E6 11FC 0000 F600             		move.b	#id_Credits,(v_gamemode).w ; go to credits
000062EC                            
000062EC                            Level_FadeDemo:
000062EC 31FC 003C F614             		move.w	#$3C,(v_demolength).w
000062F2 31FC 003F F626             		move.w	#$3F,(v_pfade_start).w
000062F8 4278 F794                  		clr.w	(v_palchgspeed).w
000062FC                            
000062FC                            	Level_FDLoop:
000062FC 11FC 0008 F62A             		move.b	#8,(v_vbla_routine).w
00006302 6100 E91A                  		bsr.w	WaitForVBla
00006306 6100 0000                  		bsr.w	MoveSonicInDemo
0000630A 4EB9 0000 0000             		jsr	(ExecuteObjects).l
00006310 4EB9 0000 0000             		jsr	(BuildSprites).l
00006316 4EB9 0000 0000             		jsr	(ObjPosLoad).l
0000631C 5378 F794                  		subq.w	#1,(v_palchgspeed).w
00006320 6A00                       		bpl.s	loc_3BC8
00006322 31FC 0002 F794             		move.w	#2,(v_palchgspeed).w
00006328 6100 DCF0                  		bsr.w	FadeOut_ToBlack
0000632C                            
0000632C                            loc_3BC8:
0000632C 4A78 F614                  		tst.w	(v_demolength).w
00006330 66CA                       		bne.s	Level_FDLoop
00006332 4E75                       		rts	
00006334                            ; ===========================================================================
00006334                            
00006334                            		include	"_inc\LZWaterFeatures.asm"
00006334                            ; ---------------------------------------------------------------------------
00006334                            ; Subroutine to	do special water effects in Labyrinth Zone
00006334                            ; ---------------------------------------------------------------------------
00006334                            
00006334                            LZWaterFeatures:
00006334 0C38 0001 FE10             		cmpi.b	#id_LZ,(v_zone).w ; check if level is LZ
0000633A 6600                       		bne.s	@notlabyrinth	; if not, branch
0000633C 0C38 0006 D024             		cmpi.b	#6,(v_player+obRoutine).w ; has Sonic just died?
00006342 6400                       		bcc.s	@setheight	; if yes, skip other effects
00006344                            
00006344 6100 0000                  		bsr.w	LZWindTunnels
00006348 6100 0000                  		bsr.w	LZWaterSlides
0000634C 6100 0000                  		bsr.w	LZDynamicWater
00006350                            
00006350                            @setheight:
00006350 4238 F64E                  		clr.b	(f_wtr_state).w
00006354 7000                       		moveq	#0,d0
00006356 1038 FE60                  		move.b	(v_oscillate+2).w,d0
0000635A E248                       		lsr.w	#1,d0
0000635C D078 F648                  		add.w	(v_waterpos2).w,d0
00006360 31C0 F646                  		move.w	d0,(v_waterpos1).w
00006364 3038 F646                  		move.w	(v_waterpos1).w,d0
00006368 9078 F704                  		sub.w	(v_screenposy).w,d0
0000636C 6400                       		bcc.s	@isbelow
0000636E 4A40                       		tst.w	d0
00006370 6A00                       		bpl.s	@isbelow	; if water is below top of screen, branch
00006372                            
00006372 11FC 00DF F625             		move.b	#223,(v_hbla_line).w
00006378 11FC 0001 F64E             		move.b	#1,(f_wtr_state).w ; screen is all underwater
0000637E                            
0000637E                            	@isbelow:
0000637E 0C40 00DF                  		cmpi.w	#223,d0		; is water within 223 pixels of top of screen?
00006382 6500                       		bcs.s	@isvisible	; if yes, branch
00006384 303C 00DF                  		move.w	#223,d0
00006388                            
00006388                            	@isvisible:
00006388 11C0 F625                  		move.b	d0,(v_hbla_line).w ; set water surface as on-screen
0000638C                            
0000638C                            @notlabyrinth:
0000638C 4E75                       		rts	
0000638E                            ; ===========================================================================
0000638E                            ; ---------------------------------------------------------------------------
0000638E                            ; Initial water heights
0000638E                            ; ---------------------------------------------------------------------------
0000638E 00B8                       WaterHeight:	dc.w $B8	; Labyrinth 1
00006390 0328                       		dc.w $328	; Labyrinth 2
00006392 0900                       		dc.w $900	; Labyrinth 3
00006394 0228                       		dc.w $228	; Scrap Brain 3
00006396                            		even
00006396                            ; ===========================================================================
00006396                            
00006396                            ; ---------------------------------------------------------------------------
00006396                            ; Labyrinth dynamic water routines
00006396                            ; ---------------------------------------------------------------------------
00006396                            
00006396                            LZDynamicWater:
00006396 7000                       		moveq	#0,d0
00006398 1038 FE11                  		move.b	(v_act).w,d0
0000639C D040                       		add.w	d0,d0
0000639E 303B 0000                  		move.w	DynWater_Index(pc,d0.w),d0
000063A2 4EBB 0000                  		jsr	DynWater_Index(pc,d0.w)
000063A6 7200                       		moveq	#0,d1
000063A8 1238 F64C                  		move.b	(f_water).w,d1
000063AC 3038 F64A                  		move.w	(v_waterpos3).w,d0
000063B0 9078 F648                  		sub.w	(v_waterpos2).w,d0
000063B4 6700                       		beq.s	@exit		; if water level is correct, branch
000063B6 6400                       		bcc.s	@movewater	; if water level is too high, branch
000063B8 4441                       		neg.w	d1		; set water to move up instead
000063BA                            
000063BA                            	@movewater:
000063BA D378 F648                  		add.w	d1,(v_waterpos2).w ; move water up/down
000063BE                            
000063BE                            	@exit:
000063BE 4E75                       		rts	
000063C0                            ; ===========================================================================
000063C0 0000                       DynWater_Index:	dc.w DynWater_LZ1-DynWater_Index
000063C2 0000                       		dc.w DynWater_LZ2-DynWater_Index
000063C4 0000                       		dc.w DynWater_LZ3-DynWater_Index
000063C6 0000                       		dc.w DynWater_SBZ3-DynWater_Index
000063C8                            ; ===========================================================================
000063C8                            
000063C8                            DynWater_LZ1:
000063C8 3038 F700                  		move.w	(v_screenposx).w,d0
000063CC 1438 F64D                  		move.b	(v_wtr_routine).w,d2
000063D0 6600                       		bne.s	@routine2
000063D2 323C 00B8                  		move.w	#$B8,d1		; water height
000063D6 0C40 0600                  		cmpi.w	#$600,d0	; has screen reached next position?
000063DA 6500                       		bcs.s	@setwater	; if not, branch
000063DC 323C 0108                  		move.w	#$108,d1
000063E0 0C78 0200 D00C             		cmpi.w	#$200,(v_player+obY).w ; is Sonic above $200 y-axis?
000063E6 6500                       		bcs.s	@sonicishigh	; if yes, branch
000063E8 0C40 0C00                  		cmpi.w	#$C00,d0
000063EC 6500                       		bcs.s	@setwater
000063EE 323C 0318                  		move.w	#$318,d1
000063F2 0C40 1080                  		cmpi.w	#$1080,d0
000063F6 6500                       		bcs.s	@setwater
000063F8 11FC 0080 F7E5             		move.b	#$80,(f_switch+5).w
000063FE 323C 05C8                  		move.w	#$5C8,d1
00006402 0C40 1380                  		cmpi.w	#$1380,d0
00006406 6500                       		bcs.s	@setwater
00006408 323C 03A8                  		move.w	#$3A8,d1
0000640C B278 F648                  		cmp.w	(v_waterpos2).w,d1 ; has water reached last height?
00006410 6600                       		bne.s	@setwater	; if not, branch
00006412 11FC 0001 F64D             		move.b	#1,(v_wtr_routine).w ; use second routine next
00006418                            
00006418                            	@setwater:
00006418 31C1 F64A                  		move.w	d1,(v_waterpos3).w
0000641C 4E75                       		rts	
0000641E                            ; ===========================================================================
0000641E                            
0000641E                            @sonicishigh:
0000641E 0C40 0C80                  		cmpi.w	#$C80,d0
00006422 65F4                       		bcs.s	@setwater
00006424 323C 00E8                  		move.w	#$E8,d1
00006428 0C40 1500                  		cmpi.w	#$1500,d0
0000642C 65EA                       		bcs.s	@setwater
0000642E 323C 0108                  		move.w	#$108,d1
00006432 60E4                       		bra.s	@setwater
00006434                            ; ===========================================================================
00006434                            
00006434                            @routine2:
00006434 5302                       		subq.b	#1,d2
00006436 6600                       		bne.s	@skip
00006438 0C78 02E0 D00C             		cmpi.w	#$2E0,(v_player+obY).w ; is Sonic above $2E0 y-axis?
0000643E 6400                       		bcc.s	@skip		; if not, branch
00006440 323C 03A8                  		move.w	#$3A8,d1
00006444 0C40 1300                  		cmpi.w	#$1300,d0
00006448 6500                       		bcs.s	@setwater2
0000644A 323C 0108                  		move.w	#$108,d1
0000644E 11FC 0002 F64D             		move.b	#2,(v_wtr_routine).w
00006454                            
00006454                            	@setwater2:
00006454 31C1 F64A                  		move.w	d1,(v_waterpos3).w
00006458                            
00006458                            	@skip:
00006458 4E75                       		rts	
0000645A                            ; ===========================================================================
0000645A                            
0000645A                            DynWater_LZ2:
0000645A 3038 F700                  		move.w	(v_screenposx).w,d0
0000645E 323C 0328                  		move.w	#$328,d1
00006462 0C40 0500                  		cmpi.w	#$500,d0
00006466 6500                       		bcs.s	@setwater
00006468 323C 03C8                  		move.w	#$3C8,d1
0000646C 0C40 0B00                  		cmpi.w	#$B00,d0
00006470 6500                       		bcs.s	@setwater
00006472 323C 0428                  		move.w	#$428,d1
00006476                            
00006476                            	@setwater:
00006476 31C1 F64A                  		move.w	d1,(v_waterpos3).w
0000647A 4E75                       		rts	
0000647C                            ; ===========================================================================
0000647C                            
0000647C                            DynWater_LZ3:
0000647C 3038 F700                  		move.w	(v_screenposx).w,d0
00006480 1438 F64D                  		move.b	(v_wtr_routine).w,d2
00006484 6600                       		bne.s	@routine2
00006486                            
00006486 323C 0900                  		move.w	#$900,d1
0000648A 0C40 0600                  		cmpi.w	#$600,d0	; has screen reached position?
0000648E 6500                       		bcs.s	@setwaterlz3	; if not, branch
00006490 0C78 03C0 D00C             		cmpi.w	#$3C0,(v_player+obY).w
00006496 6500                       		bcs.s	@setwaterlz3
00006498 0C78 0600 D00C             		cmpi.w	#$600,(v_player+obY).w ; is Sonic in a y-axis range?
0000649E 6400                       		bcc.s	@setwaterlz3	; if not, branch
000064A0                            
000064A0 323C 04C8                  		move.w	#$4C8,d1	; set new water height
000064A4 11FC 004B A506             		move.b	#$4B,(v_lvllayout+$106).w ; update level layout
000064AA 11FC 0001 F64D             		move.b	#1,(v_wtr_routine).w ; use second routine next
000064B8                            
000064B8                            	@setwaterlz3:
000064B8 31C1 F64A                  		move.w	d1,(v_waterpos3).w
000064BC 31C1 F648                  		move.w	d1,(v_waterpos2).w ; change water height instantly
000064C0 4E75                       		rts	
000064C2                            ; ===========================================================================
000064C2                            
000064C2                            @routine2:
000064C2 5302                       		subq.b	#1,d2
000064C4 6600                       		bne.s	@routine3
000064C6 323C 04C8                  		move.w	#$4C8,d1
000064CA 0C40 0770                  		cmpi.w	#$770,d0
000064CE 6500                       		bcs.s	@setwater2
000064D0 323C 0308                  		move.w	#$308,d1
000064D4 0C40 1400                  		cmpi.w	#$1400,d0
000064D8 6500                       		bcs.s	@setwater2
000064DA 0C78 0508 F64A             		cmpi.w	#$508,(v_waterpos3).w
000064E0 6700                       		beq.s	@sonicislow
000064E2 0C78 0600 D00C             		cmpi.w	#$600,(v_player+obY).w ; is Sonic below $600 y-axis?
000064E8 6400                       		bcc.s	@sonicislow	; if yes, branch
000064EA 0C78 0280 D00C             		cmpi.w	#$280,(v_player+obY).w
000064F0 6400                       		bcc.s	@setwater2
000064F2                            
000064F2                            @sonicislow:
000064F2 323C 0508                  		move.w	#$508,d1
000064F6 31C1 F648                  		move.w	d1,(v_waterpos2).w
000064FA 0C40 1770                  		cmpi.w	#$1770,d0
000064FE 6500                       		bcs.s	@setwater2
00006500 11FC 0002 F64D             		move.b	#2,(v_wtr_routine).w
00006506                            
00006506                            	@setwater2:
00006506 31C1 F64A                  		move.w	d1,(v_waterpos3).w
0000650A 4E75                       		rts	
0000650C                            ; ===========================================================================
0000650C                            
0000650C                            @routine3:
0000650C 5302                       		subq.b	#1,d2
0000650E 6600                       		bne.s	@routine4
00006510 323C 0508                  		move.w	#$508,d1
00006514 0C40 1860                  		cmpi.w	#$1860,d0
00006518 6500                       		bcs.s	@setwater3
0000651A 323C 0188                  		move.w	#$188,d1
0000651E 0C40 1AF0                  		cmpi.w	#$1AF0,d0
00006522 6400                       		bcc.s	@loc_3DC6
00006524 B278 F648                  		cmp.w	(v_waterpos2).w,d1
00006528 6600                       		bne.s	@setwater3
0000652A                            
0000652A                            	@loc_3DC6:
0000652A 11FC 0003 F64D             		move.b	#3,(v_wtr_routine).w
00006530                            
00006530                            	@setwater3:
00006530 31C1 F64A                  		move.w	d1,(v_waterpos3).w
00006534 4E75                       		rts	
00006536                            ; ===========================================================================
00006536                            
00006536                            @routine4:
00006536 5302                       		subq.b	#1,d2
00006538 6600                       		bne.s	@routine5
0000653A 323C 0188                  		move.w	#$188,d1
0000653E 0C40 1AF0                  		cmpi.w	#$1AF0,d0
00006542 6500                       		bcs.s	@setwater4
00006544 323C 0900                  		move.w	#$900,d1
00006548 0C40 1BC0                  		cmpi.w	#$1BC0,d0
0000654C 6500                       		bcs.s	@setwater4
0000654E 11FC 0004 F64D             		move.b	#4,(v_wtr_routine).w
00006554 31FC 0608 F64A             		move.w	#$608,(v_waterpos3).w
0000655A 31FC 07C0 F648             		move.w	#$7C0,(v_waterpos2).w
00006560 11FC 0001 F7E8             		move.b	#1,(f_switch+8).w
00006566 4E75                       		rts	
00006568                            ; ===========================================================================
00006568                            
00006568                            @setwater4:
00006568 31C1 F64A                  		move.w	d1,(v_waterpos3).w
0000656C 31C1 F648                  		move.w	d1,(v_waterpos2).w
00006570 4E75                       		rts	
00006572                            ; ===========================================================================
00006572                            
00006572                            @routine5:
00006572 0C40 1E00                  		cmpi.w	#$1E00,d0	; has screen passed final position?
00006576 6500                       		bcs.s	@dontset	; if not, branch
00006578 31FC 0128 F64A             		move.w	#$128,(v_waterpos3).w
0000657E                            
0000657E                            	@dontset:
0000657E 4E75                       		rts	
00006580                            ; ===========================================================================
00006580                            
00006580                            DynWater_SBZ3:
00006580 323C 0228                  		move.w	#$228,d1
00006584 0C78 0F00 F700             		cmpi.w	#$F00,(v_screenposx).w
0000658A 6500                       		bcs.s	@setwater
0000658C 323C 04C8                  		move.w	#$4C8,d1
00006590                            
00006590                            	@setwater:
00006590 31C1 F64A                  		move.w	d1,(v_waterpos3).w
00006594 4E75                       		rts
00006596                            
00006596                            ; ---------------------------------------------------------------------------
00006596                            ; Labyrinth Zone "wind tunnels"	subroutine
00006596                            ; ---------------------------------------------------------------------------
00006596                            
00006596                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00006596                            
00006596                            
00006596                            LZWindTunnels:
00006596 4A78 FE08                  		tst.w	(v_debuguse).w	; is debug mode	being used?
0000659A 6600 0000                  		bne.w	@quit	; if yes, branch
0000659E 45F9 0000 0000             		lea	(LZWind_Data+8).l,a2
000065A4 7000                       		moveq	#0,d0
000065A6 1038 FE11                  		move.b	(v_act).w,d0	; get act number
000065AA E748                       		lsl.w	#3,d0		; multiply by 8
000065AC D4C0                       		adda.w	d0,a2		; add to address for data
000065AE 7200                       		moveq	#0,d1
000065B0 4A38 FE11                  		tst.b	(v_act).w	; is act number 1?
000065B4 6600                       		bne.s	@notact1	; if not, branch
000065B6 7201                       		moveq	#1,d1
000065B8 514A                       		subq.w	#8,a2		; use different data for act 1
000065BA                            
000065BA                            	@notact1:
000065BA 43F8 D000                  		lea	(v_player).w,a1
000065BE                            
000065BE                            @chksonic:
000065BE 3029 0008                  		move.w	obX(a1),d0
000065C2 B052                       		cmp.w	(a2),d0
000065C4 6500 0000                  		bcs.w	@chknext
000065C8 B06A 0004                  		cmp.w	4(a2),d0
000065CC 6400 0000                  		bcc.w	@chknext
000065D0 3429 000C                  		move.w	obY(a1),d2
000065D4 B46A 0002                  		cmp.w	2(a2),d2
000065D8 6500                       		bcs.s	@chknext
000065DA B46A 0006                  		cmp.w	6(a2),d2
000065DE 6400                       		bcc.s	@chknext	; branch if Sonic is outside a range
000065E0 1038 FE0F                  		move.b	(v_vbla_byte).w,d0
000065E4 0200 003F                  		andi.b	#$3F,d0		; does VInt counter fall on 0, $40, $80 or $C0?
000065E8 6600                       		bne.s	@skipsound	; if not, branch
000065F4                            
000065F4                            	@skipsound:
000065F4 4A38 F7C9                  		tst.b	(f_wtunnelallow).w ; are wind tunnels disabled?
000065F8 6600 0000                  		bne.w	@quit	; if yes, branch
000065FC 0C29 0004 0024             		cmpi.b	#4,obRoutine(a1) ; is Sonic hurt/dying?
00006602 6400                       		bcc.s	@clrquit	; if yes, branch
00006604 11FC 0001 F7C7             		move.b	#1,(f_wtunnelmode).w
0000660A 0440 0080                  		subi.w	#$80,d0
0000660E B052                       		cmp.w	(a2),d0
00006610 6400                       		bcc.s	@movesonic
00006612 7002                       		moveq	#2,d0
00006614 0C38 0001 FE11             		cmpi.b	#1,(v_act).w	; is act number 2?
0000661A 6600                       		bne.s	@notact2	; if not, branch
0000661C 4440                       		neg.w	d0
0000661E                            
0000661E                            	@notact2:
0000661E D169 000C                  		add.w	d0,obY(a1)	; adjust Sonic's y-axis for curve of tunnel
00006622                            
00006622                            @movesonic:
00006622 5869 0008                  		addq.w	#4,obX(a1)
00006626 337C 0400 0010             		move.w	#$400,obVelX(a1) ; move Sonic horizontally
0000662C 337C 0000 0012             		move.w	#0,obVelY(a1)
00006632 137C 0000 001C             		move.b	#id_Float2,obAnim(a1)	; use floating animation
00006638 08E9 0001 0022             		bset	#1,obStatus(a1)
0000663E 0838 0000 F602             		btst	#0,(v_jpadhold2).w ; is up pressed?
00006644 6700                       		beq.s	@down		; if not, branch
00006646 5369 000C                  		subq.w	#1,obY(a1)	; move Sonic up on pole
0000664A                            
0000664A                            	@down:
0000664A 0838 0001 F602             		btst	#1,(v_jpadhold2).w ; is down being pressed?
00006650 6700                       		beq.s	@end		; if not, branch
00006652 5269 000C                  		addq.w	#1,obY(a1)	; move Sonic down on pole
00006656                            
00006656                            	@end:
00006656 4E75                       		rts	
00006658                            ; ===========================================================================
00006658                            
00006658                            @chknext:
00006658 504A                       		addq.w	#8,a2		; use second set of values (act 1 only)
0000665A 51C9 FF62                  		dbf	d1,@chksonic	; on act 1, repeat for a second tunnel
0000665E 4A38 F7C7                  		tst.b	(f_wtunnelmode).w ; is Sonic still in a tunnel?
00006662 6700                       		beq.s	@quit		; if yes, branch
00006664 137C 0000 001C             		move.b	#id_Walk,obAnim(a1)	; use walking animation
0000666A                            
0000666A                            @clrquit:
0000666A 4238 F7C7                  		clr.b	(f_wtunnelmode).w ; finish tunnel
0000666E                            
0000666E                            @quit:
0000666E 4E75                       		rts	
00006670                            ; End of function LZWindTunnels
00006670                            
00006670                            ; ===========================================================================
00006670                            
00006670                            		;    left, top,  right, bottom boundaries
00006670 0A80 0300 0C10 0380        LZWind_Data:	dc.w $A80, $300, $C10,  $380 ; act 1 values (set 1)
00006678 0F80 0100 1410 0180        		dc.w $F80, $100, $1410,	$180 ; act 1 values (set 2)
00006680 0460 0400 0710 0480        		dc.w $460, $400, $710,  $480 ; act 2 values
00006688 0A20 0600 1610 06E0        		dc.w $A20, $600, $1610, $6E0 ; act 3 values
00006690 0C80 0600 13D0 0680        		dc.w $C80, $600, $13D0, $680 ; SBZ act 3 values
00006698                            		even
00006698                            
00006698                            ; ---------------------------------------------------------------------------
00006698                            ; Labyrinth Zone water slide subroutine
00006698                            ; ---------------------------------------------------------------------------
00006698                            
00006698                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00006698                            
00006698                            
00006698                            LZWaterSlides:
00006698 43F8 D000                  		lea	(v_player).w,a1
0000669C 0829 0001 0022             		btst	#1,obStatus(a1)	; is Sonic jumping?
000066A2 6600                       		bne.s	loc_3F6A	; if not, branch
000066A4 3029 000C                  		move.w	obY(a1),d0
000066A8 E248                       		lsr.w	#1,d0
000066AA 0240 0380                  		andi.w	#$380,d0
000066AE 1229 0008                  		move.b	obX(a1),d1
000066B2 0241 007F                  		andi.w	#$7F,d1
000066B6 D041                       		add.w	d1,d0
000066B8 45F8 A400                  		lea	(v_lvllayout).w,a2
000066BC 1032 0000                  		move.b	(a2,d0.w),d0
000066C0 45FA 0000                  		lea	Slide_Chunks_End(pc),a2
000066C4 7200                       		moveq	#Slide_Chunks_End-Slide_Chunks-1,d1
000066C6                            
000066C6                            loc_3F62:
000066C6 B022                       		cmp.b	-(a2),d0
000066C8 57C9 FFFC                  		dbeq	d1,loc_3F62
000066CC 6700                       		beq.s	LZSlide_Move
000066CE                            
000066CE                            loc_3F6A:
000066CE 4A38 F7CA                  		tst.b	(f_jumponly).w
000066D2 6700                       		beq.s	locret_3F7A
000066D4 337C 0005 003E             		move.w	#5,$3E(a1)
000066DA 4238 F7CA                  		clr.b	(f_jumponly).w
000066DE                            
000066DE                            locret_3F7A:
000066DE 4E75                       		rts	
000066E0                            ; ===========================================================================
000066E0                            
000066E0                            LZSlide_Move:
000066E0 0C41 0003                  		cmpi.w	#3,d1
000066E4 6400                       		bcc.s	loc_3F84
000066E6 4E71                       		nop	
000066E8                            
000066E8                            loc_3F84:
000066E8 08A9 0000 0022             		bclr	#0,obStatus(a1)
000066EE 103B 1000                  		move.b	Slide_Speeds(pc,d1.w),d0
000066F2 1340 0014                  		move.b	d0,obInertia(a1)
000066F6 6A00                       		bpl.s	loc_3F9A
000066F8 08E9 0000 0022             		bset	#0,obStatus(a1)
000066FE                            
000066FE                            loc_3F9A:
000066FE 4229 0015                  		clr.b	obInertia+1(a1)
00006702 137C 0000 001C             		move.b	#id_WaterSlide,obAnim(a1) ; use Sonic's "sliding" animation
00006708 11FC 0001 F7CA             		move.b	#1,(f_jumponly).w ; lock controls (except jumping)
0000670E 1038 FE0F                  		move.b	(v_vbla_byte).w,d0
00006712 0200 001F                  		andi.b	#$1F,d0
00006716 6600                       		bne.s	locret_3FBE
00006722                            
00006722                            locret_3FBE:
00006722 4E75                       		rts	
00006724                            ; End of function LZWaterSlides
00006724                            
00006724                            ; ===========================================================================
00006724                            ; byte_3FC0:
00006724                            Slide_Speeds:
00006724 0AF5 0AF6 F5F4 0B          		dc.b $A, $F5, $A, $F6, $F5, $F4, $B
0000672C 00                         		even
0000672C                            
0000672C                            Slide_Chunks:
0000672C FFFF FFFF FFFF             		dc.b $FF,$FF,$FF,$FF,$FF,$FF
00006732                            ; byte_3FCF
00006732                            Slide_Chunks_End
00006732                            		even
00006732                            		even
00006732                            		include	"_inc\MoveSonicInDemo.asm"
00006732                            ; ---------------------------------------------------------------------------
00006732                            ; Subroutine to	move Sonic in demo mode
00006732                            ; ---------------------------------------------------------------------------
00006732                            
00006732                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00006732                            
00006732                            
00006732                            MoveSonicInDemo:
00006732 4A78 FFF0                  		tst.w	(f_demo).w	; is demo mode on?
00006736 6600                       		bne.s	MDemo_On	; if yes, branch
00006738 4E75                       		rts	
0000673A                            ; ===========================================================================
0000673A                            
0000673A                            ; This is an unused subroutine for recording a demo
0000673A                            
0000673A                            DemoRecorder:
0000673A 43F9 0008 0000             		lea	($80000).l,a1
00006740 3038 F790                  		move.w	(v_btnpushtime1).w,d0
00006744 D2C0                       		adda.w	d0,a1
00006746 1038 F604                  		move.b	(v_jpadhold1).w,d0
0000674A B011                       		cmp.b	(a1),d0
0000674C 6600                       		bne.s	@next
0000674E 5229 0001                  		addq.b	#1,1(a1)
00006752 0C29 00FF 0001             		cmpi.b	#$FF,1(a1)
00006758 6700                       		beq.s	@next
0000675A 4E75                       		rts	
0000675C                            
0000675C                            	@next:
0000675C 1340 0002                  		move.b	d0,2(a1)
00006760 137C 0000 0003             		move.b	#0,3(a1)
00006766 5478 F790                  		addq.w	#2,(v_btnpushtime1).w
0000676A 0278 03FF F790             		andi.w	#$3FF,(v_btnpushtime1).w
00006770 4E75                       		rts	
00006772                            ; ===========================================================================
00006772                            
00006772                            MDemo_On:
00006772 4A38 F604                  		tst.b	(v_jpadhold1).w	; is start button pressed?
00006776 6A00                       		bpl.s	@dontquit	; if not, branch
00006778 4A78 FFF0                  		tst.w	(f_demo).w	; is this an ending sequence demo?
0000677C 6B00                       		bmi.s	@dontquit	; if yes, branch
0000677E 11FC 0000 F600             		move.b	#id_Title,(v_gamemode).w ; go to title screen
00006784                            
00006784                            	@dontquit:
00006784 43F9 0000 0000             		lea	(DemoDataPtr).l,a1
0000678A 7000                       		moveq	#0,d0
0000678C 1038 FE10                  		move.b	(v_zone).w,d0
00006790 0C38 0000 F600             		cmpi.b	#id_Special,(v_gamemode).w ; is this a special stage?
00006796 6600                       		bne.s	@notspecial	; if not, branch
00006798 7006                       		moveq	#6,d0		; use demo #6
0000679A                            
0000679A                            	@notspecial:
0000679A E548                       		lsl.w	#2,d0
0000679C 2271 0000                  		movea.l	(a1,d0.w),a1	; fetch address for demo data
000067A0 4A78 FFF0                  		tst.w	(f_demo).w	; is this an ending sequence demo?
000067A4 6A00                       		bpl.s	@notcredits	; if not, branch
000067A6 43F9 0000 0000             		lea	(DemoEndDataPtr).l,a1
000067AC 3038 FFF4                  		move.w	(v_creditsnum).w,d0
000067B0 5340                       		subq.w	#1,d0
000067B2 E548                       		lsl.w	#2,d0
000067B4 2271 0000                  		movea.l	(a1,d0.w),a1	; fetch address for credits demo
000067B8                            
000067B8                            	@notcredits:
000067B8 3038 F790                  		move.w	(v_btnpushtime1).w,d0
000067BC D2C0                       		adda.w	d0,a1
000067BE 1011                       		move.b	(a1),d0
000067C0 41F8 F604                  		lea	(v_jpadhold1).w,a0
000067C4 1200                       		move.b	d0,d1
000067C6 1428 FFFE                  		move.b -2(a0),d2
000067CA B500                       		eor.b	d2,d0
000067CC 10C1                       		move.b	d1,(a0)+
000067CE C001                       		and.b	d1,d0
000067D0 10C0                       		move.b	d0,(a0)+
000067D2 5338 F792                  		subq.b	#1,(v_btnpushtime2).w
000067D6 6400                       		bcc.s	@end
000067D8 11E9 0003 F792             		move.b	3(a1),(v_btnpushtime2).w
000067DE 5478 F790                  		addq.w	#2,(v_btnpushtime1).w
000067E2                            
000067E2                            	@end:
000067E2 4E75                       		rts	
000067E4                            ; End of function MoveSonicInDemo
000067E4                            
000067E4                            ; ===========================================================================
000067E4                            ; ---------------------------------------------------------------------------
000067E4                            ; Demo sequence	pointers
000067E4                            ; ---------------------------------------------------------------------------
000067E4 0000 0000                  DemoDataPtr:	dc.l Demo_GHZ		; demos run after the title screen
000067E8 0000 0000                  		dc.l Demo_GHZ
000067EC 0000 0000                  		dc.l Demo_LZ
000067F0 0000 0000                  		dc.l Demo_LZ
000067F4 0000 0000                  		dc.l Demo_MZ
000067F8 0000 0000                  		dc.l Demo_MZ
000067FC 0000 0000                  		dc.l Demo_SS
00006800 0000 0000                  		dc.l Demo_SS
00006804                            
00006804 0000 0000                  DemoEndDataPtr:	dc.l Demo_EndGHZ1	; demos run during the credits
00006808 0000 0000                  		dc.l Demo_EndMZ
0000680C 0000 0000                  		dc.l Demo_EndSYZ
00006810 0000 0000                  		dc.l Demo_EndLZ
00006814 0000 0000                  		dc.l Demo_EndSLZ
00006818 0000 0000                  		dc.l Demo_EndSBZ1
0000681C 0000 0000                  		dc.l Demo_EndSBZ2
00006820 0000 0000                  		dc.l Demo_EndGHZ2
00006824                            
00006824 008B 0837 0042 085C 006A+  		dc.b 0,	$8B, 8,	$37, 0,	$42, 8,	$5C, 0,	$6A, 8,	$5F, 0,	$2F, 8,	$2C
00006834 0021 0803 2830 0808 002E+  		dc.b 0,	$21, 8,	3, $28,	$30, 8,	8, 0, $2E, 8, $15, 0, $F, 8, $46
00006844 001A 08FF 08CA 0000 0000+  		dc.b 0,	$1A, 8,	$FF, 8,	$CA, 0,	0, 0, 0, 0, 0, 0, 0, 0,	0
00006854                            		even
00006854                            		even
00006854                            
00006854                            ; ---------------------------------------------------------------------------
00006854                            ; Collision index pointer loading subroutine
00006854                            ; ---------------------------------------------------------------------------
00006854                            
00006854                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00006854                            
00006854                            
00006854                            ColIndexLoad:
00006854 7000                       		moveq	#0,d0
00006856 1038 FE10                  		move.b	(v_zone).w,d0
0000685A E548                       		lsl.w	#2,d0
0000685C 21FB 0000 F796             		move.l	ColPointers(pc,d0.w),(v_collindex).w
00006862 4E75                       		rts	
00006864                            ; End of function ColIndexLoad
00006864                            
00006864                            ; ===========================================================================
00006864                            ; ---------------------------------------------------------------------------
00006864                            ; Collision index pointers
00006864                            ; ---------------------------------------------------------------------------
00006864 0000 0000                  ColPointers:	dc.l Col_GHZ
00006868 0000 0000                  		dc.l Col_LZ
0000686C 0000 0000                  		dc.l Col_MZ
00006870 0000 0000                  		dc.l Col_SLZ
00006874 0000 0000                  		dc.l Col_SYZ
00006878 0000 0000                  		dc.l Col_SBZ
0000687C 0000 0000                  		dc.l Col_FUN ; Pointer for Ending is missing by default.
00006880 0000 0000                  		dc.l Col_IMZ
00006884 0000 0000                  		dc.l Col_CSZ
00006888 0000 0000                  		dc.l Col_GHZ ; Pointer for Ending is missing by default.
0000688C 0000 0000                  		dc.l Col_GHZ ; Pointer for Ending is missing by default.
00006890                            
00006890                            		include	"_inc\Oscillatory Routines.asm"
00006890                            ; ---------------------------------------------------------------------------
00006890                            ; Oscillating number subroutines
00006890                            ; ---------------------------------------------------------------------------
00006890                            
00006890                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00006890                            
00006890                            ; Initialise the values
00006890                            
00006890                            OscillateNumInit:
00006890 43F8 FE5E                  		lea	(v_oscillate).w,a1
00006894 45F9 0000 0000             		lea	(@baselines).l,a2
0000689A 7220                       		moveq	#$20,d1
0000689C                            
0000689C                            	@loop:
0000689C 32DA                       		move.w	(a2)+,(a1)+	; copy baseline values to RAM
0000689E 51C9 FFFC                  		dbf	d1,@loop
000068A2 4E75                       		rts	
000068A4                            
000068A4                            
000068A4                            ; ===========================================================================
000068A4 007C                       @baselines:	dc.w %0000000001111100	; oscillation direction bitfield
000068A6 0080 0000                  		dc.w $80, 0
000068AA 0080 0000                  		dc.w $80, 0
000068AE 0080 0000                  		dc.w $80, 0
000068B2 0080 0000                  		dc.w $80, 0
000068B6 0080 0000                  		dc.w $80, 0
000068BA 0080 0000                  		dc.w $80, 0
000068BE 0080 0000                  		dc.w $80, 0
000068C2 0080 0000                  		dc.w $80, 0
000068C6 0080 0000                  		dc.w $80, 0
000068CA 50F0 011E                  		dc.w $50F0, $11E
000068CE 2080 00B4                  		dc.w $2080, $B4
000068D2 3080 010E                  		dc.w $3080, $10E
000068D6 5080 01C2                  		dc.w $5080, $1C2
000068DA 7080 0276                  		dc.w $7080, $276
000068DE 0080 0000                  		dc.w $80, 0
000068E2 0080 0000                  		dc.w $80, 0
000068E6                            		even
000068E6                            
000068E6                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
000068E6                            
000068E6                            ; Oscillate values
000068E6                            
000068E6                            OscillateNumDo:
000068E6 0C38 0006 D024             		cmpi.b	#6,(v_player+obRoutine).w ; has Sonic just died?
000068EC 6400                       		bcc.s	@end		; if yes, branch
000068EE 43F8 FE5E                  		lea	(v_oscillate).w,a1
000068F2 45F9 0000 0000             		lea	(@settings).l,a2
000068F8 3619                       		move.w	(a1)+,d3	; get oscillation direction bitfield
000068FA 720F                       		moveq	#$F,d1
000068FC                            
000068FC                            @loop:
000068FC 341A                       		move.w	(a2)+,d2	; get frequency
000068FE 381A                       		move.w	(a2)+,d4	; get amplitude
00006900 0303                       		btst	d1,d3		; check oscillation direction
00006902 6600                       		bne.s	@down		; branch if 1
00006904                            
00006904                            	@up:
00006904 3029 0002                  		move.w	2(a1),d0	; get current rate
00006908 D042                       		add.w	d2,d0		; add frequency
0000690A 3340 0002                  		move.w	d0,2(a1)
0000690E D169 0000                  		add.w	d0,0(a1)	; add rate to value
00006912 B829 0000                  		cmp.b	0(a1),d4
00006916 6200                       		bhi.s	@next
00006918 03C3                       		bset	d1,d3
0000691A 6000                       		bra.s	@next
0000691C                            
0000691C                            	@down:
0000691C 3029 0002                  		move.w	2(a1),d0
00006920 9042                       		sub.w	d2,d0
00006922 3340 0002                  		move.w	d0,2(a1)
00006926 D169 0000                  		add.w	d0,0(a1)
0000692A B829 0000                  		cmp.b	0(a1),d4
0000692E 6300                       		bls.s	@next
00006930 0383                       		bclr	d1,d3
00006932                            
00006932                            	@next:
00006932 5849                       		addq.w	#4,a1
00006934 51C9 FFC6                  		dbf	d1,@loop
00006938 31C3 FE5E                  		move.w	d3,(v_oscillate).w
0000693C                            
0000693C                            @end:
0000693C 4E75                       		rts	
0000693E                            ; End of function OscillateNumDo
0000693E                            
0000693E                            ; ===========================================================================
0000693E 0002 0010                  @settings:	dc.w 2,	$10	; frequency, amplitude
00006942 0002 0018                  		dc.w 2,	$18
00006946 0002 0020                  		dc.w 2,	$20
0000694A 0002 0030                  		dc.w 2,	$30
0000694E 0004 0020                  		dc.w 4,	$20
00006952 0008 0008                  		dc.w 8,	8
00006956 0008 0040                  		dc.w 8,	$40
0000695A 0004 0040                  		dc.w 4,	$40
0000695E 0002 0050                  		dc.w 2,	$50
00006962 0002 0050                  		dc.w 2,	$50
00006966 0002 0020                  		dc.w 2,	$20
0000696A 0003 0030                  		dc.w 3,	$30
0000696E 0005 0050                  		dc.w 5,	$50
00006972 0007 0070                  		dc.w 7,	$70
00006976 0002 0010                  		dc.w 2,	$10
0000697A 0002 0010                  		dc.w 2,	$10
0000697E                            		even
0000697E                            		even
0000697E                            
0000697E                            ; ---------------------------------------------------------------------------
0000697E                            ; Subroutine to	change synchronised animation variables (rings, giant rings)
0000697E                            ; ---------------------------------------------------------------------------
0000697E                            
0000697E                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
0000697E                            
0000697E                            
0000697E                            SynchroAnimate:
0000697E                            
0000697E                            ; Used for GHZ spiked log
0000697E                            Sync1:
0000697E 5338 FEC0                  		subq.b	#1,(v_ani0_time).w ; has timer reached 0?
00006982 6A00                       		bpl.s	Sync2		; if not, branch
00006984 11FC 000B FEC0             		move.b	#$B,(v_ani0_time).w ; reset timer
0000698A 5338 FEC1                  		subq.b	#1,(v_ani0_frame).w ; next frame
0000698E 0238 0007 FEC1             		andi.b	#7,(v_ani0_frame).w ; max frame is 7
00006994                            
00006994                            ; Used for rings and giant rings
00006994                            Sync2:
00006994 5338 FEC2                  		subq.b	#1,(v_ani1_time).w
00006998 6A00                       		bpl.s	Sync3
0000699A 11FC 0007 FEC2             		move.b	#7,(v_ani1_time).w
000069A0 5238 FEC3                  		addq.b	#1,(v_ani1_frame).w
000069A4 0238 0003 FEC3             		andi.b	#3,(v_ani1_frame).w
000069AA                            
000069AA                            ; Used for nothing
000069AA                            Sync3:
000069AA 5338 FEC4                  		subq.b	#1,(v_ani2_time).w
000069AE 6A00                       		bpl.s	Sync4
000069B0 11FC 0007 FEC4             		move.b	#7,(v_ani2_time).w
000069B6 5238 FEC5                  		addq.b	#1,(v_ani2_frame).w
000069BA 0C38 0006 FEC5             		cmpi.b	#6,(v_ani2_frame).w
000069C0 6500                       		blo.s	Sync4
000069C2 11FC 0000 FEC5             		move.b	#0,(v_ani2_frame).w
000069C8                            
000069C8                            ; Used for bouncing rings
000069C8                            Sync4:
000069C8 4A38 FEC6                  		tst.b	(v_ani3_time).w
000069CC 6700                       		beq.s	SyncEnd
000069CE 7000                       		moveq	#0,d0
000069D0 1038 FEC6                  		move.b	(v_ani3_time).w,d0
000069D4 D078 FEC8                  		add.w	(v_ani3_buf).w,d0
000069D8 31C0 FEC8                  		move.w	d0,(v_ani3_buf).w
000069DC EF58                       		rol.w	#7,d0
000069DE 0240 0003                  		andi.w	#3,d0
000069E2 11C0 FEC7                  		move.b	d0,(v_ani3_frame).w
000069E6 5338 FEC6                  		subq.b	#1,(v_ani3_time).w
000069EA                            
000069EA                            SyncEnd:
000069EA 4E75                       		rts	
000069EC                            ; End of function SynchroAnimate
000069EC                            
000069EC                            ; ---------------------------------------------------------------------------
000069EC                            ; End-of-act signpost pattern loading subroutine
000069EC                            ; ---------------------------------------------------------------------------
000069EC                            
000069EC                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
000069EC                            
000069EC                            
000069EC                            SignpostArtLoad:
000069EC 4A78 FE08                  		tst.w	(v_debuguse).w	; is debug mode	being used?
000069F0 6600 0000                  		bne.w	@exit		; if yes, branch
000069F4 0C38 0002 FE11             		cmpi.b	#2,(v_act).w	; is act number 02 (act 3)?
000069FA 6700                       		beq.s	@exit		; if yes, branch
000069FC                            
000069FC 3038 F700                  		move.w	(v_screenposx).w,d0
00006A00 3238 F72A                  		move.w	(v_limitright2).w,d1
00006A04 0441 0100                  		subi.w	#$100,d1
00006A08 B041                       		cmp.w	d1,d0		; has Sonic reached the	edge of	the level?
00006A0A 6D00                       		blt.s	@exit		; if not, branch
00006A0C 4A38 FE1E                  		tst.b	(f_timecount).w
00006A10 6700                       		beq.s	@exit
00006A12 B278 F728                  		cmp.w	(v_limitleft2).w,d1
00006A16 6700                       		beq.s	@exit
00006A18 31C1 F728                  		move.w	d1,(v_limitleft2).w ; move left boundary to current screen position
00006A1C 7000                       		moveq	#plcid_Signpost,d0
00006A1E 6000 CB08                  		bra.w	NewPLC		; load signpost	patterns
00006A22                            
00006A22                            	@exit:
00006A22 4E75                       		rts	
00006A24                            ; End of function SignpostArtLoad
00006A24                            
00006A24                            ; ===========================================================================
00006A24                            Demo_GHZ:	incbin	"demodata\Intro - GHZ.bin"
00006A84                            Demo_LZ:	incbin	"demodata\Intro - LZ.bin"
00006B44                            Demo_MZ:	incbin	"demodata\Intro - MZ.bin"
00006C04                            Demo_SS:	incbin	"demodata\Intro - Special Stage.bin"
00006C74                            ; ===========================================================================
00006C74                            
00006C74                            ; ---------------------------------------------------------------------------
00006C74                            ; Special Stage
00006C74                            ; ---------------------------------------------------------------------------
00006C74                            
00006C74                            GM_Special:
00006C7C 6100 D4A6                  		bsr.w	PaletteWhiteOut
00006C80 46FC 2700                  		disable_ints
00006C84 4DF9 00C0 0004             		lea	(vdp_control_port).l,a6
00006C8A 3CBC 8B03                  		move.w	#$8B03,(a6)	; line scroll mode
00006C8E 3CBC 8004                  		move.w	#$8004,(a6)	; 8-colour mode
00006C92 31FC 8AAF F624             		move.w	#$8A00+175,(v_hbla_hreg).w
00006C98 3CBC 9011                  		move.w	#$9011,(a6)	; 128-cell hscroll size
00006C9C 3038 F60C                  		move.w	(v_vdp_buffer1).w,d0
00006CA0 0200 00BF                  		andi.b	#$BF,d0
00006CA4 33C0 00C0 0004             		move.w	d0,(vdp_control_port).l
00006CAA 6100 C59A                  		bsr.w	ClearScreen
00006CAE 46FC 2300                  		enable_ints
00006CB2 4BF9 00C0 0004 3ABC 8F01+  		fillVRAM	0,$6FFF,$5000
00006CD4                            
00006CD4                            	SS_WaitForDMA:
00006CD4 3215                       		move.w	(a5),d1		; read control port ($C00004)
00006CD6 0801 0001                  		btst	#1,d1		; is DMA running?
00006CDA 66F8                       		bne.s	SS_WaitForDMA	; if yes, branch
00006CDC 3ABC 8F02                  		move.w	#$8F02,(a5)	; set VDP increment to 2 bytes
00006CE0 6100 0000                  		bsr.w	SS_BGLoad
00006CE4 7000                       		moveq	#plcid_SpecialStage,d0
00006CE6 6100 C97A                  		bsr.w	QuickPLC	; load special stage patterns
00006CEA                            
00006CEA 43F8 D000                  		lea	(v_objspace).w,a1
00006CEE 7000                       		moveq	#0,d0
00006CF0 323C 07FF                  		move.w	#$7FF,d1
00006CF4                            	SS_ClrObjRam:
00006CF4 22C0                       		move.l	d0,(a1)+
00006CF6 51C9 FFFC                  		dbf	d1,SS_ClrObjRam	; clear	the object RAM
00006CFA                            
00006CFA 43F8 F700                  		lea	(v_screenposx).w,a1
00006CFE 7000                       		moveq	#0,d0
00006D00 323C 003F                  		move.w	#$3F,d1
00006D04                            	SS_ClrRam1:
00006D04 22C0                       		move.l	d0,(a1)+
00006D06 51C9 FFFC                  		dbf	d1,SS_ClrRam1	; clear	variables
00006D0A                            
00006D0A 43F8 FE60                  		lea	(v_oscillate+2).w,a1
00006D0E 7000                       		moveq	#0,d0
00006D10 323C 0027                  		move.w	#$27,d1
00006D14                            	SS_ClrRam2:
00006D14 22C0                       		move.l	d0,(a1)+
00006D16 51C9 FFFC                  		dbf	d1,SS_ClrRam2	; clear	variables
00006D1A                            
00006D1A 43F8 AA00                  		lea	(v_ngfx_buffer).w,a1
00006D1E 7000                       		moveq	#0,d0
00006D20 323C 007F                  		move.w	#$7F,d1
00006D24                            	SS_ClrNemRam:
00006D24 22C0                       		move.l	d0,(a1)+
00006D26 51C9 FFFC                  		dbf	d1,SS_ClrNemRam	; clear	Nemesis	buffer
00006D2A                            
00006D2A 4238 F64E                  		clr.b	(f_wtr_state).w
00006D2E 4278 FE02                  		clr.w	(f_restart).w
00006D32 700B                       		moveq	#palid_Special,d0
00006D34 6100 D4BC                  		bsr.w	PalLoad1	; load special stage palette
00006D38 4EB9 0000 0000             		jsr	(SS_Load).l		; load SS layout data
00006D3E 21FC 0000 0000 F700        		move.l	#0,(v_screenposx).w
00006D46 21FC 0000 0000 F704        		move.l	#0,(v_screenposy).w
00006D4E 11FC 0000 D000             		move.b	#id_SonicSpecial,(v_player).w ; load special stage Sonic object
00006D54 6100 0000                  		bsr.w	PalCycle_SS
00006D58 4278 F780                  		clr.w	(v_ssangle).w	; set stage angle to "upright"
00006D5C 31FC 0040 F782             		move.w	#$40,(v_ssrotate).w ; set stage rotation speed
00006D6A 31FC 0000 F790             		move.w	#0,(v_btnpushtime1).w
00006D70 43F9 0000 67E4             		lea	(DemoDataPtr).l,a1
00006D76 7006                       		moveq	#6,d0
00006D78 E548                       		lsl.w	#2,d0
00006D7A 2271 0000                  		movea.l	(a1,d0.w),a1
00006D7E 11E9 0001 F792             		move.b	1(a1),(v_btnpushtime2).w
00006D84 5338 F792                  		subq.b	#1,(v_btnpushtime2).w
00006D88 4278 FE20                  		clr.w	(v_rings).w
00006D8C 4238 FE1B                  		clr.b	(v_lifecount).w
00006D90 31FC 0000 FE08             		move.w	#0,(v_debuguse).w
00006D96 31FC 0708 F614             		move.w	#1800,(v_demolength).w
00006D9C 4A38 FFE2                  		tst.b	(f_debugcheat).w ; has debug cheat been entered?
00006DA0 6700                       		beq.s	SS_NoDebug	; if not, branch
00006DA2 0838 0006 F604             		btst	#bitA,(v_jpadhold1).w ; is A button pressed?
00006DA8 6700                       		beq.s	SS_NoDebug	; if not, branch
00006DAA 11FC 0001 FFFA             		move.b	#1,(f_debugmode).w ; enable debug mode
00006DB0                            
00006DB0                            	SS_NoDebug:
00006DB0 3038 F60C                  		move.w	(v_vdp_buffer1).w,d0
00006DB4 0000 0040                  		ori.b	#$40,d0
00006DB8 33C0 00C0 0004             		move.w	d0,(vdp_control_port).l
00006DBE 6100 D2B8                  		bsr.w	PaletteWhiteIn
00006DC2                            
00006DC2                            ; ---------------------------------------------------------------------------
00006DC2                            ; Main Special Stage loop
00006DC2                            ; ---------------------------------------------------------------------------
00006DC2                            
00006DC2                            SS_MainLoop:
00006DC2 6100 C566                  		bsr.w	PauseGame
00006DC6 11FC 000A F62A             		move.b	#$A,(v_vbla_routine).w
00006DCC 6100 DE50                  		bsr.w	WaitForVBla
00006DD0 6100 F960                  		bsr.w	MoveSonicInDemo
00006DD4 31F8 F604 F602             		move.w	(v_jpadhold1).w,(v_jpadhold2).w
00006DDA 4EB9 0000 0000             		jsr	(ExecuteObjects).l
00006DE0 4EB9 0000 0000             		jsr	(BuildSprites).l
00006DE6 4EB9 0000 0000             		jsr	(SS_ShowLayout).l
00006DEC 6100 0000                  		bsr.w	SS_BGAnimate
00006DF0 4A78 FFF0                  		tst.w	(f_demo).w	; is demo mode on?
00006DF4 6700                       		beq.s	SS_ChkEnd	; if not, branch
00006DF6 4A78 F614                  		tst.w	(v_demolength).w ; is there time left on the demo?
00006DFA 6700 0000                  		beq.w	SS_ToSegaScreen	; if not, branch
00006DFE                            
00006DFE                            	SS_ChkEnd:
00006DFE 0C38 0000 F600             		cmpi.b	#id_Special,(v_gamemode).w ; is game mode $10 (special stage)?
00006E04 6700 FFBC                  		beq.w	SS_MainLoop	; if yes, branch
00006E08                            
00006E08 4A78 FFF0                  		tst.w	(f_demo).w	; is demo mode on?
00006E0C 6600 0000                  		bne.w	SS_ToSegaScreen	; if yes, branch
00006E10 11FC 0000 F600             		move.b	#id_Level,(v_gamemode).w ; set screen mode to $0C (level)
00006E16 0C78 0503 FE10             		cmpi.w	#(id_CWZ<<8)+3,(v_zone).w ; is level number higher than FZ?
00006E1C 6500                       		blo.s	SS_Finish	; if not, branch
00006E1E 4278 FE10                  		clr.w	(v_zone).w	; set to GHZ1
00006E22                            
00006E22                            SS_Finish:
00006E22 31FC 003C F614             		move.w	#60,(v_demolength).w ; set delay time to 1 second
00006E28 31FC 003F F626             		move.w	#$3F,(v_pfade_start).w
00006E2E 4278 F794                  		clr.w	(v_palchgspeed).w
00006E32                            
00006E32                            	SS_FinLoop:
00006E32 11FC 0016 F62A             		move.b	#$16,(v_vbla_routine).w
00006E38 6100 DDE4                  		bsr.w	WaitForVBla
00006E3C 6100 F8F4                  		bsr.w	MoveSonicInDemo
00006E40 31F8 F604 F602             		move.w	(v_jpadhold1).w,(v_jpadhold2).w
00006E46 4EB9 0000 0000             		jsr	(ExecuteObjects).l
00006E4C 4EB9 0000 0000             		jsr	(BuildSprites).l
00006E52 4EB9 0000 0000             		jsr	(SS_ShowLayout).l
00006E58 6100 0000                  		bsr.w	SS_BGAnimate
00006E5C 5378 F794                  		subq.w	#1,(v_palchgspeed).w
00006E60 6A00                       		bpl.s	loc_47D4
00006E62 31FC 0002 F794             		move.w	#2,(v_palchgspeed).w
00006E68 6100 D2DA                  		bsr.w	WhiteOut_ToWhite
00006E6C                            
00006E6C                            loc_47D4:
00006E6C 4A78 F614                  		tst.w	(v_demolength).w
00006E70 66C0                       		bne.s	SS_FinLoop
00006E72                            
00006E72 46FC 2700                  		disable_ints
00006E76 4DF9 00C0 0004             		lea	(vdp_control_port).l,a6
00006E7C 3CBC 8230                  		move.w	#$8200+(vram_fg>>10),(a6) ; set foreground nametable address
00006E80 3CBC 8407                  		move.w	#$8400+(vram_bg>>13),(a6) ; set background nametable address
00006E84 3CBC 9001                  		move.w	#$9001,(a6)		; 64-cell hscroll size
00006E88 6100 C3BC                  		bsr.w	ClearScreen
00006E96 41F9 0000 0000             		lea	(Nem_TitleCard_Spec).l,a0 ; load title card patterns
00006E9C 6100 C52E                  		bsr.w	NemDec
00006EA0 4EB9 0000 0000             		jsr	(Hud_Base).l
00006EA6 46FC 2300                  		enable_ints
00006EAA 7012                       		moveq	#palid_SSResult,d0
00006EAC 6100 D360                  		bsr.w	PalLoad2	; load results screen palette
00006EB0 7000                       		moveq	#plcid_Main,d0
00006EB2 6100 C674                  		bsr.w	NewPLC
00006EB6 7000                       		moveq	#plcid_SSResult,d0
00006EB8 6100 C63C                  		bsr.w	AddPLC		; load results screen patterns
00006EBC 11FC 0001 FE1F             		move.b	#1,(f_scorecount).w ; update score counter
00006EC2 11FC 0001 F7D6             		move.b	#1,(f_endactbonus).w ; update ring bonus counter
00006EC8 3038 FE20                  		move.w	(v_rings).w,d0
00006ECC C0FC 000A                  		mulu.w	#10,d0		; multiply rings by 10
00006ED0 31C0 F7D4                  		move.w	d0,(v_ringbonus).w ; set rings bonus
00006EDE                            
00006EDE 43F8 D000                  		lea	(v_objspace).w,a1
00006EE2 7000                       		moveq	#0,d0
00006EE4 323C 07FF                  		move.w	#$7FF,d1
00006EE8                            	SS_EndClrObjRam:
00006EE8 22C0                       		move.l	d0,(a1)+
00006EEA 51C9 FFFC                  		dbf	d1,SS_EndClrObjRam ; clear object RAM
00006EEE                            
00006EEE 11FC 0000 D5C0             		move.b	#id_SSResult,(v_objspace+$5C0).w ; load results screen object
00006EF4                            
00006EF4                            SS_NormalExit:
00006EF4 6100 C434                  		bsr.w	PauseGame
00006EF8 11FC 000C F62A             		move.b	#$C,(v_vbla_routine).w
00006EFE 6100 DD1E                  		bsr.w	WaitForVBla
00006F02 4EB9 0000 0000             		jsr	(ExecuteObjects).l
00006F08 4EB9 0000 0000             		jsr	(BuildSprites).l
00006F0E 6100 C652                  		bsr.w	RunPLC
00006F12 4A78 FE02                  		tst.w	(f_restart).w
00006F16 67DC                       		beq.s	SS_NormalExit
00006F18 4AB8 F680                  		tst.l	(v_plc_buffer).w
00006F1C 66D6                       		bne.s	SS_NormalExit
00006F26 6100 D1FC                  		bsr.w	PaletteWhiteOut
00006F2A 4E75                       		rts	
00006F2C                            ; ===========================================================================
00006F2C                            
00006F2C                            SS_ToSegaScreen:
00006F2C 11FC 0000 F600             		move.b	#id_Sega,(v_gamemode).w ; goto Sega screen
00006F32 4E75                       		rts
00006F34                            
00006F34                            
00006F34                            ; ---------------------------------------------------------------------------
00006F34                            ; Special stage	background loading subroutine
00006F34                            ; ---------------------------------------------------------------------------
00006F34                            
00006F34                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00006F34                            
00006F34                            
00006F34                            SS_BGLoad:
00006F34 43F9 00FF 0000             		lea	($FF0000).l,a1
00006F3A 41F9 0000 0000             		lea	(Eni_SSBg1).l,a0 ; load	mappings for the birds and fish
00006F40 303C 4051                  		move.w	#$4051,d0
00006F44 6100 C74E                  		bsr.w	EniDec
00006F48 263C 5000 0001             		move.l	#$50000001,d3
00006F4E 45F9 00FF 0080             		lea	($FF0080).l,a2
00006F54 7E06                       		moveq	#6,d7
00006F56                            
00006F56                            loc_48BE:
00006F56 2003                       		move.l	d3,d0
00006F58 7C03                       		moveq	#3,d6
00006F5A 7800                       		moveq	#0,d4
00006F5C 0C47 0003                  		cmpi.w	#3,d7
00006F60 6400                       		bhs.s	loc_48CC
00006F62 7801                       		moveq	#1,d4
00006F64                            
00006F64                            loc_48CC:
00006F64 7A07                       		moveq	#7,d5
00006F66                            
00006F66                            loc_48CE:
00006F66 224A                       		movea.l	a2,a1
00006F68 0A04 0001                  		eori.b	#1,d4
00006F6C 6600                       		bne.s	loc_48E2
00006F6E 0C47 0006                  		cmpi.w	#6,d7
00006F72 6600                       		bne.s	loc_48F2
00006F74 43F9 00FF 0000             		lea	($FF0000).l,a1
00006F7A                            
00006F7A                            loc_48E2:
00006F7A 48E7 F800                  		movem.l	d0-d4,-(sp)
00006F7E 7207                       		moveq	#7,d1
00006F80 7407                       		moveq	#7,d2
00006F82 6100 C41E                  		bsr.w	TilemapToVRAM
00006F86 4CDF 001F                  		movem.l	(sp)+,d0-d4
00006F8A                            
00006F8A                            loc_48F2:
00006F8A 0680 0010 0000             		addi.l	#$100000,d0
00006F90 51CD FFD4                  		dbf	d5,loc_48CE
00006F94 0680 0380 0000             		addi.l	#$3800000,d0
00006F9A 0A04 0001                  		eori.b	#1,d4
00006F9E 51CE FFC4                  		dbf	d6,loc_48CC
00006FA2 0683 1000 0000             		addi.l	#$10000000,d3
00006FA8 6A00                       		bpl.s	loc_491C
00006FAA 4843                       		swap	d3
00006FAC 0683 0000 C000             		addi.l	#$C000,d3
00006FB2 4843                       		swap	d3
00006FB4                            
00006FB4                            loc_491C:
00006FB4 D4FC 0080                  		adda.w	#$80,a2
00006FB8 51CF FF9C                  		dbf	d7,loc_48BE
00006FBC 43F9 00FF 0000             		lea	($FF0000).l,a1
00006FC2 41F9 0000 0000             		lea	(Eni_SSBg2).l,a0 ; load	mappings for the clouds
00006FC8 303C 4000                  		move.w	#$4000,d0
00006FCC 6100 C6C6                  		bsr.w	EniDec
00006FD0 43F9 00FF 0000             		lea	($FF0000).l,a1
00006FD6 203C 4000 0003             		move.l	#$40000003,d0
00006FDC 723F                       		moveq	#$3F,d1
00006FDE 741F                       		moveq	#$1F,d2
00006FE0 6100 C3C0                  		bsr.w	TilemapToVRAM
00006FE4 43F9 00FF 0000             		lea	($FF0000).l,a1
00006FEA 203C 5000 0003             		move.l	#$50000003,d0
00006FF0 723F                       		moveq	#$3F,d1
00006FF2 743F                       		moveq	#$3F,d2
00006FF4 6100 C3AC                  		bsr.w	TilemapToVRAM
00006FF8 4E75                       		rts	
00006FFA                            ; End of function SS_BGLoad
00006FFA                            
00006FFA                            ; ---------------------------------------------------------------------------
00006FFA                            ; Palette cycling routine - special stage
00006FFA                            ; ---------------------------------------------------------------------------
00006FFA                            
00006FFA                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00006FFA                            
00006FFA                            
00006FFA                            PalCycle_SS:
00006FFA 4A78 F63A                  		tst.w	(f_pause).w
00006FFE 6600                       		bne.s	locret_49E6
00007000 5378 F79C                  		subq.w	#1,(v_palss_time).w
00007004 6A00                       		bpl.s	locret_49E6
00007006 4DF9 00C0 0004             		lea	(vdp_control_port).l,a6
0000700C 3038 F79A                  		move.w	(v_palss_num).w,d0
00007010 5278 F79A                  		addq.w	#1,(v_palss_num).w
00007014 0240 001F                  		andi.w	#$1F,d0
00007018 E548                       		lsl.w	#2,d0
0000701A 41F9 0000 0000             		lea	(byte_4A3C).l,a0
00007020 D0C0                       		adda.w	d0,a0
00007022 1018                       		move.b	(a0)+,d0
00007024 6A00                       		bpl.s	loc_4992
00007026 303C 01FF                  		move.w	#$1FF,d0
0000702A                            
0000702A                            loc_4992:
0000702A 31C0 F79C                  		move.w	d0,(v_palss_time).w
0000702E 7000                       		moveq	#0,d0
00007030 1018                       		move.b	(a0)+,d0
00007032 31C0 F7A0                  		move.w	d0,($FFFFF7A0).w
00007036 43F9 0000 0000             		lea	(byte_4ABC).l,a1
0000703C 43F1 0000                  		lea	(a1,d0.w),a1
00007040 303C 8200                  		move.w	#-$7E00,d0
00007044 1019                       		move.b	(a1)+,d0
00007046 3C80                       		move.w	d0,(a6)
00007048 11D1 F616                  		move.b	(a1),(v_scrposy_dup).w
0000704C 303C 8400                  		move.w	#-$7C00,d0
00007050 1018                       		move.b	(a0)+,d0
00007052 3C80                       		move.w	d0,(a6)
00007054 23FC 4000 0010 00C0 0004   		move.l	#$40000010,(vdp_control_port).l
0000705E 23F8 F616 00C0 0000        		move.l	(v_scrposy_dup).w,(vdp_data_port).l
00007066 7000                       		moveq	#0,d0
00007068 1018                       		move.b	(a0)+,d0
0000706A 6B00                       		bmi.s	loc_49E8
0000706C 43F9 0000 0000             		lea	(Pal_SSCyc1).l,a1
00007072 D2C0                       		adda.w	d0,a1
00007074 45F8 FB4E                  		lea	(v_pal_dry+$4E).w,a2
00007078 24D9                       		move.l	(a1)+,(a2)+
0000707A 24D9                       		move.l	(a1)+,(a2)+
0000707C 24D9                       		move.l	(a1)+,(a2)+
0000707E                            
0000707E                            locret_49E6:
0000707E 4E75                       		rts	
00007080                            ; ===========================================================================
00007080                            
00007080                            loc_49E8:
00007080 3238 F79E                  		move.w	($FFFFF79E).w,d1
00007084 0C40 008A                  		cmpi.w	#$8A,d0
00007088 6500                       		blo.s	loc_49F4
0000708A 5241                       		addq.w	#1,d1
0000708C                            
0000708C                            loc_49F4:
0000708C C2FC 002A                  		mulu.w	#$2A,d1
00007090 43F9 0000 0000             		lea	(Pal_SSCyc2).l,a1
00007096 D2C1                       		adda.w	d1,a1
00007098 0240 007F                  		andi.w	#$7F,d0
0000709C 0880 0000                  		bclr	#0,d0
000070A0 6700                       		beq.s	loc_4A18
000070A2 45F8 FB6E                  		lea	(v_pal_dry+$6E).w,a2
000070A6 24D1                       		move.l	(a1),(a2)+
000070A8 24E9 0004                  		move.l	4(a1),(a2)+
000070AC 24E9 0008                  		move.l	8(a1),(a2)+
000070B0                            
000070B0                            loc_4A18:
000070B0 D2FC 000C                  		adda.w	#$C,a1
000070B4 45F8 FB5A                  		lea	(v_pal_dry+$5A).w,a2
000070B8 0C40 000A                  		cmpi.w	#$A,d0
000070BC 6500                       		blo.s	loc_4A2E
000070BE 0440 000A                  		subi.w	#$A,d0
000070C2 45F8 FB7A                  		lea	(v_pal_dry+$7A).w,a2
000070C6                            
000070C6                            loc_4A2E:
000070C6 3200                       		move.w	d0,d1
000070C8 D040                       		add.w	d0,d0
000070CA D041                       		add.w	d1,d0
000070CC D2C0                       		adda.w	d0,a1
000070CE 24D9                       		move.l	(a1)+,(a2)+
000070D0 34D9                       		move.w	(a1)+,(a2)+
000070D2 4E75                       		rts	
000070D4                            ; End of function PalCycle_SS
000070D4                            
000070D4                            ; ===========================================================================
000070D4 0300 0792 0300 0790 0300+  byte_4A3C:	dc.b 3,	0, 7, $92, 3, 0, 7, $90, 3, 0, 7, $8E, 3, 0, 7,	$8C
000070E4                            
000070E4 0300 078B 0300 0780 0300+  		dc.b 3,	0, 7, $8B, 3, 0, 7, $80, 3, 0, 7, $82, 3, 0, 7,	$84
000070F4 0300 0786 0300 0788 0708+  		dc.b 3,	0, 7, $86, 3, 0, 7, $88, 7, 8, 7, 0, 7,	$A, 7, $C
00007104 FF0C 0718 FF0C 0718 070A+  		dc.b $FF, $C, 7, $18, $FF, $C, 7, $18, 7, $A, 7, $C, 7,	8, 7, 0
00007114 0300 0688 0300 0686 0300+  		dc.b 3,	0, 6, $88, 3, 0, 6, $86, 3, 0, 6, $84, 3, 0, 6,	$82
00007124 0300 0681 0300 068A 0300+  		dc.b 3,	0, 6, $81, 3, 0, 6, $8A, 3, 0, 6, $8C, 3, 0, 6,	$8E
00007134 0300 0690 0300 0692 0702+  		dc.b 3,	0, 6, $90, 3, 0, 6, $92, 7, 2, 6, $24, 7, 4, 6,	$30
00007144 FF06 063C FF06 063C 0704+  		dc.b $FF, 6, 6,	$3C, $FF, 6, 6,	$3C, 7,	4, 6, $30, 7, 2, 6, $24
00007154                            		even
00007154 1001 1800 1801 2000 2001+  byte_4ABC:	dc.b $10, 1, $18, 0, $18, 1, $20, 0, $20, 1, $28, 0, $28, 1
00007162                            		even
00007162                            
00007162                            Pal_SSCyc1:	incbin	"palette\Cycle - Special Stage 1.bin"
000071AA                            		even
000071AA                            Pal_SSCyc2:	incbin	"palette\Cycle - Special Stage 2.bin"
0000727C                            		even
0000727C                            
0000727C                            ; ---------------------------------------------------------------------------
0000727C                            ; Subroutine to	make the special stage background animated
0000727C                            ; ---------------------------------------------------------------------------
0000727C                            
0000727C                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
0000727C                            
0000727C                            
0000727C                            SS_BGAnimate:
0000727C 3038 F7A0                  		move.w	($FFFFF7A0).w,d0
00007280 6600                       		bne.s	loc_4BF6
00007282 31FC 0000 F70C             		move.w	#0,(v_bgscreenposy).w
00007288 31F8 F70C F618             		move.w	(v_bgscreenposy).w,(v_bgscrposy_dup).w
0000728E                            
0000728E                            loc_4BF6:
0000728E 0C40 0008                  		cmpi.w	#8,d0
00007292 6400                       		bhs.s	loc_4C4E
00007294 0C40 0006                  		cmpi.w	#6,d0
00007298 6600                       		bne.s	loc_4C10
0000729A 5278 F718                  		addq.w	#1,(v_bg3screenposx).w
0000729E 5278 F70C                  		addq.w	#1,(v_bgscreenposy).w
000072A2 31F8 F70C F618             		move.w	(v_bgscreenposy).w,(v_bgscrposy_dup).w
000072A8                            
000072A8                            loc_4C10:
000072A8 7000                       		moveq	#0,d0
000072AA 3038 F708                  		move.w	(v_bgscreenposx).w,d0
000072AE 4440                       		neg.w	d0
000072B0 4840                       		swap	d0
000072B2 43F9 0000 0000             		lea	(byte_4CCC).l,a1
000072B8 47F8 AA00                  		lea	(v_ngfx_buffer).w,a3
000072BC 7609                       		moveq	#9,d3
000072BE                            
000072BE                            loc_4C26:
000072BE 302B 0002                  		move.w	2(a3),d0
000072C2 6100 D98C                  		bsr.w	CalcSine
000072C6 7400                       		moveq	#0,d2
000072C8 1419                       		move.b	(a1)+,d2
000072CA C1C2                       		muls.w	d2,d0
000072CC E080                       		asr.l	#8,d0
000072CE 36C0                       		move.w	d0,(a3)+
000072D0 1419                       		move.b	(a1)+,d2
000072D2 4882                       		ext.w	d2
000072D4 D55B                       		add.w	d2,(a3)+
000072D6 51CB FFE6                  		dbf	d3,loc_4C26
000072DA 47F8 AA00                  		lea	(v_ngfx_buffer).w,a3
000072DE 45F9 0000 0000             		lea	(byte_4CB8).l,a2
000072E4 6000                       		bra.s	loc_4C7E
000072E6                            ; ===========================================================================
000072E6                            
000072E6                            loc_4C4E:
000072E6 0C40 000C                  		cmpi.w	#$C,d0
000072EA 6600                       		bne.s	loc_4C74
000072EC 5378 F718                  		subq.w	#1,(v_bg3screenposx).w
000072F0 47F8 AB00                  		lea	($FFFFAB00).w,a3
000072F4 243C 0001 8000             		move.l	#$18000,d2
000072FA 7206                       		moveq	#6,d1
000072FC                            
000072FC                            loc_4C64:
000072FC 2013                       		move.l	(a3),d0
000072FE 9082                       		sub.l	d2,d0
00007300 26C0                       		move.l	d0,(a3)+
00007302 0482 0000 2000             		subi.l	#$2000,d2
00007308 51C9 FFF2                  		dbf	d1,loc_4C64
0000730C                            
0000730C                            loc_4C74:
0000730C 47F8 AB00                  		lea	($FFFFAB00).w,a3
00007310 45F9 0000 0000             		lea	(byte_4CC4).l,a2
00007316                            
00007316                            loc_4C7E:
00007316 43F8 CC00                  		lea	(v_hscrolltablebuffer).w,a1
0000731A 3038 F718                  		move.w	(v_bg3screenposx).w,d0
0000731E 4440                       		neg.w	d0
00007320 4840                       		swap	d0
00007322 7600                       		moveq	#0,d3
00007324 161A                       		move.b	(a2)+,d3
00007326 3438 F70C                  		move.w	(v_bgscreenposy).w,d2
0000732A 4442                       		neg.w	d2
0000732C 0242 00FF                  		andi.w	#$FF,d2
00007330 E54A                       		lsl.w	#2,d2
00007332                            
00007332                            loc_4C9A:
00007332 301B                       		move.w	(a3)+,d0
00007334 544B                       		addq.w	#2,a3
00007336 7200                       		moveq	#0,d1
00007338 121A                       		move.b	(a2)+,d1
0000733A 5341                       		subq.w	#1,d1
0000733C                            
0000733C                            loc_4CA4:
0000733C 2380 2000                  		move.l	d0,(a1,d2.w)
00007340 5842                       		addq.w	#4,d2
00007342 0242 03FC                  		andi.w	#$3FC,d2
00007346 51C9 FFF4                  		dbf	d1,loc_4CA4
0000734A 51CB FFE6                  		dbf	d3,loc_4C9A
0000734E 4E75                       		rts	
00007350                            ; End of function SS_BGAnimate
00007350                            
00007350                            ; ===========================================================================
00007350 0928 1810 2818 1030 1808+  byte_4CB8:	dc.b 9,	$28, $18, $10, $28, $18, $10, $30, $18,	8, $10,	0
0000735C                            		even
0000735C 0630 3030 2818 1818        byte_4CC4:	dc.b 6,	$30, $30, $30, $28, $18, $18, $18
00007364                            		even
00007364 0802 04FF 0203 08FF 0402+  byte_4CCC:	dc.b 8,	2, 4, $FF, 2, 3, 8, $FF, 4, 2, 2, 3, 8,	$FD, 4,	2, 2, 3, 2, $FF
00007378                            		even
00007378                            
00007378                            ; ===========================================================================
00007378                            
00007378                            ; ---------------------------------------------------------------------------
00007378                            ; Continue screen
00007378                            ; ---------------------------------------------------------------------------
00007378                            
00007378                            GM_Continue:
00007378 6100 CC80                  		bsr.w	PaletteFadeOut
0000737C 46FC 2700                  		disable_ints
00007380 3038 F60C                  		move.w	(v_vdp_buffer1).w,d0
00007384 0200 00BF                  		andi.b	#$BF,d0
00007388 33C0 00C0 0004             		move.w	d0,(vdp_control_port).l
0000738E 4DF9 00C0 0004             		lea	(vdp_control_port).l,a6
00007394 3CBC 8004                  		move.w	#$8004,(a6)	; 8 colour mode
00007398 3CBC 8700                  		move.w	#$8700,(a6)	; background colour
0000739C 6100 BEA8                  		bsr.w	ClearScreen
000073A0                            
000073A0 43F8 D000                  		lea	(v_objspace).w,a1
000073A4 7000                       		moveq	#0,d0
000073A6 323C 07FF                  		move.w	#$7FF,d1
000073AA                            	Cont_ClrObjRam:
000073AA 22C0                       		move.l	d0,(a1)+
000073AC 51C9 FFFC                  		dbf	d1,Cont_ClrObjRam ; clear object RAM
000073B0                            
000073BA 41F9 0000 0000             		lea	(Nem_TitleCard).l,a0 ; load title card patterns
000073C0 6100 C00A                  		bsr.w	NemDec
000073CE 41F9 0000 0000             		lea	(Nem_ContSonic).l,a0 ; load Sonic patterns
000073D4 6100 BFF6                  		bsr.w	NemDec
000073E2 41F9 0000 0000             		lea	(Nem_MiniSonic).l,a0 ; load continue screen patterns
000073E8 6100 BFE2                  		bsr.w	NemDec
000073EC 720A                       		moveq	#10,d1
000073EE 4EB9 0000 0000             		jsr	(ContScrCounter).l	; run countdown	(start from 10)
000073F4 7013                       		moveq	#palid_Continue,d0
000073F6 6100 CDFA                  		bsr.w	PalLoad1	; load continue	screen palette
00007402 31FC 0293 F614             		move.w	#659,(v_demolength).w ; set time delay to 11 seconds
00007408 42B8 F700                  		clr.l	(v_screenposx).w
0000740C 21FC 0100 0000 F704        		move.l	#$1000000,(v_screenposy).w
00007414 11FC 0000 D000             		move.b	#id_ContSonic,(v_player).w ; load Sonic object
0000741A 11FC 0000 D040             		move.b	#id_ContScrItem,(v_objspace+$40).w ; load continue screen objects
00007420 11FC 0000 D080             		move.b	#id_ContScrItem,(v_objspace+$80).w
00007426 11FC 0003 D098             		move.b	#3,(v_objspace+$80+obPriority).w
0000742C 11FC 0004 D09A             		move.b	#4,(v_objspace+$80+obFrame).w
00007432 11FC 0000 D0C0             		move.b	#id_ContScrItem,(v_objspace+$C0).w
00007438 11FC 0004 D0E4             		move.b	#4,(v_objspace+$C0+obRoutine).w
0000743E 4EB9 0000 0000             		jsr	(ExecuteObjects).l
00007444 4EB9 0000 0000             		jsr	(BuildSprites).l
0000744A 3038 F60C                  		move.w	(v_vdp_buffer1).w,d0
0000744E 0000 0040                  		ori.b	#$40,d0
00007452 33C0 00C0 0004             		move.w	d0,(vdp_control_port).l
00007458 6100 CAFA                  		bsr.w	PaletteFadeIn
0000745C                            
0000745C                            ; ---------------------------------------------------------------------------
0000745C                            ; Continue screen main loop
0000745C                            ; ---------------------------------------------------------------------------
0000745C                            
0000745C                            Cont_MainLoop:
0000745C 11FC 0016 F62A             		move.b	#$16,(v_vbla_routine).w
00007462 6100 D7BA                  		bsr.w	WaitForVBla
00007466 0C38 0006 D024             		cmpi.b	#6,(v_player+obRoutine).w
0000746C 6400                       		bhs.s	loc_4DF2
0000746E 46FC 2700                  		disable_ints
00007472 3238 F614                  		move.w	(v_demolength).w,d1
00007476 82FC 003C                  		divu.w	#$3C,d1
0000747A 0281 0000 000F             		andi.l	#$F,d1
00007480 4EB9 0000 0000             		jsr	(ContScrCounter).l
00007486 46FC 2300                  		enable_ints
0000748A                            
0000748A                            loc_4DF2:
0000748A 4EB9 0000 0000             		jsr	(ExecuteObjects).l
00007490 4EB9 0000 0000             		jsr	(BuildSprites).l
00007496 0C78 0180 D008             		cmpi.w	#$180,(v_player+obX).w ; has Sonic run off screen?
0000749C 6400                       		bhs.s	Cont_GotoLevel	; if yes, branch
0000749E 0C38 0006 D024             		cmpi.b	#6,(v_player+obRoutine).w
000074A4 64B6                       		bhs.s	Cont_MainLoop
000074A6 4A78 F614                  		tst.w	(v_demolength).w
000074AA 6600 FFB0                  		bne.w	Cont_MainLoop
000074AE 11FC 0000 F600             		move.b	#id_Sega,(v_gamemode).w ; go to Sega screen
000074B4 4E75                       		rts	
000074B6                            ; ===========================================================================
000074B6                            
000074B6                            Cont_GotoLevel:
000074B6 11FC 0000 F600             		move.b	#id_Level,(v_gamemode).w ; set screen mode to $0C (level)
000074BC 11FC 0003 FE12             		move.b	#3,(v_lives).w	; set lives to 3
000074C2 7000                       		moveq	#0,d0
000074C4 31C0 FE20                  		move.w	d0,(v_rings).w	; clear rings
000074C8 21C0 FE22                  		move.l	d0,(v_time).w	; clear time
000074CC 21C0 FE26                  		move.l	d0,(v_score).w	; clear score
000074D0 11C0 FE30                  		move.b	d0,(v_lastlamp).w ; clear lamppost count
000074D4 5338 FE18                  		subq.b	#1,(v_continues).w ; subtract 1 from continues
000074D8 4E75                       		rts	
000074DA                            ; ===========================================================================
000074DA                            
000074DA                            		include	"_incObj\80 Continue Screen Elements.asm"
000074DA                            ; ---------------------------------------------------------------------------
000074DA                            ; Object 80 - Continue screen elements
000074DA                            ; ---------------------------------------------------------------------------
000074DA                            
000074DA                            ContScrItem:
000074DA 7000                       		moveq	#0,d0
000074DC 1028 0024                  		move.b	$24(a0),d0
000074E0 323B 0000                  		move.w	CSI_Index(pc,d0.w),d1
000074E4 4EFB 1000                  		jmp	CSI_Index(pc,d1.w)
000074E8                            ; ===========================================================================
000074E8 0000                       CSI_Index:	dc.w CSI_Main-CSI_Index
000074EA 0000                       		dc.w CSI_Display-CSI_Index
000074EC 0000                       		dc.w CSI_MakeMiniSonic-CSI_Index
000074EE 0000                       		dc.w CSI_ChkDel-CSI_Index
000074F0                            ; ===========================================================================
000074F0                            
000074F0                            CSI_Main:	; Routine 0
000074F0 5428 0024                  		addq.b	#2,obRoutine(a0)
000074F4 217C 0000 0000 0004        		move.l	#Map_ContScr,obMap(a0)
000074FC 317C 8500 0002             		move.w	#$8500,obGfx(a0)
00007502 117C 0000 0001             		move.b	#0,obRender(a0)
00007508 117C 003C 0019             		move.b	#$3C,obActWid(a0)
0000750E 317C 0120 0008             		move.w	#$120,obX(a0)
00007514 317C 00C0 000A             		move.w	#$C0,obScreenY(a0)
0000751A 31FC 0000 FE20             		move.w	#0,(v_rings).w	; clear rings
00007520                            
00007520                            CSI_Display:	; Routine 2
00007520 4EF9 0000 0000             		jmp	(DisplaySprite).l
00007526                            ; ===========================================================================
00007526                            
00007526                            	CSI_MiniSonicPos:
00007526 0116 012A 0102 013E 00EE+  		dc.w $116, $12A, $102, $13E, $EE, $152, $DA, $166, $C6
00007538 017A 00B2 018E 009E 01A2+  		dc.w $17A, $B2,	$18E, $9E, $1A2, $8A
00007544                            
00007544                            CSI_MakeMiniSonic:
00007544                            		; Routine 4
00007544 2248                       		movea.l	a0,a1
00007546 45F9 0000 7526             		lea	(CSI_MiniSonicPos).l,a2
0000754C 7200                       		moveq	#0,d1
0000754E 1238 FE18                  		move.b	(v_continues).w,d1
00007552 5501                       		subq.b	#2,d1
00007554 6400                       		bcc.s	CSI_MoreThan1
00007556 4EF9 0000 0000             		jmp	(DeleteObject).l	; cancel if you have 0-1 continues
0000755C                            
0000755C                            	CSI_MoreThan1:
0000755C 7601                       		moveq	#1,d3
0000755E 0C01 000E                  		cmpi.b	#14,d1		; do you have fewer than 16 continues
00007562 6500                       		bcs.s	CSI_FewerThan16	; if yes, branch
00007564                            
00007564 7600                       		moveq	#0,d3
00007566 720E                       		moveq	#14,d1		; cap at 15 mini-Sonics
00007568                            
00007568                            	CSI_FewerThan16:
00007568 1401                       		move.b	d1,d2
0000756A 0202 0001                  		andi.b	#1,d2
0000756E                            
0000756E                            CSI_MiniSonicLoop:
0000756E 137C 0000 0000             		move.b	#id_ContScrItem,0(a1) ; load mini-Sonic object
00007574 335A 0008                  		move.w	(a2)+,obX(a1)	; use above data for x-axis position
00007578 4A02                       		tst.b	d2		; do you have an even number of continues?
0000757A 6700                       		beq.s	CSI_Even	; if yes, branch
0000757C 0469 000A 0008             		subi.w	#$A,obX(a1)	; shift mini-Sonics slightly to the right
00007582                            
00007582                            	CSI_Even:
00007582 337C 00D0 000A             		move.w	#$D0,obScreenY(a1)
00007588 137C 0006 001A             		move.b	#6,obFrame(a1)
0000758E 137C 0006 0024             		move.b	#6,obRoutine(a1)
00007594 237C 0000 0000 0004        		move.l	#Map_ContScr,obMap(a1)
0000759C 337C 8551 0002             		move.w	#$8551,obGfx(a1)
000075A2 137C 0000 0001             		move.b	#0,obRender(a1)
000075A8 43E9 0040                  		lea	$40(a1),a1
000075AC 51C9 FFC0                  		dbf	d1,CSI_MiniSonicLoop ; repeat for number of continues
000075B0                            
000075B0 43E9 FFC0                  		lea	-$40(a1),a1
000075B4 1343 0028                  		move.b	d3,obSubtype(a1)
000075B8                            
000075B8                            CSI_ChkDel:	; Routine 6
000075B8 4A28 0028                  		tst.b	obSubtype(a0)	; do you have 16 or more continues?
000075BC 6700                       		beq.s	CSI_Animate	; if yes, branch
000075BE 0C38 0006 D024             		cmpi.b	#6,(v_player+obRoutine).w ; is Sonic running?
000075C4 6500                       		bcs.s	CSI_Animate	; if not, branch
000075C6 1038 FE0F                  		move.b	(v_vbla_byte).w,d0
000075CA 0200 0001                  		andi.b	#1,d0
000075CE 6600                       		bne.s	CSI_Animate
000075D0 4A78 D010                  		tst.w	(v_player+obVelX).w ; is Sonic running?
000075D4 6600                       		bne.s	CSI_Delete	; if yes, goto delete
000075D6 4E75                       		rts	
000075D8                            
000075D8                            CSI_Animate:
000075D8 1038 FE0F                  		move.b	(v_vbla_byte).w,d0
000075DC 0200 000F                  		andi.b	#$F,d0
000075E0 6600                       		bne.s	CSI_Display2
000075E2 0868 0000 001A             		bchg	#0,obFrame(a0)
000075E8                            
000075E8                            	CSI_Display2:
000075E8 4EF9 0000 0000             		jmp	(DisplaySprite).l
000075EE                            ; ===========================================================================
000075EE                            
000075EE                            CSI_Delete:
000075EE 4EF9 0000 0000             		jmp	(DeleteObject).l
000075EE 4EF9 0000 0000             		jmp	(DeleteObject).l
000075F4                            		include	"_incObj\81 Continue Screen Sonic.asm"
000075F4                            ; ---------------------------------------------------------------------------
000075F4                            ; Object 81 - Sonic on the continue screen
000075F4                            ; ---------------------------------------------------------------------------
000075F4                            
000075F4                            ContSonic:
000075F4 7000                       		moveq	#0,d0
000075F6 1028 0024                  		move.b	obRoutine(a0),d0
000075FA 323B 0000                  		move.w	CSon_Index(pc,d0.w),d1
000075FE 4EBB 1000                  		jsr	CSon_Index(pc,d1.w)
00007602 4EF9 0000 0000             		jmp	(DisplaySprite).l
00007608                            ; ===========================================================================
00007608 0000                       CSon_Index:	dc.w CSon_Main-CSon_Index
0000760A 0000                       		dc.w CSon_ChkLand-CSon_Index
0000760C 0000                       		dc.w CSon_Animate-CSon_Index
0000760E 0000                       		dc.w CSon_Run-CSon_Index
00007610                            ; ===========================================================================
00007610                            
00007610                            CSon_Main:	; Routine 0
00007610 5428 0024                  		addq.b	#2,obRoutine(a0)
00007614 317C 00A0 0008             		move.w	#$A0,obX(a0)
0000761A 317C 00C0 000C             		move.w	#$C0,obY(a0)
00007620 217C 0000 0000 0004        		move.l	#Map_Sonic,obMap(a0)
00007628 317C 0780 0002             		move.w	#$780,obGfx(a0)
0000762E 117C 0004 0001             		move.b	#4,obRender(a0)
00007634 117C 0002 0018             		move.b	#2,obPriority(a0)
0000763A 117C 0000 001C             		move.b	#id_Float3,obAnim(a0) ; use "floating" animation
00007640 317C 0400 0012             		move.w	#$400,obVelY(a0) ; make Sonic fall from above
00007646                            
00007646                            CSon_ChkLand:	; Routine 2
00007646 0C68 01A0 000C             		cmpi.w	#$1A0,obY(a0)	; has Sonic landed yet?
0000764C 6600                       		bne.s	CSon_ShowFall	; if not, branch
0000764E                            
0000764E 5428 0024                  		addq.b	#2,obRoutine(a0)
00007652 4268 0012                  		clr.w	obVelY(a0)	; stop Sonic falling
00007656 217C 0000 0000 0004        		move.l	#Map_ContScr,obMap(a0)
0000765E 317C 8500 0002             		move.w	#$8500,obGfx(a0)
00007664 117C 0000 001C             		move.b	#id_Walk,obAnim(a0)
0000766A 6000                       		bra.s	CSon_Animate
0000766C                            
0000766C                            CSon_ShowFall:
0000766C 4EB9 0000 0000             		jsr	(SpeedToPos).l
00007672 4EB9 0000 0000             		jsr	(Sonic_Animate).l
00007678 4EF9 0000 0000             		jmp	(Sonic_LoadGfx).l
0000767E                            ; ===========================================================================
0000767E                            
0000767E                            CSon_Animate:	; Routine 4
0000767E 4A38 F605                  		tst.b	(v_jpadpress1).w ; is Start button pressed?
00007682 6B00                       		bmi.s	CSon_GetUp	; if yes, branch
00007684 43F9 0000 0000             		lea	(AniScript_CSon).l,a1
0000768A 4EF9 0000 0000             		jmp	(AnimateSprite).l
00007690                            
00007690                            CSon_GetUp:
00007690 5428 0024                  		addq.b	#2,obRoutine(a0)
00007694 217C 0000 0000 0004        		move.l	#Map_Sonic,obMap(a0)
0000769C 317C 0780 0002             		move.w	#$780,obGfx(a0)
000076A2 117C 0000 001C             		move.b	#id_Float4,obAnim(a0) ; use "getting up" animation
000076A8 4268 0014                  		clr.w	obInertia(a0)
000076AC 5168 000C                  		subq.w	#8,obY(a0)
000076B8                            
000076B8                            CSon_Run:	; Routine 6
000076B8 0C68 0800 0014             		cmpi.w	#$800,obInertia(a0) ; check Sonic's inertia
000076BE 6600                       		bne.s	CSon_AddInertia	; if too low, branch
000076C0 317C 1000 0010             		move.w	#$1000,obVelX(a0) ; move Sonic to the right
000076C6 6000                       		bra.s	CSon_ShowRun
000076C8                            
000076C8                            CSon_AddInertia:
000076C8 0668 0020 0014             		addi.w	#$20,obInertia(a0) ; increase inertia
000076CE                            
000076CE                            CSon_ShowRun:
000076CE 4EB9 0000 0000             		jsr	(SpeedToPos).l
000076D4 4EB9 0000 0000             		jsr	(Sonic_Animate).l
000076DA 4EF9 0000 0000             		jmp	(Sonic_LoadGfx).l
000076DA 4EF9 0000 0000             		jmp	(Sonic_LoadGfx).l
000076E0                            		include	"_anim\Continue Screen Sonic.asm"
000076E0                            ; ---------------------------------------------------------------------------
000076E0                            ; Animation script - Sonic on the continue screen
000076E0                            ; ---------------------------------------------------------------------------
000076E0 0000                       AniScript_CSon:	dc.w A_CSon_1-AniScript_CSon
000076E2 0401 0101 0102 0202 0303+  A_CSon_1:	dc.b 4,	1, 1, 1, 1, 2, 2, 2, 3,	3, afEnd
000076EE 00                         		even
000076EE 00                         		even
000076EE                            Map_ContScr:	include	"_maps\Continue Screen.asm"
000076EE                            ; ---------------------------------------------------------------------------
000076EE                            ; Sprite mappings - Continue screen
000076EE                            ; ---------------------------------------------------------------------------
000076EE                            Map_ContScr_internal:
000076EE 0000                       		dc.w M_Cont_text-Map_ContScr_internal
000076F0 0000                       		dc.w M_Cont_Sonic1-Map_ContScr_internal
000076F2 0000                       		dc.w M_Cont_Sonic2-Map_ContScr_internal
000076F4 0000                       		dc.w M_Cont_Sonic3-Map_ContScr_internal
000076F6 0000                       		dc.w M_Cont_oval-Map_ContScr_internal
000076F8 0000                       		dc.w M_Cont_Mini1-Map_ContScr_internal
000076FA 0000                       		dc.w M_Cont_Mini1-Map_ContScr_internal
000076FC 0000                       		dc.w M_Cont_Mini2-Map_ContScr_internal
000076FE 0B                         M_Cont_text:	dc.b $B
000076FF F805 0088 C4               		dc.b $F8, 5, 0,	$88, $C4 ; "CONTINUE", stars and countdown
00007704 F805 00B2 D4               		dc.b $F8, 5, 0,	$B2, $D4
00007709 F805 00AE E4               		dc.b $F8, 5, 0,	$AE, $E4
0000770E F805 00C2 F4               		dc.b $F8, 5, 0,	$C2, $F4
00007713 F801 00A0 04               		dc.b $F8, 1, 0,	$A0, 4
00007718 F805 00AE 0C               		dc.b $F8, 5, 0,	$AE, $C
0000771D F805 00C6 1C               		dc.b $F8, 5, 0,	$C6, $1C
00007722 F805 0090 2C               		dc.b $F8, 5, 0,	$90, $2C
00007727 3805 2021 E8               		dc.b $38, 5, $20, $21, $E8
0000772C 3805 2021 08               		dc.b $38, 5, $20, $21, 8
00007731 3605 01FC F8               		dc.b $36, 5, 1,	$FC, $F8
00007736 03                         M_Cont_Sonic1:	dc.b 3
00007737 0405 0015 FC               		dc.b 4,	5, 0, $15, $FC	; Sonic	on floor
0000773C F40A 0006 EC               		dc.b $F4, $A, 0, 6, $EC
00007741 F406 000F 04               		dc.b $F4, 6, 0,	$F, 4
00007746 03                         M_Cont_Sonic2:	dc.b 3
00007747 0405 0019 FC               		dc.b 4,	5, 0, $19, $FC	; Sonic	on floor #2
0000774C F40A 0006 EC               		dc.b $F4, $A, 0, 6, $EC
00007751 F406 000F 04               		dc.b $F4, 6, 0,	$F, 4
00007756 03                         M_Cont_Sonic3:	dc.b 3
00007757 0405 001D FC               		dc.b 4,	5, 0, $1D, $FC	; Sonic	on floor #3
0000775C F40A 0006 EC               		dc.b $F4, $A, 0, 6, $EC
00007761 F406 000F 04               		dc.b $F4, 6, 0,	$F, 4
00007766 02                         M_Cont_oval:	dc.b 2
00007767 6009 2000 E8               		dc.b $60, 9, $20, 0, $E8 ; circle on the floor
0000776C 6009 2800 00               		dc.b $60, 9, $28, 0, 0
00007771 01                         M_Cont_Mini1:	dc.b 1
00007772 0006 0012 00               		dc.b 0,	6, 0, $12, 0	; mini Sonic
00007777 01                         M_Cont_Mini2:	dc.b 1
00007778 0006 0018 00               		dc.b 0,	6, 0, $18, 0	; mini Sonic #2
0000777E 00                         		even
0000777E 00                         		even
0000777E                            
0000777E                            ; ===========================================================================
0000777E                            ; ---------------------------------------------------------------------------
0000777E                            ; Ending sequence in Green Hill	Zone
0000777E                            ; ---------------------------------------------------------------------------
0000777E                            
0000777E                            GM_Ending:
0000777E 13FC 0006 FFFF FE57        		move.b	#6,(v_emeralds)
0000778E 6100 C86A                  		bsr.w	PaletteFadeOut
00007792                            
00007792 43F8 D000                  		lea	(v_objspace).w,a1
00007796 7000                       		moveq	#0,d0
00007798 323C 07FF                  		move.w	#$7FF,d1
0000779C                            	End_ClrObjRam:
0000779C 22C0                       		move.l	d0,(a1)+
0000779E 51C9 FFFC                  		dbf	d1,End_ClrObjRam ; clear object	RAM
000077A2                            
000077A2 43F8 F628                  		lea	($FFFFF628).w,a1
000077A6 7000                       		moveq	#0,d0
000077A8 323C 0015                  		move.w	#$15,d1
000077AC                            	End_ClrRam1:
000077AC 22C0                       		move.l	d0,(a1)+
000077AE 51C9 FFFC                  		dbf	d1,End_ClrRam1	; clear	variables
000077B2                            
000077B2 43F8 F700                  		lea	(v_screenposx).w,a1
000077B6 7000                       		moveq	#0,d0
000077B8 323C 003F                  		move.w	#$3F,d1
000077BC                            	End_ClrRam2:
000077BC 22C0                       		move.l	d0,(a1)+
000077BE 51C9 FFFC                  		dbf	d1,End_ClrRam2	; clear	variables
000077C2                            
000077C2 43F8 FE60                  		lea	(v_oscillate+2).w,a1
000077C6 7000                       		moveq	#0,d0
000077C8 323C 0047                  		move.w	#$47,d1
000077CC                            	End_ClrRam3:
000077CC 22C0                       		move.l	d0,(a1)+
000077CE 51C9 FFFC                  		dbf	d1,End_ClrRam3	; clear	variables
000077D2                            
000077D2 46FC 2700                  		disable_ints
000077D6 3038 F60C                  		move.w	(v_vdp_buffer1).w,d0
000077DA 0200 00BF                  		andi.b	#$BF,d0
000077DE 33C0 00C0 0004             		move.w	d0,(vdp_control_port).l
000077E4 6100 BA60                  		bsr.w	ClearScreen
000077E8 4DF9 00C0 0004             		lea	(vdp_control_port).l,a6
000077EE 3CBC 8B03                  		move.w	#$8B03,(a6)	; line scroll mode
000077F2 3CBC 8230                  		move.w	#$8200+(vram_fg>>10),(a6) ; set foreground nametable address
000077F6 3CBC 8407                  		move.w	#$8400+(vram_bg>>13),(a6) ; set background nametable address
000077FA 3CBC 857C                  		move.w	#$8500+(vram_sprites>>9),(a6) ; set sprite table address
000077FE 3CBC 9001                  		move.w	#$9001,(a6)		; 64-cell hscroll size
00007802 3CBC 8004                  		move.w	#$8004,(a6)		; 8-colour mode
00007806 3CBC 8720                  		move.w	#$8720,(a6)		; set background colour (line 3; colour 0)
0000780A 31FC 8ADF F624             		move.w	#$8A00+223,(v_hbla_hreg).w ; set palette change position (for water)
00007810 3CB8 F624                  		move.w	(v_hbla_hreg).w,(a6)
00007814 31FC 001E FE14             		move.w	#30,(v_air).w
0000781A 31FC 0000 FE10             		move.w	#00<<8,(v_zone).w ; set level number to 0600 (extra flowers)
00007820 0C38 0006 FE57             		cmpi.b	#6,(v_emeralds).w ; do you have all 6 emeralds?
00007826 6700                       		beq.s	End_LoadData	; if yes, branch
00007828 31FC 0001 FE10             		move.w	#(00<<8)+1,(v_zone).w ; set level number to 0601 (no flowers)
0000782E                            
0000782E                            End_LoadData:
0000782E 7000                       		moveq	#plcid_Ending,d0
00007830 6100 BE30                  		bsr.w	QuickPLC	; load ending sequence patterns
00007834 4EB9 0000 0000             		jsr	(Hud_Base).l
0000783A 6100 0000                  		bsr.w	LevelSizeLoad
0000783E 6100 0000                  		bsr.w	DeformLayers
00007842 08F8 0002 F754             		bset	#2,(v_fg_scroll_flags).w
00007848 6100 0000                  		bsr.w	LevelDataLoad
0000784C 6100 0000                  		bsr.w	LoadTilesFromStart
00007850 21FC 0000 0000 F796        		move.l	#Col_GHZ,(v_collindex).w ; load collision index
00007858 46FC 2300                  		enable_ints
0000785C 41F9 0000 0000             		lea	(Kos_EndFlowers).l,a0 ;	load extra flower patterns
00007862 43F8 9400                  		lea	($FFFF9400).w,a1 ; RAM address to buffer the patterns
00007866 6100 BFAA                  		bsr.w	KosDec
0000786A 7003                       		moveq	#palid_Sonic,d0
0000786C 6100 C984                  		bsr.w	PalLoad1	; load Sonic's palette
00007878 0838 0006 F604             		btst	#bitA,(v_jpadhold1).w ; is button A pressed?
0000787E 6700                       		beq.s	End_LoadSonic	; if not, branch
00007880 11FC 0001 FFFA             		move.b	#1,(f_debugmode).w ; enable debug mode
00007886                            
00007886                            End_LoadSonic:
00007886 11FC 0000 D000             		move.b	#id_SonicPlayer,(v_player).w ; load Sonic object
0000788C 08F8 0000 D022             		bset	#0,(v_player+obStatus).w ; make Sonic face left
00007892 11FC 0001 F7CC             		move.b	#1,(f_lockctrl).w ; lock controls
00007898 31FC 0400 F602             		move.w	#(btnL<<8),(v_jpadhold2).w ; move Sonic to the left
0000789E 31FC F800 D014             		move.w	#$F800,(v_player+obInertia).w ; set Sonic's speed
000078A4 11FC 0000 D040             		move.b	#id_HUD,(v_objspace+$40).w ; load HUD object
000078AA 4EB9 0000 0000             		jsr	(ObjPosLoad).l
000078B0 4EB9 0000 0000             		jsr	(ExecuteObjects).l
000078B6 4EB9 0000 0000             		jsr	(BuildSprites).l
000078BC 7000                       		moveq	#0,d0
000078BE 31C0 FE20                  		move.w	d0,(v_rings).w
000078C2 21C0 FE22                  		move.l	d0,(v_time).w
000078C6 11C0 FE1B                  		move.b	d0,(v_lifecount).w
000078CA 11C0 FE2C                  		move.b	d0,(v_shield).w
000078CE 11C0 FE2D                  		move.b	d0,(v_invinc).w
000078D2 11C0 FE2E                  		move.b	d0,(v_shoes).w
000078D6 11C0 FE2F                  		move.b	d0,($FFFFFE2F).w
000078DA 31C0 FE08                  		move.w	d0,(v_debuguse).w
000078DE 31C0 FE02                  		move.w	d0,(f_restart).w
000078E2 31C0 FE04                  		move.w	d0,(v_framecount).w
000078E6 6100 EFA8                  		bsr.w	OscillateNumInit
000078EA 11FC 0001 FE1F             		move.b	#1,(f_scorecount).w
000078F0 11FC 0001 FE1D             		move.b	#1,(f_ringcount).w
000078F6 11FC 0000 FE1E             		move.b	#0,(f_timecount).w
000078FC 31FC 0708 F614             		move.w	#1800,(v_demolength).w
00007902 11FC 0018 F62A             		move.b	#$18,(v_vbla_routine).w
00007908 6100 D314                  		bsr.w	WaitForVBla
0000790C 3038 F60C                  		move.w	(v_vdp_buffer1).w,d0
00007910 0000 0040                  		ori.b	#$40,d0
00007914 33C0 00C0 0004             		move.w	d0,(vdp_control_port).l
0000791A 31FC 003F F626             		move.w	#$3F,(v_pfade_start).w
00007920 6100 C632                  		bsr.w	PaletteFadeIn
00007924                            
00007924                            ; ---------------------------------------------------------------------------
00007924                            ; Main ending sequence loop
00007924                            ; ---------------------------------------------------------------------------
00007924                            
00007924                            End_MainLoop:
00007924 6100 BA04                  		bsr.w	PauseGame
00007928 11FC 0018 F62A             		move.b	#$18,(v_vbla_routine).w
0000792E 6100 D2EE                  		bsr.w	WaitForVBla
00007932 5278 FE04                  		addq.w	#1,(v_framecount).w
00007936 6100 0000                  		bsr.w	End_MoveSonic
0000793A 4EB9 0000 0000             		jsr	(ExecuteObjects).l
00007940 6100 0000                  		bsr.w	DeformLayers
00007944 4EB9 0000 0000             		jsr	(BuildSprites).l
0000794A 4EB9 0000 0000             		jsr	(ObjPosLoad).l
00007950 6100 C188                  		bsr.w	PaletteCycle
00007954 6100 EF90                  		bsr.w	OscillateNumDo
00007958 6100 F024                  		bsr.w	SynchroAnimate
0000795C 0C38 0000 F600             		cmpi.b	#id_Ending,(v_gamemode).w ; is game mode $18 (ending)?
00007962 6700                       		beq.s	End_ChkEmerald	; if yes, branch
00007964                            
00007964 11FC 0020 F600             		move.b	#$20,(v_gamemode).w ; goto credits
00007972 31FC 0000 FFF4             		move.w	#0,(v_creditsnum).w ; set credits index number to 0
00007978 4E75                       		rts	
0000797A                            ; ===========================================================================
0000797A                            
0000797A                            End_ChkEmerald:
0000797A 4A78 FE02                  		tst.w	(f_restart).w	; has Sonic released the emeralds?
0000797E 6700 FFA4                  		beq.w	End_MainLoop	; if not, branch
00007982                            
00007982 4278 FE02                  		clr.w	(f_restart).w
00007986 31FC 003F F626             		move.w	#$3F,(v_pfade_start).w
0000798C 4278 F794                  		clr.w	(v_palchgspeed).w
00007990                            
00007990                            	End_AllEmlds:
00007990 6100 B998                  		bsr.w	PauseGame
00007994 11FC 0018 F62A             		move.b	#$18,(v_vbla_routine).w
0000799A 6100 D282                  		bsr.w	WaitForVBla
0000799E 5278 FE04                  		addq.w	#1,(v_framecount).w
000079A2 6100 0000                  		bsr.w	End_MoveSonic
000079A6 4EB9 0000 0000             		jsr	(ExecuteObjects).l
000079AC 6100 0000                  		bsr.w	DeformLayers
000079B0 4EB9 0000 0000             		jsr	(BuildSprites).l
000079B6 4EB9 0000 0000             		jsr	(ObjPosLoad).l
000079BC 6100 EF28                  		bsr.w	OscillateNumDo
000079C0 6100 EFBC                  		bsr.w	SynchroAnimate
000079C4 5378 F794                  		subq.w	#1,(v_palchgspeed).w
000079C8 6A00                       		bpl.s	End_SlowFade
000079CA 31FC 0002 F794             		move.w	#2,(v_palchgspeed).w
000079D0 6100 C772                  		bsr.w	WhiteOut_ToWhite
000079D4                            
000079D4                            	End_SlowFade:
000079D4 4A78 FE02                  		tst.w	(f_restart).w
000079D8 6700 FFB6                  		beq.w	End_AllEmlds
000079DC 4278 FE02                  		clr.w	(f_restart).w
000079E0 31FC 2E2F A480             		move.w	#$2E2F,(v_lvllayout+$80).w ; modify level layout
000079E6 4BF9 00C0 0004             		lea	(vdp_control_port).l,a5
000079EC 4DF9 00C0 0000             		lea	(vdp_data_port).l,a6
000079F2 47F8 F700                  		lea	(v_screenposx).w,a3
000079F6 49F8 A400                  		lea	(v_lvllayout).w,a4
000079FA 343C 4000                  		move.w	#$4000,d2
000079FE 6100 0000                  		bsr.w	DrawChunks
00007A02 7014                       		moveq	#palid_Ending,d0
00007A04 6100 C7EC                  		bsr.w	PalLoad1	; load ending palette
00007A08 6100 C66E                  		bsr.w	PaletteWhiteIn
00007A0C 6000 FF16                  		bra.w	End_MainLoop
00007A10                            
00007A10                            ; ---------------------------------------------------------------------------
00007A10                            ; Subroutine controlling Sonic on the ending sequence
00007A10                            ; ---------------------------------------------------------------------------
00007A10                            
00007A10                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00007A10                            
00007A10                            
00007A10                            End_MoveSonic:
00007A10 1038 F7D7                  		move.b	(v_sonicend).w,d0
00007A14 6600                       		bne.s	End_MoveSon2
00007A16 0C78 0090 D008             		cmpi.w	#$90,(v_player+obX).w ; has Sonic passed $90 on x-axis?
00007A1C 6400                       		bhs.s	End_MoveSonExit	; if not, branch
00007A1E                            
00007A1E 5438 F7D7                  		addq.b	#2,(v_sonicend).w
00007A22 11FC 0001 F7CC             		move.b	#1,(f_lockctrl).w ; lock player's controls
00007A28 31FC 0800 F602             		move.w	#(btnR<<8),(v_jpadhold2).w ; move Sonic to the right
00007A2E 4E75                       		rts	
00007A30                            ; ===========================================================================
00007A30                            
00007A30                            End_MoveSon2:
00007A30 5500                       		subq.b	#2,d0
00007A32 6600                       		bne.s	End_MoveSon3
00007A34 0C78 00A0 D008             		cmpi.w	#$A0,(v_player+obX).w ; has Sonic passed $A0 on x-axis?
00007A3A 6500                       		blo.s	End_MoveSonExit	; if not, branch
00007A3C                            
00007A3C 5438 F7D7                  		addq.b	#2,(v_sonicend).w
00007A40 7000                       		moveq	#0,d0
00007A42 11C0 F7CC                  		move.b	d0,(f_lockctrl).w
00007A46 31C0 F602                  		move.w	d0,(v_jpadhold2).w ; stop Sonic moving
00007A4A 31C0 D014                  		move.w	d0,(v_player+obInertia).w
00007A4E 11FC 0081 F7C8             		move.b	#$81,(f_lockmulti).w ; lock controls & position
00007A54 11FC 0003 D01A             		move.b	#3,(v_player+obFrame).w
00007A5A 31FC 0000 D01C             		move.w	#(id_Wait<<8)+id_Wait,(v_player+obAnim).w ; use "standing" animation
00007A60 11FC 0003 D01E             		move.b	#3,(v_player+obTimeFrame).w
00007A66 4E75                       		rts	
00007A68                            ; ===========================================================================
00007A68                            
00007A68                            End_MoveSon3:
00007A68 5500                       		subq.b	#2,d0
00007A6A 6600                       		bne.s	End_MoveSonExit
00007A6C 5438 F7D7                  		addq.b	#2,(v_sonicend).w
00007A70 31FC 00A0 D008             		move.w	#$A0,(v_player+obX).w
00007A76 11FC 0000 D000             		move.b	#id_EndSonic,(v_player).w ; load Sonic ending sequence object
00007A7C 4278 D024                  		clr.w	(v_player+obRoutine).w
00007A80                            
00007A80                            End_MoveSonExit:
00007A80 4E75                       		rts	
00007A82                            ; End of function End_MoveSonic
00007A82                            
00007A82                            ; ===========================================================================
00007A82                            
00007A82                            		include	"_incObj\87 Ending Sequence Sonic.asm"
00007A82                            ; ---------------------------------------------------------------------------
00007A82                            ; Object 87 - Sonic on ending sequence
00007A82                            ; ---------------------------------------------------------------------------
00007A82                            
00007A82                            EndSonic:
00007A82 7000                       		moveq	#0,d0
00007A84 1028 0025                  		move.b	ob2ndRout(a0),d0
00007A88 323B 0000                  		move.w	ESon_Index(pc,d0.w),d1
00007A8C 4EBB 1000                  		jsr	ESon_Index(pc,d1.w)
00007A90 4EF9 0000 0000             		jmp	(DisplaySprite).l
00007A96                            ; ===========================================================================
00007A96 0000 0000                  ESon_Index:	dc.w ESon_Main-ESon_Index, ESon_MakeEmeralds-ESon_Index
00007A9A 0000 0000                  		dc.w Obj87_Animate-ESon_Index,	Obj87_LookUp-ESon_Index
00007A9E 0000 0000                  		dc.w Obj87_ClrObjRam-ESon_Index, Obj87_Animate-ESon_Index
00007AA2 0000 0000                  		dc.w Obj87_MakeLogo-ESon_Index, Obj87_Animate-ESon_Index
00007AA6 0000 0000                  		dc.w Obj87_Leap-ESon_Index, Obj87_Animate-ESon_Index
00007AAA                            
00007AAA =00000030                  eson_time:	equ $30	; time to wait between events
00007AAA                            ; ===========================================================================
00007AAA                            
00007AAA                            ESon_Main:	; Routine 0
00007AAA 0C38 0006 FE57             		cmpi.b	#6,(v_emeralds).w ; do you have all 6 emeralds?
00007AB0 6700                       		beq.s	ESon_Main2	; if yes, branch
00007AB2 0628 0010 0025             		addi.b	#$10,ob2ndRout(a0) ; else, skip emerald sequence
00007AB8 317C 00D8 0030             		move.w	#216,eson_time(a0)
00007ABE 4E75                       		rts	
00007AC0                            ; ===========================================================================
00007AC0                            
00007AC0                            ESon_Main2:
00007AC0 5428 0025                  		addq.b	#2,ob2ndRout(a0)
00007AC4 217C 0000 0000 0004        		move.l	#Map_ESon,obMap(a0)
00007ACC 317C 03E1 0002             		move.w	#$3E1,obGfx(a0)
00007AD2 117C 0004 0001             		move.b	#4,obRender(a0)
00007AD8 4228 0022                  		clr.b	obStatus(a0)
00007ADC 117C 0002 0018             		move.b	#2,obPriority(a0)
00007AE2 117C 0000 001A             		move.b	#0,obFrame(a0)
00007AE8 317C 0050 0030             		move.w	#80,eson_time(a0) ; set duration for Sonic to pause
00007AEE                            
00007AEE                            ESon_MakeEmeralds:
00007AEE                            		; Routine 2
00007AEE 5368 0030                  		subq.w	#1,eson_time(a0) ; subtract 1 from duration
00007AF2 6600                       		bne.s	ESon_Wait
00007AF4 5428 0025                  		addq.b	#2,ob2ndRout(a0)
00007AF8 317C 0001 001C             		move.w	#1,obAnim(a0)
00007AFE 11FC 0000 D400             		move.b	#id_EndChaos,(v_objspace+$400).w ; load chaos emeralds objects
00007B04                            
00007B04                            	ESon_Wait:
00007B04 4E75                       		rts	
00007B06                            ; ===========================================================================
00007B06                            
00007B06                            Obj87_LookUp:	; Routine 6
00007B06 0C79 2000 00FF D43C        		cmpi.w	#$2000,((v_objspace&$FFFFFF)+$400+$3C).l
00007B0E 6600                       		bne.s	locret_5480
00007B10 31FC 0001 FE02             		move.w	#1,(f_restart).w ; set level to	restart	(causes	flash)
00007B16 317C 005A 0030             		move.w	#90,eson_time(a0)
00007B1C 5428 0025                  		addq.b	#2,ob2ndRout(a0)
00007B20                            
00007B20                            locret_5480:
00007B20 4E75                       		rts	
00007B22                            ; ===========================================================================
00007B22                            
00007B22                            Obj87_ClrObjRam:
00007B22                            		; Routine 8
00007B22 5368 0030                  		subq.w	#1,eson_time(a0)
00007B26 6600                       		bne.s	ESon_Wait2
00007B28 43F8 D400                  		lea	(v_objspace+$400).w,a1
00007B2C 323C 00FF                  		move.w	#$FF,d1
00007B30                            
00007B30                            Obj87_ClrLoop:
00007B30 4299                       		clr.l	(a1)+
00007B32 51C9 FFFC                  		dbf	d1,Obj87_ClrLoop ; clear the object RAM
00007B36 31FC 0001 FE02             		move.w	#1,(f_restart).w
00007B3C 5428 0025                  		addq.b	#2,ob2ndRout(a0)
00007B40 117C 0001 001C             		move.b	#1,obAnim(a0)
00007B46 317C 003C 0030             		move.w	#60,eson_time(a0)
00007B4C                            
00007B4C                            ESon_Wait2:
00007B4C 4E75                       		rts	
00007B4E                            ; ===========================================================================
00007B4E                            
00007B4E                            Obj87_MakeLogo:	; Routine $C
00007B4E 5368 0030                  		subq.w	#1,eson_time(a0)
00007B52 6600                       		bne.s	ESon_Wait3
00007B54 5428 0025                  		addq.b	#2,ob2ndRout(a0)
00007B58 317C 00B4 0030             		move.w	#180,eson_time(a0)
00007B5E 117C 0002 001C             		move.b	#2,obAnim(a0)
00007B64 11FC 0000 D400             		move.b	#id_EndSTH,(v_objspace+$400).w ; load "SONIC THE HEDGEHOG" object
00007B6A                            
00007B6A                            ESon_Wait3:
00007B6A 4E75                       		rts	
00007B6C                            ; ===========================================================================
00007B6C                            
00007B6C                            Obj87_Animate:	; Rountine 4, $A, $E, $12
00007B6C 43F9 0000 0000             		lea	(AniScript_ESon).l,a1
00007B72 4EF9 0000 0000             		jmp	(AnimateSprite).l
00007B78                            ; ===========================================================================
00007B78                            
00007B78                            Obj87_Leap:	; Routine $10
00007B78 5368 0030                  		subq.w	#1,eson_time(a0)
00007B7C 6600                       		bne.s	ESon_Wait4
00007B7E 5428 0025                  		addq.b	#2,ob2ndRout(a0)
00007B82 217C 0000 0000 0004        		move.l	#Map_ESon,obMap(a0)
00007B8A 317C 03E1 0002             		move.w	#$3E1,obGfx(a0)
00007B90 117C 0004 0001             		move.b	#4,obRender(a0)
00007B96 4228 0022                  		clr.b	obStatus(a0)
00007B9A 117C 0002 0018             		move.b	#2,obPriority(a0)
00007BA0 117C 0005 001A             		move.b	#5,obFrame(a0)
00007BA6 117C 0002 001C             		move.b	#2,obAnim(a0)	; use "leaping"	animation
00007BAC 11FC 0000 D400             		move.b	#id_EndSTH,(v_objspace+$400).w ; load "SONIC THE HEDGEHOG" object
00007BB2 60B8                       		bra.s	Obj87_Animate
00007BB4                            ; ===========================================================================
00007BB4                            
00007BB4                            ESon_Wait4:
00007BB4 4E75                       		rts	
00007BB4 4E75                       		rts	
00007BB6                            		include "_anim\Ending Sequence Sonic.asm"
00007BB6                            ; ---------------------------------------------------------------------------
00007BB6                            ; Animation script - Sonic on the ending sequence
00007BB6                            ; ---------------------------------------------------------------------------
00007BB6 0000                       AniScript_ESon:	dc.w byte_551C-AniScript_ESon
00007BB8 0000                       		dc.w byte_552A-AniScript_ESon
00007BBA 0000                       		dc.w byte_5534-AniScript_ESon
00007BBC 0301 0001 0001 0001 0001+  byte_551C:	dc.b 3,	1, 0, 1, 0, 1, 0, 1, 0,	1, 0, 1, 2, $FA
00007BCA 0503 0403 0403 0403 FA00   byte_552A:	dc.b 5,	3, 4, 3, 4, 3, 4, 3, $FA, 0
00007BD4 0305 0505 0607 FE01        byte_5534:	dc.b 3,	5, 5, 5, 6, 7, $FE, 1
00007BDC                            		even
00007BDC                            		even
00007BDC                            		include	"_incObj\88 Ending Sequence Emeralds.asm"
00007BDC                            ; ---------------------------------------------------------------------------
00007BDC                            ; Object 88 - chaos emeralds on	the ending sequence
00007BDC                            ; ---------------------------------------------------------------------------
00007BDC                            
00007BDC                            EndChaos:
00007BDC 7000                       		moveq	#0,d0
00007BDE 1028 0024                  		move.b	obRoutine(a0),d0
00007BE2 323B 0000                  		move.w	ECha_Index(pc,d0.w),d1
00007BE6 4EBB 1000                  		jsr	ECha_Index(pc,d1.w)
00007BEA 4EF9 0000 0000             		jmp	(DisplaySprite).l
00007BF0                            ; ===========================================================================
00007BF0 0000                       ECha_Index:	dc.w ECha_Main-ECha_Index
00007BF2 0000                       		dc.w ECha_Move-ECha_Index
00007BF4                            
00007BF4 =00000038                  echa_origX:	equ $38	; x-axis centre of emerald circle (2 bytes)
00007BF4 =0000003A                  echa_origY:	equ $3A	; y-axis centre of emerald circle (2 bytes)
00007BF4 =0000003C                  echa_radius:	equ $3C	; radius (2 bytes)
00007BF4 =0000003E                  echa_angle:	equ $3E	; angle for rotation (2 bytes)
00007BF4                            ; ===========================================================================
00007BF4                            
00007BF4                            ECha_Main:	; Routine 0
00007BF4 0C38 0002 D01A             		cmpi.b	#2,(v_player+obFrame).w
00007BFA 6700                       		beq.s	ECha_CreateEms
00007BFC 588F                       		addq.l	#4,sp
00007BFE 4E75                       		rts	
00007C00                            ; ===========================================================================
00007C00                            
00007C00                            ECha_CreateEms:
00007C00 3178 D008 0008             		move.w	(v_player+obX).w,obX(a0) ; match X position with Sonic
00007C06 3178 D00C 000C             		move.w	(v_player+obY).w,obY(a0) ; match Y position with Sonic
00007C0C 2248                       		movea.l	a0,a1
00007C0E 7600                       		moveq	#0,d3
00007C10 7401                       		moveq	#1,d2
00007C12 7205                       		moveq	#5,d1
00007C14                            
00007C14                            	ECha_LoadLoop:
00007C14 12BC 0000                  		move.b	#id_EndChaos,(a1) ; load chaos emerald object
00007C18 5429 0024                  		addq.b	#2,obRoutine(a1)
00007C1C 237C 0000 0000 0004        		move.l	#Map_ECha,obMap(a1)
00007C24 337C 03C5 0002             		move.w	#$3C5,obGfx(a1)
00007C2A 137C 0004 0001             		move.b	#4,obRender(a1)
00007C30 137C 0001 0018             		move.b	#1,obPriority(a1)
00007C36 3368 0008 0038             		move.w	obX(a0),echa_origX(a1)
00007C3C 3368 000C 003A             		move.w	obY(a0),echa_origY(a1)
00007C42 1342 001C                  		move.b	d2,obAnim(a1)
00007C46 1342 001A                  		move.b	d2,obFrame(a1)
00007C4A 5202                       		addq.b	#1,d2
00007C4C 1343 0026                  		move.b	d3,obAngle(a1)
00007C50 0603 002A                  		addi.b	#$100/6,d3	; angle between each emerald
00007C54 43E9 0040                  		lea	$40(a1),a1
00007C58 51C9 FFBA                  		dbf	d1,ECha_LoadLoop ; repeat 5 more times
00007C5C                            
00007C5C                            ECha_Move:	; Routine 2
00007C5C 3028 003E                  		move.w	echa_angle(a0),d0
00007C60 D168 0026                  		add.w	d0,obAngle(a0)
00007C64 1028 0026                  		move.b	obAngle(a0),d0
00007C68 4EB9 0000 4C50             		jsr	(CalcSine).l
00007C6E 7800                       		moveq	#0,d4
00007C70 1828 003C                  		move.b	echa_radius(a0),d4
00007C74 C3C4                       		muls.w	d4,d1
00007C76 E081                       		asr.l	#8,d1
00007C78 C1C4                       		muls.w	d4,d0
00007C7A E080                       		asr.l	#8,d0
00007C7C D268 0038                  		add.w	echa_origX(a0),d1
00007C80 D068 003A                  		add.w	echa_origY(a0),d0
00007C84 3141 0008                  		move.w	d1,obX(a0)
00007C88 3140 000C                  		move.w	d0,obY(a0)
00007C8C                            
00007C8C                            	ECha_Expand:
00007C8C 0C68 2000 003C             		cmpi.w	#$2000,echa_radius(a0)
00007C92 6700                       		beq.s	ECha_Rotate
00007C94 0668 0020 003C             		addi.w	#$20,echa_radius(a0) ; expand circle of emeralds
00007C9A                            
00007C9A                            	ECha_Rotate:
00007C9A 0C68 2000 003E             		cmpi.w	#$2000,echa_angle(a0)
00007CA0 6700                       		beq.s	ECha_Rise
00007CA2 0668 0020 003E             		addi.w	#$20,echa_angle(a0) ; move emeralds around the centre
00007CA8                            
00007CA8                            	ECha_Rise:
00007CA8 0C68 0140 003A             		cmpi.w	#$140,echa_origY(a0)
00007CAE 6700                       		beq.s	ECha_End
00007CB0 5368 003A                  		subq.w	#1,echa_origY(a0) ; make circle rise
00007CB4                            
00007CB4                            ECha_End:
00007CB4 4E75                       		rts	
00007CB4 4E75                       		rts	
00007CB6                            		include	"_incObj\89 Ending Sequence STH.asm"
00007CB6                            ; ---------------------------------------------------------------------------
00007CB6                            ; Object 89 - "SONIC THE HEDGEHOG" text	on the ending sequence
00007CB6                            ; ---------------------------------------------------------------------------
00007CB6                            
00007CB6                            EndSTH:
00007CB6                            	;	sfx	$C9,0,0,0 ; fade out music
00007CB6                            	;	jsr	ClearScreen
00007CB6                            	;	jsr	PlayLevelC
00007CB6 4E75                       	rts
00007CB8 7000                       		moveq	#0,d0
00007CBA 1028 0024                  		move.b	$24(a0),d0
00007CBE 323B 0000                  		move.w	ESth_Index(pc,d0.w),d1
00007CC2 4EFB 1000                  		jmp	ESth_Index(pc,d1.w)
00007CC6                            ; ===========================================================================
00007CC6 0000                       ESth_Index:	dc.w ESth_Main-ESth_Index
00007CC8 0000                       		dc.w ESth_Move-ESth_Index
00007CCA 0000                       		dc.w ESth_GotoCredits-ESth_Index
00007CCC                            
00007CCC =00000030                  esth_time:	equ $30		; time until exit
00007CCC                            ; ===========================================================================
00007CCC                            
00007CCC                            ESth_Main:	; Routine 0
00007CCC 5428 0024                  		addq.b	#2,obRoutine(a0)
00007CD0 317C FFE0 0008             		move.w	#-$20,obX(a0)	; object starts	outside	the level boundary
00007CD6 317C 00D8 000A             		move.w	#$D8,obScreenY(a0)
00007CDC 217C 0000 0000 0004        		move.l	#Map_ESTH,obMap(a0)
00007CE4 317C 05C5 0002             		move.w	#$5C5,obGfx(a0)
00007CEA 117C 0000 0001             		move.b	#0,obRender(a0)
00007CF0 117C 0000 0018             		move.b	#0,obPriority(a0)
00007CF6                            
00007CF6                            ESth_Move:	; Routine 2
00007CF6 0C68 00C0 0008             		cmpi.w	#$C0,obX(a0)	; has object reached $C0?
00007CFC 6700                       		beq.s	ESth_Delay	; if yes, branch
00007CFE 0668 0010 0008             		addi.w	#$10,obX(a0)	; move object to the right
00007D04 4EB9 0000 0000             		jsr	DisplaySprite ; Temp comment
00007D0A 4E75                       		rts
00007D0C                            
00007D0C                            ESth_Delay:
00007D0C 5428 0024                  		addq.b	#2,obRoutine(a0)
00007D10 317C 07D0 0030             		move.w	#2000,esth_time(a0) ; set duration for delay (2 seconds)
00007D16                            
00007D16                            ESth_GotoCredits:
00007D16                            		; Routine 4
00007D16 5368 0030                  		subq.w	#1,esth_time(a0) ; subtract 1 from duration
00007D1A 6A00                       		bpl.s	ESth_Wait
00007D1C 11FC 0000 F600             		move.b	#id_Credits,(v_gamemode).w ; exit to credits
00007D22                            
00007D22                            	ESth_Wait:
00007D22 4EB9 0000 0000             		jsr	DisplaySprite ; Temp comment
00007D22 4EB9 0000 0000             		jsr	DisplaySprite ; Temp comment
00007D28                            Map_ESon:	include	"_maps\Ending Sequence Sonic.asm"
00007D28                            ; ================================================================================
00007D28                            ; Sprite Mappings - generated by Flex 2 Sun Nov 28 2021 13:50:33 GMT-0500 (Eastern Standard Time)
00007D28                            ; ================================================================================
00007D28                            
00007D28                            DATA1DX3I7NZ3PG:
00007D28 0000 0000                  	dc.w DATA1DX3I7NZ3PG_0-DATA1DX3I7NZ3PG, DATA1DX3I7NZ3PG_1-DATA1DX3I7NZ3PG
00007D2C 0000 0000                  	dc.w DATA1DX3I7NZ3PG_2-DATA1DX3I7NZ3PG, DATA1DX3I7NZ3PG_3-DATA1DX3I7NZ3PG
00007D30 0000 0000                  	dc.w DATA1DX3I7NZ3PG_4-DATA1DX3I7NZ3PG, DATA1DX3I7NZ3PG_5-DATA1DX3I7NZ3PG
00007D34 0000 0000                  	dc.w DATA1DX3I7NZ3PG_6-DATA1DX3I7NZ3PG, DATA1DX3I7NZ3PG_7-DATA1DX3I7NZ3PG
00007D38 02                         DATA1DX3I7NZ3PG_0: dc.b $2
00007D39 EC0B 0000 F8               	dc.b $EC, $B, $0, $0, $F8
00007D3E 0C0C 000C F0               	dc.b $C, $C, $0, $C, $F0
00007D43 03                         DATA1DX3I7NZ3PG_1: dc.b $3
00007D44 FD0D 0010 F0               	dc.b $FD, $D, $0, $10, $F0
00007D49 EC0B 0000 F8               	dc.b $EC, $B, $0, $0, $F8
00007D4E 0C0C 000C F0               	dc.b $C, $C, $0, $C, $F0
00007D53 02                         DATA1DX3I7NZ3PG_2: dc.b $2
00007D54 EC09 0018 F8               	dc.b $EC, $9, $0, $18, $F8
00007D59 FC0E 001E F0               	dc.b $FC, $E, $0, $1E, $F0
00007D5E 02                         DATA1DX3I7NZ3PG_3: dc.b $2
00007D5F EC09 002A F8               	dc.b $EC, $9, $0, $2A, $F8
00007D64 FC0E 0030 F0               	dc.b $FC, $E, $0, $30, $F0
00007D69 02                         DATA1DX3I7NZ3PG_4: dc.b $2
00007D6A EC09 082A F0               	dc.b $EC, $9, $8, $2A, $F0
00007D6F FC0E 0830 F0               	dc.b $FC, $E, $8, $30, $F0
00007D74 03                         DATA1DX3I7NZ3PG_5: dc.b $3
00007D75 EC06 003C F0               	dc.b $EC, $6, $0, $3C, $F0
00007D7A EC06 083C 00               	dc.b $EC, $6, $8, $3C, $0
00007D7F 040D 0042 F0               	dc.b $4, $D, $0, $42, $F0
00007D84 07                         DATA1DX3I7NZ3PG_6: dc.b $7
00007D85 B20C 004A F8               	dc.b $B2, $C, $0, $4A, $F8
00007D8A BA0F 004E F0               	dc.b $BA, $F, $0, $4E, $F0
00007D8F BA05 005E 10               	dc.b $BA, $5, $0, $5E, $10
00007D94 CA02 0062 10               	dc.b $CA, $2, $0, $62, $10
00007D99 DA0C 0065 F0               	dc.b $DA, $C, $0, $65, $F0
00007D9E E208 0069 F8               	dc.b $E2, $8, $0, $69, $F8
00007DA3 EA05 006C F8               	dc.b $EA, $5, $0, $6C, $F8
00007DA8 18                         DATA1DX3I7NZ3PG_7: dc.b $18
00007DA9 800F 0070 F8               	dc.b $80, $F, $0, $70, $F8
00007DAE 900B 0080 E0               	dc.b $90, $B, $0, $80, $E0
00007DB3 900B 008C 18               	dc.b $90, $B, $0, $8C, $18
00007DB8 980B 0098 30               	dc.b $98, $B, $0, $98, $30
00007DBD A00F 00A4 58               	dc.b $A0, $F, $0, $A4, $58
00007DC2 8800 00B4 F0               	dc.b $88, $0, $0, $B4, $F0
00007DC7 8005 00B5 18               	dc.b $80, $5, $0, $B5, $18
00007DCC A00F 00B9 F8               	dc.b $A0, $F, $0, $B9, $F8
00007DD1 B00B 00C9 E0               	dc.b $B0, $B, $0, $C9, $E0
00007DD6 B80F 00D5 38               	dc.b $B8, $F, $0, $D5, $38
00007DDB A805 00E5 48               	dc.b $A8, $5, $0, $E5, $48
00007DE0 C002 00E9 58               	dc.b $C0, $2, $0, $E9, $58
00007DE5 C00F 00EC F8               	dc.b $C0, $F, $0, $EC, $F8
00007DEA B80F 00FC 18               	dc.b $B8, $F, $0, $FC, $18
00007DEF B008 010C 18               	dc.b $B0, $8, $1, $C, $18
00007DF4 D80D 010F 30               	dc.b $D8, $D, $1, $F, $30
00007DF9 D808 0117 18               	dc.b $D8, $8, $1, $17, $18
00007DFE D80F 011A D8               	dc.b $D8, $F, $1, $1A, $D8
00007E03 E00D 012A F8               	dc.b $E0, $D, $1, $2A, $F8
00007E08 E000 0132 28               	dc.b $E0, $0, $1, $32, $28
00007E0D D004 0133 E0               	dc.b $D0, $4, $1, $33, $E0
00007E12 E805 0135 C8               	dc.b $E8, $5, $1, $35, $C8
00007E17 F80C 0139 C8               	dc.b $F8, $C, $1, $39, $C8
00007E1C F006 013D F8               	dc.b $F0, $6, $1, $3D, $F8
00007E22 00                         	even
00007E22 00                         	even
00007E22                            Map_ECha:	include	"_maps\Ending Sequence Emeralds.asm"
00007E22                            ; ---------------------------------------------------------------------------
00007E22                            ; Sprite mappings - chaos emeralds on the ending sequence
00007E22                            ; ---------------------------------------------------------------------------
00007E22                            Map_ECha_internal:
00007E22 0000                       		dc.w M_ECha_1-Map_ECha_internal
00007E24 0000                       		dc.w M_ECha_2-Map_ECha_internal
00007E26 0000                       		dc.w M_ECha_3-Map_ECha_internal
00007E28 0000                       		dc.w M_ECha_4-Map_ECha_internal
00007E2A 0000                       		dc.w M_ECha_5-Map_ECha_internal
00007E2C 0000                       		dc.w M_ECha_6-Map_ECha_internal
00007E2E 0000                       		dc.w M_ECha_7-Map_ECha_internal
00007E30 01                         M_ECha_1:	dc.b 1
00007E31 F805 0000 F8               		dc.b $F8, 5, 0,	0, $F8
00007E36 01                         M_ECha_2:	dc.b 1
00007E37 F805 0004 F8               		dc.b $F8, 5, 0,	4, $F8
00007E3C 01                         M_ECha_3:	dc.b 1
00007E3D F805 4010 F8               		dc.b $F8, 5, $40, $10, $F8
00007E42 01                         M_ECha_4:	dc.b 1
00007E43 F805 2018 F8               		dc.b $F8, 5, $20, $18, $F8
00007E48 01                         M_ECha_5:	dc.b 1
00007E49 F805 4014 F8               		dc.b $F8, 5, $40, $14, $F8
00007E4E 01                         M_ECha_6:	dc.b 1
00007E4F F805 0008 F8               		dc.b $F8, 5, 0,	8, $F8
00007E54 01                         M_ECha_7:	dc.b 1
00007E55 F805 000C F8               		dc.b $F8, 5, 0,	$C, $F8
00007E5A                            		even
00007E5A                            		even
00007E5A                            Map_ESth:	include	"_maps\Ending Sequence STH.asm"
00007E5A                            ; ---------------------------------------------------------------------------
00007E5A                            ; Sprite mappings - "SONIC THE HEDGEHOG" text on the ending sequence
00007E5A                            ; ---------------------------------------------------------------------------
00007E5A                            Map_ESth_internal:
00007E5A 0000                       		dc.w M_ESth_1-Map_ESth_internal
00007E5C 03                         M_ESth_1:	dc.b 3
00007E5D F00F 0000 D0               		dc.b $F0, $F, 0, 0, $D0
00007E62 F00F 0010 F0               		dc.b $F0, $F, 0, $10, $F0
00007E67 F00F 0020 10               		dc.b $F0, $F, 0, $20, $10
00007E6C                            		even
00007E6C                            		even
00007E6C                            
00007E6C                            ; ===========================================================================
00007E6C                            ; ---------------------------------------------------------------------------
00007E6C                            ; Credits ending sequence
00007E6C                            ; ---------------------------------------------------------------------------
00007E6C                            
00007E6C                            GM_Credits:
00007E6C 6100 B6E6                  		bsr.w	ClearPLC
00007E70 6100 C188                  		bsr.w	PaletteFadeOut
00007E74 4DF9 00C0 0004             		lea	(vdp_control_port).l,a6
00007E7A 3CBC 8004                  		move.w	#$8004,(a6)		; 8-colour mode
00007E7E 3CBC 8230                  		move.w	#$8200+(vram_fg>>10),(a6) ; set foreground nametable address
00007E82 3CBC 8407                  		move.w	#$8400+(vram_bg>>13),(a6) ; set background nametable address
00007E86 3CBC 9001                  		move.w	#$9001,(a6)		; 64-cell hscroll size
00007E8A 3CBC 9200                  		move.w	#$9200,(a6)		; window vertical position
00007E8E 3CBC 8B03                  		move.w	#$8B03,(a6)		; line scroll mode
00007E92 3CBC 8720                  		move.w	#$8720,(a6)		; set background colour (line 3; colour 0)
00007E96 4238 F64E                  		clr.b	(f_wtr_state).w
00007E9A 6100 B3AA                  		bsr.w	ClearScreen
00007E9E                            
00007E9E 43F8 D000                  		lea	(v_objspace).w,a1
00007EA2 7000                       		moveq	#0,d0
00007EA4 323C 07FF                  		move.w	#$7FF,d1
00007EA8                            	Cred_ClrObjRam:
00007EA8 22C0                       		move.l	d0,(a1)+
00007EAA 51C9 FFFC                  		dbf	d1,Cred_ClrObjRam ; clear object RAM
00007EAE                            
00007EB8 41F9 0000 0000             		lea	(Nem_TitleCard).l,a0 ;	load credits alphabet patterns
00007EBE 6100 B50C                  		bsr.w	NemDec
00007EC2                            
00007EC2 43F8 FB80                  		lea	(v_pal_dry_dup).w,a1
00007EC6 7000                       		moveq	#0,d0
00007EC8 323C 001F                  		move.w	#$1F,d1
00007ECC                            	Cred_ClrPal:
00007ECC 22C0                       		move.l	d0,(a1)+
00007ECE 51C9 FFFC                  		dbf	d1,Cred_ClrPal ; fill palette with black
00007ED2                            
00007ED2 7014                       		moveq	#palid_Ending,d0
00007ED4 6100 C31C                  		bsr.w	PalLoad1	; load Sonic's palette
00007ED8 11FC 0000 D080             		move.b	#id_CreditsText,(v_objspace+$80).w ; load credits object
00007EDE 4EB9 0000 0000             		jsr	(ExecuteObjects).l
00007EE4 4EB9 0000 0000             		jsr	(BuildSprites).l
00007EEA 6100 0000                  		bsr.w	EndingDemoLoad
00007EEE 7000                       		moveq	#0,d0
00007EF0 1038 FE10                  		move.b	(v_zone).w,d0
00007EF4 E948                       		lsl.w	#4,d0
00007EF6 45F9 0000 0000             		lea	(LevelHeaders).l,a2
00007EFC 45F2 0000                  		lea	(a2,d0.w),a2
00007F00 7000                       		moveq	#0,d0
00007F02 1012                       		move.b	(a2),d0
00007F04 6700                       		beq.s	Cred_SkipObjGfx
00007F06 6100 B5EE                  		bsr.w	AddPLC		; load object graphics
00007F0A                            
00007F0A                            	Cred_SkipObjGfx:
00007F0A 7000                       		moveq	#plcid_Main2,d0
00007F0C 6100 B5E8                  		bsr.w	AddPLC		; load standard	level graphics
00007F10 31FC 0078 F614             		move.w	#120,(v_demolength).w ; display a credit for 2 seconds
00007F16 6100 C03C                  		bsr.w	PaletteFadeIn
00007F1A                            
00007F1A                            Cred_WaitLoop:
00007F1A 11FC 0004 F62A             		move.b	#4,(v_vbla_routine).w
00007F20 6100 CCFC                  		bsr.w	WaitForVBla
00007F24 6100 B63C                  		bsr.w	RunPLC
00007F28 4A78 F614                  		tst.w	(v_demolength).w ; have 2 seconds elapsed?
00007F2C 66EC                       		bne.s	Cred_WaitLoop	; if not, branch
00007F2E 4AB8 F680                  		tst.l	(v_plc_buffer).w ; have level gfx finished decompressing?
00007F32 66E6                       		bne.s	Cred_WaitLoop	; if not, branch
00007F34 0C78 0009 FFF4             		cmpi.w	#9,(v_creditsnum).w ; have the credits finished?
00007F3A 6700 0000                  		beq.w	TryAgainEnd	; if yes, branch
00007F3E 4E75                       		rts	
00007F40                            
00007F40                            ; ---------------------------------------------------------------------------
00007F40                            ; Ending sequence demo loading subroutine
00007F40                            ; ---------------------------------------------------------------------------
00007F40                            
00007F40                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00007F40                            
00007F40                            
00007F40                            EndingDemoLoad:
00007F40 3038 FFF4                  		move.w	(v_creditsnum).w,d0
00007F44 0240 000F                  		andi.w	#$F,d0
00007F48 D040                       		add.w	d0,d0
00007F4A 303B 0000                  		move.w	EndDemo_Levels(pc,d0.w),d0 ; load level	array
00007F4E 31C0 FE10                  		move.w	d0,(v_zone).w	; set level from level array
00007F52 5278 FFF4                  		addq.w	#1,(v_creditsnum).w
00007F56 0C78 0009 FFF4             		cmpi.w	#9,(v_creditsnum).w ; have credits finished?
00007F5C 6400                       		bhs.s	EndDemo_Exit	; if yes, branch
00007F5E 31FC 8001 FFF0             		move.w	#$8001,(f_demo).w ; set demo+ending mode
00007F64 11FC 0000 F600             		move.b	#id_Demo,(v_gamemode).w ; set game mode to 8 (demo)
00007F6A 11FC 0003 FE12             		move.b	#3,(v_lives).w	; set lives to 3
00007F70 7000                       		moveq	#0,d0
00007F72 31C0 FE20                  		move.w	d0,(v_rings).w	; clear rings
00007F76 21C0 FE22                  		move.l	d0,(v_time).w	; clear time
00007F7A 21C0 FE26                  		move.l	d0,(v_score).w	; clear score
00007F7E 11C0 FE30                  		move.b	d0,(v_lastlamp).w ; clear lamppost counter
00007F82 0C78 0004 FFF4             		cmpi.w	#4,(v_creditsnum).w ; is SLZ demo running?
00007F88 6600                       		bne.s	EndDemo_Exit	; if not, branch
00007F8A 43F9 0000 0000             		lea	(EndDemo_LampVar).l,a1 ; load lamppost variables
00007F90 45F8 FE30                  		lea	(v_lastlamp).w,a2
00007F94 303C 0008                  		move.w	#8,d0
00007F98                            
00007F98                            	EndDemo_LampLoad:
00007F98 24D9                       		move.l	(a1)+,(a2)+
00007F9A 51C8 FFFC                  		dbf	d0,EndDemo_LampLoad
00007F9E                            
00007F9E                            EndDemo_Exit:
00007F9E 4E75                       		rts	
00007FA0                            ; End of function EndingDemoLoad
00007FA0                            
00007FA0                            ; ===========================================================================
00007FA0                            ; ---------------------------------------------------------------------------
00007FA0                            ; Levels used in the end sequence demos
00007FA0                            ; ---------------------------------------------------------------------------
00007FA0                            EndDemo_Levels:	incbin	"misc\Demo Level Order - Ending.bin"
00007FB0                            
00007FB0                            ; ---------------------------------------------------------------------------
00007FB0                            ; Lamppost variables in the end sequence demo (Star Light Zone)
00007FB0                            ; ---------------------------------------------------------------------------
00007FB0                            EndDemo_LampVar:
00007FB0 0101                       		dc.b 1,	1		; number of the last lamppost
00007FB2 0A00 062C                  		dc.w $A00, $62C		; x/y-axis position
00007FB6 000D                       		dc.w 13			; rings
00007FB8 0000 0000                  		dc.l 0			; time
00007FBC 0000                       		dc.b 0,	0		; dynamic level event routine counter
00007FBE 0800                       		dc.w $800		; level bottom boundary
00007FC0 0957 05CC                  		dc.w $957, $5CC		; x/y axis screen position
00007FC4 04AB 03A6 0000 028C 0000+  		dc.w $4AB, $3A6, 0, $28C, 0, 0 ; scroll info
00007FD0 0308                       		dc.w $308		; water height
00007FD2 0101                       		dc.b 1,	1		; water routine and state
00007FD4                            ; ===========================================================================
00007FD4                            ; ---------------------------------------------------------------------------
00007FD4                            ; "TRY AGAIN" and "END"	screens
00007FD4                            ; ---------------------------------------------------------------------------
00007FD4                            
00007FD4                            TryAgainEnd:
00007FD4 6100 B57E                  		bsr.w	ClearPLC
00007FD8 6100 C020                  		bsr.w	PaletteFadeOut
00007FDC 4DF9 00C0 0004             		lea	(vdp_control_port).l,a6
00007FE2 3CBC 8004                  		move.w	#$8004,(a6)	; use 8-colour mode
00007FE6 3CBC 8230                  		move.w	#$8200+(vram_fg>>10),(a6) ; set foreground nametable address
00007FEA 3CBC 8407                  		move.w	#$8400+(vram_bg>>13),(a6) ; set background nametable address
00007FEE 3CBC 9001                  		move.w	#$9001,(a6)	; 64-cell hscroll size
00007FF2 3CBC 9200                  		move.w	#$9200,(a6)	; window vertical position
00007FF6 3CBC 8B03                  		move.w	#$8B03,(a6)	; line scroll mode
00007FFA 3CBC 8720                  		move.w	#$8720,(a6)	; set background colour (line 3; colour 0)
00007FFE 4238 F64E                  		clr.b	(f_wtr_state).w
00008002 6100 B242                  		bsr.w	ClearScreen
00008006                            
00008006 43F8 D000                  		lea	(v_objspace).w,a1
0000800A 7000                       		moveq	#0,d0
0000800C 323C 07FF                  		move.w	#$7FF,d1
00008010                            	TryAg_ClrObjRam:
00008010 22C0                       		move.l	d0,(a1)+
00008012 51C9 FFFC                  		dbf	d1,TryAg_ClrObjRam ; clear object RAM
00008016                            
00008016 7000                       		moveq	#plcid_TryAgain,d0
00008018 6100 B648                  		bsr.w	QuickPLC	; load "TRY AGAIN" or "END" patterns
0000801C                            
0000801C 43F8 FB80                  		lea	(v_pal_dry_dup).w,a1
00008020 7000                       		moveq	#0,d0
00008022 323C 001F                  		move.w	#$1F,d1
00008026                            	TryAg_ClrPal:
00008026 22C0                       		move.l	d0,(a1)+
00008028 51C9 FFFC                  		dbf	d1,TryAg_ClrPal ; fill palette with black
0000802C                            
0000802C 7014                       		moveq	#palid_Ending,d0
0000802E 6100 C1C2                  		bsr.w	PalLoad1	; load ending palette
00008032 4278 FBC0                  		clr.w	(v_pal_dry_dup+$40).w
00008036 11FC 0000 D080             		move.b	#id_EndEggman,(v_objspace+$80).w ; load Eggman object
0000803C 4EB9 0000 0000             		jsr	(ExecuteObjects).l
00008042 4EB9 0000 0000             		jsr	(BuildSprites).l
00008048 31FC 0708 F614             		move.w	#1800,(v_demolength).w ; show screen for 30 seconds
0000804E 6100 BF04                  		bsr.w	PaletteFadeIn
00008052                            
00008052                            ; ---------------------------------------------------------------------------
00008052                            ; "TRY AGAIN" and "END"	screen main loop
00008052                            ; ---------------------------------------------------------------------------
00008052                            TryAg_MainLoop:
00008052 6100 B2D6                  		bsr.w	PauseGame
00008056 11FC 0004 F62A             		move.b	#4,(v_vbla_routine).w
0000805C 6100 CBC0                  		bsr.w	WaitForVBla
00008060 4EB9 0000 0000             		jsr	(ExecuteObjects).l
00008066 4EB9 0000 0000             		jsr	(BuildSprites).l
0000806C 0238 0080 F605             		andi.b	#btnStart,(v_jpadpress1).w ; is Start button pressed?
00008072 6600                       		bne.s	TryAg_Exit	; if yes, branch
00008074 4A78 F614                  		tst.w	(v_demolength).w ; has 30 seconds elapsed?
00008078 6700                       		beq.s	TryAg_Exit	; if yes, branch
0000807A 0C38 0000 F600             		cmpi.b	#id_Credits,(v_gamemode).w
00008080 67D0                       		beq.s	TryAg_MainLoop
00008082                            
00008082                            TryAg_Exit:
00008082 11FC 0000 F600             		move.b	#id_Sega,(v_gamemode).w ; goto Sega screen
00008088 4E75                       		rts	
0000808A                            
0000808A                            ; ===========================================================================
0000808A                            
0000808A                            		include	"_incObj\8B Try Again & End Eggman.asm"
0000808A                            ; ---------------------------------------------------------------------------
0000808A                            ; Object 8B - Eggman on "TRY AGAIN" and "END"	screens
0000808A                            ; ---------------------------------------------------------------------------
0000808A                            
0000808A                            EndEggman:
0000808A 7000                       		moveq	#0,d0
0000808C 1028 0024                  		move.b	obRoutine(a0),d0
00008090 323B 0000                  		move.w	EEgg_Index(pc,d0.w),d1
00008094 4EBB 1000                  		jsr	EEgg_Index(pc,d1.w)
00008098 4EF9 0000 0000             		jmp	(DisplaySprite).l
0000809E                            ; ===========================================================================
0000809E 0000                       EEgg_Index:	dc.w EEgg_Main-EEgg_Index
000080A0 0000                       		dc.w EEgg_Animate-EEgg_Index
000080A2 0000                       		dc.w EEgg_Juggle-EEgg_Index
000080A4 0000                       		dc.w EEgg_Wait-EEgg_Index
000080A6                            
000080A6 =00000030                  eegg_time:	equ $30		; time between juggle motions
000080A6                            ; ===========================================================================
000080A6                            
000080A6                            EEgg_Main:	; Routine 0
000080A6 5428 0024                  		addq.b	#2,obRoutine(a0)
000080AA 317C 0120 0008             		move.w	#$120,obX(a0)
000080B0 317C 00F4 000A             		move.w	#$F4,obScreenY(a0)
000080B6 217C 0000 0000 0004        		move.l	#Map_EEgg,obMap(a0)
000080BE 317C 03E1 0002             		move.w	#$3E1,obGfx(a0)
000080C4 117C 0000 0001             		move.b	#0,obRender(a0)
000080CA 117C 0002 0018             		move.b	#2,obPriority(a0)
000080D0 117C 0002 001C             		move.b	#2,obAnim(a0)	; use "END" animation
000080D6 0C38 0006 FE57             		cmpi.b	#6,(v_emeralds).w ; do you have all 6 emeralds?
000080DC 6700                       		beq.s	EEgg_Animate	; if yes, branch
000080DE                            
000080DE 11FC 0000 D0C0             		move.b	#id_CreditsText,(v_objspace+$C0).w ; load credits object
000080E4 31FC 0009 FFF4             		move.w	#9,(v_creditsnum).w ; use "TRY AGAIN" text
000080EA 11FC 0000 D800             		move.b	#id_TryChaos,(v_objspace+$800).w ; load emeralds object on "TRY AGAIN" screen
000080F0 117C 0000 001C             		move.b	#0,obAnim(a0)	; use "TRY AGAIN" animation
000080F6                            
000080F6                            EEgg_Animate:	; Routine 2
000080F6 43F9 0000 0000             		lea	(Ani_EEgg).l,a1
000080FC 4EF9 0000 0000             		jmp	(AnimateSprite).l
00008102                            ; ===========================================================================
00008102                            
00008102                            EEgg_Juggle:	; Routine 4
00008102 5428 0024                  		addq.b	#2,obRoutine(a0)
00008106 7002                       		moveq	#2,d0
00008108 0828 0000 001C             		btst	#0,obAnim(a0)
0000810E 6700                       		beq.s	@noflip
00008110 4440                       		neg.w	d0
00008112                            
00008112                            	@noflip:
00008112 43F8 D800                  		lea	(v_objspace+$800).w,a1 ; get RAM address for emeralds
00008116 7205                       		moveq	#5,d1
00008118                            
00008118                            @emeraldloop:
00008118 1340 003E                  		move.b	d0,$3E(a1)
0000811C 3400                       		move.w	d0,d2
0000811E E742                       		asl.w	#3,d2
00008120 D529 0026                  		add.b	d2,obAngle(a1)
00008124 43E9 0040                  		lea	$40(a1),a1
00008128                            	;	dbf	d1,@emeraldloop ; temp comment
00008128 5228 001A                  		addq.b	#1,obFrame(a0)
0000812C 317C 0070 0030             		move.w	#112,eegg_time(a0)
00008132                            
00008132                            EEgg_Wait:	; Routine 6
00008132 5368 0030                  		subq.w	#1,eegg_time(a0) ; decrement timer
00008136                            	;	bpl.s	@nochg		; branch if time remains ; temp comment
00008136 0868 0000 001C             		bchg	#0,obAnim(a0)
0000813C 117C 0002 0024             		move.b	#2,obRoutine(a0) ; goto EEgg_Animate next
00008142                            
00008142                            	@nochg:
00008142 4E75                       		rts	
00008142 4E75                       		rts	
00008144                            		include "_anim\Try Again & End Eggman.asm"
00008144                            ; ---------------------------------------------------------------------------
00008144                            ; Animation script - Eggman on the "TRY AGAIN" and "END" screens
00008144                            ; ---------------------------------------------------------------------------
00008144                            Ani_EEgg:	;dc.w @tryagain1-Ani_EEgg ; temp comments
00008144                            ;		dc.w @tryagain2-Ani_EEgg
00008144                            ;		dc.w @end-Ani_EEgg
00008144                            ;@tryagain1:	dc.b 5,	0, afRoutine, 1
00008144                            ;@tryagain2:	dc.b 5,	2, afRoutine, 3
00008144                            ;@end:		dc.b 7,	4, 5, 6, 5, 4, 5, 6, 5,	4, 5, 6, 5, 7, 5, 6, 5,	afEnd
00008144                            		even
00008144                            		even
00008144                            		include	"_incObj\8C Try Again Emeralds.asm"
00008144                            ; ---------------------------------------------------------------------------
00008144                            ; Object 8C - chaos emeralds on	the "TRY AGAIN"	screen
00008144                            ; ---------------------------------------------------------------------------
00008144                            
00008144                            TryChaos:
00008144 7000                       		moveq	#0,d0
00008146 1028 0024                  		move.b	obRoutine(a0),d0
0000814A 323B 0000                  		move.w	TCha_Index(pc,d0.w),d1
0000814E 4EBB 1000                  		jsr	TCha_Index(pc,d1.w)
00008152 4EF9 0000 0000             		jmp	(DisplaySprite).l
00008158                            ; ===========================================================================
00008158 0000                       TCha_Index:	dc.w TCha_Main-TCha_Index
0000815A 0000                       		dc.w TCha_Move-TCha_Index
0000815C                            ; ===========================================================================
0000815C                            
0000815C                            TCha_Main:	; Routine 0
0000815C 2248                       		movea.l	a0,a1
0000815E 7400                       		moveq	#0,d2
00008160 7600                       		moveq	#0,d3
00008162 7205                       		moveq	#5,d1
00008164 9238 FE57                  		sub.b	(v_emeralds).w,d1
00008168                            
00008168                            @makeemerald:
00008168 12BC 0000                  		move.b	#id_TryChaos,(a1) ; load emerald object
0000816C 5429 0024                  		addq.b	#2,obRoutine(a1)
00008170 237C 0000 7E22 0004        		move.l	#Map_ECha,obMap(a1)
00008178 337C 03C5 0002             		move.w	#$3C5,obGfx(a1)
0000817E 137C 0000 0001             		move.b	#0,obRender(a1)
00008184 137C 0001 0018             		move.b	#1,obPriority(a1)
0000818A 337C 0104 0008             		move.w	#$104,obX(a1)
00008190 337C 0120 0038             		move.w	#$120,$38(a1)
00008196 337C 00EC 000A             		move.w	#$EC,obScreenY(a1)
0000819C 3369 000A 003A             		move.w	obScreenY(a1),$3A(a1)
000081A2 137C 001C 003C             		move.b	#$1C,$3C(a1)
000081A8 47F8 FE58                  		lea	(v_emldlist).w,a3
000081AC                            
000081AC                            	@chkemerald:
000081AC 7000                       		moveq	#0,d0
000081AE 1038 FE57                  		move.b	(v_emeralds).w,d0
000081B2 5340                       		subq.w	#1,d0
000081B4 6500                       		bcs.s	@loc_5B42
000081B6                            
000081B6                            	@chkloop:
000081B6 B433 0000                  		cmp.b	(a3,d0.w),d2
000081BA 6600                       		bne.s	@notgot
000081BC 5202                       		addq.b	#1,d2
000081BE 60EC                       		bra.s	@chkemerald
000081C0                            ; ===========================================================================
000081C0                            
000081C0                            	@notgot:
000081C0 51C8 FFF4                  		dbf	d0,@chkloop
000081C4                            
000081C4                            @loc_5B42:
000081C4 1342 001A                  		move.b	d2,obFrame(a1)
000081C8 5229 001A                  		addq.b	#1,obFrame(a1)
000081CC 5202                       		addq.b	#1,d2
000081CE 137C 0080 0026             		move.b	#$80,obAngle(a1)
000081D4 1343 001E                  		move.b	d3,obTimeFrame(a1)
000081D8 1343 001F                  		move.b	d3,obDelayAni(a1)
000081DC 0643 000A                  		addi.w	#10,d3
000081E0 43E9 0040                  		lea	$40(a1),a1
000081E4 51C9 FF82                  		dbf	d1,@makeemerald	; repeat 5 times
000081E8                            
000081E8                            TCha_Move:	; Routine 2
000081E8 4A68 003E                  		tst.w	$3E(a0)
000081EC 6700                       		beq.s	locret_5BBA
000081EE 4A28 001E                  		tst.b	obTimeFrame(a0)
000081F2 6700                       		beq.s	loc_5B78
000081F4 5328 001E                  		subq.b	#1,obTimeFrame(a0)
000081F8 6600                       		bne.s	loc_5B80
000081FA                            
000081FA                            loc_5B78:
000081FA 3028 003E                  		move.w	$3E(a0),d0
000081FE D168 0026                  		add.w	d0,obAngle(a0)
00008202                            
00008202                            loc_5B80:
00008202 1028 0026                  		move.b	obAngle(a0),d0
00008206 6700                       		beq.s	loc_5B8C
00008208 0C00 0080                  		cmpi.b	#$80,d0
0000820C 6600                       		bne.s	loc_5B96
0000820E                            
0000820E                            loc_5B8C:
0000820E 4268 003E                  		clr.w	$3E(a0)
00008212 1168 001F 001E             		move.b	obDelayAni(a0),obTimeFrame(a0)
00008218                            
00008218                            loc_5B96:
00008218 4EB9 0000 4C50             		jsr	(CalcSine).l
0000821E 7800                       		moveq	#0,d4
00008220 1828 003C                  		move.b	$3C(a0),d4
00008224 C3C4                       		muls.w	d4,d1
00008226 E081                       		asr.l	#8,d1
00008228 C1C4                       		muls.w	d4,d0
0000822A E080                       		asr.l	#8,d0
0000822C D268 0038                  		add.w	$38(a0),d1
00008230 D068 003A                  		add.w	$3A(a0),d0
00008234 3141 0008                  		move.w	d1,obX(a0)
00008238 3140 000A                  		move.w	d0,obScreenY(a0)
0000823C                            
0000823C                            locret_5BBA:
0000823C 4E75                       		rts	
0000823C 4E75                       		rts	
0000823E                            Map_EEgg:	include	"_maps\Try Again & End Eggman.asm"
0000823E                            ; ---------------------------------------------------------------------------
0000823E                            ; Sprite mappings - Robotnik on	the "TRY AGAIN"	and "END" screens
0000823E                            ; ---------------------------------------------------------------------------
0000823E                            Map_EEgg_internal:
0000823E 0000                       		dc.w M_EEgg_Try1-Map_EEgg_internal
00008240 0000                       		dc.w M_EEgg_Try2-Map_EEgg_internal
00008242 0000                       		dc.w M_EEgg_Try3-Map_EEgg_internal
00008244 0000                       		dc.w M_EEgg_Try4-Map_EEgg_internal
00008246 0000                       		dc.w M_EEgg_End1-Map_EEgg_internal
00008248 0000                       		dc.w M_EEgg_End2-Map_EEgg_internal
0000824A 0000                       		dc.w M_EEgg_End3-Map_EEgg_internal
0000824C 0000                       		dc.w M_EEgg_End4-Map_EEgg_internal
0000824E 08                         M_EEgg_Try1:	dc.b 8
0000824F E905 0000 F0               		dc.b $E9, 5, 0,	0, $F0
00008254 F90C 0004 E0               		dc.b $F9, $C, 0, 4, $E0
00008259 E904 0008 00               		dc.b $E9, 4, 0,	8, 0
0000825E F10D 000A 00               		dc.b $F1, $D, 0, $A, 0
00008263 0106 0023 F0               		dc.b 1,	6, 0, $23, $F0
00008268 0106 0823 00               		dc.b 1,	6, 8, $23, 0
0000826D 1804 0029 EC               		dc.b $18, 4, 0,	$29, $EC
00008272 1804 0829 04               		dc.b $18, 4, 8,	$29, 4
00008277 08                         M_EEgg_Try2:	dc.b 8
00008278 E80D 0012 E0               		dc.b $E8, $D, 0, $12, $E0
0000827D F808 001A E8               		dc.b $F8, 8, 0,	$1A, $E8
00008282 E805 0800 00               		dc.b $E8, 5, 8,	0, 0
00008287 F80C 0804 00               		dc.b $F8, $C, 8, 4, 0
0000828C 0006 001D F0               		dc.b 0,	6, 0, $1D, $F0
00008291 0006 081D 00               		dc.b 0,	6, 8, $1D, 0
00008296 1804 0029 EC               		dc.b $18, 4, 0,	$29, $EC
0000829B 1804 0829 04               		dc.b $18, 4, 8,	$29, 4
000082A0 08                         M_EEgg_Try3:	dc.b 8
000082A1 E904 0808 F0               		dc.b $E9, 4, 8,	8, $F0
000082A6 F10D 080A E0               		dc.b $F1, $D, 8, $A, $E0
000082AB E905 0800 00               		dc.b $E9, 5, 8,	0, 0
000082B0 F90C 0804 00               		dc.b $F9, $C, 8, 4, 0
000082B5 0106 0023 F0               		dc.b 1,	6, 0, $23, $F0
000082BA 0106 0823 00               		dc.b 1,	6, 8, $23, 0
000082BF 1804 0029 EC               		dc.b $18, 4, 0,	$29, $EC
000082C4 1804 0829 04               		dc.b $18, 4, 8,	$29, 4
000082C9 08                         M_EEgg_Try4:	dc.b 8
000082CA E805 0000 F0               		dc.b $E8, 5, 0,	0, $F0
000082CF F80C 0004 E0               		dc.b $F8, $C, 0, 4, $E0
000082D4 E80D 0812 00               		dc.b $E8, $D, 8, $12, 0
000082D9 F808 081A 00               		dc.b $F8, 8, 8,	$1A, 0
000082DE 0006 001D F0               		dc.b 0,	6, 0, $1D, $F0
000082E3 0006 081D 00               		dc.b 0,	6, 8, $1D, 0
000082E8 1804 0029 EC               		dc.b $18, 4, 0,	$29, $EC
000082ED 1804 0829 04               		dc.b $18, 4, 8,	$29, 4
000082F2 0C                         M_EEgg_End1:	dc.b $C
000082F3 ED0A 002B E8               		dc.b $ED, $A, 0, $2B, $E8
000082F8 F500 0034 E0               		dc.b $F5, 0, 0,	$34, $E0
000082FD 0504 0035 F0               		dc.b 5,	4, 0, $35, $F0
00008302 0D08 0037 E8               		dc.b $D, 8, 0, $37, $E8
00008307 ED0A 082B 00               		dc.b $ED, $A, 8, $2B, 0
0000830C F500 0834 18               		dc.b $F5, 0, 8,	$34, $18
00008311 0504 0835 00               		dc.b 5,	4, 8, $35, 0
00008316 0D08 0837 00               		dc.b $D, 8, 8, $37, 0
0000831B 100D 0073 E0               		dc.b $10, $D, 0, $73, $E0
00008320 100D 007B 00               		dc.b $10, $D, 0, $7B, 0
00008325 1C0C 005B E0               		dc.b $1C, $C, 0, $5B, $E0
0000832A 1C0C 085B 00               		dc.b $1C, $C, 8, $5B, 0
0000832F 0A                         M_EEgg_End2:	dc.b $A
00008330 D207 003A F0               		dc.b $D2, 7, 0,	$3A, $F0
00008335 DA00 0042 E8               		dc.b $DA, 0, 0,	$42, $E8
0000833A F207 0043 F0               		dc.b $F2, 7, 0,	$43, $F0
0000833F D207 083A 00               		dc.b $D2, 7, 8,	$3A, 0
00008344 DA00 0842 10               		dc.b $DA, 0, 8,	$42, $10
00008349 F207 0843 00               		dc.b $F2, 7, 8,	$43, 0
0000834E 100D 0067 E8               		dc.b $10, $D, 0, $67, $E8
00008353 1005 006F 08               		dc.b $10, 5, 0,	$6F, 8
00008358 1C0C 005F E0               		dc.b $1C, $C, 0, $5F, $E0
0000835D 1C0C 085F 00               		dc.b $1C, $C, 8, $5F, 0
00008362 0A                         M_EEgg_End3:	dc.b $A
00008363 C40B 004B E8               		dc.b $C4, $B, 0, $4B, $E8
00008368 E408 0057 E8               		dc.b $E4, 8, 0,	$57, $E8
0000836D EC00 005A F0               		dc.b $EC, 0, 0,	$5A, $F0
00008372 C40B 084B 00               		dc.b $C4, $B, 8, $4B, 0
00008377 E408 0857 00               		dc.b $E4, 8, 8,	$57, 0
0000837C EC00 085A 08               		dc.b $EC, 0, 8,	$5A, 8
00008381 100D 0067 E8               		dc.b $10, $D, 0, $67, $E8
00008386 1005 006F 08               		dc.b $10, 5, 0,	$6F, 8
0000838B 1C0C 0063 E0               		dc.b $1C, $C, 0, $63, $E0
00008390 1C0C 0863 00               		dc.b $1C, $C, 8, $63, 0
00008395 0C                         M_EEgg_End4:	dc.b $C
00008396 F40A 002B E8               		dc.b $F4, $A, 0, $2B, $E8
0000839B FC00 0034 E0               		dc.b $FC, 0, 0,	$34, $E0
000083A0 0C04 0035 F0               		dc.b $C, 4, 0, $35, $F0
000083A5 1408 0037 E8               		dc.b $14, 8, 0,	$37, $E8
000083AA F40A 082B 00               		dc.b $F4, $A, 8, $2B, 0
000083AF FC00 0834 18               		dc.b $FC, 0, 8,	$34, $18
000083B4 0C04 0835 00               		dc.b $C, 4, 8, $35, 0
000083B9 1408 0837 00               		dc.b $14, 8, 8,	$37, 0
000083BE 180C 0083 E0               		dc.b $18, $C, 0, $83, $E0
000083C3 180C 0087 00               		dc.b $18, $C, 0, $87, 0
000083C8 1C0C 005B E0               		dc.b $1C, $C, 0, $5B, $E0
000083CD 1C0C 085B 00               		dc.b $1C, $C, 8, $5B, 0
000083D2                            		even
000083D2                            		even
000083D2                            
000083D2                            ; ---------------------------------------------------------------------------
000083D2                            ; Ending sequence demos
000083D2                            ; ---------------------------------------------------------------------------
000083D2                            Demo_EndGHZ1:	incbin	"demodata\Ending - GHZ1.bin"
00008400                            		even
00008400                            Demo_EndMZ:	incbin	"demodata\Ending - MZ.bin"
00008440                            		even
00008440                            Demo_EndSYZ:	incbin	"demodata\Ending - SYZ.bin"
00008470                            		even
00008470                            Demo_EndLZ:	incbin	"demodata\Ending - LZ.bin"
000084A0                            		even
000084A0                            Demo_EndSLZ:	incbin	"demodata\Ending - SLZ.bin"
000084C0                            		even
000084C0                            Demo_EndSBZ1:	incbin	"demodata\Ending - SBZ1.bin"
000084E0                            		even
000084E0                            Demo_EndSBZ2:	incbin	"demodata\Ending - SBZ2.bin"
00008510                            		even
00008510                            Demo_EndGHZ2:	incbin	"demodata\Ending - GHZ2.bin"
00008540                            		even
00008540                            
00008540                            		include	"_inc\LevelSizeLoad & BgScrollSpeed.asm"
00008540                            ; ---------------------------------------------------------------------------
00008540                            ; Subroutine to	load level boundaries and start	locations
00008540                            ; ---------------------------------------------------------------------------
00008540                            
00008540                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00008540                            
00008540                            
00008540                            LevelSizeLoad:
00008540 7000                       		moveq	#0,d0
00008542 11C0 F740                  		move.b	d0,($FFFFF740).w
00008546 11C0 F741                  		move.b	d0,($FFFFF741).w
0000854A 11C0 F746                  		move.b	d0,($FFFFF746).w
0000854E 11C0 F748                  		move.b	d0,($FFFFF748).w
00008552 11C0 F742                  		move.b	d0,(v_dle_routine).w
00008556 3038 FE10                  		move.w	(v_zone).w,d0
0000855A ED08                       		lsl.b	#6,d0
0000855C E848                       		lsr.w	#4,d0
0000855E 3200                       		move.w	d0,d1
00008560 D040                       		add.w	d0,d0
00008562 D041                       		add.w	d1,d0
00008564 41FB 0000                  		lea	LevelSizeArray(pc,d0.w),a0 ; load level	boundaries
00008568 3018                       		move.w	(a0)+,d0
0000856A 31C0 F730                  		move.w	d0,($FFFFF730).w
0000856E 2018                       		move.l	(a0)+,d0
00008570 21C0 F728                  		move.l	d0,(v_limitleft2).w
00008574 21C0 F720                  		move.l	d0,(v_limitleft1).w
00008578 2018                       		move.l	(a0)+,d0
0000857A 21C0 F72C                  		move.l	d0,(v_limittop2).w
0000857E 21C0 F724                  		move.l	d0,(v_limittop1).w
00008582 3038 F728                  		move.w	(v_limitleft2).w,d0
00008586 0640 0240                  		addi.w	#$240,d0
0000858A 31C0 F732                  		move.w	d0,(v_limitleft3).w
0000858E 31FC 1010 F74A             		move.w	#$1010,($FFFFF74A).w
00008594 3018                       		move.w	(a0)+,d0
00008596 31C0 F73E                  		move.w	d0,(v_lookshift).w
0000859A 6000 0000                  		bra.w	LevSz_ChkLamp
0000859E                            ; ===========================================================================
0000859E                            ; ---------------------------------------------------------------------------
0000859E                            ; Level size array
0000859E                            ; ---------------------------------------------------------------------------
0000859E                            LevelSizeArray:
0000859E                            		; GHZ
0000859E 0004 0000 24BF 0000 0300+  		dc.w $0004, $0000, $24BF, $0000, $0300, $0060
000085AA 0004 0000 2050 0000 0220+  		dc.w $0004, $0000, $2050, $0000, $0220, $0060
000085B6 0004 0000 295C 0000 0300+  		dc.w $0004, $0000, $295C, $0000, $0300, $0060
000085C2 0004 0000 2ABF 0000 0300+  		dc.w $0004, $0000, $2ABF, $0000, $0300, $0060
000085CE                            		; LZ
000085CE 0004 0000 19BF 0000 0530+  		dc.w $0004, $0000, $19BF, $0000, $0530, $0060
000085DA 0004 0000 10AF 0000 0720+  		dc.w $0004, $0000, $10AF, $0000, $0720, $0060
000085E6 0004 0000 202F FF00 0800+  		dc.w $0004, $0000, $202F, $FF00, $0800, $0060
000085F2 0004 0000 20BF 0000 0720+  		dc.w $0004, $0000, $20BF, $0000, $0720, $0060
000085FE                            		; MZ
000085FE 0004 0000 17BF 0000 0320+  		dc.w $0004, $0000, $17BF, $0000, $0320, $0060
0000860A 0004 0000 17BF 0000 0520+  		dc.w $0004, $0000, $17BF, $0000, $0520, $0060
00008616 0004 0000 1800 0000 0720+  		dc.w $0004, $0000, $1800, $0000, $0720, $0060
00008622 0004 0000 16BF 0000 0720+  		dc.w $0004, $0000, $16BF, $0000, $0720, $0060
0000862E                            		; SLZ
0000862E 0004 0000 1FBF 0000 0640+  		dc.w $0004, $0000, $1FBF, $0000, $0640, $0060
0000863A 0004 0000 1FBF 0000 0640+  		dc.w $0004, $0000, $1FBF, $0000, $0640, $0060
00008646 0004 0000 2000 0000 06C0+  		dc.w $0004, $0000, $2000, $0000, $06C0, $0060
00008652 0004 0000 3EC0 0000 0720+  		dc.w $0004, $0000, $3EC0, $0000, $0720, $0060
0000865E                            		; SYZ
0000865E 0004 0000 1F60 0000 0420+  		dc.w $0004, $0000, $1F60, $0000, $0420, $0060
0000866A 0004 0000 28C0 0000 0520+  		dc.w $0004, $0000, $28C0, $0000, $0520, $0060
00008676 0004 0000 2C00 0000 0620+  		dc.w $0004, $0000, $2C00, $0000, $0620, $0060
00008682 0004 0000 2EC0 0000 0620+  		dc.w $0004, $0000, $2EC0, $0000, $0620, $0060
0000868E                            		; SBZ
0000868E 0004 0000 21C0 0000 0720+  		dc.w $0004, $0000, $21C0, $0000, $0720, $0060
0000869A 0004 0000 1E40 FF00 0800+  		dc.w $0004, $0000, $1E40, $FF00, $0800, $0060
000086A6 0004 0000 1E40 FF00 0800+  		dc.w $0004, $0000, $1E40, $FF00, $0800, $0060
000086B2 0004 0000 3EC0 0000 0720+  		dc.w $0004, $0000, $3EC0, $0000, $0720, $0060
000086BE                            		; Ending
000086BE 0004 0000 1300 0000 0720+  		dc.w $0004, $0000, $1300, $0000, $0720, $0060
000086CA 0004 0000 1E40 FF00 0800+  		dc.w $0004, $0000, $1E40, $FF00, $0800, $0060
000086D6 0004 2080 2460 0510 0510+  		dc.w $0004, $2080, $2460, $0510, $0510, $0060
000086E2 0004 0000 3EC0 0000 0720+  		dc.w $0004, $0000, $3EC0, $0000, $0720, $0060
000086EE                            		
000086EE 0004 0000 0D50 0000 0200+  		dc.w $0004, $0000, $0D50, $0000, $0200, $0060
000086FA 0004 0000 1E40 FF00 0800+  		dc.w $0004, $0000, $1E40, $FF00, $0800, $0060
00008706 0004 2080 2460 0510 0510+  		dc.w $0004, $2080, $2460, $0510, $0510, $0060
00008712 0004 0000 3EC0 0000 0720+  		dc.w $0004, $0000, $3EC0, $0000, $0720, $0060
0000871E                            		
0000871E 0004 0000 21C0 0000 0720+  		dc.w $0004, $0000, $21C0, $0000, $0720, $0060
0000872A 0004 0000 1E40 FF00 0800+  		dc.w $0004, $0000, $1E40, $FF00, $0800, $0060
00008736 0004 2080 2460 0510 0510+  		dc.w $0004, $2080, $2460, $0510, $0510, $0060
00008742 0004 0000 3EC0 0000 0720+  		dc.w $0004, $0000, $3EC0, $0000, $0720, $0060
0000874E 0004 0000 21C0 0000 0720+  		dc.w $0004, $0000, $21C0, $0000, $0720, $0060
0000875A 0004 0000 1E40 FF00 0800+  		dc.w $0004, $0000, $1E40, $FF00, $0800, $0060
00008766 0004 2080 2460 0510 0510+  		dc.w $0004, $2080, $2460, $0510, $0510, $0060
00008772 0004 0000 3EC0 0000 0720+  		dc.w $0004, $0000, $3EC0, $0000, $0720, $0060		
0000877E 0004 0000 21C0 0000 0720+  		dc.w $0004, $0000, $21C0, $0000, $0720, $0060
0000878A 0004 0000 1E40 FF00 0800+  		dc.w $0004, $0000, $1E40, $FF00, $0800, $0060
00008796 0004 2080 2460 0510 0510+  		dc.w $0004, $2080, $2460, $0510, $0510, $0060
000087A2 0004 0000 3EC0 0000 0720+  		dc.w $0004, $0000, $3EC0, $0000, $0720, $0060
000087AE                            
000087AE                            ; ---------------------------------------------------------------------------
000087AE                            ; Ending start location array
000087AE                            ; ---------------------------------------------------------------------------
000087AE                            EndingStLocArray:
000087AE                            		include	"_inc\Start Location Array - Ending.asm"
000087AE                            ; ---------------------------------------------------------------------------
000087AE                            ; Ending start location array
000087AE                            ; ---------------------------------------------------------------------------
000087AE                            
000087AE                            		incbin	"startpos\ghz1 (Credits demo 1).bin"
000087B2                            		incbin	"startpos\mz2 (Credits demo).bin"
000087B6                            		incbin	"startpos\syz3 (Credits demo).bin"
000087BA                            		incbin	"startpos\lz3 (Credits demo).bin"
000087BE                            		incbin	"startpos\slz3 (Credits demo).bin"
000087C2                            		incbin	"startpos\sbz1 (Credits demo).bin"
000087C6                            		incbin	"startpos\sbz2 (Credits demo).bin"
000087CA                            		incbin	"startpos\ghz1 (Credits demo 2).bin"
000087CE                            		even
000087CE                            		even
000087CE                            
000087CE                            ; ===========================================================================
000087CE                            
000087CE                            LevSz_ChkLamp:
000087CE 4A38 FE30                  		tst.b	(v_lastlamp).w	; have any lampposts been hit?
000087D2 6700                       		beq.s	LevSz_StartLoc	; if not, branch
000087D4                            
000087D4 4EB9 0000 0000             		jsr	(Lamp_LoadInfo).l
000087DA 3238 D008                  		move.w	(v_player+obX).w,d1
000087DE 3038 D00C                  		move.w	(v_player+obY).w,d0
000087E2 6000 0000                  		bra.w	LevSz_SkipStartPos
000087E6                            ; ===========================================================================
000087E6                            
000087E6                            LevSz_StartLoc:
000087E6 3038 FE10                  		move.w	(v_zone).w,d0
000087EA ED08                       		lsl.b	#6,d0
000087EC E848                       		lsr.w	#4,d0
000087EE 43FB 0000                  		lea	StartLocArray(pc,d0.w),a1 ; load Sonic's start location
000087F2 4A78 FFF0                  		tst.w	(f_demo).w	; is ending demo mode on?
000087F6 6A00 0000                  		bpl.w	LevSz_SonicPos	; if not, branch
000087FA                            
000087FA 3038 FFF4                  		move.w	(v_creditsnum).w,d0
000087FE 5340                       		subq.w	#1,d0
00008800 E548                       		lsl.w	#2,d0
00008802 43FB 00AA                  		lea	EndingStLocArray(pc,d0.w),a1 ; load Sonic's start location
00008806                            	
00008806                            StartLocArray:	include	"_inc\Start Location Array - Levels.asm"
00008806                            ; ---------------------------------------------------------------------------
00008806                            ; Sonic start location array
00008806                            ; ---------------------------------------------------------------------------
00008806                            
00008806                            		incbin	"startpos\ghz1.bin"
0000880A                            		incbin	"startpos\ghz2.bin"
0000880E                            		incbin	"startpos\ghz3.bin"
00008812 0080 00A8                  		dc.w	$80,$A8
00008816                            
00008816                            		incbin	"startpos\lz1.bin"
0000881A                            		incbin	"startpos\lz2.bin"
0000881E                            		incbin	"startpos\lz3.bin"
00008822                            		incbin	"startpos\sbz3.bin"
00008826                            
00008826                            		incbin	"startpos\mz1.bin"
0000882A                            		incbin	"startpos\mz2.bin"
0000882E                            		incbin	"startpos\mz3.bin"
00008832 0080 00A8                  		dc.w	$80,$A8
00008836                            
00008836                            		incbin	"startpos\slz1.bin"
0000883A                            		incbin	"startpos\slz2.bin"
0000883E                            		incbin	"startpos\slz3.bin"
00008842 0080 00A8                  		dc.w	$80,$A8
00008846                            
00008846                            		incbin	"startpos\syz1.bin"
0000884A                            		incbin	"startpos\syz2.bin"
0000884E                            		incbin	"startpos\syz3.bin"
00008852 0080 00A8                  		dc.w	$80,$A8
00008856                            
00008856                            		incbin	"startpos\sbz1.bin"
0000885A                            		incbin	"startpos\sbz2.bin"
0000885E                            		incbin	"startpos\fz.bin"
00008862 0080 00A8                  		dc.w	$80,$A8
00008866                            
00008866                            		incbin	"startpos\end1.bin"
0000886A                            		incbin	"startpos\end2.bin"
0000886E 0080 00A8                  		dc.w	$80,$A8
00008872 0080 00A8                  		dc.w	$80,$A8
00008876                            		
00008876                            		incbin	"startpos\imz1.bin"
0000887A 0080 00A8                  		dc.w	$80,$A8
0000887E 0080 00A8                  		dc.w	$80,$A8
00008882 0080 00A8                  		dc.w	$80,$A8
00008886                            		
00008886                            		incbin	"startpos\csz1.bin"
0000888A 0080 00A8                  		dc.w	$80,$A8
0000888E 0080 00A8                  		dc.w	$80,$A8
00008892 0080 00A8                  		dc.w	$80,$A8
00008896                            		
00008896                            		incbin	"startpos\end2.bin"
0000889A 0080 00A8                  		dc.w	$80,$A8
0000889E 0080 00A8                  		dc.w	$80,$A8
000088A2 0080 00A8                  		dc.w	$80,$A8		
000088A6 0080 00A8                  		dc.w	$80,$A8
000088AA 0080 00A8                  		dc.w	$80,$A8
000088AE 0080 00A8                  		dc.w	$80,$A8
000088B2 0080 00A8                  		dc.w	$80,$A8
000088B6                            
000088B6                            		even
000088B6                            		even
000088B6                            
000088B6                            LevSz_SonicPos:
000088B6 7200                       		moveq	#0,d1
000088B8 3219                       		move.w	(a1)+,d1
000088BA 31C1 D008                  		move.w	d1,(v_player+obX).w ; set Sonic's position on x-axis
000088BE 7000                       		moveq	#0,d0
000088C0 3011                       		move.w	(a1),d0
000088C2 31C0 D00C                  		move.w	d0,(v_player+obY).w ; set Sonic's position on y-axis
000088C6                            
000088C6                            SetScreen:
000088C6                            	LevSz_SkipStartPos:
000088C6 0441 00A0                  		subi.w	#160,d1		; is Sonic more than 160px from left edge?
000088CA 6400                       		bcc.s	SetScr_WithinLeft ; if yes, branch
000088CC 7200                       		moveq	#0,d1
000088CE                            
000088CE                            	SetScr_WithinLeft:
000088CE 3438 F72A                  		move.w	(v_limitright2).w,d2
000088D2 B242                       		cmp.w	d2,d1		; is Sonic inside the right edge?
000088D4 6500                       		bcs.s	SetScr_WithinRight ; if yes, branch
000088D6 3202                       		move.w	d2,d1
000088D8                            
000088D8                            	SetScr_WithinRight:
000088D8 31C1 F700                  		move.w	d1,(v_screenposx).w ; set horizontal screen position
000088DC                            
000088DC 0440 0060                  		subi.w	#96,d0		; is Sonic within 96px of upper edge?
000088E0 6400                       		bcc.s	SetScr_WithinTop ; if yes, branch
000088E2 7000                       		moveq	#0,d0
000088E4                            
000088E4                            	SetScr_WithinTop:
000088E4 B078 F72E                  		cmp.w	(v_limitbtm2).w,d0 ; is Sonic above the bottom edge?
000088E8 6D00                       		blt.s	SetScr_WithinBottom ; if yes, branch
000088EA 3038 F72E                  		move.w	(v_limitbtm2).w,d0
000088EE                            
000088EE                            	SetScr_WithinBottom:
000088EE 31C0 F704                  		move.w	d0,(v_screenposy).w ; set vertical screen position
000088F2 6100 0000                  		bsr.w	BgScrollSpeed
000088F6 7000                       		moveq	#0,d0
000088F8 1038 FE10                  		move.b	(v_zone).w,d0
000088FC E508                       		lsl.b	#2,d0
000088FE 21FB 0000 F7AC             		move.l	LoopTileNums(pc,d0.w),(v_256loop1).w
00008904 6000 0000                  		bra.w	LevSz_LoadScrollBlockSize
00008908                            ; ===========================================================================
00008908                            ; ---------------------------------------------------------------------------
00008908                            ; Which	256x256	tiles contain loops or roll-tunnels
00008908                            ; ---------------------------------------------------------------------------
00008908                            
00008908                            LoopTileNums:
00008908                            
00008908                            ; 		loop	loop	tunnel	tunnel
00008908                            
00008908 B57F 1F20                  	dc.b	$B5,	$7F,	$1F,	$20	; Green Hill
0000890C 7F7F 7F7F                  	dc.b	$7F,	$7F,	$7F,	$7F	; Labyrinth
00008910 7F7F 7F7F                  	dc.b	$7F,	$7F,	$7F,	$7F	; Marble
00008914 B5A8 7F7F                  	dc.b	$B5,	$A8,	$7F,	$7F	; Star Light
00008918 7F7F 7F7F                  	dc.b	$7F,	$7F,	$7F,	$7F	; Spring Yard
0000891C 7F7F 7F7F                  	dc.b	$7F,	$7F,	$7F,	$7F	; Scrap Brain
00008920 7F7F 7F7F                  	dc.b	$7F,	$7F,	$7F,	$7F	; Ending (Green Hill)
00008924                            
00008924                            		even
00008924                            
00008924                            ; ===========================================================================
00008924                            ; LevSz_Unk:
00008924                            LevSz_LoadScrollBlockSize:
00008924 7000                       		moveq	#0,d0
00008926 1038 FE10                  		move.b	(v_zone).w,d0
0000892A E748                       		lsl.w	#3,d0
0000892C 43FB 0000                  		lea	BGScrollBlockSizes(pc,d0.w),a1
00008930 45F8 F7F0                  		lea	(v_scroll_block_1_size).w,a2
00008934 24D9                       		move.l	(a1)+,(a2)+
00008936 24D9                       		move.l	(a1)+,(a2)+
00008938 4E75                       		rts	
0000893A                            ; End of function LevelSizeLoad
0000893A                            
0000893A                            ; ===========================================================================
0000893A                            ; dword_61B4:
0000893A                            BGScrollBlockSizes:
0000893A                            		; GHZ
0000893A 0070                       		dc.w $70
0000893C 0100                       		dc.w $100	; I guess these used to be per act?
0000893E 0100                       		dc.w $100	; Or maybe each scroll block got its own size?
00008940 0100                       		dc.w $100	; Either way, these are unused now.
00008942                            		; LZ
00008942 0800                       		dc.w $800
00008944 0100                       		dc.w $100
00008946 0100                       		dc.w $100
00008948 0000                       		dc.w 0
0000894A                            		; MZ
0000894A 0800                       		dc.w $800
0000894C 0100                       		dc.w $100
0000894E 0100                       		dc.w $100
00008950 0000                       		dc.w 0
00008952                            		; SLZ
00008952 0800                       		dc.w $800
00008954 0100                       		dc.w $100
00008956 0100                       		dc.w $100
00008958 0000                       		dc.w 0
0000895A                            		; SYZ
0000895A 0800                       		dc.w $800
0000895C 0100                       		dc.w $100
0000895E 0100                       		dc.w $100
00008960 0000                       		dc.w 0
00008962                            		; SBZ
00008962 0800                       		dc.w $800
00008964 0100                       		dc.w $100
00008966 0100                       		dc.w $100
00008968 0000                       		dc.w 0
0000896A                            		; Ending
0000896A 0070                       		dc.w $70
0000896C 0100                       		dc.w $100
0000896E 0100                       		dc.w $100
00008970 0100                       		dc.w $100
00008972                            
00008972                            ; ---------------------------------------------------------------------------
00008972                            ; Subroutine to	set scroll speed of some backgrounds
00008972                            ; ---------------------------------------------------------------------------
00008972                            
00008972                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00008972                            
00008972                            
00008972                            BgScrollSpeed:
00008972 4A38 FE30                  		tst.b	(v_lastlamp).w
00008976 6600                       		bne.s	loc_6206
00008978 31C0 F70C                  		move.w	d0,(v_bgscreenposy).w
0000897C 31C0 F714                  		move.w	d0,(v_bg2screenposy).w
00008980 31C1 F708                  		move.w	d1,(v_bgscreenposx).w
00008984 31C1 F710                  		move.w	d1,(v_bg2screenposx).w
00008988 31C1 F718                  		move.w	d1,(v_bg3screenposx).w
0000898C                            
0000898C                            loc_6206:
0000898C 7400                       		moveq	#0,d2
0000898E 1438 FE10                  		move.b	(v_zone).w,d2
00008992 D442                       		add.w	d2,d2
00008994 343B 2000                  		move.w	BgScroll_Index(pc,d2.w),d2
00008998 4EFB 2000                  		jmp	BgScroll_Index(pc,d2.w)
0000899C                            ; End of function BgScrollSpeed
0000899C                            
0000899C                            ; ===========================================================================
0000899C 0000 0000                  BgScroll_Index:	dc.w BgScroll_GHZ-BgScroll_Index, BgScroll_LZ-BgScroll_Index
000089A0 0000 0000                  		dc.w BgScroll_MZ-BgScroll_Index, BgScroll_SLZ-BgScroll_Index
000089A4 0000 0000                  		dc.w BgScroll_SYZ-BgScroll_Index, BgScroll_SBZ-BgScroll_Index
000089A8 0000 0000                  		dc.w BgScroll_End-BgScroll_Index, BgScroll_End-BgScroll_Index
000089AC 0000 0000                  		dc.w BgScroll_End-BgScroll_Index, BgScroll_End-BgScroll_Index
000089B0                            ; ===========================================================================
000089B0                            
000089B0                            BgScroll_GHZ:
000089B0 42B8 F708                  		clr.l	(v_bgscreenposx).w
000089B4 42B8 F70C                  		clr.l	(v_bgscreenposy).w
000089B8 42B8 F714                  		clr.l	(v_bg2screenposy).w
000089BC 42B8 F71C                  		clr.l	(v_bg3screenposy).w
000089C0 45F8 A800                  		lea	($FFFFA800).w,a2
000089C4 429A                       		clr.l	(a2)+
000089C6 429A                       		clr.l	(a2)+
000089C8 429A                       		clr.l	(a2)+
000089CA 4E75                       		rts
000089CC                            ; ===========================================================================
000089CC                            
000089CC                            BgScroll_LZ:
000089CC E280                       		asr.l	#1,d0
000089CE 31C0 F70C                  		move.w	d0,(v_bgscreenposy).w
000089D2 4E75                       		rts	
000089D4                            ; ===========================================================================
000089D4                            
000089D4                            BgScroll_MZ:
000089D4 4E75                       		rts	
000089D6                            ; ===========================================================================
000089D6                            
000089D6                            BgScroll_SLZ:
000089D6 E280                       		asr.l	#1,d0
000089D8 0640 00C0                  		addi.w	#$C0,d0
000089DC 31C0 F70C                  		move.w	d0,(v_bgscreenposy).w
000089E0 42B8 F708                  		clr.l	(v_bgscreenposx).w
000089E4 4E75                       		rts	
000089E6                            ; ===========================================================================
000089E6                            
000089E6                            BgScroll_SYZ:
000089E6 E980                       		asl.l	#4,d0
000089E8 2400                       		move.l	d0,d2
000089EA E380                       		asl.l	#1,d0
000089EC D082                       		add.l	d2,d0
000089EE E080                       		asr.l	#8,d0
000089F0 5240                       		addq.w	#1,d0
000089F2 31C0 F70C                  		move.w	d0,(v_bgscreenposy).w
000089F6 42B8 F708                  		clr.l	(v_bgscreenposx).w
000089FA 4E75                       		rts	
000089FC                            ; ===========================================================================
000089FC                            
000089FC                            BgScroll_SBZ:
000089FC 0240 07F8                  		andi.w	#$7F8,d0
00008A00 E640                       		asr.w	#3,d0
00008A02 5240                       		addq.w	#1,d0
00008A04 31C0 F70C                  		move.w	d0,(v_bgscreenposy).w
00008A08 4E75                       		rts	
00008A0A                            ; ===========================================================================
00008A0A                            
00008A0A                            BgScroll_End:
00008A0A 3038 F700                  		move.w	(v_screenposx).w,d0
00008A0E E240                       		asr.w	#1,d0
00008A10 31C0 F708                  		move.w	d0,(v_bgscreenposx).w
00008A14 31C0 F710                  		move.w	d0,(v_bg2screenposx).w
00008A18 E440                       		asr.w	#2,d0
00008A1A 3200                       		move.w	d0,d1
00008A1C D040                       		add.w	d0,d0
00008A1E D041                       		add.w	d1,d0
00008A20 31C0 F718                  		move.w	d0,(v_bg3screenposx).w
00008A24 42B8 F70C                  		clr.l	(v_bgscreenposy).w
00008A28 42B8 F714                  		clr.l	(v_bg2screenposy).w
00008A2C 42B8 F71C                  		clr.l	(v_bg3screenposy).w
00008A30 45F8 A800                  		lea	($FFFFA800).w,a2
00008A34 429A                       		clr.l	(a2)+
00008A36 429A                       		clr.l	(a2)+
00008A38 429A                       		clr.l	(a2)+
00008A3A 4E75                       		rts
00008A3A 4E75                       		rts
00008A3C                            		include	"_inc\DeformLayers (JP1).asm"
00008A3C                            ; ---------------------------------------------------------------------------
00008A3C                            ; Background layer deformation subroutines
00008A3C                            ; ---------------------------------------------------------------------------
00008A3C                            
00008A3C                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00008A3C                            
00008A3C                            
00008A3C                            DeformLayers:
00008A3C 4A38 F744                  		tst.b	(f_nobgscroll).w
00008A40 6700                       		beq.s	@bgscroll
00008A42 4E75                       		rts	
00008A44                            ; ===========================================================================
00008A44                            
00008A44                            	@bgscroll:
00008A44 4278 F754                  		clr.w	(v_fg_scroll_flags).w
00008A48 4278 F756                  		clr.w	(v_bg1_scroll_flags).w
00008A4C 4278 F758                  		clr.w	(v_bg2_scroll_flags).w
00008A50 4278 F75A                  		clr.w	(v_bg3_scroll_flags).w
00008A54 6100 0000                  		bsr.w	ScrollHoriz
00008A58 6100 0000                  		bsr.w	ScrollVertical
00008A5C 6100 0000                  		bsr.w	DynamicLevelEvents
00008A60 31F8 F704 F616             		move.w	(v_screenposy).w,(v_scrposy_dup).w
00008A66 31F8 F70C F618             		move.w	(v_bgscreenposy).w,(v_bgscrposy_dup).w
00008A6C 7000                       		moveq	#0,d0
00008A6E 1038 FE10                  		move.b	(v_zone).w,d0
00008A72 D040                       		add.w	d0,d0
00008A74 303B 0000                  		move.w	Deform_Index(pc,d0.w),d0
00008A78 4EFB 0000                  		jmp	Deform_Index(pc,d0.w)
00008A7C                            ; End of function DeformLayers
00008A7C                            
00008A7C                            ; ===========================================================================
00008A7C                            ; ---------------------------------------------------------------------------
00008A7C                            ; Offset index for background layer deformation	code
00008A7C                            ; ---------------------------------------------------------------------------
00008A7C 0000 0000                  Deform_Index:	dc.w Deform_GHZ-Deform_Index, Deform_LZ-Deform_Index
00008A80 0000 0000                  		dc.w Deform_MZ-Deform_Index, Deform_SLZ-Deform_Index
00008A84 0000 0000                  		dc.w Deform_SYZ-Deform_Index, Deform_SBZ-Deform_Index
00008A88 0000 0000                  		dc.w Deform_SBZ-Deform_Index, Deform_GHZ-Deform_Index
00008A8C 0000                       		dc.w Deform_CSZ-Deform_Index
00008A8E                            ; ---------------------------------------------------------------------------
00008A8E                            ; Green	Hill Zone background layer deformation code
00008A8E                            ; ---------------------------------------------------------------------------
00008A8E                            
00008A8E                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00008A8E                            
00008A8E                            Deform_GHZ:
00008A8E                            	; block 3 - distant mountains
00008A8E 3838 F73A                  		move.w	(v_scrshiftx).w,d4
00008A92 48C4                       		ext.l	d4
00008A94 E584                       		asl.l	#2,d4
00008A96 2204                       		move.l	d4,d1
00008A98 E384                       		asl.l	#1,d4
00008A9A D881                       		add.l	d1,d4
00008A9C 7C00                       		moveq	#0,d6
00008A9E 6100 0000                  		bsr.w	BGScroll_Block3
00008AA2                            	; block 2 - hills & waterfalls
00008AA2 3838 F73A                  		move.w	(v_scrshiftx).w,d4
00008AA6 48C4                       		ext.l	d4
00008AA8 EB84                       		asl.l	#5,d4
00008AAA 7C00                       		moveq	#0,d6
00008AAC 6100 0000                  		bsr.w	BGScroll_Block2
00008AB0                            	; calculate Y position
00008AB0 43F8 CC00                  		lea	(v_hscrolltablebuffer).w,a1
00008AB4 3038 F704                  		move.w	(v_screenposy).w,d0
00008AB8 0240 07FF                  		andi.w	#$7FF,d0
00008ABC EA48                       		lsr.w	#5,d0
00008ABE 4440                       		neg.w	d0
00008AC0 0640 0010                  		addi.w	#$10,d0
00008AC4 6A00                       		bpl.s	@limitY
00008AC6 7000                       		moveq	#0,d0
00008AC8                            	@limitY:
00008AC8 3800                       		move.w	d0,d4
00008ACA 31C0 F618                  		move.w	d0,(v_bgscrposy_dup).w
00008ACE 3038 F700                  		move.w	(v_screenposx).w,d0
00008AD2 0C38 0000 F600             		cmpi.b	#id_Title,(v_gamemode).w
00008AD8 6600                       		bne.s	@notTitle
00008ADA 7000                       		moveq	#0,d0	; reset foreground position in title screen
00008ADC                            	@notTitle:
00008ADC 4440                       		neg.w	d0
00008ADE 4840                       		swap	d0
00008AE0                            	; auto-scroll clouds
00008AE0 45F8 A800                  		lea	(v_bgscroll_buffer).w,a2
00008AE4 069A 0000 8000             		addi.l	#$8000,(a2)+
00008AEA 069A 0000 8000             		addi.l	#$8000,(a2)+
00008AF0 069A 0000 8000             		addi.l	#$8000,(a2)+
00008AF6                            	; calculate background scroll	
00008AF6 3038 A800                  		move.w	(v_bgscroll_buffer).w,d0
00008AFA D078 F718                  		add.w	(v_bg3screenposx).w,d0
00008AFE 4440                       		neg.w	d0
00008B00 323C 001F                  		move.w	#$1F,d1
00008B04 9244                       		sub.w	d4,d1
00008B06 6500                       		bcs.s	@gotoCloud2
00008B08                            	@cloudLoop1:		; upper cloud (32px)
00008B08 22C0                       		move.l	d0,(a1)+
00008B0A 51C9 FFFC                  		dbf	d1,@cloudLoop1
00008B0E                            
00008B0E                            	@gotoCloud2:
00008B0E 3038 A804                  		move.w	(v_bgscroll_buffer+4).w,d0
00008B12 D078 F718                  		add.w	(v_bg3screenposx).w,d0
00008B16 4440                       		neg.w	d0
00008B18 323C 000F                  		move.w	#$F,d1
00008B1C                            	@cloudLoop2:		; middle cloud (16px)
00008B1C 22C0                       		move.l	d0,(a1)+
00008B1E 51C9 FFFC                  		dbf	d1,@cloudLoop2
00008B22                            
00008B22 3038 A808                  		move.w	(v_bgscroll_buffer+8).w,d0
00008B26 D078 F718                  		add.w	(v_bg3screenposx).w,d0
00008B2A 4440                       		neg.w	d0
00008B2C 323C 000F                  		move.w	#$F,d1
00008B30                            	@cloudLoop3:		; lower cloud (16px)
00008B30 22C0                       		move.l	d0,(a1)+
00008B32 51C9 FFFC                  		dbf	d1,@cloudLoop3
00008B36                            
00008B36 323C 006E                  		move.w	#$6E,d1
00008B3A 3038 F718                  		move.w	(v_bg3screenposx).w,d0
00008B3E 4440                       		neg.w	d0
00008B40                            	@mountainLoop:		; distant mountains (48px)
00008B40 22C0                       		move.l	d0,(a1)+
00008B42 51C9 FFFC                  		dbf	d1,@mountainLoop
00008B46                            
00008B46 323C 0000                  		move.w	#$00,d1
00008B4A 3038 F710                  		move.w	(v_bg2screenposx).w,d0
00008B4E 4440                       		neg.w	d0
00008B50                            	@hillLoop:			; hills & waterfalls (40px)
00008B50 22C0                       		move.l	d0,(a1)+
00008B52 51C9 FFFC                  		dbf	d1,@hillLoop
00008B56                            
00008B56 3038 F710                  		move.w	(v_bg2screenposx).w,d0
00008B5A 3438 F700                  		move.w	(v_screenposx).w,d2
00008B5E 9440                       		sub.w	d0,d2
00008B60 48C2                       		ext.l	d2
00008B62 E182                       		asl.l	#8,d2
00008B64 85FC 0068                  		divs.w	#$68,d2
00008B68 48C2                       		ext.l	d2
00008B6A E182                       		asl.l	#8,d2
00008B6C 7600                       		moveq	#0,d3
00008B6E 3600                       		move.w	d0,d3
00008B70 323C 0047                  		move.w	#$47,d1
00008B74 D244                       		add.w	d4,d1
00008B76                            	@waterLoop:			; water deformation
00008B76 3003                       		move.w	d3,d0
00008B78 4440                       		neg.w	d0
00008B7A 22C0                       		move.l	d0,(a1)+
00008B7C                            	;	swap	d3
00008B7C                            	;	add.l	d2,d3
00008B7C                            	;	swap	d3
00008B7C 51C9 FFF8                  		dbf	d1,@waterLoop
00008B80 4E75                       		rts
00008B82                            ; End of function Deform_GHZ
00008B82                            
00008B82                            ; ---------------------------------------------------------------------------
00008B82                            ; Labyrinth Zone background layer deformation code
00008B82                            ; ---------------------------------------------------------------------------
00008B82                            
00008B82                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00008B82                            Deform_LZ:
00008B82 3838 F73A                  		move.w	(v_scrshiftx).w,d4
00008B86 48C4                       		ext.l	d4
00008B88 EF84                       		asl.l	#7,d4
00008B8A 3A38 F73C                  		move.w	(v_scrshifty).w,d5
00008B8E 48C5                       		ext.l	d5
00008B90 EF85                       		asl.l	#7,d5
00008B92 6100 0000                  		bsr.w	BGScroll_Block1
00008B96 31FC 0000 F70C             		move.w #$0,($FFFFF70C).w
00008B9C 31F8 F70C F618             		move.w	(v_bgscreenposy).w,(v_bgscrposy_dup).w
00008BA2 43F8 CC00                  		lea	($FFFFCC00).w,a1	; load beginning address of horizontal scroll buffer to a1
00008BA6                            
00008BA6 3038 F700                  		move.w	($FFFFF700).w,d0	; load FG screen's X position
00008BAA 4440                       		neg.w	d0			; negate (positive to negative)
00008BAC 4840                       		swap	d0			; send to the left side of d0
00008BAE 3038 F708                  		move.w	($FFFFF708).w,d0	; load BG screen's X position
00008BB2 4440                       		neg.w	d0			; negate (positive to negative)
00008BB4 E240                       		asr.w	#1,d0			; divide by 2 (Slow down the scroll position)
00008BB6 323C 002F                  		move.w	#48-1,d1		; set number of scan lines to dump (minus 1 for dbf)
00008BBA                            LZ_DeformLoop_1:
00008BBA 22C0                       		move.l	d0,(a1)+		; dump both the FG and BG scanline position to buffer
00008BBC 51C9 FFFC                  		dbf	d1,LZ_DeformLoop_1	; repeat d1 number of scanlines
00008BC0                            
00008BC0 3038 F700                  		move.w	($FFFFF700).w,d0	; load FG screen's X position
00008BC4 4440                       		neg.w	d0			; negate (positive to negative)
00008BC6 4840                       		swap	d0			; send to the left side of d0
00008BC8 3038 F708                  		move.w	($FFFFF708).w,d0	; load BG screen's X position
00008BCC 4440                       		neg.w	d0			; negate (positive to negative)
00008BCE E440                       		asr.w	#2,d0			; divide by 4 (Slow down the scroll position)
00008BD0 323C 0017                  		move.w	#24-1,d1		; set number of scan lines to dump (minus 1 for dbf)
00008BD4                            LZ_DeformLoop_2:
00008BD4 22C0                       		move.l	d0,(a1)+		; dump both the FG and BG scanline position to buffer
00008BD6 51C9 FFFC                  		dbf	d1,LZ_DeformLoop_2	; repeat d1 number of scanlines
00008BDA                            
00008BDA 3038 F700                  		move.w	($FFFFF700).w,d0	; load FG screen's X position
00008BDE 4440                       		neg.w	d0			; negate (positive to negative)
00008BE0 4840                       		swap	d0			; send to the left side of d0
00008BE2 3038 F708                  		move.w	($FFFFF708).w,d0	; load BG screen's X position
00008BE6 4440                       		neg.w	d0			; negate (positive to negative)
00008BE8 E640                       		asr.w	#3,d0			; divide by 8 (Slow down the scroll position)
00008BEA 323C 0007                  		move.w	#8-1,d1		; set number of scan lines to dump (minus 1 for dbf)
00008BEE                            LZ_DeformLoop_3:
00008BEE 22C0                       		move.l	d0,(a1)+		; dump both the FG and BG scanline position to buffer
00008BF0 51C9 FFFC                  		dbf	d1,LZ_DeformLoop_3	; repeat d1 number of scanlines
00008BF4                            
00008BF4 3038 F700                  		move.w	($FFFFF700).w,d0	; load FG screen's X position
00008BF8 4440                       		neg.w	d0			; negate (positive to negative)
00008BFA 4840                       		swap	d0			; send to the left side of d0
00008BFC 3038 F708                  		move.w	($FFFFF708).w,d0	; load BG screen's X position
00008C00 4440                       		neg.w	d0			; negate (positive to negative)
00008C02 E840                       		asr.w	#4,d0			; divide by 16 (Slow down the scroll position)
00008C04 323C 003F                  		move.w	#64-1,d1		; set number of scan lines to dump (minus 1 for dbf)
00008C08                            LZ_DeformLoop_4:
00008C08 22C0                       		move.l	d0,(a1)+		; dump both the FG and BG scanline position to buffer
00008C0A 51C9 FFFC                  		dbf	d1,LZ_DeformLoop_4	; repeat d1 number of scanlines
00008C0E                            
00008C0E 3038 F700                  		move.w	($FFFFF700).w,d0	; load FG screen's X position
00008C12 4440                       		neg.w	d0			; negate (positive to negative)
00008C14 4840                       		swap	d0			; send to the left side of d0
00008C16 3038 F708                  		move.w	($FFFFF708).w,d0	; load BG screen's X position
00008C1A 4440                       		neg.w	d0			; negate (positive to negative)
00008C1C E640                       		asr.w	#3,d0			; divide by 8 (Slow down the scroll position)
00008C1E 323C 0007                  		move.w	#8-1,d1		; set number of scan lines to dump (minus 1 for dbf)
00008C22                            LZ_DeformLoop_5:
00008C22 22C0                       		move.l	d0,(a1)+		; dump both the FG and BG scanline position to buffer
00008C24 51C9 FFFC                  		dbf	d1,LZ_DeformLoop_5	; repeat d1 number of scanlines
00008C28                            
00008C28 3038 F700                  		move.w	($FFFFF700).w,d0	; load FG screen's X position
00008C2C 4440                       		neg.w	d0			; negate (positive to negative)
00008C2E 4840                       		swap	d0			; send to the left side of d0
00008C30 3038 F708                  		move.w	($FFFFF708).w,d0	; load BG screen's X position
00008C34 4440                       		neg.w	d0			; negate (positive to negative)
00008C36 E440                       		asr.w	#2,d0			; divide by 4 (Slow down the scroll position)
00008C38 323C 0017                  		move.w	#24-1,d1		; set number of scan lines to dump (minus 1 for dbf)
00008C3C                            LZ_DeformLoop_6:
00008C3C 22C0                       		move.l	d0,(a1)+		; dump both the FG and BG scanline position to buffer
00008C3E 51C9 FFFC                  		dbf	d1,LZ_DeformLoop_6	; repeat d1 number of scanlines
00008C42                            
00008C42 3038 F700                  		move.w	($FFFFF700).w,d0	; load FG screen's X position
00008C46 4440                       		neg.w	d0			; negate (positive to negative)
00008C48 4840                       		swap	d0			; send to the left side of d0
00008C4A 3038 F708                  		move.w	($FFFFF708).w,d0	; load BG screen's X position
00008C4E 4440                       		neg.w	d0			; negate (positive to negative)
00008C50 E240                       		asr.w	#1,d0			; divide by 2 (Slow down the scroll position)
00008C52 323C 0035                  		move.w	#54-1,d1		; set number of scan lines to dump (minus 1 for dbf)
00008C56                            LZ_DeformLoop_7:
00008C56 22C0                       		move.l	d0,(a1)+		; dump both the FG and BG scanline position to buffer
00008C58 51C9 FFFC                  		dbf	d1,LZ_DeformLoop_7	; repeat d1 number of scanlines
00008C5C 4E75                       		rts	
00008C5E                            ; End of function Deform_LZ
00008C5E                            
00008C5E                            ; ---------------------------------------------------------------------------
00008C5E                            ; Marble Zone background layer deformation code
00008C5E                            ; ---------------------------------------------------------------------------
00008C5E                            
00008C5E                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00008C5E                            
00008C5E                            
00008C5E                            Deform_MZ:
00008C5E 3838 F73A                  		move.w	(v_scrshiftx).w,d4
00008C62 48C4                       		ext.l	d4
00008C64 ED84                       		asl.l	#6,d4
00008C66 2204                       		move.l	d4,d1
00008C68 E384                       		asl.l	#1,d4
00008C6A D881                       		add.l	d1,d4
00008C6C 7A00                       		moveq	#0,d5
00008C6E 6100 0000                  		bsr.w	ScrollBlock1
00008C72 303C 0200                  		move.w	#$200,d0
00008C76 3238 F704                  		move.w	(v_screenposy).w,d1
00008C7A 0441 01C8                  		subi.w	#$1C8,d1
00008C7E 6500                       		bcs.s	loc_6402
00008C80 3401                       		move.w	d1,d2
00008C82 D241                       		add.w	d1,d1
00008C84 D242                       		add.w	d2,d1
00008C86 E441                       		asr.w	#2,d1
00008C88 D041                       		add.w	d1,d0
00008C8A                            
00008C8A                            loc_6402:
00008C8A 31C0 F714                  		move.w	d0,(v_bg2screenposy).w
00008C8E 6100 0000                  		bsr.w	ScrollBlock3
00008C92 31F8 F70C F618             		move.w	(v_bgscreenposy).w,(v_bgscrposy_dup).w
00008C98 43F8 CC00                  		lea	(v_hscrolltablebuffer).w,a1
00008C9C 323C 00DF                  		move.w	#223,d1
00008CA0 3038 F700                  		move.w	(v_screenposx).w,d0
00008CA4 4440                       		neg.w	d0
00008CA6 4840                       		swap	d0
00008CA8 3038 F708                  		move.w	(v_bgscreenposx).w,d0
00008CAC 4440                       		neg.w	d0
00008CAE                            
00008CAE                            loc_6426:
00008CAE 22C0                       		move.l	d0,(a1)+
00008CB0 51C9 FFFC                  		dbf	d1,loc_6426
00008CB4 4E75                       		rts	
00008CB6                            ; End of function Deform_MZ
00008CB6                            
00008CB6                            ; ---------------------------------------------------------------------------
00008CB6                            ; Star Light Zone background layer deformation code
00008CB6                            ; ---------------------------------------------------------------------------
00008CB6                            
00008CB6                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00008CB6                            
00008CB6                            
00008CB6                            Deform_SLZ:
00008CB6 3838 F73A                  		move.w	(v_scrshiftx).w,d4
00008CBA 48C4                       		ext.l	d4
00008CBC EF84                       		asl.l	#7,d4
00008CBE 3A38 F73C                  		move.w	(v_scrshifty).w,d5
00008CC2 48C5                       		ext.l	d5
00008CC4 EF85                       		asl.l	#7,d5
00008CC6 6100 0000                  		bsr.w	ScrollBlock2
00008CCA 31F8 F70C F618             		move.w	(v_bgscreenposy).w,(v_bgscrposy_dup).w
00008CD0 6100 0000                  		bsr.w	Deform_SLZ_2
00008CD4 45F8 A800                  		lea	(v_bgscroll_buffer).w,a2
00008CD8 3038 F70C                  		move.w	(v_bgscreenposy).w,d0
00008CDC 3400                       		move.w	d0,d2
00008CDE 0440 00C0                  		subi.w	#$C0,d0
00008CE2 0240 03F0                  		andi.w	#$3F0,d0
00008CE6 E648                       		lsr.w	#3,d0
00008CE8 45F2 0000                  		lea	(a2,d0.w),a2
00008CEC 43F8 CC00                  		lea	(v_hscrolltablebuffer).w,a1
00008CF0 323C 000E                  		move.w	#$E,d1
00008CF4 3038 F700                  		move.w	(v_screenposx).w,d0
00008CF8 4440                       		neg.w	d0
00008CFA 4840                       		swap	d0
00008CFC 0242 000F                  		andi.w	#$F,d2
00008D00 D442                       		add.w	d2,d2
00008D02 301A                       		move.w	(a2)+,d0
00008D04 4EFB 2000                  		jmp	loc_6482(pc,d2.w)
00008D08                            ; ===========================================================================
00008D08                            
00008D08                            loc_6480:
00008D08 301A                       		move.w	(a2)+,d0
00008D0A                            
00008D0A                            loc_6482:
00008D0A 22C0                       		move.l	d0,(a1)+
00008D0C 22C0                       		move.l	d0,(a1)+
00008D0E 22C0                       		move.l	d0,(a1)+
00008D10 22C0                       		move.l	d0,(a1)+
00008D12 22C0                       		move.l	d0,(a1)+
00008D14 22C0                       		move.l	d0,(a1)+
00008D16 22C0                       		move.l	d0,(a1)+
00008D18 22C0                       		move.l	d0,(a1)+
00008D1A 22C0                       		move.l	d0,(a1)+
00008D1C 22C0                       		move.l	d0,(a1)+
00008D1E 22C0                       		move.l	d0,(a1)+
00008D20 22C0                       		move.l	d0,(a1)+
00008D22 22C0                       		move.l	d0,(a1)+
00008D24 22C0                       		move.l	d0,(a1)+
00008D26 22C0                       		move.l	d0,(a1)+
00008D28 22C0                       		move.l	d0,(a1)+
00008D2A 51C9 FFDC                  		dbf	d1,loc_6480
00008D2E 4E75                       		rts	
00008D30                            ; End of function Deform_SLZ
00008D30                            
00008D30                            Deform_SLZ_2:
00008D30 43F8 A800                  		lea	(v_bgscroll_buffer).w,a1
00008D34 3438 F700                  		move.w	(v_screenposx).w,d2
00008D38 4442                       		neg.w	d2
00008D3A 3002                       		move.w	d2,d0
00008D3C E640                       		asr.w	#3,d0
00008D3E 9042                       		sub.w	d2,d0
00008D40 48C0                       		ext.l	d0
00008D42 E980                       		asl.l	#4,d0
00008D44 81FC 001C                  		divs.w	#$1C,d0
00008D48 48C0                       		ext.l	d0
00008D4A E980                       		asl.l	#4,d0
00008D4C E180                       		asl.l	#8,d0
00008D4E 7600                       		moveq	#0,d3
00008D50 3602                       		move.w	d2,d3
00008D52 323C 001B                  		move.w	#$1B,d1
00008D56                            
00008D56                            loc_64CE:
00008D56 32C3                       		move.w	d3,(a1)+
00008D58 4843                       		swap	d3
00008D5A D680                       		add.l	d0,d3
00008D5C 4843                       		swap	d3
00008D5E 51C9 FFF6                  		dbf	d1,loc_64CE
00008D62 3002                       		move.w	d2,d0
00008D64 E640                       		asr.w	#3,d0
00008D66 323C 0004                  		move.w	#4,d1
00008D6A                            
00008D6A                            loc_64E2:
00008D6A 32C0                       		move.w	d0,(a1)+
00008D6C 51C9 FFFC                  		dbf	d1,loc_64E2
00008D70 3002                       		move.w	d2,d0
00008D72 E440                       		asr.w	#2,d0
00008D74 323C 0004                  		move.w	#4,d1
00008D78                            
00008D78                            loc_64F0:
00008D78 32C0                       		move.w	d0,(a1)+
00008D7A 51C9 FFFC                  		dbf	d1,loc_64F0
00008D7E 3002                       		move.w	d2,d0
00008D80 E240                       		asr.w	#1,d0
00008D82 323C 001D                  		move.w	#$1D,d1
00008D86                            
00008D86                            loc_64FE:
00008D86 32C0                       		move.w	d0,(a1)+
00008D88 51C9 FFFC                  		dbf	d1,loc_64FE
00008D8C 4E75                       		rts	
00008D8E                            ; End of function Deform_SLZ_2
00008D8E                            
00008D8E                            ; ---------------------------------------------------------------------------
00008D8E                            ; Spring Yard Zone background layer deformation	code
00008D8E                            ; ---------------------------------------------------------------------------
00008D8E                            
00008D8E                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00008D8E                            
00008D8E                            
00008D8E                            Deform_SYZ:
00008D8E 3838 F73A                  		move.w	(v_scrshiftx).w,d4
00008D92 48C4                       		ext.l	d4
00008D94 ED84                       		asl.l	#6,d4
00008D96 3A38 F73C                  		move.w	(v_scrshifty).w,d5
00008D9A 48C5                       		ext.l	d5
00008D9C E985                       		asl.l	#4,d5
00008D9E 2205                       		move.l	d5,d1
00008DA0 E385                       		asl.l	#1,d5
00008DA2 DA81                       		add.l	d1,d5
00008DA4 6100 0000                  		bsr.w	ScrollBlock1
00008DA8 31F8 F70C F618             		move.w	(v_bgscreenposy).w,(v_bgscrposy_dup).w
00008DAE 43F8 CC00                  		lea	(v_hscrolltablebuffer).w,a1
00008DB2 323C 00DF                  		move.w	#223,d1
00008DB6 3038 F700                  		move.w	(v_screenposx).w,d0
00008DBA 4440                       		neg.w	d0
00008DBC 4840                       		swap	d0
00008DBE 3038 F708                  		move.w	(v_bgscreenposx).w,d0
00008DC2 4440                       		neg.w	d0
00008DC4                            
00008DC4                            loc_653C:
00008DC4 22C0                       		move.l	d0,(a1)+
00008DC6 51C9 FFFC                  		dbf	d1,loc_653C
00008DCA 4E75                       		rts	
00008DCC                            ; End of function Deform_SYZ
00008DCC                            
00008DCC                            ; ---------------------------------------------------------------------------
00008DCC                            ; Scrap	Brain Zone background layer deformation	code
00008DCC                            ; ---------------------------------------------------------------------------
00008DCC                            
00008DCC                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00008DCC                            
00008DCC                            
00008DCC                            Deform_SBZ:
00008DCC 3838 F73A                  		move.w	(v_scrshiftx).w,d4
00008DD0 48C4                       		ext.l	d4
00008DD2 ED84                       		asl.l	#6,d4
00008DD4 3A38 F73C                  		move.w	(v_scrshifty).w,d5
00008DD8 48C5                       		ext.l	d5
00008DDA E985                       		asl.l	#4,d5
00008DDC E385                       		asl.l	#1,d5
00008DDE 6100 0000                  		bsr.w	ScrollBlock1
00008DE2 31F8 F70C F618             		move.w	(v_bgscreenposy).w,(v_bgscrposy_dup).w
00008DE8 43F8 CC00                  		lea	(v_hscrolltablebuffer).w,a1
00008DEC 323C 00DF                  		move.w	#223,d1
00008DF0 3038 F700                  		move.w	(v_screenposx).w,d0
00008DF4 4440                       		neg.w	d0
00008DF6 4840                       		swap	d0
00008DF8 3038 F708                  		move.w	(v_bgscreenposx).w,d0
00008DFC 4440                       		neg.w	d0
00008DFE                            
00008DFE                            loc_6576:
00008DFE 22C0                       		move.l	d0,(a1)+
00008E00 51C9 FFFC                  		dbf	d1,loc_6576
00008E04 4E75                       		rts	
00008E06                            ; End of function Deform_SBZ
00008E06                            
00008E06                            Deform_CSZ:
00008E06 3838 F73A                  		move.w	(v_scrshiftx).w,d4
00008E0A 48C4                       		ext.l	d4
00008E0C EF84                       		asl.l	#7,d4
00008E0E 3A38 F73C                  		move.w	(v_scrshifty).w,d5
00008E12 48C5                       		ext.l	d5
00008E14 EF85                       		asl.l	#7,d5
00008E16 6100 0000                  		bsr.w	ScrollBlock1
00008E1A 31FC 0000 F70C             		move.w #$0,($FFFFF70C).w
00008E20 31F8 F70C F618             		move.w	(v_bgscreenposy).w,(v_bgscrposy_dup).w
00008E26 43F8 CC00                  		lea	($FFFFCC00).w,a1	; load beginning address of horizontal scroll buffer to a1
00008E2A                            
00008E2A 3038 F700                  		move.w	($FFFFF700).w,d0	; load FG screen's X position
00008E2E 4440                       		neg.w	d0			; negate (positive to negative)
00008E30 4840                       		swap	d0			; send to the left side of d0
00008E32 3038 F708                  		move.w	($FFFFF708).w,d0	; load BG screen's X position
00008E36 4440                       		neg.w	d0			; negate (positive to negative)
00008E38 E040                       		asr.w	#8,d0			; divide by 256 (Slow down the scroll position)
00008E3A 323C 006B                  		move.w	#108-1,d1		; set number of scan lines to dump (minus 1 for dbf)
00008E3E                            CSZ_Deform1:
00008E3E 22C0                       		move.l	d0,(a1)+		; dump both the FG and BG scanline position to buffer
00008E40 51C9 FFFC                  		dbf	d1,CSZ_Deform1	; repeat d1 number of scanlines
00008E44                            
00008E44 3038 F700                  		move.w	($FFFFF700).w,d0	; load FG screen's X position
00008E48 4440                       		neg.w	d0			; negate (positive to negative)
00008E4A 4840                       		swap	d0			; send to the left side of d0
00008E4C 3038 F708                  		move.w	($FFFFF708).w,d0	; load BG screen's X position
00008E50 4440                       		neg.w	d0			; negate (positive to negative)
00008E52 EA40                       		asr.w	#5,d0			; divide by 64 (Slow down the scroll position)
00008E54 323C 000B                  		move.w	#12-1,d1		; set number of scan lines to dump (minus 1 for dbf)
00008E58                            CSZ_Deform2:
00008E58 22C0                       		move.l	d0,(a1)+		; dump both the FG and BG scanline position to buffer
00008E5A 51C9 FFFC                  		dbf	d1,CSZ_Deform2	; repeat d1 number of scanlines
00008E5E                            
00008E5E 3038 F700                  		move.w	($FFFFF700).w,d0	; load FG screen's X position
00008E62 4440                       		neg.w	d0			; negate (positive to negative)
00008E64 4840                       		swap	d0			; send to the left side of d0
00008E66 3038 F708                  		move.w	($FFFFF708).w,d0	; load BG screen's X position
00008E6A 4440                       		neg.w	d0			; negate (positive to negative)
00008E6C EA40                       		asr.w	#5,d0			; divide by 32 (Slow down the scroll position)
00008E6E 323C 0007                  		move.w	#8-1,d1		; set number of scan lines to dump (minus 1 for dbf)
00008E72                            CSZ_Deform3:
00008E72 22C0                       		move.l	d0,(a1)+		; dump both the FG and BG scanline position to buffer
00008E74 51C9 FFFC                  		dbf	d1,CSZ_Deform3	; repeat d1 number of scanlines
00008E78                            
00008E78 3038 F700                  		move.w	($FFFFF700).w,d0	; load FG screen's X position
00008E7C 4440                       		neg.w	d0			; negate (positive to negative)
00008E7E 4840                       		swap	d0			; send to the left side of d0
00008E80 3038 F708                  		move.w	($FFFFF708).w,d0	; load BG screen's X position
00008E84 4440                       		neg.w	d0			; negate (positive to negative)
00008E86 E840                       		asr.w	#4,d0			; divide by 16 (Slow down the scroll position)
00008E88 323C 0007                  		move.w	#8-1,d1		; set number of scan lines to dump (minus 1 for dbf)
00008E8C                            CSZ_Deform4:
00008E8C 22C0                       		move.l	d0,(a1)+		; dump both the FG and BG scanline position to buffer
00008E8E 51C9 FFFC                  		dbf	d1,CSZ_Deform4	; repeat d1 number of scanlines
00008E92                            
00008E92 3038 F700                  		move.w	($FFFFF700).w,d0	; load FG screen's X position
00008E96 4440                       		neg.w	d0			; negate (positive to negative)
00008E98 4840                       		swap	d0			; send to the left side of d0
00008E9A 3038 F708                  		move.w	($FFFFF708).w,d0	; load BG screen's X position
00008E9E 4440                       		neg.w	d0			; negate (positive to negative)
00008EA0 E640                       		asr.w	#3,d0			; divide by 8 (Slow down the scroll position)
00008EA2 323C 0007                  		move.w	#8-1,d1		; set number of scan lines to dump (minus 1 for dbf)
00008EA6                            CSZ_Deform5:
00008EA6 22C0                       		move.l	d0,(a1)+		; dump both the FG and BG scanline position to buffer
00008EA8 51C9 FFFC                  		dbf	d1,CSZ_Deform5	; repeat d1 number of scanlines
00008EAC                            
00008EAC 3038 F700                  		move.w	($FFFFF700).w,d0	; load FG screen's X position
00008EB0 4440                       		neg.w	d0			; negate (positive to negative)
00008EB2 4840                       		swap	d0			; send to the left side of d0
00008EB4 3038 F708                  		move.w	($FFFFF708).w,d0	; load BG screen's X position
00008EB8 4440                       		neg.w	d0			; negate (positive to negative)
00008EBA E440                       		asr.w	#2,d0			; divide by 4 (Slow down the scroll position)
00008EBC 323C 001F                  		move.w	#32-1,d1		; set number of scan lines to dump (minus 1 for dbf)
00008EC0                            CSZ_Deform6:
00008EC0 22C0                       		move.l	d0,(a1)+		; dump both the FG and BG scanline position to buffer
00008EC2 51C9 FFFC                  		dbf	d1,CSZ_Deform6	; repeat d1 number of scanlines
00008EC6                            
00008EC6 3038 F700                  		move.w	($FFFFF700).w,d0	; load FG screen's X position
00008ECA 4440                       		neg.w	d0			; negate (positive to negative)
00008ECC 4840                       		swap	d0			; send to the left side of d0
00008ECE 3038 F708                  		move.w	($FFFFF708).w,d0	; load BG screen's X position
00008ED2 4440                       		neg.w	d0			; negate (positive to negative)
00008ED4 E240                       		asr.w	#1,d0			; divide by 2 (Slow down the scroll position)
00008ED6 323C 0035                  		move.w	#54-1,d1		; set number of scan lines to dump (minus 1 for dbf)
00008EDA                            CSZ_Deform7:
00008EDA 22C0                       		move.l	d0,(a1)+		; dump both the FG and BG scanline position to buffer
00008EDC 51C9 FFFC                  		dbf	d1,CSZ_Deform7	; repeat d1 number of scanlines
00008EE0                            ; End of function Deform_CSZ
00008EE0                            
00008EE0                            ; ---------------------------------------------------------------------------
00008EE0                            ; Subroutine to	scroll the level horizontally as Sonic moves
00008EE0                            ; ---------------------------------------------------------------------------
00008EE0                            
00008EE0                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00008EE0                            
00008EE0                            
00008EE0                            ScrollHoriz:
00008EE0 3838 F700                  		move.w	(v_screenposx).w,d4 ; save old screen position
00008EE4 6100                       		bsr.s	MoveScreenHoriz
00008EE6 3038 F700                  		move.w	(v_screenposx).w,d0
00008EEA 0240 0010                  		andi.w	#$10,d0
00008EEE 1238 F74A                  		move.b	(v_fg_xblock).w,d1
00008EF2 B300                       		eor.b	d1,d0
00008EF4 6600                       		bne.s	@return
00008EF6 0A38 0010 F74A             		eori.b	#$10,(v_fg_xblock).w
00008EFC 3038 F700                  		move.w	(v_screenposx).w,d0
00008F00 9044                       		sub.w	d4,d0		; compare new with old screen position
00008F02 6A00                       		bpl.s	@scrollRight
00008F04                            
00008F04 08F8 0002 F754             		bset	#2,(v_fg_scroll_flags).w ; screen moves backward
00008F0A 4E75                       		rts	
00008F0C                            
00008F0C                            	@scrollRight:
00008F0C 08F8 0003 F754             		bset	#3,(v_fg_scroll_flags).w ; screen moves forward
00008F12                            
00008F12                            	@return:
00008F12 4E75                       		rts	
00008F14                            ; End of function ScrollHoriz
00008F14                            
00008F14                            
00008F14                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00008F14                            
00008F14                            
00008F14                            MoveScreenHoriz:
00008F14 3038 D008                  		move.w	(v_player+obX).w,d0
00008F18 9078 F700                  		sub.w	(v_screenposx).w,d0 ; Sonic's distance from left edge of screen
00008F1C 0440 0090                  		subi.w	#144,d0		; is distance less than 144px?
00008F20 6500                       		bcs.s	SH_BehindMid	; if yes, branch
00008F22 0440 0010                  		subi.w	#16,d0		; is distance more than 160px?
00008F26 6400                       		bcc.s	SH_AheadOfMid	; if yes, branch
00008F28 4278 F73A                  		clr.w	(v_scrshiftx).w
00008F2C 4E75                       		rts	
00008F2E                            ; ===========================================================================
00008F2E                            
00008F2E                            SH_AheadOfMid:
00008F2E 0C40 0010                  		cmpi.w	#16,d0		; is Sonic within 16px of middle area?
00008F32 6500                       		bcs.s	SH_Ahead16	; if yes, branch
00008F34 303C 0010                  		move.w	#16,d0		; set to 16 if greater
00008F38                            
00008F38                            	SH_Ahead16:
00008F38 D078 F700                  		add.w	(v_screenposx).w,d0
00008F3C B078 F72A                  		cmp.w	(v_limitright2).w,d0
00008F40 6D00                       		blt.s	SH_SetScreen
00008F42 3038 F72A                  		move.w	(v_limitright2).w,d0
00008F46                            
00008F46                            SH_SetScreen:
00008F46 3200                       		move.w	d0,d1
00008F48 9278 F700                  		sub.w	(v_screenposx).w,d1
00008F4C E141                       		asl.w	#8,d1
00008F4E 31C0 F700                  		move.w	d0,(v_screenposx).w ; set new screen position
00008F52 31C1 F73A                  		move.w	d1,(v_scrshiftx).w ; set distance for screen movement
00008F56 4E75                       		rts	
00008F58                            ; ===========================================================================
00008F58                            
00008F58                            SH_BehindMid:
00008F58 D078 F700                  		add.w	(v_screenposx).w,d0
00008F5C B078 F728                  		cmp.w	(v_limitleft2).w,d0
00008F60 6EE4                       		bgt.s	SH_SetScreen
00008F62 3038 F728                  		move.w	(v_limitleft2).w,d0
00008F66 60DE                       		bra.s	SH_SetScreen
00008F68                            ; End of function MoveScreenHoriz
00008F68                            
00008F68                            ; ===========================================================================
00008F68 4A40                       		tst.w	d0
00008F6A 6A00                       		bpl.s	loc_6610
00008F6C 303C FFFE                  		move.w	#-2,d0
00008F70 60E6                       		bra.s	SH_BehindMid
00008F72                            
00008F72                            loc_6610:
00008F72 303C 0002                  		move.w	#2,d0
00008F76 60B6                       		bra.s	SH_AheadOfMid
00008F78                            
00008F78                            ; ---------------------------------------------------------------------------
00008F78                            ; Subroutine to	scroll the level vertically as Sonic moves
00008F78                            ; ---------------------------------------------------------------------------
00008F78                            
00008F78                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00008F78                            
00008F78                            
00008F78                            ScrollVertical:
00008F78 7200                       		moveq	#0,d1
00008F7A 3038 D00C                  		move.w	(v_player+obY).w,d0
00008F7E 9078 F704                  		sub.w	(v_screenposy).w,d0 ; Sonic's distance from top of screen
00008F82 0838 0002 D022             		btst	#2,(v_player+obStatus).w ; is Sonic rolling?
00008F88 6700                       		beq.s	SV_NotRolling	; if not, branch
00008F8A 5B40                       		subq.w	#5,d0
00008F8C                            
00008F8C                            	SV_NotRolling:
00008F8C 0838 0001 D022             		btst	#1,(v_player+obStatus).w ; is Sonic jumping?
00008F92 6700                       		beq.s	loc_664A	; if not, branch
00008F94                            
00008F94 0640 0020                  		addi.w	#32,d0
00008F98 9078 F73E                  		sub.w	(v_lookshift).w,d0
00008F9C 6500                       		bcs.s	loc_6696
00008F9E 0440 0040                  		subi.w	#64,d0
00008FA2 6400                       		bcc.s	loc_6696
00008FA4 4A38 F75C                  		tst.b	(f_bgscrollvert).w
00008FA8 6600                       		bne.s	loc_66A8
00008FAA 6000                       		bra.s	loc_6656
00008FAC                            ; ===========================================================================
00008FAC                            
00008FAC                            loc_664A:
00008FAC 9078 F73E                  		sub.w	(v_lookshift).w,d0
00008FB0 6600                       		bne.s	loc_665C
00008FB2 4A38 F75C                  		tst.b	(f_bgscrollvert).w
00008FB6 6600                       		bne.s	loc_66A8
00008FB8                            
00008FB8                            loc_6656:
00008FB8 4278 F73C                  		clr.w	(v_scrshifty).w
00008FBC 4E75                       		rts	
00008FBE                            ; ===========================================================================
00008FBE                            
00008FBE                            loc_665C:
00008FBE 0C78 0060 F73E             		cmpi.w	#$60,(v_lookshift).w
00008FC4 6600                       		bne.s	loc_6684
00008FC6 3238 D014                  		move.w	(v_player+obInertia).w,d1
00008FCA 6A00                       		bpl.s	loc_666C
00008FCC 4441                       		neg.w	d1
00008FCE                            
00008FCE                            loc_666C:
00008FCE 0C41 0800                  		cmpi.w	#$800,d1
00008FD2 6400                       		bcc.s	loc_6696
00008FD4 323C 0600                  		move.w	#$600,d1
00008FD8 0C40 0006                  		cmpi.w	#6,d0
00008FDC 6E00                       		bgt.s	loc_66F6
00008FDE 0C40 FFFA                  		cmpi.w	#-6,d0
00008FE2 6D00                       		blt.s	loc_66C0
00008FE4 6000                       		bra.s	loc_66AE
00008FE6                            ; ===========================================================================
00008FE6                            
00008FE6                            loc_6684:
00008FE6 323C 0200                  		move.w	#$200,d1
00008FEA 0C40 0002                  		cmpi.w	#2,d0
00008FEE 6E00                       		bgt.s	loc_66F6
00008FF0 0C40 FFFE                  		cmpi.w	#-2,d0
00008FF4 6D00                       		blt.s	loc_66C0
00008FF6 6000                       		bra.s	loc_66AE
00008FF8                            ; ===========================================================================
00008FF8                            
00008FF8                            loc_6696:
00008FF8 323C 1000                  		move.w	#$1000,d1
00008FFC 0C40 0010                  		cmpi.w	#$10,d0
00009000 6E00                       		bgt.s	loc_66F6
00009002 0C40 FFF0                  		cmpi.w	#-$10,d0
00009006 6D00                       		blt.s	loc_66C0
00009008 6000                       		bra.s	loc_66AE
0000900A                            ; ===========================================================================
0000900A                            
0000900A                            loc_66A8:
0000900A 7000                       		moveq	#0,d0
0000900C 11C0 F75C                  		move.b	d0,(f_bgscrollvert).w
00009010                            
00009010                            loc_66AE:
00009010 7200                       		moveq	#0,d1
00009012 3200                       		move.w	d0,d1
00009014 D278 F704                  		add.w	(v_screenposy).w,d1
00009018 4A40                       		tst.w	d0
0000901A 6A00 0000                  		bpl.w	loc_6700
0000901E 6000 0000                  		bra.w	loc_66CC
00009022                            ; ===========================================================================
00009022                            
00009022                            loc_66C0:
00009022 4441                       		neg.w	d1
00009024 48C1                       		ext.l	d1
00009026 E181                       		asl.l	#8,d1
00009028 D2B8 F704                  		add.l	(v_screenposy).w,d1
0000902C 4841                       		swap	d1
0000902E                            
0000902E                            loc_66CC:
0000902E B278 F72C                  		cmp.w	(v_limittop2).w,d1
00009032 6E00                       		bgt.s	loc_6724
00009034 0C41 FF00                  		cmpi.w	#-$100,d1
00009038 6E00                       		bgt.s	loc_66F0
0000903A 0241 07FF                  		andi.w	#$7FF,d1
0000903E 0278 07FF D00C             		andi.w	#$7FF,(v_player+obY).w
00009044 0278 07FF F704             		andi.w	#$7FF,(v_screenposy).w
0000904A 0278 03FF F70C             		andi.w	#$3FF,(v_bgscreenposy).w
00009050 6000                       		bra.s	loc_6724
00009052                            ; ===========================================================================
00009052                            
00009052                            loc_66F0:
00009052 3238 F72C                  		move.w	(v_limittop2).w,d1
00009056 6000                       		bra.s	loc_6724
00009058                            ; ===========================================================================
00009058                            
00009058                            loc_66F6:
00009058 48C1                       		ext.l	d1
0000905A E181                       		asl.l	#8,d1
0000905C D2B8 F704                  		add.l	(v_screenposy).w,d1
00009060 4841                       		swap	d1
00009062                            
00009062                            loc_6700:
00009062 B278 F72E                  		cmp.w	(v_limitbtm2).w,d1
00009066 6D00                       		blt.s	loc_6724
00009068 0441 0800                  		subi.w	#$800,d1
0000906C 6500                       		bcs.s	loc_6720
0000906E 0278 07FF D00C             		andi.w	#$7FF,(v_player+obY).w
00009074 0478 0800 F704             		subi.w	#$800,(v_screenposy).w
0000907A 0278 03FF F70C             		andi.w	#$3FF,(v_bgscreenposy).w
00009080 6000                       		bra.s	loc_6724
00009082                            ; ===========================================================================
00009082                            
00009082                            loc_6720:
00009082 3238 F72E                  		move.w	(v_limitbtm2).w,d1
00009086                            
00009086                            loc_6724:
00009086 3838 F704                  		move.w	(v_screenposy).w,d4
0000908A 4841                       		swap	d1
0000908C 2601                       		move.l	d1,d3
0000908E 96B8 F704                  		sub.l	(v_screenposy).w,d3
00009092 E09B                       		ror.l	#8,d3
00009094 31C3 F73C                  		move.w	d3,(v_scrshifty).w
00009098 21C1 F704                  		move.l	d1,(v_screenposy).w
0000909C 3038 F704                  		move.w	(v_screenposy).w,d0
000090A0 0240 0010                  		andi.w	#$10,d0
000090A4 1238 F74B                  		move.b	(v_fg_yblock).w,d1
000090A8 B300                       		eor.b	d1,d0
000090AA 6600                       		bne.s	@return
000090AC 0A38 0010 F74B             		eori.b	#$10,(v_fg_yblock).w
000090B2 3038 F704                  		move.w	(v_screenposy).w,d0
000090B6 9044                       		sub.w	d4,d0
000090B8 6A00                       		bpl.s	@scrollBottom
000090BA 08F8 0000 F754             		bset	#0,(v_fg_scroll_flags).w
000090C0 4E75                       		rts	
000090C2                            ; ===========================================================================
000090C2                            
000090C2                            	@scrollBottom:
000090C2 08F8 0001 F754             		bset	#1,(v_fg_scroll_flags).w
000090C8                            
000090C8                            	@return:
000090C8 4E75                       		rts	
000090CA                            ; End of function ScrollVertical
000090CA                            
000090CA                            
000090CA                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
000090CA                            ; Scrolls background and sets redraw flags.
000090CA                            ; d4 - background x offset * $10000
000090CA                            ; d5 - background y offset * $10000
000090CA                            
000090CA                            BGScroll_XY:
000090CA 2438 F708                  		move.l	(v_bgscreenposx).w,d2
000090CE 2002                       		move.l	d2,d0
000090D0 D084                       		add.l	d4,d0
000090D2 21C0 F708                  		move.l	d0,(v_bgscreenposx).w
000090D6 2200                       		move.l	d0,d1
000090D8 4841                       		swap.w	d1
000090DA 0241 0010                  		andi.w	#$10,d1
000090DE 1638 F74C                  		move.b	(v_bg1_xblock).w,d3
000090E2 B701                       		eor.b	d3,d1
000090E4 6600                       		bne.s	BGScroll_YRelative	; no change in Y
000090E6 0A38 0010 F74C             		eori.b	#$10,(v_bg1_xblock).w
000090EC 9082                       		sub.l	d2,d0	; new - old
000090EE 6A00                       		bpl.s	@scrollRight
000090F0 08F8 0002 F756             		bset	#2,(v_bg1_scroll_flags).w
000090F6 6000                       		bra.s	BGScroll_YRelative
000090F8                            	@scrollRight:
000090F8 08F8 0003 F756             		bset	#3,(v_bg1_scroll_flags).w
000090FE                            BGScroll_YRelative:
000090FE 2638 F70C                  		move.l	(v_bgscreenposy).w,d3
00009102 2003                       		move.l	d3,d0
00009104 D085                       		add.l	d5,d0
00009106 21C0 F70C                  		move.l	d0,(v_bgscreenposy).w
0000910A 2200                       		move.l	d0,d1
0000910C 4841                       		swap.w	d1
0000910E 0241 0010                  		andi.w	#$10,d1
00009112 1438 F74D                  		move.b	(v_bg1_yblock).w,d2
00009116 B501                       		eor.b	d2,d1
00009118 6600                       		bne.s	@return
0000911A 0A38 0010 F74D             		eori.b	#$10,(v_bg1_yblock).w
00009120 9083                       		sub.l	d3,d0
00009122 6A00                       		bpl.s	@scrollBottom
00009124 08F8 0000 F756             		bset	#0,(v_bg1_scroll_flags).w
0000912A 4E75                       		rts
0000912C                            	@scrollBottom:
0000912C 08F8 0001 F756             		bset	#1,(v_bg1_scroll_flags).w
00009132                            	@return:
00009132 4E75                       		rts
00009134                            ; End of function BGScroll_XY
00009134                            
00009134                            Bg_Scroll_Y:
00009134 2638 F70C                  		move.l	(v_bgscreenposy).w,d3
00009138 2003                       		move.l	d3,d0
0000913A D085                       		add.l	d5,d0
0000913C 21C0 F70C                  		move.l	d0,(v_bgscreenposy).w
00009140 2200                       		move.l	d0,d1
00009142 4841                       		swap.w	d1
00009144 0241 0010                  		andi.w	#$10,d1
00009148 1438 F74D                  		move.b	(v_bg1_yblock).w,d2
0000914C B501                       		eor.b	d2,d1
0000914E 6600                       		bne.s	@return
00009150 0A38 0010 F74D             		eori.b	#$10,(v_bg1_yblock).w
00009156 9083                       		sub.l	d3,d0
00009158 6A00                       		bpl.s	@scrollBottom
0000915A 08F8 0004 F756             		bset	#4,(v_bg1_scroll_flags).w
00009160 4E75                       		rts
00009162                            	@scrollBottom:
00009162 08F8 0005 F756             		bset	#5,(v_bg1_scroll_flags).w
00009168                            	@return:
00009168 4E75                       		rts
0000916A                            
0000916A                            
0000916A                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
0000916A                            
0000916A                            
0000916A                            BGScroll_YAbsolute:
0000916A 3638 F70C                  		move.w	(v_bgscreenposy).w,d3
0000916E 31C0 F70C                  		move.w	d0,(v_bgscreenposy).w
00009172 3200                       		move.w	d0,d1
00009174 0241 0010                  		andi.w	#$10,d1
00009178 1438 F74D                  		move.b	(v_bg1_yblock).w,d2
0000917C B501                       		eor.b	d2,d1
0000917E 6600                       		bne.s	@return
00009180 0A38 0010 F74D             		eori.b	#$10,(v_bg1_yblock).w
00009186 9043                       		sub.w	d3,d0
00009188 6A00                       		bpl.s	@scrollBottom
0000918A 08F8 0000 F756             		bset	#0,(v_bg1_scroll_flags).w
00009190 4E75                       		rts
00009192                            	@scrollBottom:
00009192 08F8 0001 F756             		bset	#1,(v_bg1_scroll_flags).w
00009198                            	@return:
00009198 4E75                       		rts
0000919A                            ; End of function BGScroll_YAbsolute
0000919A                            
0000919A                            
0000919A                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
0000919A                            ; d6 - bit to set for redraw
0000919A                            
0000919A                            BGScroll_Block1:
0000919A 2438 F708                  		move.l	(v_bgscreenposx).w,d2
0000919E 2002                       		move.l	d2,d0
000091A0 D084                       		add.l	d4,d0
000091A2 21C0 F708                  		move.l	d0,(v_bgscreenposx).w
000091A6 2200                       		move.l	d0,d1
000091A8 4841                       		swap.w	d1
000091AA 0241 0010                  		andi.w	#$10,d1
000091AE 1638 F74C                  		move.b	(v_bg1_xblock).w,d3
000091B2 B701                       		eor.b	d3,d1
000091B4 6600                       		bne.s	@return
000091B6 0A38 0010 F74C             		eori.b	#$10,(v_bg1_xblock).w
000091BC 9082                       		sub.l	d2,d0
000091BE 6A00                       		bpl.s	@scrollRight
000091C0 0DF8 F756                  		bset	d6,(v_bg1_scroll_flags).w
000091C4 6000                       		bra.s	@return
000091C6                            	@scrollRight:
000091C6 5206                       		addq.b	#1,d6
000091C8 0DF8 F756                  		bset	d6,(v_bg1_scroll_flags).w
000091CC                            	@return:
000091CC 4E75                       		rts
000091CE                            ; End of function BGScroll_Block1
000091CE                            
000091CE                            
000091CE                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
000091CE                            
000091CE                            
000091CE                            BGScroll_Block2:
000091CE 2438 F710                  		move.l	(v_bg2screenposx).w,d2
000091D2 2002                       		move.l	d2,d0
000091D4 D084                       		add.l	d4,d0
000091D6 21C0 F710                  		move.l	d0,(v_bg2screenposx).w
000091DA 2200                       		move.l	d0,d1
000091DC 4841                       		swap.w	d1
000091DE 0241 0010                  		andi.w	#$10,d1
000091E2 1638 F74E                  		move.b	(v_bg2_xblock).w,d3
000091E6 B701                       		eor.b	d3,d1
000091E8 6600                       		bne.s	@return
000091EA 0A38 0010 F74E             		eori.b	#$10,(v_bg2_xblock).w
000091F0 9082                       		sub.l	d2,d0
000091F2 6A00                       		bpl.s	@scrollRight
000091F4 0DF8 F758                  		bset	d6,(v_bg2_scroll_flags).w
000091F8 6000                       		bra.s	@return
000091FA                            	@scrollRight:
000091FA 5206                       		addq.b	#1,d6
000091FC 0DF8 F758                  		bset	d6,(v_bg2_scroll_flags).w
00009200                            	@return:
00009200 4E75                       		rts
00009202                            ;-------------------------------------------------------------------------------
00009202                            BGScroll_Block3:
00009202 2438 F718                  		move.l	(v_bg3screenposx).w,d2
00009206 2002                       		move.l	d2,d0
00009208 D084                       		add.l	d4,d0
0000920A 21C0 F718                  		move.l	d0,(v_bg3screenposx).w
0000920E 2200                       		move.l	d0,d1
00009210 4841                       		swap.w	d1
00009212 0241 0010                  		andi.w	#$10,d1
00009216 1638 F750                  		move.b	(v_bg3_xblock).w,d3
0000921A B701                       		eor.b	d3,d1
0000921C 6600                       		bne.s	@return
0000921E 0A38 0010 F750             		eori.b	#$10,(v_bg3_xblock).w
00009224 9082                       		sub.l	d2,d0
00009226 6A00                       		bpl.s	@scrollRight
00009228 0DF8 F75A                  		bset	d6,(v_bg3_scroll_flags).w
0000922C 6000                       		bra.s	@return
0000922E                            	@scrollRight:
0000922E 5206                       		addq.b	#1,d6
00009230 0DF8 F75A                  		bset	d6,(v_bg3_scroll_flags).w
00009234                            	@return:
00009234 4E75                       		rts
00009236                            		
00009236                            BGScroll_Block4:
00009236 3438 F710                  		move.w	(v_bg2screenposx).w,d2
0000923A 3638 F714                  		move.w	(v_bg2screenposy).w,d3
0000923E 3038 F73A                  		move.w	(v_scrshiftx).w,d0
00009242 48C0                       		ext.l	d0
00009244 EF80                       		asl.l	#7,d0
00009246 D1B8 F710                  		add.l	d0,(v_bg2screenposx).w
0000924A 3038 F710                  		move.w	(v_bg2screenposx).w,d0
0000924E 0240 0010                  		andi.w	#$10,d0
00009252 1238 F74E                  		move.b	($FFFFF74E).w,d1
00009256 B300                       		eor.b	d1,d0
00009258 6600                       		bne.s	locret_6884
0000925A 0A38 0010 F74E             		eori.b	#$10,($FFFFF74E).w
00009260 3038 F710                  		move.w	(v_bg2screenposx).w,d0
00009264 9042                       		sub.w	d2,d0
00009266 6A00                       		bpl.s	loc_687E
00009268 08F8 0002 F758             		bset	#2,(v_bg2_scroll_flags).w
0000926E 6000                       		bra.s	locret_6884
00009270                            ; ===========================================================================
00009270                            
00009270                            loc_687E:
00009270 08F8 0003 F758             		bset	#3,(v_bg2_scroll_flags).w
00009276                            
00009276                            locret_6884:
00009276 4E75                       		rts
00009278                            ; End of function ScrollBlock4  
00009278                            ; ITS A MIXTURE!
00009278                            ScrollBlock1:
00009278 2438 F708                  		move.l	(v_bgscreenposx).w,d2
0000927C 2002                       		move.l	d2,d0
0000927E D084                       		add.l	d4,d0
00009280 21C0 F708                  		move.l	d0,(v_bgscreenposx).w
00009284 2200                       		move.l	d0,d1
00009286 4841                       		swap	d1
00009288 0241 0010                  		andi.w	#$10,d1
0000928C 1638 F74C                  		move.b	($FFFFF74C).w,d3
00009290 B701                       		eor.b	d3,d1
00009292 6600                       		bne.s	loc_679C
00009294 0A38 0010 F74C             		eori.b	#$10,($FFFFF74C).w
0000929A 9082                       		sub.l	d2,d0
0000929C 6A00                       		bpl.s	loc_6796
0000929E 08F8 0002 F756             		bset	#2,(v_bg1_scroll_flags).w
000092A4 6000                       		bra.s	loc_679C
000092A6                            ; ===========================================================================
000092A6                            
000092A6                            loc_6796:
000092A6 08F8 0003 F756             		bset	#3,(v_bg1_scroll_flags).w
000092AC                            
000092AC                            loc_679C:
000092AC 2638 F70C                  		move.l	(v_bgscreenposy).w,d3
000092B0 2003                       		move.l	d3,d0
000092B2 D085                       		add.l	d5,d0
000092B4 21C0 F70C                  		move.l	d0,(v_bgscreenposy).w
000092B8 2200                       		move.l	d0,d1
000092BA 4841                       		swap	d1
000092BC 0241 0010                  		andi.w	#$10,d1
000092C0 1438 F74D                  		move.b	($FFFFF74D).w,d2
000092C4 B501                       		eor.b	d2,d1
000092C6 6600                       		bne.s	locret_67D0
000092C8 0A38 0010 F74D             		eori.b	#$10,($FFFFF74D).w
000092CE 9083                       		sub.l	d3,d0
000092D0 6A00                       		bpl.s	loc_67CA
000092D2 08F8 0000 F756             		bset	#0,(v_bg1_scroll_flags).w
000092D8 4E75                       		rts	
000092DA                            ; ===========================================================================
000092DA                            
000092DA                            loc_67CA:
000092DA 08F8 0001 F756             		bset	#1,(v_bg1_scroll_flags).w
000092E0                            
000092E0                            locret_67D0:
000092E0 4E75                       		rts	
000092E2                            ; End of function ScrollBlock1
000092E2                            
000092E2                            
000092E2                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
000092E2                            
000092E2                            
000092E2                            ScrollBlock2:
000092E2 2438 F708                  		move.l	(v_bgscreenposx).w,d2
000092E6 2002                       		move.l	d2,d0
000092E8 D084                       		add.l	d4,d0
000092EA 21C0 F708                  		move.l	d0,(v_bgscreenposx).w
000092EE 2638 F70C                  		move.l	(v_bgscreenposy).w,d3
000092F2 2003                       		move.l	d3,d0
000092F4 D085                       		add.l	d5,d0
000092F6 21C0 F70C                  		move.l	d0,(v_bgscreenposy).w
000092FA 2200                       		move.l	d0,d1
000092FC 4841                       		swap	d1
000092FE 0241 0010                  		andi.w	#$10,d1
00009302 1438 F74D                  		move.b	($FFFFF74D).w,d2
00009306 B501                       		eor.b	d2,d1
00009308 6600                       		bne.s	locret_6812
0000930A 0A38 0010 F74D             		eori.b	#$10,($FFFFF74D).w
00009310 9083                       		sub.l	d3,d0
00009312 6A00                       		bpl.s	loc_680C
00009314 08F8 0000 F756             		bset	#0,(v_bg1_scroll_flags).w
0000931A 4E75                       		rts	
0000931C                            ; ===========================================================================
0000931C                            
0000931C                            loc_680C:
0000931C 08F8 0001 F756             		bset	#1,(v_bg1_scroll_flags).w
00009322                            
00009322                            locret_6812:
00009322 4E75                       		rts	
00009324                            ; End of function ScrollBlock2
00009324                            
00009324                            
00009324                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00009324                            
00009324                            
00009324                            ScrollBlock3:
00009324 3638 F70C                  		move.w	(v_bgscreenposy).w,d3
00009328 31C0 F70C                  		move.w	d0,(v_bgscreenposy).w
0000932C 3200                       		move.w	d0,d1
0000932E 0241 0010                  		andi.w	#$10,d1
00009332 1438 F74D                  		move.b	($FFFFF74D).w,d2
00009336 B501                       		eor.b	d2,d1
00009338 6600                       		bne.s	locret_6842
0000933A 0A38 0010 F74D             		eori.b	#$10,($FFFFF74D).w
00009340 9043                       		sub.w	d3,d0
00009342 6A00                       		bpl.s	loc_683C
00009344 08F8 0000 F756             		bset	#0,(v_bg1_scroll_flags).w
0000934A 4E75                       		rts	
0000934C                            ; ===========================================================================
0000934C                            
0000934C                            loc_683C:
0000934C 08F8 0001 F756             		bset	#1,(v_bg1_scroll_flags).w
00009352                            
00009352                            locret_6842:
00009352 4E75                       		rts	
00009354                            ; End of function ScrollBlock3
00009354                            
00009354                            
00009354                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00009354                            
00009354                            
00009354                            ScrollBlock4:
00009354 3438 F710                  		move.w	(v_bg2screenposx).w,d2
00009358 3638 F714                  		move.w	(v_bg2screenposy).w,d3
0000935C 3038 F73A                  		move.w	(v_scrshiftx).w,d0
00009360 48C0                       		ext.l	d0
00009362 EF80                       		asl.l	#7,d0
00009364 D1B8 F710                  		add.l	d0,(v_bg2screenposx).w
00009368 3038 F710                  		move.w	(v_bg2screenposx).w,d0
0000936C 0240 0010                  		andi.w	#$10,d0
00009370 1238 F74E                  		move.b	($FFFFF74E).w,d1
00009374 B300                       		eor.b	d1,d0
00009376 6600                       		bne.s	locret_68842
00009378 0A38 0010 F74E             		eori.b	#$10,($FFFFF74E).w
0000937E 3038 F710                  		move.w	(v_bg2screenposx).w,d0
00009382 9042                       		sub.w	d2,d0
00009384 6A00                       		bpl.s	loc_687E2
00009386 08F8 0002 F758             		bset	#2,(v_bg2_scroll_flags).w
0000938C 6000                       		bra.s	locret_68842
0000938E                            ; ===========================================================================
0000938E                            
0000938E                            loc_687E2:
0000938E 08F8 0003 F758             		bset	#3,(v_bg2_scroll_flags).w
00009394                            
00009394                            locret_68842:
00009394 4E75                       		rts
00009396                            ; End of function ScrollBlock4  
00009396                            ; End of function ScrollBlock4  
00009396                            		
00009396                            
00009396                            
00009396                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00009396                            
00009396                            ; sub_6886:
00009396                            LoadTilesAsYouMove_BGOnly:
00009396 4BF9 00C0 0004             		lea	(vdp_control_port).l,a5
0000939C 4DF9 00C0 0000             		lea	(vdp_data_port).l,a6
000093A2 45F8 F756                  		lea	(v_bg1_scroll_flags).w,a2
000093A6 47F8 F708                  		lea	(v_bgscreenposx).w,a3
000093AA 49F8 A440                  		lea	(v_lvllayout+$40).w,a4
000093AE 343C 6000                  		move.w	#$6000,d2
000093B2 6100 0000                  		bsr.w	DrawBGScrollBlock1
000093B6 45F8 F758                  		lea	(v_bg2_scroll_flags).w,a2
000093BA 47F8 F710                  		lea	(v_bg2screenposx).w,a3
000093BE 6000 0000                  		bra.w	DrawBGScrollBlock2
000093C2                            ; End of function sub_6886
000093C2                            
000093C2                            ; ---------------------------------------------------------------------------
000093C2                            ; Subroutine to	display	correct	tiles as you move
000093C2                            ; ---------------------------------------------------------------------------
000093C2                            
000093C2                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
000093C2                            
000093C2                            
000093C2                            LoadTilesAsYouMove:
000093C2 4BF9 00C0 0004             		lea	(vdp_control_port).l,a5
000093C8 4DF9 00C0 0000             		lea	(vdp_data_port).l,a6
000093CE                            		; First, update the background
000093CE 45F8 FF32                  		lea	(v_bg1_scroll_flags_dup).w,a2	; Scroll block 1 scroll flags
000093D2 47F8 FF18                  		lea	(v_bgscreenposx_dup).w,a3	; Scroll block 1 X coordinate
000093D6 49F8 A440                  		lea	(v_lvllayout+$40).w,a4
000093DA 343C 6000                  		move.w	#$6000,d2			; VRAM thing for selecting Plane B
000093DE 6100 0000                  		bsr.w	DrawBGScrollBlock1
000093E2 45F8 FF34                  		lea	(v_bg2_scroll_flags_dup).w,a2	; Scroll block 2 scroll flags
000093E6 47F8 FF20                  		lea	(v_bg2screenposx_dup).w,a3	; Scroll block 2 X coordinate
000093EA 6100 0000                  		bsr.w	DrawBGScrollBlock2
000093EE                            		; Then, update the foreground
000093EE 45F8 FF30                  		lea	(v_fg_scroll_flags_dup).w,a2	; Foreground scroll flags
000093F2 47F8 FF10                  		lea	(v_screenposx_dup).w,a3		; Foreground X coordinate
000093F6 49F8 A400                  		lea	(v_lvllayout).w,a4
000093FA 343C 4000                  		move.w	#$4000,d2			; VRAM thing for selecting Plane A
000093FE                            		; The FG's update function is inlined here
000093FE 4A12                       		tst.b	(a2)
00009400 6700                       		beq.s	locret_6952	; If there are no flags set, nothing needs updating
00009402 0892 0000                  		bclr	#0,(a2)
00009406 6700                       		beq.s	loc_6908
00009408                            		; Draw new tiles at the top
00009408 78F0                       		moveq	#-16,d4	; Y coordinate. Note that 16 is the size of a block in pixels
0000940A 7AF0                       		moveq	#-16,d5 ; X coordinate
0000940C 6100 0000                  		bsr.w	Calc_VRAM_Pos
00009410 78F0                       		moveq	#-16,d4 ; Y coordinate
00009412 7AF0                       		moveq	#-16,d5 ; X coordinate
00009414 6100 0000                  		bsr.w	DrawBlocks_LR
00009418                            
00009418                            loc_6908:
00009418 0892 0001                  		bclr	#1,(a2)
0000941C 6700                       		beq.s	loc_6922
0000941E                            		; Draw new tiles at the bottom
0000941E 383C 00E0                  		move.w	#224,d4	; Start at bottom of the screen. Since this draws from top to bottom, we don't need 224+16
00009422 7AF0                       		moveq	#-16,d5
00009424 6100 0000                  		bsr.w	Calc_VRAM_Pos
00009428 383C 00E0                  		move.w	#224,d4
0000942C 7AF0                       		moveq	#-16,d5
0000942E 6100 0000                  		bsr.w	DrawBlocks_LR
00009432                            
00009432                            loc_6922:
00009432 0892 0002                  		bclr	#2,(a2)
00009436 6700                       		beq.s	loc_6938
00009438                            		; Draw new tiles on the left
00009438 78F0                       		moveq	#-16,d4
0000943A 7AF0                       		moveq	#-16,d5
0000943C 6100 0000                  		bsr.w	Calc_VRAM_Pos
00009440 78F0                       		moveq	#-16,d4
00009442 7AF0                       		moveq	#-16,d5
00009444 6100 0000                  		bsr.w	DrawBlocks_TB
00009448                            
00009448                            loc_6938:
00009448 0892 0003                  		bclr	#3,(a2)
0000944C 6700                       		beq.s	locret_6952
0000944E                            		; Draw new tiles on the right
0000944E 78F0                       		moveq	#-16,d4
00009450 3A3C 0140                  		move.w	#320,d5
00009454 6100 0000                  		bsr.w	Calc_VRAM_Pos
00009458 78F0                       		moveq	#-16,d4
0000945A 3A3C 0140                  		move.w	#320,d5
0000945E 6100 0000                  		bsr.w	DrawBlocks_TB
00009462                            
00009462                            locret_6952:
00009462 4E75                       		rts	
00009464                            ; End of function LoadTilesAsYouMove
00009464                            
00009464                            
00009464                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00009464                            
00009464                            ; sub_6954:
00009464                            DrawBGScrollBlock1:
00009464 4A12                       		tst.b	(a2)
00009466 6700 0000                  		beq.w	locret_69F2
0000946A 0892 0000                  		bclr	#0,(a2)
0000946E 6700                       		beq.s	loc_6972
00009470                            		; Draw new tiles at the top
00009470 78F0                       		moveq	#-16,d4
00009472 7AF0                       		moveq	#-16,d5
00009474 6100 0000                  		bsr.w	Calc_VRAM_Pos
00009478 78F0                       		moveq	#-16,d4
0000947A 7AF0                       		moveq	#-16,d5
0000947C 7C1F                       		moveq	#(512/16)-1,d6	 ; Draw entire row of plane
0000947E 6100 0000                  		bsr.w	DrawBlocks_LR_2
00009482                            
00009482                            loc_6972:
00009482 0892 0001                  		bclr	#1,(a2)
00009486 6700                       		beq.s	loc_698E
00009488                            		; Draw new tiles at the top
00009488 383C 00E0                  		move.w	#224,d4
0000948C 7AF0                       		moveq	#-16,d5
0000948E 6100 0000                  		bsr.w	Calc_VRAM_Pos
00009492 383C 00E0                  		move.w	#224,d4
00009496 7AF0                       		moveq	#-16,d5
00009498 7C1F                       		moveq	#(512/16)-1,d6
0000949A 6100 0000                  		bsr.w	DrawBlocks_LR_2
0000949E                            
0000949E                            loc_698E:
0000949E 0892 0002                  		bclr	#2,(a2)
000094A2                            
000094A2 6700                       		beq.s	loc_69BE
000094A4                            		; Draw new tiles on the left
000094A4 78F0                       		moveq	#-16,d4
000094A6 7AF0                       		moveq	#-16,d5
000094A8 6100 0000                  		bsr.w	Calc_VRAM_Pos
000094AC 78F0                       		moveq	#-16,d4
000094AE 7AF0                       		moveq	#-16,d5
000094B0 3C38 F7F0                  		move.w	(v_scroll_block_1_size).w,d6
000094B4 322B 0004                  		move.w	4(a3),d1
000094B8 0241 FFF0                  		andi.w	#-16,d1		; Floor camera Y coordinate to the nearest block
000094BC 9C41                       		sub.w	d1,d6
000094BE 6D00                       		blt.s	loc_69BE	; If scroll block 1 is offscreen, skip loading its tiles
000094C0 E84E                       		lsr.w	#4,d6		; Get number of rows not above the screen
000094C2 0C46 000F                  		cmpi.w	#((224+16+16)/16)-1,d6
000094C6 6500                       		blo.s	loc_69BA
000094C8 7C0F                       		moveq	#((224+16+16)/16)-1,d6	; Cap at height of screen
000094CA                            
000094CA                            loc_69BA:
000094CA 6100 0000                  		bsr.w	DrawBlocks_TB_2
000094CE                            
000094CE                            loc_69BE:
000094CE 0892 0003                  		bclr	#3,(a2)
000094D2 6700                       		beq.s	locret_69F2
000094D4                            		; Draw new tiles on the right
000094D4 78F0                       		moveq	#-16,d4
000094D6 3A3C 0140                  		move.w	#320,d5
000094DA 6100 0000                  		bsr.w	Calc_VRAM_Pos
000094DE 78F0                       		moveq	#-16,d4
000094E0 3A3C 0140                  		move.w	#320,d5
000094E4 3C38 F7F0                  		move.w	(v_scroll_block_1_size).w,d6
000094E8 322B 0004                  		move.w	4(a3),d1
000094EC 0241 FFF0                  		andi.w	#-16,d1
000094F0 9C41                       		sub.w	d1,d6
000094F2 6D00                       		blt.s	locret_69F2
000094F4 E84E                       		lsr.w	#4,d6
000094F6 0C46 000F                  		cmpi.w	#((224+16+16)/16)-1,d6
000094FA 6500                       		blo.s	loc_69EE
000094FC 7C0F                       		moveq	#((224+16+16)/16)-1,d6
000094FE                            
000094FE                            loc_69EE:
000094FE 6100 0000                  		bsr.w	DrawBlocks_TB_2
00009502                            
00009502                            
00009502                            locret_69F2:
00009502 4E75                       		rts	
00009504                            ; End of function DrawBGScrollBlock1
00009504                            
00009504                            
00009504                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00009504                            
00009504                            ; Essentially, this draws everything that isn't scroll block 1
00009504                            ; sub_69F4:
00009504                            DrawBGScrollBlock2:
00009504                            
00009504 4A12                       		tst.b	(a2)
00009506 6700 0000                  		beq.w	locret_6A80
0000950A 0892 0002                  		bclr	#2,(a2)
0000950E 6700                       		beq.s	loc_6A3E
00009510                            		; Draw new tiles on the left
00009510 0C53 0010                  		cmpi.w	#16,(a3)
00009514 6500                       		blo.s	loc_6A3E
00009516 3838 F7F0                  		move.w	(v_scroll_block_1_size).w,d4
0000951A 322B 0004                  		move.w	4(a3),d1
0000951E 0241 FFF0                  		andi.w	#-16,d1
00009522 9841                       		sub.w	d1,d4	; Get remaining coverage of screen that isn't scroll block 1
00009524 3F04                       		move.w	d4,-(sp)
00009526 7AF0                       		moveq	#-16,d5
00009528 6100 0000                  		bsr.w	Calc_VRAM_Pos
0000952C 381F                       		move.w	(sp)+,d4
0000952E 7AF0                       		moveq	#-16,d5
00009530 3C38 F7F0                  		move.w	(v_scroll_block_1_size).w,d6
00009534 322B 0004                  		move.w	4(a3),d1
00009538 0241 FFF0                  		andi.w	#-16,d1
0000953C 9C41                       		sub.w	d1,d6
0000953E 6D00                       		blt.s	loc_6A3E	; If scroll block 1 is completely offscreen, branch?
00009540 E84E                       		lsr.w	#4,d6
00009542 0446 000E                  		subi.w	#((224+16)/16)-1,d6	; Get however many of the rows on screen are not scroll block 1
00009546 6400                       		bhs.s	loc_6A3E
00009548 4446                       		neg.w	d6
0000954A 6100 0000                  		bsr.w	DrawBlocks_TB_2
0000954E                            
0000954E                            loc_6A3E:
0000954E 0892 0003                  		bclr	#3,(a2)
00009552 6700                       		beq.s	locret_6A80
00009554                            		; Draw new tiles on the right
00009554 3838 F7F0                  		move.w	(v_scroll_block_1_size).w,d4
00009558 322B 0004                  		move.w	4(a3),d1
0000955C 0241 FFF0                  		andi.w	#-16,d1
00009560 9841                       		sub.w	d1,d4
00009562 3F04                       		move.w	d4,-(sp)
00009564 3A3C 0140                  		move.w	#320,d5
00009568 6100 0000                  		bsr.w	Calc_VRAM_Pos
0000956C 381F                       		move.w	(sp)+,d4
0000956E 3A3C 0140                  		move.w	#320,d5
00009572 3C38 F7F0                  		move.w	(v_scroll_block_1_size).w,d6
00009576 322B 0004                  		move.w	4(a3),d1
0000957A 0241 FFF0                  		andi.w	#-16,d1
0000957E 9C41                       		sub.w	d1,d6
00009580 6D00                       		blt.s	locret_6A80
00009582 E84E                       		lsr.w	#4,d6
00009584 0446 000E                  		subi.w	#((224+16)/16)-1,d6
00009588 6400                       		bhs.s	locret_6A80
0000958A 4446                       		neg.w	d6
0000958C 6100 0000                  		bsr.w	DrawBlocks_TB_2
00009590                            
00009590                            locret_6A80:
00009590 4E75                       		rts	
00009592                            ; End of function DrawBGScrollBlock2
00009592                            
00009592                            ; ===========================================================================
00009592                            
00009592                            ; Abandoned unused scroll block code.
00009592                            ; This would have drawn a scroll block that started at 208 pixels down, and was 48 pixels long.
00009592 4A12                       		tst.b	(a2)
00009594 6700                       		beq.s	locret_6AD6
00009596 0892 0002                  		bclr	#2,(a2)
0000959A 6700                       		beq.s	loc_6AAC
0000959C                            		; Draw new tiles on the left
0000959C 383C 00D0                  		move.w	#224-16,d4	; Note that full screen coverage is normally 224+16+16. This is exactly three blocks less.
000095A0 322B 0004                  		move.w	4(a3),d1
000095A4 0241 FFF0                  		andi.w	#-16,d1
000095A8 9841                       		sub.w	d1,d4
000095AA 3F04                       		move.w	d4,-(sp)
000095AC 7AF0                       		moveq	#-16,d5
000095AE 6100 0000                  		bsr.w	Calc_VRAM_Pos_Unknown
000095B2 381F                       		move.w	(sp)+,d4
000095B4 7AF0                       		moveq	#-16,d5
000095B6 7C02                       		moveq	#3-1,d6	; Draw only three rows
000095B8 6100 0000                  		bsr.w	DrawBlocks_TB_2
000095BC                            
000095BC                            loc_6AAC:
000095BC 0892 0003                  		bclr	#3,(a2)
000095C0 6700                       		beq.s	locret_6AD6
000095C2                            		; Draw new tiles on the right
000095C2 383C 00D0                  		move.w	#224-16,d4
000095C6 322B 0004                  		move.w	4(a3),d1
000095CA 0241 FFF0                  		andi.w	#-16,d1
000095CE 9841                       		sub.w	d1,d4
000095D0 3F04                       		move.w	d4,-(sp)
000095D2 3A3C 0140                  		move.w	#320,d5
000095D6 6100 0000                  		bsr.w	Calc_VRAM_Pos_Unknown
000095DA 381F                       		move.w	(sp)+,d4
000095DC 3A3C 0140                  		move.w	#320,d5
000095E0 7C02                       		moveq	#3-1,d6
000095E2 6100 0000                  		bsr.w	DrawBlocks_TB_2
000095E6                            
000095E6                            locret_6AD6:
000095E6 4E75                       		rts	
000095E8                            
000095E8                            
000095E8                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
000095E8                            
000095E8                            ; Don't be fooled by the name: this function's for drawing from left to right
000095E8                            ; when the camera's moving up or down
000095E8                            ; DrawTiles_LR:
000095E8                            DrawBlocks_LR:
000095E8 7C15                       		moveq	#((320+16+16)/16)-1,d6	; Draw the entire width of the screen + two extra columns
000095EA                            ; DrawTiles_LR_2:
000095EA                            DrawBlocks_LR_2:
000095EA 2E3C 0080 0000             		move.l	#$800000,d7	; Delta between rows of tiles
000095F0 2200                       		move.l	d0,d1
000095F2                            
000095F2                            	@loop:
000095F2 48E7 0C00                  		movem.l	d4-d5,-(sp)
000095F6 6100 0000                  		bsr.w	GetBlockData
000095FA 2001                       		move.l	d1,d0
000095FC 6100 0000                  		bsr.w	DrawBlock
00009600 5801                       		addq.b	#4,d1		; Two tiles ahead
00009602 0201 007F                  		andi.b	#$7F,d1		; Wrap around row
00009606 4CDF 0030                  		movem.l	(sp)+,d4-d5
0000960A 0645 0010                  		addi.w	#16,d5		; Move X coordinate one block ahead
0000960E 51CE FFE2                  		dbf	d6,@loop
00009612 4E75                       		rts
00009614                            ; End of function DrawBlocks_LR
00009614                            
00009614                            
00009614                            
00009614                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00009614                            
00009614                            ; Don't be fooled by the name: this function's for drawing from top to bottom
00009614                            ; when the camera's moving left or right
00009614                            ; DrawTiles_TB:
00009614                            DrawBlocks_TB:
00009614 7C0F                       		moveq	#((224+16+16)/16)-1,d6	; Draw the entire height of the screen + two extra rows
00009616                            ; DrawTiles_TB_2:
00009616                            DrawBlocks_TB_2:
00009616 2E3C 0080 0000             		move.l	#$800000,d7	; Delta between rows of tiles
0000961C 2200                       		move.l	d0,d1
0000961E                            
0000961E                            	@loop:
0000961E 48E7 0C00                  		movem.l	d4-d5,-(sp)
00009622 6100 0000                  		bsr.w	GetBlockData
00009626 2001                       		move.l	d1,d0
00009628 6100 0000                  		bsr.w	DrawBlock
0000962C 0641 0100                  		addi.w	#$100,d1	; Two rows ahead
00009630 0241 0FFF                  		andi.w	#$FFF,d1	; Wrap around plane
00009634 4CDF 0030                  		movem.l	(sp)+,d4-d5
00009638 0644 0010                  		addi.w	#16,d4		; Move X coordinate one block ahead
0000963C 51CE FFE0                  		dbf	d6,@loop
00009640 4E75                       		rts	
00009642                            ; End of function DrawBlocks_TB_2
00009642                            
00009642                            
00009642                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00009642                            
00009642                            ; Draws a block's worth of tiles
00009642                            ; Parameters:
00009642                            ; a0 = Pointer to block metadata (block index and X/Y flip)
00009642                            ; a1 = Pointer to block
00009642                            ; a5 = Pointer to VDP command port
00009642                            ; a6 = Pointer to VDP data port
00009642                            ; d0 = VRAM command to access plane
00009642                            ; d2 = VRAM plane A/B specifier
00009642                            ; d7 = Plane row delta
00009642                            ; DrawTiles:
00009642                            DrawBlock:
00009642 8042                       		or.w	d2,d0	; OR in that plane A/B specifier to the VRAM command
00009644 4840                       		swap	d0
00009646 0810 0004                  		btst	#4,(a0)	; Check Y-flip bit
0000964A 6600                       		bne.s	DrawFlipY
0000964C 0810 0003                  		btst	#3,(a0)	; Check X-flip bit
00009650 6600                       		bne.s	DrawFlipX
00009652 2A80                       		move.l	d0,(a5)
00009654 2C99                       		move.l	(a1)+,(a6)	; Write top two tiles
00009656 D087                       		add.l	d7,d0		; Next row
00009658 2A80                       		move.l	d0,(a5)
0000965A 2C99                       		move.l	(a1)+,(a6)	; Write bottom two tiles
0000965C 4E75                       		rts	
0000965E                            ; ===========================================================================
0000965E                            
0000965E                            DrawFlipX:
0000965E 2A80                       		move.l	d0,(a5)
00009660 2819                       		move.l	(a1)+,d4
00009662 0A84 0800 0800             		eori.l	#$8000800,d4	; Invert X-flip bits of each tile
00009668 4844                       		swap	d4		; Swap the tiles around
0000966A 2C84                       		move.l	d4,(a6)		; Write top two tiles
0000966C D087                       		add.l	d7,d0		; Next row
0000966E 2A80                       		move.l	d0,(a5)
00009670 2819                       		move.l	(a1)+,d4
00009672 0A84 0800 0800             		eori.l	#$8000800,d4
00009678 4844                       		swap	d4
0000967A 2C84                       		move.l	d4,(a6)		; Write bottom two tiles
0000967C 4E75                       		rts	
0000967E                            ; ===========================================================================
0000967E                            
0000967E                            DrawFlipY:
0000967E 0810 0003                  		btst	#3,(a0)
00009682 6600                       		bne.s	DrawFlipXY
00009684 2A80                       		move.l	d0,(a5)
00009686 2A19                       		move.l	(a1)+,d5
00009688 2819                       		move.l	(a1)+,d4
0000968A 0A84 1000 1000             		eori.l	#$10001000,d4
00009690 2C84                       		move.l	d4,(a6)
00009692 D087                       		add.l	d7,d0
00009694 2A80                       		move.l	d0,(a5)
00009696 0A85 1000 1000             		eori.l	#$10001000,d5
0000969C 2C85                       		move.l	d5,(a6)
0000969E 4E75                       		rts	
000096A0                            ; ===========================================================================
000096A0                            
000096A0                            DrawFlipXY:
000096A0 2A80                       		move.l	d0,(a5)
000096A2 2A19                       		move.l	(a1)+,d5
000096A4 2819                       		move.l	(a1)+,d4
000096A6 0A84 1800 1800             		eori.l	#$18001800,d4
000096AC 4844                       		swap	d4
000096AE 2C84                       		move.l	d4,(a6)
000096B0 D087                       		add.l	d7,d0
000096B2 2A80                       		move.l	d0,(a5)
000096B4 0A85 1800 1800             		eori.l	#$18001800,d5
000096BA 4845                       		swap	d5
000096BC 2C85                       		move.l	d5,(a6)
000096BE 4E75                       		rts	
000096C0                            ; End of function DrawBlocks
000096C0                            
000096C0                            ; ===========================================================================
000096C0                            ; unused garbage
000096C0                            ; This is interesting. It draws a block, but not before
000096C0                            ; incrementing its palette lines by 1. This may have been
000096C0                            ; a debug function to discolour mirrored tiles, to test
000096C0                            ; if they're loading properly.
000096C0 4E75                       		rts	
000096C2 2A80                       		move.l	d0,(a5)
000096C4 3A3C 2000                  		move.w	#$2000,d5
000096C8 3819                       		move.w	(a1)+,d4
000096CA D845                       		add.w	d5,d4
000096CC 3C84                       		move.w	d4,(a6)
000096CE 3819                       		move.w	(a1)+,d4
000096D0 D845                       		add.w	d5,d4
000096D2 3C84                       		move.w	d4,(a6)
000096D4 D087                       		add.l	d7,d0
000096D6 2A80                       		move.l	d0,(a5)
000096D8 3819                       		move.w	(a1)+,d4
000096DA D845                       		add.w	d5,d4
000096DC 3C84                       		move.w	d4,(a6)
000096DE 3819                       		move.w	(a1)+,d4
000096E0 D845                       		add.w	d5,d4
000096E2 3C84                       		move.w	d4,(a6)
000096E4 4E75                       		rts
000096E6                            
000096E6                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
000096E6                            
000096E6                            ; Gets address of block at a certain coordinate
000096E6                            ; Parameters:
000096E6                            ; a4 = Pointer to level layout
000096E6                            ; d4 = Relative Y coordinate
000096E6                            ; d5 = Relative X coordinate
000096E6                            ; Returns:
000096E6                            ; a0 = Address of block metadata
000096E6                            ; a1 = Address of block
000096E6                            ; DrawBlocks:
000096E6                            GetBlockData:
000096E6 43F8 B000                  		lea	(v_16x16).w,a1
000096EA D86B 0004                  		add.w	4(a3),d4	; Add camera Y coordinate to relative coordinate
000096EE DA53                       		add.w	(a3),d5		; Add camera X coordinate to relative coordinate
000096F0                            		; Turn Y coordinate into index into level layout
000096F0 3604                       		move.w	d4,d3
000096F2 E24B                       		lsr.w	#1,d3
000096F4 0243 0380                  		andi.w	#$380,d3
000096F8                            		; Turn X coordinate into index into level layout
000096F8 E64D                       		lsr.w	#3,d5
000096FA 3005                       		move.w	d5,d0
000096FC EA48                       		lsr.w	#5,d0
000096FE 0240 007F                  		andi.w	#$7F,d0
00009702                            		; Get chunk from level layout
00009702 D043                       		add.w	d3,d0
00009704 76FF                       		moveq	#-1,d3
00009706 1634 0000                  		move.b	(a4,d0.w),d3
0000970A 6700                       		beq.s	locret_6C1E	; If chunk 00, just return a pointer to the first block (expected to be empty)
0000970C                            		; Turn chunk ID into index into chunk table
0000970C 5303                       		subq.b	#1,d3
0000970E 0243 007F                  		andi.w	#$7F,d3
00009712 EE5B                       		ror.w	#7,d3
00009714                            		; Turn Y coordinate into index into chunk
00009714 D844                       		add.w	d4,d4
00009716 0244 01E0                  		andi.w	#$1E0,d4
0000971A                            		; Turn X coordinate into index into chunk
0000971A 0245 001E                  		andi.w	#$1E,d5
0000971E                            		; Get block metadata from chunk
0000971E D644                       		add.w	d4,d3
00009720 D645                       		add.w	d5,d3
00009722 2043                       		movea.l	d3,a0
00009724 3610                       		move.w	(a0),d3
00009726                            		; Turn block ID into address
00009726 0243 03FF                  		andi.w	#$3FF,d3
0000972A E74B                       		lsl.w	#3,d3
0000972C D2C3                       		adda.w	d3,a1
0000972E                            
0000972E                            locret_6C1E:
0000972E 4E75                       		rts	
00009730                            ; End of function GetBlockData
00009730                            
00009730                            
00009730                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00009730                            
00009730                            ; Produces a VRAM plane access command from coordinates
00009730                            ; Parameters:
00009730                            ; d4 = Relative Y coordinate
00009730                            ; d5 = Relative X coordinate
00009730                            ; Returns VDP command in d0
00009730                            Calc_VRAM_Pos:
00009730 D86B 0004                  		add.w	4(a3),d4	; Add camera Y coordinate
00009734 DA53                       		add.w	(a3),d5		; Add camera X coordinate
00009736                            		; Floor the coordinates to the nearest pair of tiles (the size of a block).
00009736                            		; Also note that this wraps the value to the size of the plane:
00009736                            		; The plane is 64*8 wide, so wrap at $100, and it's 32*8 tall, so wrap at $200
00009736 0244 00F0                  		andi.w	#$F0,d4
0000973A 0245 01F0                  		andi.w	#$1F0,d5
0000973E                            		; Transform the adjusted coordinates into a VDP command
0000973E E94C                       		lsl.w	#4,d4
00009740 E44D                       		lsr.w	#2,d5
00009742 D845                       		add.w	d5,d4
00009744 7003                       		moveq	#3,d0	; Highest bits of plane VRAM address
00009746 4840                       		swap	d0
00009748 3004                       		move.w	d4,d0
0000974A 4E75                       		rts	
0000974C                            ; End of function Calc_VRAM_Pos
0000974C                            
0000974C                            
0000974C                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
0000974C                            ; not used
0000974C                            
0000974C                            ; This is just like Calc_VRAM_Pos, but seemingly for an earlier
0000974C                            ; VRAM layout: the only difference is the high bits of the
0000974C                            ; plane's VRAM address, which are 10 instead of 11.
0000974C                            ; Both the foreground and background are at $C000 and $E000
0000974C                            ; respectively, so this one starting at $8000 makes no sense.
0000974C                            ; sub_6C3C:
0000974C                            Calc_VRAM_Pos_Unknown:
0000974C D86B 0004                  		add.w	4(a3),d4
00009750 DA53                       		add.w	(a3),d5
00009752 0244 00F0                  		andi.w	#$F0,d4
00009756 0245 01F0                  		andi.w	#$1F0,d5
0000975A E94C                       		lsl.w	#4,d4
0000975C E44D                       		lsr.w	#2,d5
0000975E D845                       		add.w	d5,d4
00009760 7002                       		moveq	#2,d0
00009762 4840                       		swap	d0
00009764 3004                       		move.w	d4,d0
00009766 4E75                       		rts	
00009768                            ; End of function Calc_VRAM_Pos_Unknown
00009768                            
00009768                            ; ---------------------------------------------------------------------------
00009768                            ; Subroutine to	load tiles as soon as the level	appears
00009768                            ; ---------------------------------------------------------------------------
00009768                            
00009768                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00009768                            
00009768                            
00009768                            LoadTilesFromStart:
00009768 4BF9 00C0 0004             		lea	(vdp_control_port).l,a5
0000976E 4DF9 00C0 0000             		lea	(vdp_data_port).l,a6
00009774 47F8 F700                  		lea	(v_screenposx).w,a3
00009778 49F8 A400                  		lea	(v_lvllayout).w,a4
0000977C 343C 4000                  		move.w	#$4000,d2
00009780 6100                       		bsr.s	DrawChunks
00009782 47F8 F708                  		lea	(v_bgscreenposx).w,a3
00009786 49F8 A440                  		lea	(v_lvllayout+$40).w,a4
0000978A 343C 6000                  		move.w	#$6000,d2
0000978E                            ; End of function LoadTilesFromStart
0000978E                            
0000978E                            
0000978E                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
0000978E                            
0000978E                            
0000978E                            DrawChunks:
0000978E 78F0                       		moveq	#-16,d4
00009790 7C0F                       		moveq	#((224+16+16)/16)-1,d6
00009792                            
00009792                            	@loop:
00009792 48E7 0E00                  		movem.l	d4-d6,-(sp)
00009796 7A00                       		moveq	#0,d5
00009798 3204                       		move.w	d4,d1
0000979A 6100 FF94                  		bsr.w	Calc_VRAM_Pos
0000979E 3801                       		move.w	d1,d4
000097A0 7A00                       		moveq	#0,d5
000097A2 7C1F                       		moveq	#(512/16)-1,d6
000097A4 6100 FE44                  		bsr.w	DrawBlocks_LR_2
000097A8 4CDF 0070                  		movem.l	(sp)+,d4-d6
000097AC 0644 0010                  		addi.w	#16,d4
000097B0 51CE FFE0                  		dbf	d6,@loop
000097B4 4E75                       		rts	
000097B6                            ; End of function DrawChunks
000097B6                            
000097B6                            
000097B6                            ; ---------------------------------------------------------------------------
000097B6                            ; Subroutine to load basic level data
000097B6                            ; ---------------------------------------------------------------------------
000097B6                            
000097B6                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
000097B6                            
000097B6                            
000097B6                            LevelDataLoad:
000097B6 7000                       		moveq	#0,d0
000097B8 1038 FE10                  		move.b	(v_zone).w,d0
000097BC E948                       		lsl.w	#4,d0
000097BE 45F9 0000 0000             		lea	(LevelHeaders).l,a2
000097C4 45F2 0000                  		lea	(a2,d0.w),a2
000097C8 2F0A                       		move.l	a2,-(sp)
000097CA 588A                       		addq.l	#4,a2
000097CC 205A                       		movea.l	(a2)+,a0
000097CE 43F8 B000                  		lea	(v_16x16).w,a1	; RAM address for 16x16 mappings
000097D2 303C 0000                  		move.w	#0,d0
000097D6 6100 9EBC                  		bsr.w	EniDec
000097DA 205A                       		movea.l	(a2)+,a0
000097DC 43F9 00FF 0000             		lea	(v_256x256).l,a1 ; RAM address for 256x256 mappings
000097E2 6100 A02E                  		bsr.w	KosDec
000097E6 6100 0000                  		bsr.w	LevelLayoutLoad
000097EA 301A                       		move.w	(a2)+,d0
000097EC 3012                       		move.w	(a2),d0
000097EE 0240 00FF                  		andi.w	#$FF,d0
000097F2 0C78 0103 FE10             		cmpi.w	#(id_LZ<<8)+3,(v_zone).w ; is level SBZ3 (LZ4) ?
000097F8 6600                       		bne.s	@notSBZ3	; if not, branch
000097FA 700D                       		moveq	#palid_CWZ3,d0	; use SB3 palette
000097FC                            
000097FC                            	@notSBZ3:
000097FC 0C78 0501 FE10             		cmpi.w	#(id_CWZ<<8)+1,(v_zone).w ; is level SBZ2?
00009802 6700                       		beq.s	@isSBZorFZ	; if yes, branch
00009804 0C78 0502 FE10             		cmpi.w	#(id_CWZ<<8)+2,(v_zone).w ; is level FZ?
0000980A 6600                       		bne.s	@normalpal	; if not, branch
0000980C                            
0000980C                            	@isSBZorFZ:
0000980C 700F                       		moveq	#palid_CWZ2,d0	; use SBZ2/FZ palette
0000980E                            
0000980E                            	@normalpal:
0000980E 6100 A9E2                  		bsr.w	PalLoad1	; load palette (based on d0)
00009812 245F                       		movea.l	(sp)+,a2
00009814 584A                       		addq.w	#4,a2		; read number for 2nd PLC
00009816 7000                       		moveq	#0,d0
00009818 1012                       		move.b	(a2),d0
0000981A 6700                       		beq.s	@skipPLC	; if 2nd PLC is 0 (i.e. the ending sequence), branch
0000981C 6100 9CD8                  		bsr.w	AddPLC		; load pattern load cues
00009820                            
00009820                            	@skipPLC:
00009820 4E75                       		rts	
00009822                            ; End of function LevelDataLoad
00009822                            
00009822                            ; ---------------------------------------------------------------------------
00009822                            ; Level	layout loading subroutine
00009822                            ; ---------------------------------------------------------------------------
00009822                            
00009822                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00009822                            
00009822                            
00009822                            LevelLayoutLoad:
00009822 47F8 A400                  		lea	(v_lvllayout).w,a3
00009826 323C 01FF                  		move.w	#$1FF,d1
0000982A 7000                       		moveq	#0,d0
0000982C                            
0000982C                            LevLoad_ClrRam:
0000982C 26C0                       		move.l	d0,(a3)+
0000982E 51C9 FFFC                  		dbf	d1,LevLoad_ClrRam ; clear the RAM ($A400-A7FF)
00009832                            
00009832 47F8 A400                  		lea	(v_lvllayout).w,a3 ; RAM address for level layout
00009836 7200                       		moveq	#0,d1
00009838 6100 0000                  		bsr.w	LevelLayoutLoad2 ; load	level layout into RAM
0000983C 47F8 A440                  		lea	(v_lvllayout+$40).w,a3 ; RAM address for background layout
00009840 7202                       		moveq	#2,d1
00009842                            ; End of function LevelLayoutLoad
00009842                            
00009842                            ; "LevelLayoutLoad2" is	run twice - for	the level and the background
00009842                            
00009842                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00009842                            
00009842                            
00009842                            LevelLayoutLoad2:
00009842 3038 FE10                  		move.w	(v_zone).w,d0
00009846 ED08                       		lsl.b	#6,d0
00009848 EA48                       		lsr.w	#5,d0
0000984A 3400                       		move.w	d0,d2
0000984C D040                       		add.w	d0,d0
0000984E D042                       		add.w	d2,d0
00009850 D041                       		add.w	d1,d0
00009852 43F9 0000 0000             		lea	(Level_Index).l,a1
00009858 3031 0000                  		move.w	(a1,d0.w),d0
0000985C 43F1 0000                  		lea	(a1,d0.w),a1
00009860 7200                       		moveq	#0,d1
00009862 3401                       		move.w	d1,d2
00009864 1219                       		move.b	(a1)+,d1	; load level width (in tiles)
00009866 1419                       		move.b	(a1)+,d2	; load level height (in	tiles)
00009868                            
00009868                            LevLoad_NumRows:
00009868 3001                       		move.w	d1,d0
0000986A 204B                       		movea.l	a3,a0
0000986C                            
0000986C                            LevLoad_Row:
0000986C 10D9                       		move.b	(a1)+,(a0)+
0000986E 51C8 FFFC                  		dbf	d0,LevLoad_Row	; load 1 row
00009872 47EB 0080                  		lea	$80(a3),a3	; do next row
00009876 51CA FFF0                  		dbf	d2,LevLoad_NumRows ; repeat for	number of rows
0000987A 4E75                       		rts	
0000987C                            ; End of function LevelLayoutLoad2
0000987C                            
0000987C                            		include	"_inc\DynamicLevelEvents.asm"
0000987C                            ; ---------------------------------------------------------------------------
0000987C                            ; Dynamic level events
0000987C                            ; ---------------------------------------------------------------------------
0000987C                            
0000987C                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
0000987C                            
0000987C                            
0000987C                            DynamicLevelEvents:
0000987C 7000                       		moveq	#0,d0
0000987E 1038 FE10                  		move.b	(v_zone).w,d0
00009882 D040                       		add.w	d0,d0
00009884 303B 0000                  		move.w	DLE_Index(pc,d0.w),d0
00009888 4EBB 0000                  		jsr	DLE_Index(pc,d0.w) ; run level-specific events
0000988C 7202                       		moveq	#2,d1
0000988E 3038 F726                  		move.w	(v_limitbtm1).w,d0
00009892 9078 F72E                  		sub.w	(v_limitbtm2).w,d0 ; has lower level boundary changed recently?
00009896 6700                       		beq.s	DLE_NoChg	; if not, branch
00009898 6400                       		bcc.s	loc_6DAC
0000989A                            
0000989A 4441                       		neg.w	d1
0000989C 3038 F704                  		move.w	(v_screenposy).w,d0
000098A0 B078 F726                  		cmp.w	(v_limitbtm1).w,d0
000098A4 6300                       		bls.s	loc_6DA0
000098A6 31C0 F72E                  		move.w	d0,(v_limitbtm2).w
000098AA 0278 FFFE F72E             		andi.w	#$FFFE,(v_limitbtm2).w
000098B0                            
000098B0                            loc_6DA0:
000098B0 D378 F72E                  		add.w	d1,(v_limitbtm2).w
000098B4 11FC 0001 F75C             		move.b	#1,(f_bgscrollvert).w
000098BA                            
000098BA                            DLE_NoChg:
000098BA 4E75                       		rts	
000098BC                            ; ===========================================================================
000098BC                            
000098BC                            loc_6DAC:
000098BC 3038 F704                  		move.w	(v_screenposy).w,d0
000098C0 5040                       		addq.w	#8,d0
000098C2 B078 F72E                  		cmp.w	(v_limitbtm2).w,d0
000098C6 6500                       		bcs.s	loc_6DC4
000098C8 0838 0001 D022             		btst	#1,(v_player+obStatus).w
000098CE 6700                       		beq.s	loc_6DC4
000098D0 D241                       		add.w	d1,d1
000098D2 D241                       		add.w	d1,d1
000098D4                            
000098D4                            loc_6DC4:
000098D4 D378 F72E                  		add.w	d1,(v_limitbtm2).w
000098D8 11FC 0001 F75C             		move.b	#1,(f_bgscrollvert).w
000098DE 4E75                       		rts	
000098E0                            ; End of function DynamicLevelEvents
000098E0                            
000098E0                            ; ===========================================================================
000098E0                            ; ---------------------------------------------------------------------------
000098E0                            ; Offset index for dynamic level events
000098E0                            ; ---------------------------------------------------------------------------
000098E0 0000 0000                  DLE_Index:	dc.w DLE_GHZ-DLE_Index, DLE_LZ-DLE_Index
000098E4 0000 0000                  		dc.w DLE_MZ-DLE_Index, DLE_SLZ-DLE_Index
000098E8 0000 0000                  		dc.w DLE_SYZ-DLE_Index, DLE_SBZ-DLE_Index
000098EC 0000 0000                  		dc.w DLE_Ending-DLE_Index, DLE_IMZ-DLE_Index
000098F0 0000 0000                  		dc.w DLE_SBZ-DLE_Index, DLE_SBZ-DLE_Index
000098F4 0000 0000                  		dc.w DLE_SBZ-DLE_Index, DLE_SBZ-DLE_Index
000098F8                            ; ===========================================================================
000098F8                            ; ---------------------------------------------------------------------------
000098F8                            ; Green	Hill Zone dynamic level events
000098F8                            ; ---------------------------------------------------------------------------
000098F8                            
000098F8                            DLE_GHZ:
000098F8 7000                       		moveq	#0,d0
000098FA 1038 FE11                  		move.b	(v_act).w,d0
000098FE D040                       		add.w	d0,d0
00009900 303B 0000                  		move.w	DLE_GHZx(pc,d0.w),d0
00009904 4EFB 0000                  		jmp	DLE_GHZx(pc,d0.w)
00009908                            ; ===========================================================================
00009908 0000                       DLE_GHZx:	dc.w DLE_GHZ1-DLE_GHZx
0000990A 0000                       		dc.w DLE_GHZ2-DLE_GHZx
0000990C 0000                       		dc.w DLE_GHZ3-DLE_GHZx
0000990E                            ; ===========================================================================
0000990E                            
0000990E                            DLE_GHZ1:
0000990E 31FC 0300 F726             		move.w	#$300,(v_limitbtm1).w ; set lower y-boundary
00009914 0C78 0D00 F700             		cmpi.w	#$0D00,(v_screenposx).w ; has the camera reached $1780 on x-axis?
0000991A 6500                       		bcs.s	locret_6E08	; if not, branch
0000991C 31FC 0200 F726             		move.w	#$200,(v_limitbtm1).w ; set lower y-boundary
00009922 0C78 1680 F700             		cmpi.w	#$1680,(v_screenposx).w ; has the camera reached $1780 on x-axis?
00009928 6500                       		bcs.s	locret_6E08	; if not, branch
0000992A 31FC 0400 F726             		move.w	#$400,(v_limitbtm1).w ; set lower y-boundary
00009930                            
00009930                            locret_6E08:
00009930 4E75                       		rts	
00009932                            ; ===========================================================================
00009932                            
00009932                            DLE_GHZ2:
00009932                            	;	move.w	#$100,(v_limittop1).w
00009932                            	;	cmpi.w	#$ED0,(v_screenposx).w
00009932                            	;	bcs.s	locret_6E3A
00009932                            	;	move.w	#$200,(v_limitbtm1).w
00009932                            	;	cmpi.w	#$1600,(v_screenposx).w
00009932                            	;	bcs.s	locret_6E3A
00009932                            	;	move.w	#$400,(v_limitbtm1).w
00009932                            	;	cmpi.w	#$1AE0,(v_screenposx).w
00009932                            	;	bcs.s	locret_6E3A
00009932                            	;	move.w	#$200,(v_limittop2).w
00009932                            
00009932                            locret_6E3A:
00009932 4E75                       		rts	
00009934                            ; ===========================================================================
00009934                            
00009934                            DLE_GHZ3:
00009934 7000                       		moveq	#0,d0
00009936 1038 F742                  		move.b	(v_dle_routine).w,d0
0000993A 303B 0000                  		move.w	off_6E4A(pc,d0.w),d0
0000993E 4EFB 0000                  		jmp	off_6E4A(pc,d0.w)
00009942                            ; ===========================================================================
00009942 0000                       off_6E4A:	dc.w DLE_GHZ3main-off_6E4A
00009944 0000                       		dc.w DLE_GHZ3boss-off_6E4A
00009946 0000                       		dc.w DLE_GHZ3end-off_6E4A
00009948                            ; ===========================================================================
00009948                            
00009948                            DLE_GHZ3main:
00009948 31FC 0300 F726             		move.w	#$300,(v_limitbtm1).w
0000994E 0C78 0380 F700             		cmpi.w	#$380,(v_screenposx).w
00009954 6500                       		bcs.s	locret_6E96
00009956 31FC 0310 F726             		move.w	#$310,(v_limitbtm1).w
0000995C 0C78 0960 F700             		cmpi.w	#$960,(v_screenposx).w
00009962 6500                       		bcs.s	locret_6E96
00009964 0C78 0280 F704             		cmpi.w	#$280,(v_screenposy).w
0000996A 6500                       		bcs.s	loc_6E98
0000996C 31FC 0300 F726             		move.w	#$300,(v_limitbtm1).w
00009972 0C78 1680 F700             		cmpi.w	#$1680,(v_screenposx).w
00009978 6400                       		bcc.s	loc_6E8E
0000997A 31FC 0400 F726             		move.w	#$400,(v_limitbtm1).w
00009980 31FC 0400 F72E             		move.w	#$400,(v_limitbtm2).w
00009986                            
00009986                            loc_6E8E:
00009986 0C78 1700 F700             		cmpi.w	#$1700,(v_screenposx).w
0000998C 6400                       		bcc.s	loc_6E98
0000998E                            
0000998E                            locret_6E96:
0000998E 4E75                       		rts	
00009990                            ; ===========================================================================
00009990                            
00009990                            loc_6E98:
00009990 31FC 0300 F726             		move.w	#$300,(v_limitbtm1).w
00009996 5438 F742                  		addq.b	#2,(v_dle_routine).w
0000999A 4E75                       		rts	
0000999C                            ; ===========================================================================
0000999C                            
0000999C                            DLE_GHZ3boss:
0000999C 0C78 0960 F700             		cmpi.w	#$960,(v_screenposx).w
000099A2 6400                       		bcc.s	loc_6EB0
000099A4 5538 F742                  		subq.b	#2,(v_dle_routine).w
000099A8                            
000099A8                            loc_6EB0:
000099A8 0C78 2900 F700             		cmpi.w	#$2900,(v_screenposx).w
000099AE 6500                       		bcs.s	locret_6EE8
000099B0 6100 0000                  		bsr.w	FindFreeObj
000099B4 6600                       		bne.s	loc_6ED0
000099B6 137C 0000 0000             		move.b	#id_BossGreenHill,0(a1) ; load GHZ boss	object
000099BC 337C 2A60 0008             		move.w	#$2A60,obX(a1)
000099C2 337C 0280 000C             		move.w	#$280,obY(a1)
000099C8                            
000099C8                            loc_6ED0:
000099D0 11FC 0001 F7AA             		move.b	#1,(f_lockscreen).w ; lock screen
000099D6 5438 F742                  		addq.b	#2,(v_dle_routine).w
000099DA 7000                       		moveq	#plcid_Boss,d0
000099DC 6000 9B18                  		bra.w	AddPLC		; load boss patterns
000099E0                            ; ===========================================================================
000099E0                            
000099E0                            locret_6EE8:
000099E0 4E75                       		rts	
000099E2                            ; ===========================================================================
000099E2                            
000099E2                            DLE_GHZ3end:
000099E2 31F8 F700 F728             		move.w	(v_screenposx).w,(v_limitleft2).w
000099E8 4E75                       		rts	
000099EA                            ; ===========================================================================
000099EA                            ; ---------------------------------------------------------------------------
000099EA                            ; Labyrinth Zone dynamic level events
000099EA                            ; ---------------------------------------------------------------------------
000099EA                            
000099EA                            DLE_LZ:
000099EA 7000                       		moveq	#0,d0
000099EC 1038 FE11                  		move.b	(v_act).w,d0
000099F0 D040                       		add.w	d0,d0
000099F2 303B 0000                  		move.w	DLE_LZx(pc,d0.w),d0
000099F6 4EFB 0000                  		jmp	DLE_LZx(pc,d0.w)
000099FA                            ; ===========================================================================
000099FA 0000                       DLE_LZx:	dc.w DLE_LZ12-DLE_LZx
000099FC 0000                       		dc.w DLE_LZ12-DLE_LZx
000099FE 0000                       		dc.w DLE_LZ3-DLE_LZx
00009A00 0000                       		dc.w DLE_SBZ3-DLE_LZx
00009A02                            ; ===========================================================================
00009A02                            
00009A02                            DLE_LZ12:
00009A02 4E75                       		rts	
00009A04                            ; ===========================================================================
00009A04                            
00009A04                            DLE_LZ3:
00009A04 4A38 F7EF                  		tst.b	(f_switch+$F).w	; has switch $F	been pressed?
00009A08 6700                       		beq.s	loc_6F28	; if not, branch
00009A0A 43F8 A506                  		lea	(v_lvllayout+$106).w,a1
00009A0E 0C11 0007                  		cmpi.b	#7,(a1)
00009A12 6700                       		beq.s	loc_6F28
00009A14 12BC 0007                  		move.b	#7,(a1)		; modify level layout
00009A20                            
00009A20                            loc_6F28:
00009A20 4A38 F742                  		tst.b	(v_dle_routine).w
00009A24 6600                       		bne.s	locret_6F64
00009A26 0C78 1CA0 F700             		cmpi.w	#$1CA0,(v_screenposx).w
00009A2C 6500                       		bcs.s	locret_6F62
00009A2E 0C78 0600 F704             		cmpi.w	#$600,(v_screenposy).w
00009A34 6400                       		bcc.s	locret_6F62
00009A36 6100 0000                  		bsr.w	FindFreeObj
00009A3A 6600                       		bne.s	loc_6F4A
00009A3C 137C 0000 0000             		move.b	#id_BossLabyrinth,0(a1) ; load LZ boss object
00009A42                            
00009A42                            loc_6F4A:
00009A4A 11FC 0001 F7AA             		move.b	#1,(f_lockscreen).w ; lock screen
00009A50 5438 F742                  		addq.b	#2,(v_dle_routine).w
00009A54 7000                       		moveq	#plcid_Boss,d0
00009A56 6000 9A9E                  		bra.w	AddPLC		; load boss patterns
00009A5A                            ; ===========================================================================
00009A5A                            
00009A5A                            locret_6F62:
00009A5A 4E75                       		rts	
00009A5C                            ; ===========================================================================
00009A5C                            
00009A5C                            locret_6F64:
00009A5C 4E75                       		rts	
00009A5E                            ; ===========================================================================
00009A5E                            
00009A5E                            DLE_SBZ3:
00009A5E 0C78 0D00 F700             		cmpi.w	#$D00,(v_screenposx).w
00009A64 6500                       		bcs.s	locret_6F8C
00009A66 0C78 0018 D00C             		cmpi.w	#$18,(v_player+obY).w ; has Sonic reached the top of the level?
00009A6C 6400                       		bcc.s	locret_6F8C	; if not, branch
00009A6E 4238 FE30                  		clr.b	(v_lastlamp).w
00009A72 31FC 0001 FE02             		move.w	#1,(f_restart).w ; restart level
00009A78 31FC 0502 FE10             		move.w	#(id_CWZ<<8)+2,(v_zone).w ; set level number to 0502 (FZ)
00009A7E 11FC 0001 F7C8             		move.b	#1,(f_lockmulti).w ; freeze Sonic
00009A84                            
00009A84                            locret_6F8C:
00009A84 4E75                       		rts	
00009A86                            ; ===========================================================================
00009A86                            ; ---------------------------------------------------------------------------
00009A86                            ; Marble Zone dynamic level events
00009A86                            ; ---------------------------------------------------------------------------
00009A86                            
00009A86                            DLE_MZ:
00009A86 7000                       		moveq	#0,d0
00009A88 1038 FE11                  		move.b	(v_act).w,d0
00009A8C D040                       		add.w	d0,d0
00009A8E 303B 0000                  		move.w	DLE_MZx(pc,d0.w),d0
00009A92 4EFB 0000                  		jmp	DLE_MZx(pc,d0.w)
00009A96                            ; ===========================================================================
00009A96 0000                       DLE_MZx:	dc.w DLE_MZ1-DLE_MZx
00009A98 0000                       		dc.w DLE_MZ2-DLE_MZx
00009A9A 0000                       		dc.w DLE_MZ3-DLE_MZx
00009A9C                            ; ===========================================================================
00009A9C                            
00009A9C                            DLE_MZ1:
00009A9C 4E75                       		rts
00009A9E                            
00009A9E                            DLE_MZ2:
00009A9E 31FC 0520 F726             		move.w	#$520,(v_limitbtm1).w
00009AA4 0C78 1700 F700             		cmpi.w	#$1700,(v_screenposx).w
00009AAA 6500                       		bcs.s	locret_7088
00009AAC 31FC 0200 F726             		move.w	#$200,(v_limitbtm1).w
00009AB2                            
00009AB2                            locret_7088:
00009AB2 4E75                       		rts	
00009AB4                            ; ===========================================================================
00009AB4                            
00009AB4                            DLE_MZ3:
00009AB4 7000                       		moveq	#0,d0
00009AB6 1038 F742                  		move.b	(v_dle_routine).w,d0
00009ABA 303B 0000                  		move.w	off_7098(pc,d0.w),d0
00009ABE 4EFB 0000                  		jmp	off_7098(pc,d0.w)
00009AC2                            ; ===========================================================================
00009AC2 0000                       off_7098:	dc.w DLE_MZ3boss-off_7098
00009AC4 0000                       		dc.w DLE_MZ3end-off_7098
00009AC6                            ; ===========================================================================
00009AC6                            
00009AC6                            DLE_MZ3boss:
00009AC6                            	;	move.w	#$720,(v_limitbtm1).w
00009AC6 0C78 1560 F700             		cmpi.w	#$1560,(v_screenposx).w
00009ACC 6500                       		bcs.s	locret_70E8
00009ACE 31FC 0410 F726             		move.w	#$410,(v_limitbtm1).w
00009AD4 0C78 17F0 F700             		cmpi.w	#$17F0,(v_screenposx).w
00009ADA 6500                       		bcs.s	locret_70E8
00009ADC 6100 0000                  		bsr.w	FindFreeObj
00009AE0 6600                       		bne.s	loc_70D0
00009AE2 137C 0000 0000             		move.b	#id_BossMarble,0(a1) ; load MZ boss object
00009AE8 337C 19F0 0008             		move.w	#$19F0,obX(a1)
00009AEE 337C 042C 000C             		move.w	#$42C,obY(a1)
00009AF4                            
00009AF4                            loc_70D0:
00009AFC 11FC 0001 F7AA             		move.b	#1,(f_lockscreen).w ; lock screen
00009B02 5438 F742                  		addq.b	#2,(v_dle_routine).w
00009B06 7000                       		moveq	#plcid_Boss,d0
00009B08 6000 99EC                  		bra.w	AddPLC		; load boss patterns
00009B0C                            ; ===========================================================================
00009B0C                            
00009B0C                            locret_70E8:
00009B0C 4E75                       		rts	
00009B0E                            ; ===========================================================================
00009B0E                            
00009B0E                            DLE_MZ3end:
00009B0E 31F8 F700 F728             		move.w	(v_screenposx).w,(v_limitleft2).w
00009B14 4E75                       		rts	
00009B16                            ; ===========================================================================
00009B16                            ; ---------------------------------------------------------------------------
00009B16                            ; Star Light Zone dynamic level events
00009B16                            ; ---------------------------------------------------------------------------
00009B16                            
00009B16                            DLE_SLZ:
00009B16 7000                       		moveq	#0,d0
00009B18 1038 FE11                  		move.b	(v_act).w,d0
00009B1C D040                       		add.w	d0,d0
00009B1E 303B 0000                  		move.w	DLE_SLZx(pc,d0.w),d0
00009B22 4EFB 0000                  		jmp	DLE_SLZx(pc,d0.w)
00009B26                            ; ===========================================================================
00009B26 0000                       DLE_SLZx:	dc.w DLE_SLZ12-DLE_SLZx
00009B28 0000                       		dc.w DLE_SLZ12-DLE_SLZx
00009B2A 0000                       		dc.w DLE_SLZ3-DLE_SLZx
00009B2C                            ; ===========================================================================
00009B2C                            
00009B2C                            DLE_SLZ12:
00009B2C 4E75                       		rts	
00009B2E                            ; ===========================================================================
00009B2E                            
00009B2E                            DLE_SLZ3:
00009B2E 7000                       		moveq	#0,d0
00009B30 1038 F742                  		move.b	(v_dle_routine).w,d0
00009B34 303B 0000                  		move.w	off_7118(pc,d0.w),d0
00009B38 4EFB 0000                  		jmp	off_7118(pc,d0.w)
00009B3C                            ; ===========================================================================
00009B3C 0000                       off_7118:	dc.w DLE_SLZ3main-off_7118
00009B3E 0000                       		dc.w DLE_SLZ3boss-off_7118
00009B40 0000                       		dc.w DLE_SLZ3end-off_7118
00009B42                            ; ===========================================================================
00009B42                            
00009B42                            DLE_SLZ3main:
00009B42 0C78 1E70 F700             		cmpi.w	#$1E70,(v_screenposx).w
00009B48 6500                       		bcs.s	locret_7130
00009B4A 31FC 0210 F726             		move.w	#$210,(v_limitbtm1).w
00009B50 5438 F742                  		addq.b	#2,(v_dle_routine).w
00009B54                            
00009B54                            locret_7130:
00009B54 4E75                       		rts	
00009B56                            ; ===========================================================================
00009B56                            
00009B56                            DLE_SLZ3boss:
00009B56 0C78 2000 F700             		cmpi.w	#$2000,(v_screenposx).w
00009B5C 6500                       		bcs.s	locret_715C
00009B5E 6100 0000                  		bsr.w	FindFreeObj
00009B62 6600                       		bne.s	loc_7144
00009B64 12BC 0000                  		move.b	#id_BossStarLight,(a1) ; load SLZ boss object
00009B68                            
00009B68                            loc_7144:
00009B70 11FC 0001 F7AA             		move.b	#1,(f_lockscreen).w ; lock screen
00009B76 5438 F742                  		addq.b	#2,(v_dle_routine).w
00009B7A 7000                       		moveq	#plcid_Boss,d0
00009B7C 6000 9978                  		bra.w	AddPLC		; load boss patterns
00009B80                            ; ===========================================================================
00009B80                            
00009B80                            locret_715C:
00009B80 4E75                       		rts	
00009B82                            ; ===========================================================================
00009B82                            
00009B82                            DLE_SLZ3end:
00009B82 31F8 F700 F728             		move.w	(v_screenposx).w,(v_limitleft2).w
00009B88 4E75                       		rts
00009B8A 4E75                       		rts
00009B8C                            ; ===========================================================================
00009B8C                            ; ---------------------------------------------------------------------------
00009B8C                            ; Spring Yard Zone dynamic level events
00009B8C                            ; ---------------------------------------------------------------------------
00009B8C                            
00009B8C                            DLE_SYZ:
00009B8C 7000                       		moveq	#0,d0
00009B8E 1038 FE11                  		move.b	(v_act).w,d0
00009B92 D040                       		add.w	d0,d0
00009B94 303B 0000                  		move.w	DLE_SYZx(pc,d0.w),d0
00009B98 4EFB 0000                  		jmp	DLE_SYZx(pc,d0.w)
00009B9C                            ; ===========================================================================
00009B9C 0000                       DLE_SYZx:	dc.w DLE_SYZ1-DLE_SYZx
00009B9E 0000                       		dc.w DLE_SYZ2-DLE_SYZx
00009BA0 0000                       		dc.w DLE_SYZ3-DLE_SYZx
00009BA2                            ; ===========================================================================
00009BA2                            
00009BA2                            DLE_SYZ1:
00009BA2 4E75                       		rts	
00009BA4                            ; ===========================================================================
00009BA4                            
00009BA4                            DLE_SYZ2:
00009BA4 31FC 0520 F726             		move.w	#$520,(v_limitbtm1).w
00009BAA 0C78 25A0 F700             		cmpi.w	#$25A0,(v_screenposx).w
00009BB0 6500                       		bcs.s	locret_71A2
00009BB2 31FC 0420 F726             		move.w	#$420,(v_limitbtm1).w
00009BB8 0C78 04D0 D00C             		cmpi.w	#$4D0,(v_player+obY).w
00009BBE 6500                       		bcs.s	locret_71A2
00009BC0 31FC 0520 F726             		move.w	#$520,(v_limitbtm1).w
00009BC6                            
00009BC6                            locret_71A2:
00009BC6 4E75                       		rts	
00009BC8                            ; ===========================================================================
00009BC8                            
00009BC8                            DLE_SYZ3:
00009BC8 7000                       		moveq	#0,d0
00009BCA 1038 F742                  		move.b	(v_dle_routine).w,d0
00009BCE 303B 0000                  		move.w	off_71B2(pc,d0.w),d0
00009BD2 4EFB 0000                  		jmp	off_71B2(pc,d0.w)
00009BD6                            ; ===========================================================================
00009BD6 0000                       off_71B2:	dc.w DLE_SYZ3main-off_71B2
00009BD8 0000                       		dc.w DLE_SYZ3boss-off_71B2
00009BDA 0000                       		dc.w DLE_SYZ3end-off_71B2
00009BDC                            ; ===========================================================================
00009BDC                            
00009BDC                            DLE_SYZ3main:
00009BDC 0C78 2AC0 F700             		cmpi.w	#$2AC0,(v_screenposx).w
00009BE2 6500                       		bcs.s	locret_71CE
00009BE4 6100 0000                  		bsr.w	FindFreeObj
00009BE8 6600                       		bne.s	locret_71CE
00009BEA 12BC 0000                  		move.b	#id_BossBlock,(a1) ; load blocks that boss picks up
00009BEE 5438 F742                  		addq.b	#2,(v_dle_routine).w
00009BF2                            
00009BF2                            locret_71CE:
00009BF2 4E75                       		rts	
00009BF4                            ; ===========================================================================
00009BF4                            
00009BF4                            DLE_SYZ3boss:
00009BF4 0C78 2C00 F700             		cmpi.w	#$2C00,(v_screenposx).w
00009BFA 6500                       		bcs.s	locret_7200
00009BFC 31FC 04CC F726             		move.w	#$4CC,(v_limitbtm1).w
00009C02 6100 0000                  		bsr.w	FindFreeObj
00009C06 6600                       		bne.s	loc_71EC
00009C08 12BC 0000                  		move.b	#id_BossSpringYard,(a1) ; load SYZ boss	object
00009C0C 5438 F742                  		addq.b	#2,(v_dle_routine).w
00009C10                            
00009C10                            loc_71EC:
00009C18 11FC 0001 F7AA             		move.b	#1,(f_lockscreen).w ; lock screen
00009C1E 7000                       		moveq	#plcid_Boss,d0
00009C20 6000 98D4                  		bra.w	AddPLC		; load boss patterns
00009C24                            ; ===========================================================================
00009C24                            
00009C24                            locret_7200:
00009C24 4E75                       		rts	
00009C26                            ; ===========================================================================
00009C26                            
00009C26                            DLE_SYZ3end:
00009C26 31F8 F700 F728             		move.w	(v_screenposx).w,(v_limitleft2).w
00009C2C 4E75                       		rts	
00009C2E                            ; ===========================================================================
00009C2E                            ; ---------------------------------------------------------------------------
00009C2E                            ; Scrap	Brain Zone dynamic level events
00009C2E                            ; ---------------------------------------------------------------------------
00009C2E                            
00009C2E                            DLE_SBZ:
00009C2E 7000                       		moveq	#0,d0
00009C30 1038 FE11                  		move.b	(v_act).w,d0
00009C34 D040                       		add.w	d0,d0
00009C36 303B 0000                  		move.w	DLE_SBZx(pc,d0.w),d0
00009C3A 4EFB 0000                  		jmp	DLE_SBZx(pc,d0.w)
00009C3E                            ; ===========================================================================
00009C3E 0000                       DLE_SBZx:	dc.w DLE_SBZ1-DLE_SBZx
00009C40 0000                       		dc.w DLE_SBZ2-DLE_SBZx
00009C42 0000                       		dc.w DLE_FZ-DLE_SBZx
00009C44                            ; ===========================================================================
00009C44                            
00009C44                            DLE_SBZ1:
00009C44 31FC 0720 F726             		move.w	#$720,(v_limitbtm1).w
00009C4A 0C78 1880 F700             		cmpi.w	#$1880,(v_screenposx).w
00009C50 6500                       		bcs.s	locret_7242
00009C52 31FC 0620 F726             		move.w	#$620,(v_limitbtm1).w
00009C58 0C78 2000 F700             		cmpi.w	#$2000,(v_screenposx).w
00009C5E 6500                       		bcs.s	locret_7242
00009C60 31FC 02A0 F726             		move.w	#$2A0,(v_limitbtm1).w
00009C66                            
00009C66                            locret_7242:
00009C66 4E75                       		rts	
00009C68                            ; ===========================================================================
00009C68                            
00009C68                            DLE_SBZ2:
00009C68 7000                       		moveq	#0,d0
00009C6A 1038 F742                  		move.b	(v_dle_routine).w,d0
00009C6E 303B 0000                  		move.w	off_7252(pc,d0.w),d0
00009C72 4EFB 0000                  		jmp	off_7252(pc,d0.w)
00009C76                            ; ===========================================================================
00009C76 0000                       off_7252:	dc.w DLE_SBZ2main-off_7252
00009C78 0000                       		dc.w DLE_SBZ2boss-off_7252
00009C7A 0000                       		dc.w DLE_SBZ2boss2-off_7252
00009C7C 0000                       		dc.w DLE_SBZ2end-off_7252
00009C7E                            ; ===========================================================================
00009C7E                            
00009C7E                            DLE_SBZ2main:
00009C7E 31FC 0800 F726             		move.w	#$800,(v_limitbtm1).w
00009C84 0C78 1800 F700             		cmpi.w	#$1800,(v_screenposx).w
00009C8A 6500                       		bcs.s	locret_727A
00009C8C 31FC 0800 F726             		move.w	#$800,(v_limitbtm1).w
00009C92 0C78 1E00 F700             		cmpi.w	#$1E00,(v_screenposx).w
00009C98 6500                       		bcs.s	locret_727A
00009C9A 5438 F742                  		addq.b	#2,(v_dle_routine).w
00009C9E                            
00009C9E                            locret_727A:
00009C9E 4E75                       		rts	
00009CA0                            ; ===========================================================================
00009CA0                            
00009CA0                            DLE_SBZ2boss:
00009CA0 0C78 1EB0 F700             		cmpi.w	#$1EB0,(v_screenposx).w
00009CA6 6500                       		bcs.s	locret_7298
00009CA8 6100 0000                  		bsr.w	FindFreeObj
00009CAC 6600                       		bne.s	locret_7298
00009CAE 12BC 0000                  		move.b	#id_FalseFloor,(a1) ; load collapsing block object
00009CB2 5438 F742                  		addq.b	#2,(v_dle_routine).w
00009CB6 7000                       		moveq	#plcid_EggmanSBZ2,d0
00009CB8 6000 983C                  		bra.w	AddPLC		; load SBZ2 Eggman patterns
00009CBC                            ; ===========================================================================
00009CBC                            
00009CBC                            locret_7298:
00009CBC 4E75                       		rts	
00009CBE                            ; ===========================================================================
00009CBE                            
00009CBE                            DLE_SBZ2boss2:
00009CBE 0C78 1F60 F700             		cmpi.w	#$1F60,(v_screenposx).w
00009CC4 6500                       		bcs.s	loc_72B6
00009CC6 6100 0000                  		bsr.w	FindFreeObj
00009CCA 6600                       		bne.s	loc_72B0
00009CCC 12BC 0000                  		move.b	#id_ScrapEggman,(a1) ; load SBZ2 Eggman object
00009CD0 5438 F742                  		addq.b	#2,(v_dle_routine).w
00009CD4                            
00009CD4                            loc_72B0:
00009CD4 11FC 0001 F7AA             		move.b	#1,(f_lockscreen).w ; lock screen
00009CDA                            
00009CDA                            loc_72B6:
00009CDA 6000                       		bra.s	loc_72C2
00009CDC                            ; ===========================================================================
00009CDC                            
00009CDC                            DLE_SBZ2end:
00009CDC 0C78 2050 F700             		cmpi.w	#$2050,(v_screenposx).w
00009CE2 6500                       		bcs.s	loc_72C2
00009CE4 4E75                       		rts	
00009CE6                            ; ===========================================================================
00009CE6                            
00009CE6                            loc_72C2:
00009CE6                            	;	move.w	(v_screenposx).w,(v_limitleft2).w
00009CE6 4E75                       		rts	
00009CE8                            ; ===========================================================================
00009CE8                            
00009CE8                            DLE_FZ:
00009CE8 7000                       		moveq	#0,d0
00009CEA 1038 F742                  		move.b	(v_dle_routine).w,d0
00009CEE 303B 0000                  		move.w	off_72D8(pc,d0.w),d0
00009CF2 4EFB 0000                  		jmp	off_72D8(pc,d0.w)
00009CF6                            ; ===========================================================================
00009CF6 0000 0000                  off_72D8:	dc.w DLE_FZmain-off_72D8, DLE_FZboss-off_72D8
00009CFA 0000 0000                  		dc.w DLE_FZend-off_72D8, locret_7322-off_72D8
00009CFE 0000                       		dc.w DLE_FZend2-off_72D8
00009D00                            ; ===========================================================================
00009D00                            
00009D00                            DLE_FZmain:
00009D00 0C78 2148 F700             		cmpi.w	#$2148,(v_screenposx).w
00009D06 6500                       		bcs.s	loc_72F4
00009D08 5438 F742                  		addq.b	#2,(v_dle_routine).w
00009D0C 7000                       		moveq	#plcid_FZBoss,d0
00009D0E 6100 97E6                  		bsr.w	AddPLC		; load FZ boss patterns
00009D12                            
00009D12                            loc_72F4:
00009D12 60D2                       		bra.s	loc_72C2
00009D14                            ; ===========================================================================
00009D14                            
00009D14                            DLE_FZboss:
00009D14 0C78 2300 F700             		cmpi.w	#$2300,(v_screenposx).w
00009D1A 6500                       		bcs.s	loc_7312
00009D1C 6100 0000                  		bsr.w	FindFreeObj
00009D20 6600                       		bne.s	loc_7312
00009D22 12BC 0000                  		move.b	#id_BossFinal,(a1) ; load FZ boss object
00009D26 5438 F742                  		addq.b	#2,(v_dle_routine).w
00009D2A 11FC 0001 F7AA             		move.b	#1,(f_lockscreen).w ; lock screen
00009D30                            
00009D30                            loc_7312:
00009D30 60B4                       		bra.s	loc_72C2
00009D32                            ; ===========================================================================
00009D32                            
00009D32                            DLE_FZend:
00009D32 0C78 2450 F700             		cmpi.w	#$2450,(v_screenposx).w
00009D38 6500                       		bcs.s	loc_7320
00009D3A 5438 F742                  		addq.b	#2,(v_dle_routine).w
00009D3E                            
00009D3E                            loc_7320:
00009D3E 60A6                       		bra.s	loc_72C2
00009D40                            ; ===========================================================================
00009D40                            
00009D40                            locret_7322:
00009D40 4E75                       		rts	
00009D42                            ; ===========================================================================
00009D42                            
00009D42                            DLE_FZend2:
00009D42 60A2                       		bra.s	loc_72C2
00009D44                            ; ===========================================================================
00009D44                            ; ---------------------------------------------------------------------------
00009D44                            ; Ending sequence dynamic level events (empty)
00009D44                            ; ---------------------------------------------------------------------------
00009D44                            
00009D44                            DLE_Ending:
00009D44 4E75                       		rts	
00009D46                            		
00009D46                            ; ---------------------------------------------------------------------------
00009D46                            ; Ice Mountain dynamic level events (empty)
00009D46                            ; ---------------------------------------------------------------------------
00009D46                            
00009D46                            DLE_IMZ:
00009D46 4E75                       		rts	
00009D46 4E75                       		rts	
00009D48                            
00009D48                            		include	"_incObj\11 Bridge (part 1).asm"
00009D48                            ; ---------------------------------------------------------------------------
00009D48                            ; Object 11 - GHZ bridge
00009D48                            ; ---------------------------------------------------------------------------
00009D48                            
00009D48                            Bridge:
00009D48 7000                       		moveq	#0,d0
00009D4A 1028 0024                  		move.b	obRoutine(a0),d0
00009D4E 323B 0000                  		move.w	Bri_Index(pc,d0.w),d1
00009D52 4EFB 1000                  		jmp	Bri_Index(pc,d1.w)
00009D56                            ; ===========================================================================
00009D56 0000 0000                  Bri_Index:	dc.w Bri_Main-Bri_Index, Bri_Action-Bri_Index
00009D5A 0000 0000                  		dc.w Bri_Platform-Bri_Index, Bri_Delete-Bri_Index
00009D5E 0000 0000                  		dc.w Bri_Delete-Bri_Index, Bri_Display-Bri_Index
00009D62                            ; ===========================================================================
00009D62                            
00009D62                            Bri_Main:	; Routine 0
00009D62 5428 0024                  		addq.b	#2,obRoutine(a0)
00009D66 217C 0000 0000 0004        		move.l	#Map_Bri,obMap(a0)
00009D6E 317C 438E 0002             		move.w	#$438E,obGfx(a0)
00009D74 117C 0004 0001             		move.b	#4,obRender(a0)
00009D7A 117C 0003 0018             		move.b	#3,obPriority(a0)
00009D80 117C 0080 0019             		move.b	#$80,obActWid(a0)
00009D86 3428 000C                  		move.w	obY(a0),d2
00009D8A 3628 0008                  		move.w	obX(a0),d3
00009D8E 1828 0000                  		move.b	0(a0),d4	; copy object number ($11) to d4
00009D92 45E8 0028                  		lea	obSubtype(a0),a2
00009D96 7200                       		moveq	#0,d1
00009D98 1212                       		move.b	(a2),d1		; copy bridge length to d1
00009D9A 14FC 0000                  		move.b	#0,(a2)+	; clear bridge length
00009D9E 3001                       		move.w	d1,d0
00009DA0 E248                       		lsr.w	#1,d0
00009DA2 E948                       		lsl.w	#4,d0
00009DA4 9640                       		sub.w	d0,d3		; d3 is position of leftmost log
00009DA6 5501                       		subq.b	#2,d1
00009DA8 6500                       		bcs.s	Bri_Action	; don't make more if bridge has only 1 log
00009DAA                            
00009DAA                            @buildloop:
00009DAA 6100 0000                  		bsr.w	FindFreeObj
00009DAE 6600                       		bne.s	Bri_Action
00009DB0 5228 0028                  		addq.b	#1,obSubtype(a0)
00009DB4 B668 0008                  		cmp.w	obX(a0),d3	; is this log the leftmost one?
00009DB8 6600                       		bne.s	@notleftmost	; if not, branch
00009DBA                            
00009DBA 0643 0010                  		addi.w	#$10,d3
00009DBE 3142 000C                  		move.w	d2,obY(a0)
00009DC2 3142 003C                  		move.w	d2,$3C(a0)
00009DC6 3A08                       		move.w	a0,d5
00009DC8 0445 D000                  		subi.w	#$D000,d5
00009DCC EC4D                       		lsr.w	#6,d5
00009DCE 0245 007F                  		andi.w	#$7F,d5
00009DD2 14C5                       		move.b	d5,(a2)+
00009DD4 5228 0028                  		addq.b	#1,obSubtype(a0)
00009DD8                            
00009DD8                            	@notleftmost:
00009DD8 3A09                       		move.w	a1,d5
00009DDA 0445 D000                  		subi.w	#$D000,d5
00009DDE EC4D                       		lsr.w	#6,d5
00009DE0 0245 007F                  		andi.w	#$7F,d5
00009DE4 14C5                       		move.b	d5,(a2)+
00009DE6 137C 000A 0024             		move.b	#$A,obRoutine(a1)
00009DEC 1344 0000                  		move.b	d4,0(a1)	; load bridge object (d4 = $11)
00009DF0 3342 000C                  		move.w	d2,obY(a1)
00009DF4 3342 003C                  		move.w	d2,$3C(a1)
00009DF8 3343 0008                  		move.w	d3,obX(a1)
00009DFC 237C 0000 0000 0004        		move.l	#Map_Bri,obMap(a1)
00009E04 337C 438E 0002             		move.w	#$438E,obGfx(a1)
00009E0A 137C 0004 0001             		move.b	#4,obRender(a1)
00009E10 137C 0003 0018             		move.b	#3,obPriority(a1)
00009E16 137C 0008 0019             		move.b	#8,obActWid(a1)
00009E1C 0643 0010                  		addi.w	#$10,d3
00009E20 51C9 FF88                  		dbf	d1,@buildloop ; repeat d1 times (length of bridge)
00009E24                            
00009E24                            Bri_Action:	; Routine 2
00009E24 6100                       		bsr.s	Bri_Solid
00009E26 4A28 003E                  		tst.b	$3E(a0)
00009E2A 6700                       		beq.s	@display
00009E2C 5928 003E                  		subq.b	#4,$3E(a0)
00009E30 6100 0000                  		bsr.w	Bri_Bend
00009E34                            
00009E34                            	@display:
00009E34 6100 0000                  		bsr.w	DisplaySprite
00009E38 6000 0000                  		bra.w	Bri_ChkDel
00009E3C                            
00009E3C                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00009E3C                            
00009E3C                            
00009E3C                            Bri_Solid:
00009E3C 7200                       		moveq	#0,d1
00009E3E 1228 0028                  		move.b	obSubtype(a0),d1
00009E42 E749                       		lsl.w	#3,d1
00009E44 3401                       		move.w	d1,d2
00009E46 5041                       		addq.w	#8,d1
00009E48 D442                       		add.w	d2,d2
00009E4A 43F8 D000                  		lea	(v_player).w,a1
00009E4E 4A69 0012                  		tst.w	obVelY(a1)
00009E52 6B00 0000                  		bmi.w	Plat_Exit
00009E56 3029 0008                  		move.w	obX(a1),d0
00009E5A 9068 0008                  		sub.w	obX(a0),d0
00009E5E D041                       		add.w	d1,d0
00009E60 6B00 0000                  		bmi.w	Plat_Exit
00009E64 B042                       		cmp.w	d2,d0
00009E66 6400 0000                  		bcc.w	Plat_Exit
00009E6A 6000                       		bra.s	Plat_NoXCheck
00009E6C                            ; End of function Bri_Solid
00009E6C                            ; End of function Bri_Solid
00009E6C                            
00009E6C                            ; ---------------------------------------------------------------------------
00009E6C                            ; Platform subroutine
00009E6C                            ; ---------------------------------------------------------------------------
00009E6C                            
00009E6C                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00009E6C                            
00009E6C                            PlatformObject:
00009E6C 43F8 D000                  		lea	(v_player).w,a1
00009E70 4A69 0012                  		tst.w	obVelY(a1)	; is Sonic moving up/jumping?
00009E74 6B00 0000                  		bmi.w	Plat_Exit	; if yes, branch
00009E78                            
00009E78                            ;		perform x-axis range check
00009E78 3029 0008                  		move.w	obX(a1),d0
00009E7C 9068 0008                  		sub.w	obX(a0),d0
00009E80 D041                       		add.w	d1,d0
00009E82 6B00 0000                  		bmi.w	Plat_Exit
00009E86 D241                       		add.w	d1,d1
00009E88 B041                       		cmp.w	d1,d0
00009E8A 6400 0000                  		bhs.w	Plat_Exit
00009E8E                            
00009E8E                            	Plat_NoXCheck:
00009E8E 3028 000C                  		move.w	obY(a0),d0
00009E92 5140                       		subq.w	#8,d0
00009E94                            
00009E94                            Platform3:
00009E94                            ;		perform y-axis range check
00009E94 3429 000C                  		move.w	obY(a1),d2
00009E98 1229 0016                  		move.b	obHeight(a1),d1
00009E9C 4881                       		ext.w	d1
00009E9E D242                       		add.w	d2,d1
00009EA0 5841                       		addq.w	#4,d1
00009EA2 9041                       		sub.w	d1,d0
00009EA4 6200 0000                  		bhi.w	Plat_Exit
00009EA8 0C40 FFF0                  		cmpi.w	#-$10,d0
00009EAC 6500 0000                  		blo.w	Plat_Exit
00009EB0                            
00009EB0 4A38 F7C8                  		tst.b	(f_lockmulti).w
00009EB4 6B00 0000                  		bmi.w	Plat_Exit
00009EB8 0C29 0006 0024             		cmpi.b	#6,obRoutine(a1)
00009EBE 6400 0000                  		bhs.w	Plat_Exit
00009EC2 D440                       		add.w	d0,d2
00009EC4 5642                       		addq.w	#3,d2
00009EC6 3342 000C                  		move.w	d2,obY(a1)
00009ECA 5428 0024                  		addq.b	#2,obRoutine(a0)
00009ECE                            
00009ECE                            loc_74AE:
00009ECE 0829 0003 0022             		btst	#3,obStatus(a1)
00009ED4 6700                       		beq.s	loc_74DC
00009ED6 7000                       		moveq	#0,d0
00009ED8 1029 003D                  		move.b	$3D(a1),d0
00009EDC ED48                       		lsl.w	#6,d0
00009EDE 0680 00FF D000             		addi.l	#v_objspace&$FFFFFF,d0
00009EE4 2440                       		movea.l	d0,a2
00009EE6 08AA 0003 0022             		bclr	#3,obStatus(a2)
00009EEC 422A 0025                  		clr.b	ob2ndRout(a2)
00009EF0 0C2A 0004 0024             		cmpi.b	#4,obRoutine(a2)
00009EF6 6600                       		bne.s	loc_74DC
00009EF8 552A 0024                  		subq.b	#2,obRoutine(a2)
00009EFC                            
00009EFC                            loc_74DC:
00009EFC 3008                       		move.w	a0,d0
00009EFE 0440 D000                  		subi.w	#-$3000,d0
00009F02 EC48                       		lsr.w	#6,d0
00009F04 0240 007F                  		andi.w	#$7F,d0
00009F08 1340 003D                  		move.b	d0,$3D(a1)
00009F0C 137C 0000 0026             		move.b	#0,obAngle(a1)
00009F12 337C 0000 0012             		move.w	#0,obVelY(a1)
00009F18 3369 0010 0014             		move.w	obVelX(a1),obInertia(a1)
00009F1E 0829 0001 0022             		btst	#1,obStatus(a1)
00009F24 6700                       		beq.s	loc_7512
00009F26 2F08                       		move.l	a0,-(sp)
00009F28 2049                       		movea.l	a1,a0
00009F2A 4EB9 0000 0000             		jsr	(Sonic_ResetOnFloor).l
00009F30 205F                       		movea.l	(sp)+,a0
00009F32                            
00009F32                            loc_7512:
00009F32 08E9 0003 0022             		bset	#3,obStatus(a1)
00009F38 08E8 0003 0022             		bset	#3,obStatus(a0)
00009F3E                            
00009F3E                            Plat_Exit:
00009F3E 4E75                       		rts	
00009F40                            ; End of function PlatformObject
00009F40                            
00009F40                            ; ---------------------------------------------------------------------------
00009F40                            ; Sloped platform subroutine (GHZ collapsing ledges and	SLZ seesaws)
00009F40                            ; ---------------------------------------------------------------------------
00009F40                            
00009F40                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00009F40                            
00009F40                            
00009F40                            SlopeObject:
00009F40 43F8 D000                  		lea	(v_player).w,a1
00009F44 4A69 0012                  		tst.w	obVelY(a1)
00009F48 6B00 FFF4                  		bmi.w	Plat_Exit
00009F4C 3029 0008                  		move.w	obX(a1),d0
00009F50 9068 0008                  		sub.w	obX(a0),d0
00009F54 D041                       		add.w	d1,d0
00009F56 6BE6                       		bmi.s	Plat_Exit
00009F58 D241                       		add.w	d1,d1
00009F5A B041                       		cmp.w	d1,d0
00009F5C 64E0                       		bhs.s	Plat_Exit
00009F5E 0828 0000 0001             		btst	#0,obRender(a0)
00009F64 6700                       		beq.s	loc_754A
00009F66 4640                       		not.w	d0
00009F68 D041                       		add.w	d1,d0
00009F6A                            
00009F6A                            loc_754A:
00009F6A E248                       		lsr.w	#1,d0
00009F6C 7600                       		moveq	#0,d3
00009F6E 1632 0000                  		move.b	(a2,d0.w),d3
00009F72 3028 000C                  		move.w	obY(a0),d0
00009F76 9043                       		sub.w	d3,d0
00009F78 6000 FF1A                  		bra.w	Platform3
00009F7C                            ; End of function SlopeObject
00009F7C                            
00009F7C                            
00009F7C                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00009F7C                            
00009F7C                            
00009F7C                            Swing_Solid:
00009F7C 43F8 D000                  		lea	(v_player).w,a1
00009F80 4A69 0012                  		tst.w	obVelY(a1)
00009F84 6B00 FFB8                  		bmi.w	Plat_Exit
00009F88 3029 0008                  		move.w	obX(a1),d0
00009F8C 9068 0008                  		sub.w	obX(a0),d0
00009F90 D041                       		add.w	d1,d0
00009F92 6B00 FFAA                  		bmi.w	Plat_Exit
00009F96 D241                       		add.w	d1,d1
00009F98 B041                       		cmp.w	d1,d0
00009F9A 6400 FFA2                  		bhs.w	Plat_Exit
00009F9E 3028 000C                  		move.w	obY(a0),d0
00009FA2 9043                       		sub.w	d3,d0
00009FA4 6000 FEEE                  		bra.w	Platform3
00009FA8                            ; End of function Obj15_Solid
00009FA8                            
00009FA8                            ; ===========================================================================
00009FA8                            
00009FA8                            		include	"_incObj\11 Bridge (part 2).asm"
00009FA8                            
00009FA8                            Bri_Platform:	; Routine 4
00009FA8 6100                       		bsr.s	Bri_WalkOff
00009FAA 6100 0000                  		bsr.w	DisplaySprite
00009FAE 6000 0000                  		bra.w	Bri_ChkDel
00009FB2                            
00009FB2                            ; ---------------------------------------------------------------------------
00009FB2                            ; Subroutine allowing Sonic to walk off a bridge
00009FB2                            ; ---------------------------------------------------------------------------
00009FB2                            
00009FB2                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00009FB2                            
00009FB2                            
00009FB2                            Bri_WalkOff:
00009FB2 7200                       		moveq	#0,d1
00009FB4 1228 0028                  		move.b	obSubtype(a0),d1
00009FB8 E749                       		lsl.w	#3,d1
00009FBA 3401                       		move.w	d1,d2
00009FBC 5041                       		addq.w	#8,d1
00009FBE 6100                       		bsr.s	ExitPlatform2
00009FC0 6400                       		bcc.s	locret_75BE
00009FC2 E848                       		lsr.w	#4,d0
00009FC4 1140 003F                  		move.b	d0,$3F(a0)
00009FC8 1028 003E                  		move.b	$3E(a0),d0
00009FCC 0C00 0040                  		cmpi.b	#$40,d0
00009FD0 6700                       		beq.s	loc_75B6
00009FD2 5828 003E                  		addq.b	#4,$3E(a0)
00009FD6                            
00009FD6                            loc_75B6:
00009FD6 6100 0000                  		bsr.w	Bri_Bend
00009FDA 6100 0000                  		bsr.w	Bri_MoveSonic
00009FDE                            
00009FDE                            locret_75BE:
00009FDE 4E75                       		rts	
00009FE0                            ; End of function Bri_WalkOff
00009FE0                            ; End of function Bri_WalkOff
00009FE0                            
00009FE0                            ; ---------------------------------------------------------------------------
00009FE0                            ; Subroutine allowing Sonic to walk or jump off	a platform
00009FE0                            ; ---------------------------------------------------------------------------
00009FE0                            
00009FE0                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
00009FE0                            
00009FE0                            
00009FE0                            ExitPlatform:
00009FE0 3401                       		move.w	d1,d2
00009FE2                            
00009FE2                            ExitPlatform2:
00009FE2 D442                       		add.w	d2,d2
00009FE4 43F8 D000                  		lea	(v_player).w,a1
00009FE8 0829 0001 0022             		btst	#1,obStatus(a1)
00009FEE 6600                       		bne.s	loc_75E0
00009FF0 3029 0008                  		move.w	obX(a1),d0
00009FF4 9068 0008                  		sub.w	obX(a0),d0
00009FF8 D041                       		add.w	d1,d0
00009FFA 6B00                       		bmi.s	loc_75E0
00009FFC B042                       		cmp.w	d2,d0
00009FFE 6500                       		blo.s	locret_75F2
0000A000                            
0000A000                            loc_75E0:
0000A000 08A9 0003 0022             		bclr	#3,obStatus(a1)
0000A006 117C 0002 0024             		move.b	#2,obRoutine(a0)
0000A00C 08A8 0003 0022             		bclr	#3,obStatus(a0)
0000A012                            
0000A012                            locret_75F2:
0000A012 4E75                       		rts	
0000A014                            ; End of function ExitPlatform
0000A014                            
0000A014                            		include	"_incObj\11 Bridge (part 3).asm"
0000A014                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
0000A014                            
0000A014                            
0000A014                            Bri_MoveSonic:
0000A014 7000                       		moveq	#0,d0
0000A016 1028 003F                  		move.b	$3F(a0),d0
0000A01A 1030 0029                  		move.b	$29(a0,d0.w),d0
0000A01E ED48                       		lsl.w	#6,d0
0000A020 0680 00FF D000             		addi.l	#v_objspace&$FFFFFF,d0
0000A026 2440                       		movea.l	d0,a2
0000A028 43F8 D000                  		lea	(v_player).w,a1
0000A02C 302A 000C                  		move.w	obY(a2),d0
0000A030 5140                       		subq.w	#8,d0
0000A032 7200                       		moveq	#0,d1
0000A034 1229 0016                  		move.b	obHeight(a1),d1
0000A038 9041                       		sub.w	d1,d0
0000A03A 3340 000C                  		move.w	d0,obY(a1)	; change Sonic's position on y-axis
0000A03E 4E75                       		rts	
0000A040                            ; End of function Bri_MoveSonic
0000A040                            
0000A040                            
0000A040                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
0000A040                            
0000A040                            
0000A040                            Bri_Bend:
0000A040 1028 003E                  		move.b	$3E(a0),d0
0000A044 6100 AC0A                  		bsr.w	CalcSine
0000A048 3800                       		move.w	d0,d4
0000A04A 49F9 0000 0000             		lea	(Obj11_BendData2).l,a4
0000A050 7000                       		moveq	#0,d0
0000A052 1028 0028                  		move.b	obSubtype(a0),d0
0000A056 E948                       		lsl.w	#4,d0
0000A058 7600                       		moveq	#0,d3
0000A05A 1628 003F                  		move.b	$3F(a0),d3
0000A05E 3403                       		move.w	d3,d2
0000A060 D640                       		add.w	d0,d3
0000A062 7A00                       		moveq	#0,d5
0000A064 4BF9 0000 0000             		lea	(Obj11_BendData).l,a5
0000A06A 1A35 3000                  		move.b	(a5,d3.w),d5
0000A06E 0243 000F                  		andi.w	#$F,d3
0000A072 E94B                       		lsl.w	#4,d3
0000A074 47F4 3000                  		lea	(a4,d3.w),a3
0000A078 45E8 0029                  		lea	$29(a0),a2
0000A07C                            
0000A07C                            loc_765C:
0000A07C 7000                       		moveq	#0,d0
0000A07E 101A                       		move.b	(a2)+,d0
0000A080 ED48                       		lsl.w	#6,d0
0000A082 0680 00FF D000             		addi.l	#v_objspace&$FFFFFF,d0
0000A088 2240                       		movea.l	d0,a1
0000A08A 7000                       		moveq	#0,d0
0000A08C 101B                       		move.b	(a3)+,d0
0000A08E 5240                       		addq.w	#1,d0
0000A090 C0C5                       		mulu.w	d5,d0
0000A092 C0C4                       		mulu.w	d4,d0
0000A094 4840                       		swap	d0
0000A096 D069 003C                  		add.w	$3C(a1),d0
0000A09A 3340 000C                  		move.w	d0,obY(a1)
0000A09E 51CA FFDC                  		dbf	d2,loc_765C
0000A0A2 7000                       		moveq	#0,d0
0000A0A4 1028 0028                  		move.b	obSubtype(a0),d0
0000A0A8 7600                       		moveq	#0,d3
0000A0AA 1628 003F                  		move.b	$3F(a0),d3
0000A0AE 5203                       		addq.b	#1,d3
0000A0B0 9600                       		sub.b	d0,d3
0000A0B2 4403                       		neg.b	d3
0000A0B4 6B00                       		bmi.s	locret_76CA
0000A0B6 3403                       		move.w	d3,d2
0000A0B8 E94B                       		lsl.w	#4,d3
0000A0BA 47F4 3000                  		lea	(a4,d3.w),a3
0000A0BE D6C2                       		adda.w	d2,a3
0000A0C0 5342                       		subq.w	#1,d2
0000A0C2 6500                       		bcs.s	locret_76CA
0000A0C4                            
0000A0C4                            loc_76A4:
0000A0C4 7000                       		moveq	#0,d0
0000A0C6 101A                       		move.b	(a2)+,d0
0000A0C8 ED48                       		lsl.w	#6,d0
0000A0CA 0680 00FF D000             		addi.l	#v_objspace&$FFFFFF,d0
0000A0D0 2240                       		movea.l	d0,a1
0000A0D2 7000                       		moveq	#0,d0
0000A0D4 1023                       		move.b	-(a3),d0
0000A0D6 5240                       		addq.w	#1,d0
0000A0D8 C0C5                       		mulu.w	d5,d0
0000A0DA C0C4                       		mulu.w	d4,d0
0000A0DC 4840                       		swap	d0
0000A0DE D069 003C                  		add.w	$3C(a1),d0
0000A0E2 3340 000C                  		move.w	d0,obY(a1)
0000A0E6 51CA FFDC                  		dbf	d2,loc_76A4
0000A0EA                            
0000A0EA                            locret_76CA:
0000A0EA 4E75                       		rts	
0000A0EC                            ; End of function Bri_Bend
0000A0EC                            
0000A0EC                            ; ===========================================================================
0000A0EC                            ; ---------------------------------------------------------------------------
0000A0EC                            ; GHZ bridge-bending data
0000A0EC                            ; (Defines how the bridge bends	when Sonic walks across	it)
0000A0EC                            ; ---------------------------------------------------------------------------
0000A0EC                            Obj11_BendData:	incbin	"misc\ghzbend1.bin"
0000A1FC                            		even
0000A1FC                            Obj11_BendData2:incbin	"misc\ghzbend2.bin"
0000A2FC                            		even
0000A2FC                            
0000A2FC                            ; ===========================================================================
0000A2FC                            
0000A2FC                            Bri_ChkDel:
0000A31A 4E75                       		rts	
0000A31C                            ; ===========================================================================
0000A31C                            
0000A31C                            @deletebridge:
0000A31C 7400                       		moveq	#0,d2
0000A31E 45E8 0028                  		lea	obSubtype(a0),a2 ; load bridge length
0000A322 141A                       		move.b	(a2)+,d2	; move bridge length to	d2
0000A324 5302                       		subq.b	#1,d2		; subtract 1
0000A326 6500                       		bcs.s	@delparent
0000A328                            
0000A328                            	@loop:
0000A328 7000                       		moveq	#0,d0
0000A32A 101A                       		move.b	(a2)+,d0
0000A32C ED48                       		lsl.w	#6,d0
0000A32E 0680 00FF D000             		addi.l	#v_objspace&$FFFFFF,d0
0000A334 2240                       		movea.l	d0,a1
0000A336 B048                       		cmp.w	a0,d0
0000A338 6700                       		beq.s	@skipdel
0000A33A 6100 0000                  		bsr.w	DeleteChild
0000A33E                            
0000A33E                            	@skipdel:
0000A33E 51CA FFE8                  		dbf	d2,@loop ; repeat d2 times (bridge length)
0000A342                            
0000A342                            @delparent:
0000A342 6100 0000                  		bsr.w	DeleteObject
0000A346 4E75                       		rts	
0000A348                            ; ===========================================================================
0000A348                            
0000A348                            Bri_Delete:	; Routine 6, 8
0000A348 6100 0000                  		bsr.w	DeleteObject
0000A34C 4E75                       		rts	
0000A34E                            ; ===========================================================================
0000A34E                            
0000A34E                            Bri_Display:	; Routine $A
0000A34E 6100 0000                  		bsr.w	DisplaySprite
0000A352 4E75                       		rts	
0000A352 4E75                       		rts	
0000A354                            Map_Bri:	include	"_maps\Bridge.asm"
0000A354                            ; ---------------------------------------------------------------------------
0000A354                            ; Sprite mappings - GHZ	bridge
0000A354                            ; ---------------------------------------------------------------------------
0000A354                            Map_Bri_internal:
0000A354 0000                       		dc.w M_Bri_Log-Map_Bri_internal
0000A356 0000                       		dc.w M_Bri_Stump-Map_Bri_internal
0000A358 0000                       		dc.w M_Bri_Rope-Map_Bri_internal
0000A35A 01                         M_Bri_Log:	dc.b 1
0000A35B F805 0000 F8               		dc.b $F8, 5, 0,	0, $F8	; log
0000A360 02                         M_Bri_Stump:	dc.b 2
0000A361 F804 0004 F0               		dc.b $F8, 4, 0,	4, $F0	; stump & rope
0000A366 000C 0006 F0               		dc.b 0,	$C, 0, 6, $F0
0000A36B 01                         M_Bri_Rope:	dc.b 1
0000A36C FC04 0008 F8               		dc.b $FC, 4, 0,	8, $F8	; rope only
0000A372 00                         		even
0000A372 00                         		even
0000A372                            
0000A372                            		include	"_incObj\15 Swinging Platforms (part 1).asm"
0000A372                            ; ---------------------------------------------------------------------------
0000A372                            ; Object 15 - swinging platforms (GHZ, MZ, SLZ)
0000A372                            ;	    - spiked ball on a chain (SBZ)
0000A372                            ; ---------------------------------------------------------------------------
0000A372                            
0000A372                            SwingingPlatform:
0000A372 7000                       		moveq	#0,d0
0000A374 1028 0024                  		move.b	obRoutine(a0),d0
0000A378 323B 0000                  		move.w	Swing_Index(pc,d0.w),d1
0000A37C 4EFB 1000                  		jmp	Swing_Index(pc,d1.w)
0000A380                            ; ===========================================================================
0000A380 0000 0000                  Swing_Index:	dc.w Swing_Main-Swing_Index, Swing_SetSolid-Swing_Index
0000A384 0000 0000                  		dc.w Swing_Action2-Swing_Index,	Swing_Delete-Swing_Index
0000A388 0000 0000                  		dc.w Swing_Delete-Swing_Index, Swing_Display-Swing_Index
0000A38C 0000                       		dc.w Swing_Action-Swing_Index
0000A38E                            
0000A38E =0000003A                  swing_origX:	equ $3A		; original x-axis position
0000A38E =00000038                  swing_origY:	equ $38		; original y-axis position
0000A38E                            ; ===========================================================================
0000A38E                            
0000A38E                            Swing_Main:	; Routine 0
0000A38E 5428 0024                  		addq.b	#2,obRoutine(a0)
0000A392 217C 0000 0000 0004        		move.l	#Map_Swing_GHZ,obMap(a0) ; GHZ and MZ specific code
0000A39A 317C 4380 0002             		move.w	#$4380,obGfx(a0)
0000A3A0 117C 0004 0001             		move.b	#4,obRender(a0)
0000A3A6 117C 0003 0018             		move.b	#3,obPriority(a0)
0000A3AC 117C 0018 0019             		move.b	#$18,obActWid(a0)
0000A3B2 117C 0008 0016             		move.b	#8,obHeight(a0)
0000A3B8 3168 000C 0038             		move.w	obY(a0),swing_origY(a0)
0000A3BE 3168 0008 003A             		move.w	obX(a0),swing_origX(a0)
0000A3C4 0C38 0003 FE10             		cmpi.b	#id_SLZ,(v_zone).w ; check if level is SLZ
0000A3CA 6600                       		bne.s	@notSLZ
0000A3CC                            
0000A3CC 217C 0000 0000 0004        		move.l	#Map_Swing_SLZ,obMap(a0) ; SLZ specific code
0000A3D4 317C 43DC 0002             		move.w	#$43DC,obGfx(a0)
0000A3DA 117C 0020 0019             		move.b	#$20,obActWid(a0)
0000A3E0 117C 0010 0016             		move.b	#$10,obHeight(a0)
0000A3E6 117C 0099 0020             		move.b	#$99,obColType(a0)
0000A3EC                            
0000A3EC                            	@notSLZ:
0000A3EC 0C38 0005 FE10             		cmpi.b	#id_CWZ,(v_zone).w ; check if level is SBZ
0000A3F2 6600                       		bne.s	@length
0000A3F4                            
0000A3F4 217C 0000 0000 0004        		move.l	#Map_BBall,obMap(a0) ; SBZ specific code
0000A3FC 317C 0391 0002             		move.w	#$391,obGfx(a0)
0000A402 117C 0018 0019             		move.b	#$18,obActWid(a0)
0000A408 117C 0018 0016             		move.b	#$18,obHeight(a0)
0000A40E 117C 0086 0020             		move.b	#$86,obColType(a0)
0000A414 117C 000C 0024             		move.b	#$C,obRoutine(a0) ; goto Swing_Action next
0000A41A                            
0000A41A                            @length:
0000A41A 1828 0000                  		move.b	0(a0),d4
0000A41E 7200                       		moveq	#0,d1
0000A420 45E8 0028                  		lea	obSubtype(a0),a2 ; move chain length to a2
0000A424 1212                       		move.b	(a2),d1		; move a2 to d1
0000A426 3F01                       		move.w	d1,-(sp)
0000A428 0241 000F                  		andi.w	#$F,d1
0000A42C 14FC 0000                  		move.b	#0,(a2)+
0000A430 3601                       		move.w	d1,d3
0000A432 E94B                       		lsl.w	#4,d3
0000A434 5003                       		addq.b	#8,d3
0000A436 1143 003C                  		move.b	d3,$3C(a0)
0000A43A 5103                       		subq.b	#8,d3
0000A43C 4A28 001A                  		tst.b	obFrame(a0)
0000A440 6700                       		beq.s	@makechain
0000A442 5003                       		addq.b	#8,d3
0000A444 5341                       		subq.w	#1,d1
0000A446                            
0000A446                            @makechain:
0000A446 6100 0000                  		bsr.w	FindFreeObj
0000A44A 6600                       		bne.s	@fail
0000A44C 5228 0028                  		addq.b	#1,obSubtype(a0)
0000A450 3A09                       		move.w	a1,d5
0000A452 0445 D000                  		subi.w	#$D000,d5
0000A456 EC4D                       		lsr.w	#6,d5
0000A458 0245 007F                  		andi.w	#$7F,d5
0000A45C 14C5                       		move.b	d5,(a2)+
0000A45E 137C 000A 0024             		move.b	#$A,obRoutine(a1) ; goto Swing_Display next
0000A464 1344 0000                  		move.b	d4,0(a1)	; load swinging	object
0000A468 2368 0004 0004             		move.l	obMap(a0),obMap(a1)
0000A46E 3368 0002 0002             		move.w	obGfx(a0),obGfx(a1)
0000A474 08A9 0006 0002             		bclr	#6,obGfx(a1)
0000A47A 137C 0004 0001             		move.b	#4,obRender(a1)
0000A480 137C 0004 0018             		move.b	#4,obPriority(a1)
0000A486 137C 0008 0019             		move.b	#8,obActWid(a1)
0000A48C 137C 0001 001A             		move.b	#1,obFrame(a1)
0000A492 1343 003C                  		move.b	d3,$3C(a1)
0000A496 0403 0010                  		subi.b	#$10,d3
0000A49A 6400                       		bcc.s	@notanchor
0000A49C 137C 0002 001A             		move.b	#2,obFrame(a1)
0000A4A2 137C 0003 0018             		move.b	#3,obPriority(a1)
0000A4A8 08E9 0006 0002             		bset	#6,obGfx(a1)
0000A4AE                            
0000A4AE                            	@notanchor:
0000A4AE 51C9 FF96                  		dbf	d1,@makechain ; repeat d1 times (chain length)
0000A4B2                            
0000A4B2                            	@fail:
0000A4B2 3A08                       		move.w	a0,d5
0000A4B4 0445 D000                  		subi.w	#$D000,d5
0000A4B8 EC4D                       		lsr.w	#6,d5
0000A4BA 0245 007F                  		andi.w	#$7F,d5
0000A4BE 14C5                       		move.b	d5,(a2)+
0000A4C0 317C 4080 0026             		move.w	#$4080,obAngle(a0)
0000A4C6 317C FE00 003E             		move.w	#-$200,$3E(a0)
0000A4CC 321F                       		move.w	(sp)+,d1
0000A4CE 0801 0004                  		btst	#4,d1		; is object type $1X ?
0000A4D2 6700                       		beq.s	@not1X	; if not, branch
0000A4D4 217C 0000 0000 0004        		move.l	#Map_GBall,obMap(a0) ; use GHZ ball mappings
0000A4DC 317C 43AA 0002             		move.w	#$43AA,obGfx(a0)
0000A4E2 117C 0001 001A             		move.b	#1,obFrame(a0)
0000A4E8 117C 0002 0018             		move.b	#2,obPriority(a0)
0000A4EE 117C 0081 0020             		move.b	#$81,obColType(a0) ; make object hurt when touched
0000A4F4                            
0000A4F4                            	@not1X:
0000A4F4 0C38 0005 FE10             		cmpi.b	#id_CWZ,(v_zone).w ; is zone SBZ?
0000A4FA 6700                       		beq.s	Swing_Action	; if yes, branch
0000A4FC                            
0000A4FC                            Swing_SetSolid:	; Routine 2
0000A4FC 7200                       		moveq	#0,d1
0000A4FE 1228 0019                  		move.b	obActWid(a0),d1
0000A502 7600                       		moveq	#0,d3
0000A504 1628 0016                  		move.b	obHeight(a0),d3
0000A508 6100 FA72                  		bsr.w	Swing_Solid
0000A50C                            
0000A50C                            Swing_Action:	; Routine $C
0000A50C 6100 0000                  		bsr.w	Swing_Move
0000A510 6100 0000                  		bsr.w	DisplaySprite
0000A514 6000 0000                  		bra.w	Swing_ChkDel
0000A518                            ; ===========================================================================
0000A518                            
0000A518                            Swing_Action2:	; Routine 4
0000A518 7200                       		moveq	#0,d1
0000A51A 1228 0019                  		move.b	obActWid(a0),d1
0000A51E 6100 FAC0                  		bsr.w	ExitPlatform
0000A522 3F28 0008                  		move.w	obX(a0),-(sp)
0000A526 6100 0000                  		bsr.w	Swing_Move
0000A52A 341F                       		move.w	(sp)+,d2
0000A52C 7600                       		moveq	#0,d3
0000A52E 1628 0016                  		move.b	obHeight(a0),d3
0000A532 5203                       		addq.b	#1,d3
0000A534 6100 0000                  		bsr.w	MvSonicOnPtfm
0000A538 6100 0000                  		bsr.w	DisplaySprite
0000A53C 6000 0000                  		bra.w	Swing_ChkDel
0000A540                            
0000A540 4E75                       		rts
0000A540 4E75                       		rts
0000A542                            
0000A542                            ; ---------------------------------------------------------------------------
0000A542                            ; Subroutine to	change Sonic's position with a platform
0000A542                            ; ---------------------------------------------------------------------------
0000A542                            
0000A542                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
0000A542                            
0000A542                            
0000A542                            MvSonicOnPtfm:
0000A542 43F8 D000                  		lea	(v_player).w,a1
0000A546 3028 000C                  		move.w	obY(a0),d0
0000A54A 9043                       		sub.w	d3,d0
0000A54C 6000                       		bra.s	MvSonic2
0000A54E                            ; End of function MvSonicOnPtfm
0000A54E                            
0000A54E                            ; ---------------------------------------------------------------------------
0000A54E                            ; Subroutine to	change Sonic's position with a platform
0000A54E                            ; ---------------------------------------------------------------------------
0000A54E                            
0000A54E                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
0000A54E                            
0000A54E                            
0000A54E                            MvSonicOnPtfm2:
0000A54E 43F8 D000                  		lea	(v_player).w,a1
0000A552 3028 000C                  		move.w	obY(a0),d0
0000A556 0440 0009                  		subi.w	#9,d0
0000A55A                            
0000A55A                            MvSonic2:
0000A55A 4A38 F7C8                  		tst.b	(f_lockmulti).w
0000A55E 6B00                       		bmi.s	locret_7B62
0000A560 0C38 0006 D024             		cmpi.b	#6,(v_player+obRoutine).w
0000A566 6400                       		bhs.s	locret_7B62
0000A568 4A78 FE08                  		tst.w	(v_debuguse).w
0000A56C 6600                       		bne.s	locret_7B62
0000A56E 7200                       		moveq	#0,d1
0000A570 1229 0016                  		move.b	obHeight(a1),d1
0000A574 9041                       		sub.w	d1,d0
0000A576 3340 000C                  		move.w	d0,obY(a1)
0000A57A 9468 0008                  		sub.w	obX(a0),d2
0000A57E 9569 0008                  		sub.w	d2,obX(a1)
0000A582                            
0000A582                            locret_7B62:
0000A582 4E75                       		rts	
0000A584                            ; End of function MvSonicOnPtfm2
0000A584                            TestObj:	include	"_incObj/TestDisplayObj.asm"
0000A584                            ; ---------------------------------------------------------------------------
0000A584                            ; Object 24 - rings
0000A584                            ; ---------------------------------------------------------------------------
0000A584                            
0000A584                            TestDisplay:
0000A584 7000                       		moveq	#0,d0
0000A586 1028 0024                  		move.b	$24(a0),d0
0000A58A 323B 0000                  		move.w	off_4CCC(pc,d0.w),d1
0000A58E 4EFB 1000                  		jmp	off_4CCC(pc,d1.w)
0000A592                            ; ---------------------------------------------------------------------------
0000A592                            
0000A592 0000 0000 0000 0000        off_4CCC:	dc.w loc_4CD4-off_4CCC, loc_4D04-off_4CCC, loc_4D28-off_4CCC, loc_4D28-off_4CCC
0000A59A                            ; ---------------------------------------------------------------------------
0000A59A                            
0000A59A                            loc_4CD4:
0000A59A 5428 0024                  		addq.b	#2,$24(a0)
0000A59E 317C 0284 000C             		move.w	#$284,$C(a0)	;	Y
0000A5A4 317C 00D7 0008             		move.w	#$D7,$8(a0)	;	X
0000A5AA 217C 0000 0000 0004        		move.l	#Map02,4(a0)
0000A5B2 317C 2100 0002             		move.w	#$2100,2(a0)
0000A5B8 117C 0004 0001             		move.b	#4,1(a0)
0000A5BE 117C 0001 0021             		move.b	#1,$21(a0)
0000A5C4 117C 0002 001A             		move.b	#2,$1A(a0)
0000A5CA 117C 0003 0019             		move.b	#3,$19(a0)
0000A5D0                            
0000A5D0                            loc_4D04:
0000A5D0 6100 0000                  		bsr.w	DisplaySprite
0000A5D4 5328 001E                  		subq.b	#1,$1E(a0)
0000A5D8 6A00                       		bpl.s	locret_4D26
0000A5DA 117C 0004 001E             		move.b	#$4,$1E(a0)
0000A5E0 1028 001A                  		move.b	$1A(a0),d0
0000A5E4 5200                       		addq.b	#1,d0
0000A5E6 0C00 0028                  		cmpi.b	#$28,d0
0000A5EA 6500                       		bcs.s	loc_4D22
0000A5EC 7028                       		moveq	#$28,d0
0000A5EE                            
0000A5EE                            loc_4D22:
0000A5EE 1140 001A                  		move.b	d0,$1A(a0)
0000A5F2                            
0000A5F2                            locret_4D26:
0000A5F2 4E75                       		rts
0000A5F4                            ; ---------------------------------------------------------------------------
0000A5F4                            
0000A5F4                            loc_4D28:
0000A5F4 6100 0000                  		bsr.w	DeleteObject
0000A5F8 4E75                       		rts
0000A5FA                            ; End of function CollectKey
0000A5FA                            
0000A5FA                            
0000A5FA                            		include	"_incObj\15 Swinging Platforms (part 2).asm"
0000A5FA                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
0000A5FA                            
0000A5FA                            
0000A5FA                            Swing_Move:
0000A5FA 1038 FE78                  		move.b	(v_oscillate+$1A).w,d0
0000A5FE 323C 0080                  		move.w	#$80,d1
0000A602 0828 0000 0022             		btst	#0,obStatus(a0)
0000A608 6700                       		beq.s	loc_7B78
0000A60A 4440                       		neg.w	d0
0000A60C D041                       		add.w	d1,d0
0000A60E                            
0000A60E                            loc_7B78:
0000A60E 6000                       		bra.s	Swing_Move2
0000A610                            ; End of function Swing_Move
0000A610                            
0000A610                            
0000A610                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
0000A610                            
0000A610                            
0000A610                            Obj48_Move:
0000A610 4A28 003D                  		tst.b	$3D(a0)
0000A614 6600                       		bne.s	loc_7B9C
0000A616 3028 003E                  		move.w	$3E(a0),d0
0000A61A 5040                       		addq.w	#8,d0
0000A61C 3140 003E                  		move.w	d0,$3E(a0)
0000A620 D168 0026                  		add.w	d0,obAngle(a0)
0000A624 0C40 0200                  		cmpi.w	#$200,d0
0000A628 6600                       		bne.s	loc_7BB6
0000A62A 117C 0001 003D             		move.b	#1,$3D(a0)
0000A630 6000                       		bra.s	loc_7BB6
0000A632                            ; ===========================================================================
0000A632                            
0000A632                            loc_7B9C:
0000A632 3028 003E                  		move.w	$3E(a0),d0
0000A636 5140                       		subq.w	#8,d0
0000A638 3140 003E                  		move.w	d0,$3E(a0)
0000A63C D168 0026                  		add.w	d0,obAngle(a0)
0000A640 0C40 FE00                  		cmpi.w	#-$200,d0
0000A644 6600                       		bne.s	loc_7BB6
0000A646 117C 0000 003D             		move.b	#0,$3D(a0)
0000A64C                            
0000A64C                            loc_7BB6:
0000A64C 1028 0026                  		move.b	obAngle(a0),d0
0000A650                            ; End of function Obj48_Move
0000A650                            
0000A650                            
0000A650                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
0000A650                            
0000A650                            
0000A650                            Swing_Move2:
0000A650 6100 A5FE                  		bsr.w	CalcSine
0000A654 3428 0038                  		move.w	$38(a0),d2
0000A658 3628 003A                  		move.w	$3A(a0),d3
0000A65C 45E8 0028                  		lea	obSubtype(a0),a2
0000A660 7C00                       		moveq	#0,d6
0000A662 1C1A                       		move.b	(a2)+,d6
0000A664                            
0000A664                            loc_7BCE:
0000A664 7800                       		moveq	#0,d4
0000A666 181A                       		move.b	(a2)+,d4
0000A668 ED4C                       		lsl.w	#6,d4
0000A66A 0684 00FF D000             		addi.l	#v_objspace&$FFFFFF,d4
0000A670 2244                       		movea.l	d4,a1
0000A672 7800                       		moveq	#0,d4
0000A674 1829 003C                  		move.b	$3C(a1),d4
0000A678 2A04                       		move.l	d4,d5
0000A67A C9C0                       		muls.w	d0,d4
0000A67C E084                       		asr.l	#8,d4
0000A67E CBC1                       		muls.w	d1,d5
0000A680 E085                       		asr.l	#8,d5
0000A682 D842                       		add.w	d2,d4
0000A684 DA43                       		add.w	d3,d5
0000A686 3344 000C                  		move.w	d4,obY(a1)
0000A68A 3345 0008                  		move.w	d5,obX(a1)
0000A68E 51CE FFD4                  		dbf	d6,loc_7BCE
0000A692 4E75                       		rts	
0000A694                            ; End of function Swing_Move2
0000A694                            
0000A694                            ; ===========================================================================
0000A694                            
0000A694                            Swing_ChkDel:
0000A6B2 4E75                       		rts	
0000A6B4                            ; ===========================================================================
0000A6B4                            
0000A6B4                            Swing_DelAll:
0000A6B4 7400                       		moveq	#0,d2
0000A6B6 45E8 0028                  		lea	obSubtype(a0),a2
0000A6BA 141A                       		move.b	(a2)+,d2
0000A6BC                            
0000A6BC                            Swing_DelLoop:
0000A6BC 7000                       		moveq	#0,d0
0000A6BE 101A                       		move.b	(a2)+,d0
0000A6C0 ED48                       		lsl.w	#6,d0
0000A6C2 0680 00FF D000             		addi.l	#v_objspace&$FFFFFF,d0
0000A6C8 2240                       		movea.l	d0,a1
0000A6CA 6100 0000                  		bsr.w	DeleteChild
0000A6CE 51CA FFEC                  		dbf	d2,Swing_DelLoop ; repeat for length of	chain
0000A6D2 4E75                       		rts	
0000A6D4                            ; ===========================================================================
0000A6D4                            
0000A6D4                            Swing_Delete:	; Routine 6, 8
0000A6D4 6100 0000                  		bsr.w	DeleteObject
0000A6D8 4E75                       		rts	
0000A6DA                            ; ===========================================================================
0000A6DA                            
0000A6DA                            Swing_Display:	; Routine $A
0000A6DA 6000 0000                  		bra.w	DisplaySprite
0000A6DA 6000 0000                  		bra.w	DisplaySprite
0000A6DE                            Map_Swing_GHZ:	include	"_maps\Swinging Platforms (GHZ).asm"
0000A6DE                            ; ---------------------------------------------------------------------------
0000A6DE                            ; Sprite mappings - GHZ	and MZ swinging	platforms
0000A6DE                            ; ---------------------------------------------------------------------------
0000A6DE                            Map_Swing_GHZ_internal:
0000A6DE 0000                       		dc.w @block-Map_Swing_GHZ_internal
0000A6E0 0000                       		dc.w @chain-Map_Swing_GHZ_internal
0000A6E2 0000                       		dc.w @anchor-Map_Swing_GHZ_internal
0000A6E4 02                         @block:		dc.b 2
0000A6E5 F809 0004 E8               		dc.b $F8, 9, 0,	4, $E8
0000A6EA F809 0004 00               		dc.b $F8, 9, 0,	4, 0
0000A6EF 01                         @chain:		dc.b 1
0000A6F0 F805 0000 F8               		dc.b $F8, 5, 0,	0, $F8
0000A6F5 01                         @anchor:	dc.b 1
0000A6F6 F805 000A F8               		dc.b $F8, 5, 0,	$A, $F8
0000A6FC 00                         		even
0000A6FC 00                         		even
0000A6FC                            Map_Swing_SLZ:	include	"_maps\Swinging Platforms (SLZ).asm"
0000A6FC                            ; ---------------------------------------------------------------------------
0000A6FC                            ; Sprite mappings - SLZ	swinging platforms
0000A6FC                            ; ---------------------------------------------------------------------------
0000A6FC                            Map_Swing_SLZ_internal:
0000A6FC 0000                       		dc.w @block-Map_Swing_SLZ_internal
0000A6FE 0000                       		dc.w @chain-Map_Swing_SLZ_internal
0000A700 0000                       		dc.w @anchor-Map_Swing_SLZ_internal
0000A702 08                         @block:		dc.b 8
0000A703 F00F 0004 E0               		dc.b $F0, $F, 0, 4, $E0
0000A708 F00F 0804 00               		dc.b $F0, $F, 8, 4, 0
0000A70D F005 0014 D0               		dc.b $F0, 5, 0,	$14, $D0
0000A712 F005 0814 20               		dc.b $F0, 5, 8,	$14, $20
0000A717 1004 0018 E0               		dc.b $10, 4, 0,	$18, $E0
0000A71C 1004 0818 10               		dc.b $10, 4, 8,	$18, $10
0000A721 1001 001A F8               		dc.b $10, 1, 0,	$1A, $F8
0000A726 1001 081A 00               		dc.b $10, 1, 8,	$1A, 0
0000A72B 01                         @chain:		dc.b 1
0000A72C F805 4000 F8               		dc.b $F8, 5, $40, 0, $F8
0000A731 01                         @anchor:	dc.b 1
0000A732 F805 001C F8               		dc.b $F8, 5, 0,	$1C, $F8
0000A738 00                         		even
0000A738 00                         		even
0000A738                            		include	"_incObj\17 Spiked Pole Helix.asm"
0000A738                            ; ---------------------------------------------------------------------------
0000A738                            ; Object 17 - helix of spikes on a pole	(GHZ)
0000A738                            ; ---------------------------------------------------------------------------
0000A738                            
0000A738                            Helix:
0000A738 7000                       		moveq	#0,d0
0000A73A 1028 0024                  		move.b	obRoutine(a0),d0
0000A73E 323B 0000                  		move.w	Hel_Index(pc,d0.w),d1
0000A742 4EFB 1000                  		jmp	Hel_Index(pc,d1.w)
0000A746                            ; ===========================================================================
0000A746 0000                       Hel_Index:	dc.w Hel_Main-Hel_Index
0000A748 0000                       		dc.w Hel_Action-Hel_Index
0000A74A 0000                       		dc.w Hel_Action-Hel_Index
0000A74C 0000                       		dc.w Hel_Delete-Hel_Index
0000A74E 0000                       		dc.w Hel_Display-Hel_Index
0000A750                            
0000A750 =0000003E                  hel_frame:	equ $3E		; start frame (different for each spike)
0000A750                            
0000A750                            ;		$29-38 are used for child object addresses
0000A750                            ; ===========================================================================
0000A750                            
0000A750                            Hel_Main:	; Routine 0
0000A750 5428 0024                  		addq.b	#2,obRoutine(a0)
0000A754 217C 0000 0000 0004        		move.l	#Map_Hel,obMap(a0)
0000A75C 317C 4398 0002             		move.w	#$4398,obGfx(a0)
0000A762 117C 0007 0022             		move.b	#7,obStatus(a0)
0000A768 117C 0004 0001             		move.b	#4,obRender(a0)
0000A76E 117C 0003 0018             		move.b	#3,obPriority(a0)
0000A774 117C 0008 0019             		move.b	#8,obActWid(a0)
0000A77A 3428 000C                  		move.w	obY(a0),d2
0000A77E 3628 0008                  		move.w	obX(a0),d3
0000A782 1828 0000                  		move.b	0(a0),d4
0000A786 45E8 0028                  		lea	obSubtype(a0),a2 ; move helix length to a2
0000A78A 7200                       		moveq	#0,d1
0000A78C 1212                       		move.b	(a2),d1		; move helix length to d1
0000A78E 14FC 0000                  		move.b	#0,(a2)+	; clear subtype
0000A792 3001                       		move.w	d1,d0
0000A794 E248                       		lsr.w	#1,d0
0000A796 E948                       		lsl.w	#4,d0
0000A798 9640                       		sub.w	d0,d3		; d3 is x-axis position of leftmost spike
0000A79A 5501                       		subq.b	#2,d1
0000A79C 6500                       		bcs.s	Hel_Action	; skip to action if length is only 1
0000A79E 7C00                       		moveq	#0,d6
0000A7A0                            
0000A7A0                            Hel_Build:
0000A7A0 6100 0000                  		bsr.w	FindFreeObj
0000A7A4 6600                       		bne.s	Hel_Action
0000A7A6 5228 0028                  		addq.b	#1,obSubtype(a0)
0000A7AA 3A09                       		move.w	a1,d5
0000A7AC 0445 D000                  		subi.w	#$D000,d5
0000A7B0 EC4D                       		lsr.w	#6,d5
0000A7B2 0245 007F                  		andi.w	#$7F,d5
0000A7B6 14C5                       		move.b	d5,(a2)+	; copy child address to parent RAM
0000A7B8 137C 0008 0024             		move.b	#8,obRoutine(a1)
0000A7BE 1344 0000                  		move.b	d4,0(a1)
0000A7C2 3342 000C                  		move.w	d2,ObY(a1)
0000A7C6 3343 0008                  		move.w	d3,obX(a1)
0000A7CA 2368 0004 0004             		move.l	obMap(a0),obMap(a1)
0000A7D0 337C 4398 0002             		move.w	#$4398,obGfx(a1)
0000A7D6 137C 0004 0001             		move.b	#4,obRender(a1)
0000A7DC 137C 0003 0018             		move.b	#3,obPriority(a1)
0000A7E2 137C 0008 0019             		move.b	#8,obActWid(a1)
0000A7E8 1346 003E                  		move.b	d6,hel_frame(a1)
0000A7EC 5206                       		addq.b	#1,d6
0000A7EE 0206 0007                  		andi.b	#7,d6
0000A7F2 0643 0010                  		addi.w	#$10,d3
0000A7F6 B668 0008                  		cmp.w	obX(a0),d3	; is this spike in the centre?
0000A7FA 6600                       		bne.s	Hel_NotCentre	; if not, branch
0000A7FC                            
0000A7FC 1146 003E                  		move.b	d6,hel_frame(a0) ; set parent spike frame
0000A800 5206                       		addq.b	#1,d6
0000A802 0206 0007                  		andi.b	#7,d6
0000A806 0643 0010                  		addi.w	#$10,d3		; skip to next spike
0000A80A 5228 0028                  		addq.b	#1,obSubtype(a0)
0000A80E                            
0000A80E                            	Hel_NotCentre:
0000A80E 51C9 FF90                  		dbf	d1,Hel_Build ; repeat d1 times (helix length)
0000A812                            
0000A812                            Hel_Action:	; Routine 2, 4
0000A812 6100 0000                  		bsr.w	Hel_RotateSpikes
0000A816 6100 0000                  		bsr.w	DisplaySprite
0000A81A 6000 0000                  		bra.w	Hel_ChkDel
0000A81E                            
0000A81E                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
0000A81E                            
0000A81E                            
0000A81E                            Hel_RotateSpikes:
0000A81E 1038 FEC1                  		move.b	(v_ani0_frame).w,d0
0000A822 117C 0000 0020             		move.b	#0,obColType(a0) ; make object harmless
0000A828 D028 003E                  		add.b	hel_frame(a0),d0
0000A82C 0200 0007                  		andi.b	#7,d0
0000A830 1140 001A                  		move.b	d0,obFrame(a0)	; change current frame
0000A834 6600                       		bne.s	locret_7DA6
0000A836 117C 0084 0020             		move.b	#$84,obColType(a0) ; make object harmful
0000A83C                            
0000A83C                            locret_7DA6:
0000A83C 4E75                       		rts	
0000A83E                            ; End of function Hel_RotateSpikes
0000A83E                            
0000A83E                            ; ===========================================================================
0000A83E                            
0000A83E                            Hel_ChkDel:
0000A85C 4E75                       		rts	
0000A85E                            ; ===========================================================================
0000A85E                            
0000A85E                            Hel_DelAll:
0000A85E 7400                       		moveq	#0,d2
0000A860 45E8 0028                  		lea	obSubtype(a0),a2 ; move helix length to a2
0000A864 141A                       		move.b	(a2)+,d2	; move helix length to d2
0000A866 5502                       		subq.b	#2,d2
0000A868 6500                       		bcs.s	Hel_Delete
0000A86A                            
0000A86A                            	Hel_DelLoop:
0000A86A 7000                       		moveq	#0,d0
0000A86C 101A                       		move.b	(a2)+,d0
0000A86E ED48                       		lsl.w	#6,d0
0000A870 0680 00FF D000             		addi.l	#v_objspace&$FFFFFF,d0
0000A876 2240                       		movea.l	d0,a1		; get child address
0000A878 6100 0000                  		bsr.w	DeleteChild	; delete object
0000A87C 51CA FFEC                  		dbf	d2,Hel_DelLoop ; repeat d2 times (helix length)
0000A880                            
0000A880                            Hel_Delete:	; Routine 6
0000A880 6100 0000                  		bsr.w	DeleteObject
0000A884 4E75                       		rts	
0000A886                            ; ===========================================================================
0000A886                            
0000A886                            Hel_Display:	; Routine 8
0000A886 6100 FF96                  		bsr.w	Hel_RotateSpikes
0000A88A 6000 0000                  		bra.w	DisplaySprite
0000A88A 6000 0000                  		bra.w	DisplaySprite
0000A88E                            Map_Hel:	include	"_maps\Spiked Pole Helix.asm"
0000A88E                            ; ---------------------------------------------------------------------------
0000A88E                            ; Sprite mappings - helix of spikes on a pole (GHZ)
0000A88E                            ; ---------------------------------------------------------------------------
0000A88E                            Map_Hel_internal:
0000A88E 0000                       		dc.w byte_7E08-Map_Hel_internal
0000A890 0000                       		dc.w byte_7E0E-Map_Hel_internal
0000A892 0000                       		dc.w byte_7E14-Map_Hel_internal
0000A894 0000                       		dc.w byte_7E1A-Map_Hel_internal
0000A896 0000                       		dc.w byte_7E20-Map_Hel_internal
0000A898 0000                       		dc.w byte_7E26-Map_Hel_internal
0000A89A 0000                       		dc.w byte_7E2E-Map_Hel_internal
0000A89C 0000                       		dc.w byte_7E2C-Map_Hel_internal
0000A89E 01                         byte_7E08:	dc.b 1
0000A89F F001 0000 FC               		dc.b $F0, 1, 0,	0, $FC	; points straight up (harmful)
0000A8A4 01                         byte_7E0E:	dc.b 1
0000A8A5 F505 0002 F8               		dc.b $F5, 5, 0,	2, $F8	; 45 degree
0000A8AA 01                         byte_7E14:	dc.b 1
0000A8AB F805 0006 F8               		dc.b $F8, 5, 0,	6, $F8	; 90 degree
0000A8B0 01                         byte_7E1A:	dc.b 1
0000A8B1 FB05 000A F8               		dc.b $FB, 5, 0,	$A, $F8	; 45 degree
0000A8B6 01                         byte_7E20:	dc.b 1
0000A8B7 0001 000E FC               		dc.b 0,	1, 0, $E, $FC	; straight down
0000A8BC 01                         byte_7E26:	dc.b 1
0000A8BD 0400 0010 FD               		dc.b 4,	0, 0, $10, $FD	; 45 degree
0000A8C2 01                         byte_7E2C:	dc.b 1
0000A8C3 F4                         		dc.b $F4
0000A8C4                            byte_7E2E:	; reads the 0 below	; not visible
0000A8C4 0000 11FD                  		dc.b 0, 0,	$11, $FD ; 45 degree
0000A8C8                            		even
0000A8C8                            		even
0000A8C8                            		include	"_incObj\18 Platforms.asm"
0000A8C8                            ; ---------------------------------------------------------------------------
0000A8C8                            ; Object 18 - platforms	(GHZ, SYZ, SLZ)
0000A8C8                            ; ---------------------------------------------------------------------------
0000A8C8                            
0000A8C8                            BasicPlatform:
0000A8C8 7000                       		moveq	#0,d0
0000A8CA 1028 0024                  		move.b	obRoutine(a0),d0
0000A8CE 323B 0000                  		move.w	Plat_Index(pc,d0.w),d1
0000A8D2 4EFB 1000                  		jmp	Plat_Index(pc,d1.w)
0000A8D6                            ; ===========================================================================
0000A8D6 0000                       Plat_Index:	dc.w Plat_Main-Plat_Index
0000A8D8 0000                       		dc.w Plat_Solid-Plat_Index
0000A8DA 0000                       		dc.w Plat_Action2-Plat_Index
0000A8DC 0000                       		dc.w Plat_Delete-Plat_Index
0000A8DE 0000                       		dc.w Plat_Action-Plat_Index
0000A8E0                            ; ===========================================================================
0000A8E0                            
0000A8E0                            Plat_Main:	; Routine 0
0000A8E0 5428 0024                  		addq.b	#2,obRoutine(a0)
0000A8E4 317C 4000 0002             		move.w	#$4000,obGfx(a0)
0000A8EA 217C 0000 0000 0004        		move.l	#Map_Plat_GHZ,obMap(a0)
0000A8F2 117C 0020 0019             		move.b	#$20,obActWid(a0)
0000A8F8 0C38 0004 FE10             		cmpi.b	#id_SZ,(v_zone).w ; check if level is SYZ
0000A8FE 6600                       		bne.s	@notSYZ
0000A900                            
0000A900 217C 0000 0000 0004        		move.l	#Map_Plat_SYZ,obMap(a0) ; SYZ specific code
0000A908 117C 0020 0019             		move.b	#$20,obActWid(a0)
0000A90E                            
0000A90E                            	@notSYZ:
0000A90E 0C38 0003 FE10             		cmpi.b	#id_SLZ,(v_zone).w ; check if level is SLZ
0000A914 6600                       		bne.s	@notSLZ
0000A916 217C 0000 0000 0004        		move.l	#Map_Plat_SLZ,obMap(a0) ; SLZ specific code
0000A91E 117C 0020 0019             		move.b	#$20,obActWid(a0)
0000A924 317C 4000 0002             		move.w	#$4000,obGfx(a0)
0000A92A 117C 0003 0028             		move.b	#3,obSubtype(a0)
0000A930                            
0000A930                            	@notSLZ:
0000A930 117C 0004 0001             		move.b	#4,obRender(a0)
0000A936 117C 0004 0018             		move.b	#4,obPriority(a0)
0000A93C 3168 000C 002C             		move.w	obY(a0),$2C(a0)
0000A942 3168 000C 0034             		move.w	obY(a0),$34(a0)
0000A948 3168 0008 0032             		move.w	obX(a0),$32(a0)
0000A94E 317C 0080 0026             		move.w	#$80,obAngle(a0)
0000A954 7200                       		moveq	#0,d1
0000A956 1028 0028                  		move.b	obSubtype(a0),d0
0000A95A 0C00 000A                  		cmpi.b	#$A,d0		; is object type $A (large platform)?
0000A95E 6600                       		bne.s	@setframe	; if not, branch
0000A960 5201                       		addq.b	#1,d1		; use frame #1
0000A962 117C 0020 0019             		move.b	#$20,obActWid(a0) ; set width
0000A968                            
0000A968                            	@setframe:
0000A968 1141 001A                  		move.b	d1,obFrame(a0)	; set frame to d1
0000A96C                            
0000A96C                            Plat_Solid:	; Routine 2
0000A96C 4A28 0038                  		tst.b	$38(a0)
0000A970 6700                       		beq.s	loc_7EE0
0000A972 5928 0038                  		subq.b	#4,$38(a0)
0000A976                            
0000A976                            	loc_7EE0:
0000A976 7200                       		moveq	#0,d1
0000A978 1228 0019                  		move.b	obActWid(a0),d1
0000A97C 6100 F4EE                  		bsr.w	PlatformObject
0000A980                            
0000A980                            Plat_Action:	; Routine 8
0000A980 6100 0000                  		bsr.w	Plat_Move
0000A984 6100 0000                  		bsr.w	Plat_Nudge
0000A988 6100 0000                  		bsr.w	DisplaySprite
0000A98C 6000 0000                  		bra.w	Plat_ChkDel
0000A990                            ; ===========================================================================
0000A990                            
0000A990                            Plat_Action2:	; Routine 4
0000A990 0C28 0040 0038             		cmpi.b	#$40,$38(a0)
0000A996 6700                       		beq.s	loc_7F06
0000A998 5828 0038                  		addq.b	#4,$38(a0)
0000A99C                            
0000A99C                            	loc_7F06:
0000A99C 7200                       		moveq	#0,d1
0000A99E 1228 0019                  		move.b	obActWid(a0),d1
0000A9A2 6100 F63C                  		bsr.w	ExitPlatform
0000A9A6 3F28 0008                  		move.w	obX(a0),-(sp)
0000A9AA 6100 0000                  		bsr.w	Plat_Move
0000A9AE 6100 0000                  		bsr.w	Plat_Nudge
0000A9B2 341F                       		move.w	(sp)+,d2
0000A9B4 6100 FB98                  		bsr.w	MvSonicOnPtfm2
0000A9B8 6100 0000                  		bsr.w	DisplaySprite
0000A9BC 6000 0000                  		bra.w	Plat_ChkDel
0000A9C0                            
0000A9C0 4E75                       		rts
0000A9C2                            
0000A9C2                            ; ---------------------------------------------------------------------------
0000A9C2                            ; Subroutine to	move platform slightly when you	stand on it
0000A9C2                            ; ---------------------------------------------------------------------------
0000A9C2                            
0000A9C2                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
0000A9C2                            
0000A9C2                            
0000A9C2                            Plat_Nudge:
0000A9C2 1028 0038                  		move.b	$38(a0),d0
0000A9C6 6100 A288                  		bsr.w	CalcSine
0000A9CA 323C 0400                  		move.w	#$400,d1
0000A9CE C1C1                       		muls.w	d1,d0
0000A9D0 4840                       		swap	d0
0000A9D2 D068 002C                  		add.w	$2C(a0),d0
0000A9D6 3140 000C                  		move.w	d0,obY(a0)
0000A9DA 4E75                       		rts	
0000A9DC                            ; End of function Plat_Nudge
0000A9DC                            
0000A9DC                            ; ---------------------------------------------------------------------------
0000A9DC                            ; Subroutine to	move platforms
0000A9DC                            ; ---------------------------------------------------------------------------
0000A9DC                            
0000A9DC                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
0000A9DC                            
0000A9DC                            
0000A9DC                            Plat_Move:
0000A9DC 7000                       		moveq	#0,d0
0000A9DE 1028 0028                  		move.b	obSubtype(a0),d0
0000A9E2 0240 000F                  		andi.w	#$F,d0
0000A9E6 D040                       		add.w	d0,d0
0000A9E8 323B 0000                  		move.w	@index(pc,d0.w),d1
0000A9EC 4EFB 1000                  		jmp	@index(pc,d1.w)
0000A9F0                            ; End of function Plat_Move
0000A9F0                            
0000A9F0                            ; ===========================================================================
0000A9F0 0000 0000                  @index:		dc.w @type00-@index, @type01-@index
0000A9F4 0000 0000                  		dc.w @type02-@index, @type03-@index
0000A9F8 0000 0000                  		dc.w @type04-@index, @type05-@index
0000A9FC 0000 0000                  		dc.w @type06-@index, @type07-@index
0000AA00 0000 0000                  		dc.w @type08-@index, @type00-@index
0000AA04 0000 0000                  		dc.w @type0A-@index, @type0B-@index
0000AA08 0000                       		dc.w @type0C-@index
0000AA0A                            ; ===========================================================================
0000AA0A                            
0000AA0A                            @type00:
0000AA0A 4E75                       		rts			; platform 00 doesn't move
0000AA0C                            ; ===========================================================================
0000AA0C                            
0000AA0C                            @type05:
0000AA0C 3028 0032                  		move.w	$32(a0),d0
0000AA10 1228 0026                  		move.b	obAngle(a0),d1	; load platform-motion variable
0000AA14 4401                       		neg.b	d1		; reverse platform-motion
0000AA16 0601 0040                  		addi.b	#$40,d1
0000AA1A 6000                       		bra.s	@type01_move
0000AA1C                            ; ===========================================================================
0000AA1C                            
0000AA1C                            @type01:
0000AA1C 3028 0032                  		move.w	$32(a0),d0
0000AA20 1228 0026                  		move.b	obAngle(a0),d1	; load platform-motion variable
0000AA24 0401 0040                  		subi.b	#$40,d1
0000AA28                            
0000AA28                            	@type01_move:
0000AA28 4881                       		ext.w	d1
0000AA2A D041                       		add.w	d1,d0
0000AA2C 3140 0008                  		move.w	d0,obX(a0)	; change position on x-axis
0000AA30 6000 0000                  		bra.w	@chgmotion
0000AA34                            ; ===========================================================================
0000AA34                            
0000AA34                            @type0C:
0000AA34 3028 0034                  		move.w	$34(a0),d0
0000AA38 1238 FE6C                  		move.b	(v_oscillate+$E).w,d1 ; load platform-motion variable
0000AA3C 4401                       		neg.b	d1		; reverse platform-motion
0000AA3E 0601 0030                  		addi.b	#$30,d1
0000AA42 6000                       		bra.s	@type02_move
0000AA44                            ; ===========================================================================
0000AA44                            
0000AA44                            @type0B:
0000AA44 3028 0034                  		move.w	$34(a0),d0
0000AA48 1238 FE6C                  		move.b	(v_oscillate+$E).w,d1 ; load platform-motion variable
0000AA4C 0401 0030                  		subi.b	#$30,d1
0000AA50 6000                       		bra.s	@type02_move
0000AA52                            ; ===========================================================================
0000AA52                            
0000AA52                            @type06:
0000AA52 3028 0034                  		move.w	$34(a0),d0
0000AA56 1228 0026                  		move.b	obAngle(a0),d1	; load platform-motion variable
0000AA5A 4401                       		neg.b	d1		; reverse platform-motion
0000AA5C 0601 0040                  		addi.b	#$40,d1
0000AA60 6000                       		bra.s	@type02_move
0000AA62                            ; ===========================================================================
0000AA62                            
0000AA62                            @type02:
0000AA62 3028 0034                  		move.w	$34(a0),d0
0000AA66 1228 0026                  		move.b	obAngle(a0),d1	; load platform-motion variable
0000AA6A 0401 0040                  		subi.b	#$40,d1
0000AA6E                            
0000AA6E                            	@type02_move:
0000AA6E 4881                       		ext.w	d1
0000AA70 D041                       		add.w	d1,d0
0000AA72 3140 002C                  		move.w	d0,$2C(a0)	; change position on y-axis
0000AA76 6000 0000                  		bra.w	@chgmotion
0000AA7A                            ; ===========================================================================
0000AA7A                            
0000AA7A                            @type03:
0000AA7A 4A68 003A                  		tst.w	$3A(a0)		; is time delay	set?
0000AA7E 6600                       		bne.s	@type03_wait	; if yes, branch
0000AA80 0828 0003 0022             		btst	#3,obStatus(a0)	; is Sonic standing on the platform?
0000AA86 6700                       		beq.s	@type03_nomove	; if not, branch
0000AA88 317C 001E 003A             		move.w	#30,$3A(a0)	; set time delay to 0.5	seconds
0000AA8E                            
0000AA8E                            	@type03_nomove:
0000AA8E 4E75                       		rts	
0000AA90                            
0000AA90                            	@type03_wait:
0000AA90 5368 003A                  		subq.w	#1,$3A(a0)	; subtract 1 from time
0000AA94 66F8                       		bne.s	@type03_nomove	; if time is > 0, branch
0000AA96 317C 0020 003A             		move.w	#32,$3A(a0)
0000AA9C 5228 0028                  		addq.b	#1,obSubtype(a0) ; change to type 04 (falling)
0000AAA0 4E75                       		rts	
0000AAA2                            ; ===========================================================================
0000AAA2                            
0000AAA2                            @type04:
0000AAA2 4A68 003A                  		tst.w	$3A(a0)
0000AAA6 6700                       		beq.s	@loc_8048
0000AAA8 5368 003A                  		subq.w	#1,$3A(a0)
0000AAAC 6600                       		bne.s	@loc_8048
0000AAAE 0828 0003 0022             		btst	#3,obStatus(a0)
0000AAB4 6700                       		beq.s	@loc_8042
0000AAB6 08E9 0001 0022             		bset	#1,obStatus(a1)
0000AABC 08A9 0003 0022             		bclr	#3,obStatus(a1)
0000AAC2 137C 0002 0024             		move.b	#2,obRoutine(a1)
0000AAC8 08A8 0003 0022             		bclr	#3,obStatus(a0)
0000AACE 4228 0025                  		clr.b	$25(a0)
0000AAD2 3368 0012 0012             		move.w	obVelY(a0),obVelY(a1)
0000AAD8                            
0000AAD8                            	@loc_8042:
0000AAD8 117C 0008 0024             		move.b	#8,obRoutine(a0)
0000AADE                            
0000AADE                            	@loc_8048:
0000AADE 2628 002C                  		move.l	$2C(a0),d3
0000AAE2 3028 0012                  		move.w	obVelY(a0),d0
0000AAE6 48C0                       		ext.l	d0
0000AAE8 E180                       		asl.l	#8,d0
0000AAEA D680                       		add.l	d0,d3
0000AAEC 2143 002C                  		move.l	d3,$2C(a0)
0000AAF0 0668 0038 0012             		addi.w	#$38,obVelY(a0)
0000AAF6 3038 F72E                  		move.w	(v_limitbtm2).w,d0
0000AAFA 0640 00E0                  		addi.w	#$E0,d0
0000AAFE B068 002C                  		cmp.w	$2C(a0),d0
0000AB02 6400                       		bcc.s	@locret_8074
0000AB04 117C 0006 0024             		move.b	#6,obRoutine(a0)
0000AB0A                            
0000AB0A                            	@locret_8074:
0000AB0A 4E75                       		rts	
0000AB0C                            ; ===========================================================================
0000AB0C                            
0000AB0C                            @type07:
0000AB0C 4A68 003A                  		tst.w	$3A(a0)		; is time delay	set?
0000AB10 6600                       		bne.s	@type07_wait	; if yes, branch
0000AB12 45F8 F7E0                  		lea	(f_switch).w,a2	; load switch statuses
0000AB16 7000                       		moveq	#0,d0
0000AB18 1028 0028                  		move.b	obSubtype(a0),d0 ; move object type ($x7) to d0
0000AB1C E848                       		lsr.w	#4,d0		; divide d0 by 8, round	down
0000AB1E 4A32 0000                  		tst.b	(a2,d0.w)	; has switch no. d0 been pressed?
0000AB22 6700                       		beq.s	@type07_nomove	; if not, branch
0000AB24 317C 003C 003A             		move.w	#60,$3A(a0)	; set time delay to 1 second
0000AB2A                            
0000AB2A                            	@type07_nomove:
0000AB2A 4E75                       		rts	
0000AB2C                            
0000AB2C                            	@type07_wait:
0000AB2C 5368 003A                  		subq.w	#1,$3A(a0)	; subtract 1 from time delay
0000AB30 66F8                       		bne.s	@type07_nomove	; if time is > 0, branch
0000AB32 5228 0028                  		addq.b	#1,obSubtype(a0) ; change to type 08
0000AB36 4E75                       		rts	
0000AB38                            ; ===========================================================================
0000AB38                            
0000AB38                            @type08:
0000AB38 5568 002C                  		subq.w	#2,$2C(a0)	; move platform	up
0000AB3C 3028 0034                  		move.w	$34(a0),d0
0000AB40 0440 0200                  		subi.w	#$200,d0
0000AB44 B068 002C                  		cmp.w	$2C(a0),d0	; has platform moved $200 pixels?
0000AB48 6600                       		bne.s	@type08_nostop	; if not, branch
0000AB4A 4228 0028                  		clr.b	obSubtype(a0)	; change to type 00 (stop moving)
0000AB4E                            
0000AB4E                            	@type08_nostop:
0000AB4E 4E75                       		rts	
0000AB50                            ; ===========================================================================
0000AB50                            
0000AB50                            @type0A:
0000AB50 3028 0034                  		move.w	$34(a0),d0
0000AB54 1228 0026                  		move.b	obAngle(a0),d1	; load platform-motion variable
0000AB58 0401 0040                  		subi.b	#$40,d1
0000AB5C 4881                       		ext.w	d1
0000AB5E E241                       		asr.w	#1,d1
0000AB60 D041                       		add.w	d1,d0
0000AB62 3140 002C                  		move.w	d0,$2C(a0)	; change position on y-axis
0000AB66                            
0000AB66                            @chgmotion:
0000AB66 1178 FE78 0026             		move.b	(v_oscillate+$1A).w,$26(a0) ; update platform-movement variable
0000AB6C 4E75                       		rts	
0000AB6E                            ; ===========================================================================
0000AB6E                            
0000AB6E                            Plat_ChkDel:
0000AB8A 4E75                       		rts	
0000AB8C                            ; ===========================================================================
0000AB8C                            
0000AB8C                            Plat_Delete:	; Routine 6
0000AB8C 6000 0000                  		bra.w	DeleteObject
0000AB8C 6000 0000                  		bra.w	DeleteObject
0000AB90                            Map_Plat_Unused:include	"_maps\Platforms (unused).asm"
0000AB90                            ; ---------------------------------------------------------------------------
0000AB90                            ; Sprite mappings - unused
0000AB90                            ; ---------------------------------------------------------------------------
0000AB90                            Map_Plat_Unused_internal:
0000AB90 0000                       		dc.w @small-Map_Plat_Unused_internal
0000AB92 0000                       		dc.w @large-Map_Plat_Unused_internal
0000AB94 02                         @small:		dc.b 2
0000AB95 F40B 003C E8               		dc.b $F4, $B, 0, $3C, $E8
0000AB9A F40B 0048 00               		dc.b $F4, $B, 0, $48, 0
0000AB9F 0A                         @large:		dc.b $A
0000ABA0 F40F 00CA E0               		dc.b $F4, $F, 0, $CA, $E0
0000ABA5 040F 00DA E0               		dc.b 4,	$F, 0, $DA, $E0
0000ABAA 240F 00DA E0               		dc.b $24, $F, 0, $DA, $E0
0000ABAF 440F 00DA E0               		dc.b $44, $F, 0, $DA, $E0
0000ABB4 640F 00DA E0               		dc.b $64, $F, 0, $DA, $E0
0000ABB9 F40F 08CA 00               		dc.b $F4, $F, 8, $CA, 0
0000ABBE 040F 08DA 00               		dc.b 4,	$F, 8, $DA, 0
0000ABC3 240F 08DA 00               		dc.b $24, $F, 8, $DA, 0
0000ABC8 440F 08DA 00               		dc.b $44, $F, 8, $DA, 0
0000ABCD 640F 08DA 00               		dc.b $64, $F, 8, $DA, 0
0000ABD2                            		even
0000ABD2                            		even
0000ABD2                            Map_Plat_GHZ:	include	"_maps\Platforms (GHZ).asm"
0000ABD2                            ; ---------------------------------------------------------------------------
0000ABD2                            ; Sprite mappings - GHZ	platforms
0000ABD2                            ; ---------------------------------------------------------------------------
0000ABD2                            Map_Plat_GHZ_internal:
0000ABD2 0000                       		dc.w @small-Map_Plat_GHZ_internal
0000ABD4 0000                       		dc.w @large-Map_Plat_GHZ_internal
0000ABD6 04                         @small:		dc.b 4
0000ABD7 F40B 003B E0               		dc.b $F4, $B, 0, $3B, $E0 ; small platform
0000ABDC F407 003F F8               		dc.b $F4, 7, 0,	$3F, $F8
0000ABE1 F407 003F 08               		dc.b $F4, 7, 0,	$3F, 8
0000ABE6 F403 0047 18               		dc.b $F4, 3, 0,	$47, $18
0000ABEB 0A                         @large:		dc.b $A
0000ABEC F40F 00C5 E0               		dc.b $F4, $F, 0, $C5, $E0 ; large column platform
0000ABF1 040F 00D5 E0               		dc.b 4,	$F, 0, $D5, $E0
0000ABF6 240F 00D5 E0               		dc.b $24, $F, 0, $D5, $E0
0000ABFB 440F 00D5 E0               		dc.b $44, $F, 0, $D5, $E0
0000AC00 640F 00D5 E0               		dc.b $64, $F, 0, $D5, $E0
0000AC05 F40F 08C5 00               		dc.b $F4, $F, 8, $C5, 0
0000AC0A 040F 08D5 00               		dc.b 4,	$F, 8, $D5, 0
0000AC0F 240F 08D5 00               		dc.b $24, $F, 8, $D5, 0
0000AC14 440F 08D5 00               		dc.b $44, $F, 8, $D5, 0
0000AC19 640F 08D5 00               		dc.b $64, $F, 8, $D5, 0
0000AC1E                            		even
0000AC1E                            		even
0000AC1E                            Map_Plat_SYZ:	include	"_maps\Platforms (SYZ).asm"
0000AC1E                            ; ---------------------------------------------------------------------------
0000AC1E                            ; Sprite mappings - SYZ	platforms
0000AC1E                            ; ---------------------------------------------------------------------------
0000AC1E                            Map_Plat_SYZ_internal:
0000AC1E 0000                       		dc.w @platform-Map_Plat_SYZ_internal
0000AC20 03                         @platform:	dc.b 3
0000AC21 F60B 0049 E0               		dc.b $F6, $B, 0, $49, $E0
0000AC26 F607 0051 F8               		dc.b $F6, 7, 0,	$51, $F8
0000AC2B F60B 0055 08               		dc.b $F6, $B, 0, $55, 8
0000AC30                            		even
0000AC30                            		even
0000AC30                            Map_Plat_SLZ:	include	"_maps\Platforms (SLZ).asm"
0000AC30                            ; ---------------------------------------------------------------------------
0000AC30                            ; Sprite mappings - SLZ	platforms
0000AC30                            ; ---------------------------------------------------------------------------
0000AC30                            Map_Plat_SLZ_internal:
0000AC30 0000                       		dc.w @platform-Map_Plat_SLZ_internal
0000AC32 02                         @platform:	dc.b 2
0000AC33 F80F 0021 E0               		dc.b $F8, $F, 0, $21, $E0
0000AC38 F80F 0021 00               		dc.b $F8, $F, 0, $21, 0
0000AC3E 00                         		even
0000AC3E 00                         		even
0000AC3E                            		include	"_incObj\19.asm"
0000AC3E                            ; ---------------------------------------------------------------------------
0000AC3E                            ; Object 19 - GHZ Boulder
0000AC3E                            ; ---------------------------------------------------------------------------
0000AC3E                            
0000AC3E =00000000                  Ball_JumpWith = 0
0000AC3E =00000000                  Ball_ReverseDirection = 0
0000AC3E                            
0000AC3E                            ghzboulder:
0000AC3E 7000                               moveq   #0,d0
0000AC40 1028 0024                          move.b  obRoutine(a0),d0
0000AC44 323B 0000                          move.w  ObjRollingBall_Index(pc,d0.w),d1
0000AC48 4EFB 1000                          jmp     ObjRollingBall_Index(pc,d1.w)
0000AC4C                            ; ---------------------------------------------------------------------------
0000AC4C                            ObjRollingBall_Index:	
0000AC4C 0000                       		dc.w ObjRollingBall_Init-ObjRollingBall_Index
0000AC4E 0000                       		dc.w ObjRollingBall_Main-ObjRollingBall_Index
0000AC50 0000                       		dc.w loc_5D86-ObjRollingBall_Index
0000AC52 0000                       		dc.w ObjRollingBall_Delete-ObjRollingBall_Index
0000AC54 0000                       		dc.w sub_5CEE-ObjRollingBall_Index
0000AC56                            ; ---------------------------------------------------------------------------
0000AC56                            
0000AC56                            ObjRollingBall_Init:
0000AC56 117C 0018 0016                     move.b  #$18,obHeight(a0)
0000AC5C 117C 000C 0017                     move.b  #$C,obWidth(a0)
0000AC62 4EB9 0000 0000                     jsr   ObjectFall
0000AC68 4EB9 0000 0000                     jsr     (ObjFloorDist).l
0000AC6E 4A41                               tst.w   d1
0000AC70 6A00                               bpl.s   ObjRollingBall_Return
0000AC72 D368 000C                          add.w   d1,obY(a0)
0000AC76 317C 0000 0012                     move.w  #0,obVelY(a0)
0000AC7C 117C 0008 0024                     move.b  #8,obRoutine(a0)
0000AC82 217C 0000 0000 0004                move.l  #Map_GBall,obMap(a0)
0000AC8A 317C 43AA 0002                     move.w  #$43AA,obGfx(a0)
0000AC90 117C 0004 0001                     move.b  #4,obRender(a0)
0000AC96 117C 0003 0018                     move.b  #3,obPriority(a0)
0000AC9C 117C 0018 0019                     move.b  #$18,obActWid(a0)
0000ACA2 117C 0001 0027                     move.b  #1,$27(a0)
0000ACA8 6100 0000                          bsr.w   sub_5DC8
0000ACAC                            
0000ACAC                            ObjRollingBall_Return:
0000ACAC 4E75                               rts
0000ACAE                            
0000ACAE                            ; =============== S U B R O U T I N E =======================================
0000ACAE                            
0000ACAE                            
0000ACAE                            sub_5CEE:
0000ACAE 323C 0023                          move.w  #$23,d1 ; '#'
0000ACB2 343C 0018                          move.w  #$18,d2
0000ACB6 363C 0018                          move.w  #$18,d3
0000ACBA 3828 0008                          move.w  obX(a0),d4
0000ACBE 4EB9 0000 0000                     jsr   SolidObject
0000ACC4 0828 0005 0022                     btst    #5,obStatus(a0)
0000ACCA 6600                               bne.s   loc_5D14
0000ACCC 3038 D008                          move.w  (v_objspace+obX).w,d0
0000ACD0 9068 0008                          sub.w   obX(a0),d0
0000ACD4 6500                               bcs.s   loc_5D20
0000ACD6                            
0000ACD6                            loc_5D14:
0000ACD6 117C 0002 0024                     move.b  #2,obRoutine(a0)
0000ACDC 317C 0080 002C                     move.w  #$80,$2C(a0)
0000ACE2                            
0000ACE2                            loc_5D20:
0000ACE2 6100 0000                          bsr.w   sub_5DC8
0000ACE6 4EB9 0000 0000                     jsr   DisplaySprite
0000ACEC 6000 0000                          bra.w   loc_5E2A
0000ACF0                            ; End of function sub_5CEE
0000ACF0                            
0000ACF0                            ; ---------------------------------------------------------------------------
0000ACF0                            
0000ACF0                            ObjRollingBall_Main:
0000ACF0 0828 0001 0022                     btst    #1,obStatus(a0)
0000ACF6 6600 0000                          bne.w   loc_5D86
0000ACFA 6100 0000                          bsr.w   sub_5DC8
0000ACFE 6100 0000                          bsr.w   sub_5E50
0000AD02 0828 0003 0022             		btst    #3,obStatus(a0)
0000AD08 6700                       		beq.s   @noneed
0000AD0A 117C 0001 003C             		move.b  #1,$3C(a0)
0000AD10                            		
0000AD10                            	@noneed:
0000AD10 4EB9 0000 0000                     jsr   SpeedToPos
0000AD16 323C 0023                          move.w  #$23,d1 ; '#'
0000AD1A 343C 0018                          move.w  #$18,d2
0000AD1E 363C 0018                          move.w  #$18,d3
0000AD22 3828 0008                          move.w  obX(a0),d4
0000AD26 4EB9 0000 0000                     jsr   SolidObject
0000AD2C 4EB9 0000 0000                     jsr     (loc_14602).l
0000AD32 0C68 0020 0008                     cmpi.w  #$20,obX(a0) ; ' '
0000AD38 6400                               bcc.s   loc_5D7E
0000AD3A 317C 0020 0008                     move.w  #$20,obX(a0) ; ' '
0000AD40 317C 0400 002C                     move.w  #$400,$2C(a0)
0000AD46                            
0000AD46                            ;loc_5D70:
0000AD46                            ;        btst    #1,obStatus(a0)
0000AD46                            ;        beq.s   loc_5D7E
0000AD46                            ;        move.w  #-$3FF,obVelY(a0)
0000AD46                            
0000AD46                            loc_5D7E:
0000AD46 4A28 003C                  		tst.b   $3C(a0)
0000AD4A 6600                       		bne.s   @nowall
0000AD4C 7600                       		moveq   #0,d3
0000AD4E 1628 0019                  		move.b  obActWid(a0),d3
0000AD52 4A68 0010                  		tst.w   obVelX(a0)
0000AD56 6A00                       		bpl.s   @negative
0000AD58 4643                       		not.w	d3
0000AD5A 4EB9 0000 0000             		jsr   ObjHitWallLeft
0000AD60 4A41                       		tst.w   d1
0000AD62 6A00                       		bpl.s   @nowall
0000AD64 317C 0000 0010             		move.w  #0,obVelX(a0)
0000AD6A 317C 0000 002C             		move.w  #0,$2C(a0)
0000AD70 6000                       		bra.s   @nowall
0000AD72                            		
0000AD72                            	@negative:
0000AD72 4EB9 0000 0000             		jsr   ObjHitWallRight
0000AD78 4A41                       		tst.w   d1
0000AD7A 6A00                       		bpl.s   @nowall
0000AD7C 317C 0000 0010             		move.w  #0,obVelX(a0)
0000AD82 317C 0000 002C             		move.w  #0,$2C(a0)
0000AD88                            	
0000AD88                            	@nowall:
0000AD88 4EB9 0000 0000                     jsr   DisplaySprite
0000AD8E 6000 0000                          bra.w   loc_5E2A
0000AD92                            ; ---------------------------------------------------------------------------
0000AD92                            
0000AD92                            loc_5D86:
0000AD92 6100 0000                          bsr.w   sub_5DC8
0000AD96 4EB9 0000 0000             		jsr	SpeedToPos
0000AD9C 323C 0023                          move.w  #$23,d1 ; '#'
0000ADA0 343C 0018                          move.w  #$18,d2
0000ADA4 363C 0018                          move.w  #$18,d3
0000ADA8 3828 0008                          move.w  obX(a0),d4
0000ADAC 4EB9 0000 0000                     jsr   SolidObject
0000ADB2 4EB9 0000 0000                     jsr     (Sonic_Floor).l
0000ADB8 0828 0001 0022                     btst    #1,obStatus(a0)
0000ADBE 6700                               beq.s   loc_5DBE
0000ADC0 3028 0012                          move.w  obVelY(a0),d0
0000ADC4 0640 0028                          addi.w  #$28,d0 ; '('
0000ADC8 3140 0012                          move.w  d0,obVelY(a0)
0000ADCC 6000 FF78                          bra.w   loc_5D7E
0000ADD0                            ; ---------------------------------------------------------------------------
0000ADD0                            
0000ADD0                            loc_5DBE:
0000ADD0 4E71                               nop
0000ADD2 6000 FF72                  		bra.w  loc_5D7E
0000ADD6                            
0000ADD6                            ; =============== S U B R O U T I N E =======================================
0000ADD6                            
0000ADD6                            
0000ADD6                            sub_5DC8:
0000ADD6 1028 002C                          move.b  $2C(a0),d0
0000ADDA 6700                               beq.s   loc_5E02
0000ADDC 6B00                               bmi.s   loc_5E0A
0000ADDE 5328 001E                          subq.b  #1,obTimeFrame(a0)
0000ADE2 6A00                               bpl.s   loc_5E02
0000ADE4 4400                               neg.b   d0
0000ADE6 5000                               addq.b  #8,d0
0000ADE8 6500                               bcs.s   loc_5DEC
0000ADEA 7000                               moveq   #0,d0
0000ADEC                            
0000ADEC                            loc_5DEC:
0000ADEC 1140 001E                          move.b  d0,obTimeFrame(a0)
0000ADF0 1028 0027                          move.b  $27(a0),d0
0000ADF4 5200                               addq.b  #1,d0
0000ADF6 0C00 0004                          cmpi.b  #4,d0
0000ADFA 6600                               bne.s   loc_5DFE
0000ADFC 7001                               moveq   #1,d0
0000ADFE                            
0000ADFE                            loc_5DFE:
0000ADFE 1140 0027                          move.b  d0,$27(a0)
0000AE02                            
0000AE02                            loc_5E02:
0000AE02 1168 0027 001A                     move.b  $27(a0),obFrame(a0)
0000AE08 4E75                               rts
0000AE0A                            ; ---------------------------------------------------------------------------
0000AE0A                            
0000AE0A                            loc_5E0A:
0000AE0A 5328 001E                          subq.b  #1,obTimeFrame(a0)
0000AE0E 6AF2                               bpl.s   loc_5E02
0000AE10 5000                               addq.b  #8,d0
0000AE12 6500                               bcs.s   loc_5E16
0000AE14 7000                               moveq   #0,d0
0000AE16                            
0000AE16                            loc_5E16:
0000AE16 1140 001E                          move.b  d0,obTimeFrame(a0)
0000AE1A 1028 0027                          move.b  $27(a0),d0
0000AE1E 5300                               subq.b  #1,d0
0000AE20 6600                               bne.s   loc_5E24
0000AE22 7003                               moveq   #3,d0
0000AE24                            
0000AE24                            loc_5E24:
0000AE24 1140 0027                          move.b  d0,$27(a0)
0000AE28 60D8                               bra.s   loc_5E02
0000AE2A                            ; End of function sub_5DC8
0000AE2A                            
0000AE2A                            ; ---------------------------------------------------------------------------
0000AE2A                            ; START OF FUNCTION CHUNK FOR sub_5CEE
0000AE2A                            
0000AE2A                            loc_5E2A:
0000AE2A                            	;	out_of_range_s3	DeleteObject,@nodel
0000AE2A                            		
0000AE2A                            @nodel:
0000AE2A                            	;	jsr  ReactToItemBall
0000AE2A 4E75                       		rts
0000AE2C                            		
0000AE2C                            ; ---------------------------------------------------------------------------
0000AE2C                            	
0000AE2C                            ; END OF FUNCTION CHUNK FOR sub_5CEE
0000AE2C                            ; ---------------------------------------------------------------------------
0000AE2C                            
0000AE2C                            ObjRollingBall_Delete:
0000AE2C 6100 0000                          bsr.w   DeleteObject
0000AE30 4E75                               rts
0000AE32                            
0000AE32                            ; =============== S U B R O U T I N E =======================================
0000AE32                            
0000AE32                            
0000AE32                            sub_5E50:
0000AE32 1028 0026                  		move.b  obAngle(a0),d0
0000AE36 4EB9 0000 4C50             		jsr		CalcSine
0000AE3C 3400                       		move.w  d0,d2
0000AE3E C5FC 0038                  		muls.w  #$38,d2 ; '8'
0000AE42 E082                       		asr.l   #8,d2
0000AE44 D568 002C                  		add.w   d2,$2C(a0)
0000AE48 C3E8 002C                  		muls.w  $2C(a0),d1
0000AE4C E081                       		asr.l   #8,d1
0000AE4E 3141 0010                  		move.w  d1,obVelX(a0)
0000AE52 C1E8 002C                  		muls.w  $2C(a0),d0
0000AE56 E080                       		asr.l   #8,d0
0000AE58 3140 0012                  		move.w  d0,obVelY(a0)
0000AE5C 4E75                       		rts
0000AE5E                            ; End of function sub_5E50
0000AE5E                            
0000AE5E                            	;	include "_incObj/sub_ReactToItemBall.asm"
0000AE5E                            	;	include "_incObj/sub_ReactToItemBall.asm"
0000AE5E                            Map_GBall:	include	"_maps\GHZ Ball.asm"
0000AE5E                            ; ---------------------------------------------------------------------------
0000AE5E                            ; Sprite mappings - swinging ball on a chain from GHZ boss
0000AE5E                            ; ---------------------------------------------------------------------------
0000AE5E                            Map_GBall_internal:
0000AE5E 0000                       		dc.w @shiny-Map_GBall_internal
0000AE60 0000                       		dc.w @check1-Map_GBall_internal
0000AE62 0000                       		dc.w @check2-Map_GBall_internal
0000AE64 0000                       		dc.w @check3-Map_GBall_internal
0000AE66 06                         @shiny:		dc.b 6
0000AE67 F004 0024 F0               		dc.b $F0, 4, 0,	$24, $F0
0000AE6C F804 1024 F0               		dc.b $F8, 4, $10, $24, $F0
0000AE71 E80A 0000 E8               		dc.b $E8, $A, 0, 0, $E8
0000AE76 E80A 0800 00               		dc.b $E8, $A, 8, 0, 0
0000AE7B 000A 1000 E8               		dc.b 0,	$A, $10, 0, $E8
0000AE80 000A 1800 00               		dc.b 0,	$A, $18, 0, 0
0000AE85 04                         @check1:	dc.b 4
0000AE86 E80A 0009 E8               		dc.b $E8, $A, 0, 9, $E8
0000AE8B E80A 0809 00               		dc.b $E8, $A, 8, 9, 0
0000AE90 000A 1009 E8               		dc.b 0,	$A, $10, 9, $E8
0000AE95 000A 1809 00               		dc.b 0,	$A, $18, 9, 0
0000AE9A 04                         @check2:	dc.b 4
0000AE9B E80A 0012 E8               		dc.b $E8, $A, 0, $12, $E8
0000AEA0 E80A 001B 00               		dc.b $E8, $A, 0, $1B, 0
0000AEA5 000A 181B E8               		dc.b 0,	$A, $18, $1B, $E8
0000AEAA 000A 1812 00               		dc.b 0,	$A, $18, $12, 0
0000AEAF 04                         @check3:	dc.b 4
0000AEB0 E80A 081B E8               		dc.b $E8, $A, 8, $1B, $E8
0000AEB5 E80A 0812 00               		dc.b $E8, $A, 8, $12, 0
0000AEBA 000A 1012 E8               		dc.b 0,	$A, $10, $12, $E8
0000AEBF 000A 101B 00               		dc.b 0,	$A, $10, $1B, 0
0000AEC4                            		even
0000AEC4                            		even
0000AEC4                            		include	"_incObj\1A Collapsing Ledge (part 1).asm"
0000AEC4                            ; ---------------------------------------------------------------------------
0000AEC4                            ; Object 1A - GHZ collapsing ledge
0000AEC4                            ; ---------------------------------------------------------------------------
0000AEC4                            
0000AEC4                            CollapseLedge:
0000AEC4 7000                       		moveq	#0,d0
0000AEC6 1028 0024                  		move.b	obRoutine(a0),d0
0000AECA 323B 0000                  		move.w	Ledge_Index(pc,d0.w),d1
0000AECE 4EFB 1000                  		jmp	Ledge_Index(pc,d1.w)
0000AED2                            ; ===========================================================================
0000AED2 0000 0000                  Ledge_Index:	dc.w Ledge_Main-Ledge_Index, Ledge_Touch-Ledge_Index
0000AED6 0000 0000                  		dc.w Ledge_Collapse-Ledge_Index, Ledge_Display-Ledge_Index
0000AEDA 0000 0000                  		dc.w Ledge_Delete-Ledge_Index, Ledge_WalkOff-Ledge_Index
0000AEDE                            
0000AEDE =00000038                  ledge_timedelay:	equ $38		; time between touching the ledge and it collapsing
0000AEDE =0000003A                  ledge_collapse_flag:	equ $3A		; collapse flag
0000AEDE                            ; ===========================================================================
0000AEDE                            
0000AEDE                            Ledge_Main:	; Routine 0
0000AEDE 5428 0024                  		addq.b	#2,obRoutine(a0)
0000AEE2 217C 0000 0000 0004        		move.l	#Map_Ledge,obMap(a0)
0000AEEA 317C 4000 0002             		move.w	#$4000,obGfx(a0)
0000AEF0 0028 0004 0001             		ori.b	#4,obRender(a0)
0000AEF6 117C 0004 0018             		move.b	#4,obPriority(a0)
0000AEFC 117C 0007 0038             		move.b	#7,ledge_timedelay(a0) ; set time delay for collapse
0000AF02 117C 0064 0019             		move.b	#$64,obActWid(a0)
0000AF08 1168 0028 001A             		move.b	obSubtype(a0),obFrame(a0)
0000AF0E 117C 0038 0016             		move.b	#$38,obHeight(a0)
0000AF14 08E8 0004 0001             		bset	#4,obRender(a0)
0000AF1A                            
0000AF1A                            Ledge_Touch:	; Routine 2
0000AF1A 4A28 003A                  		tst.b	ledge_collapse_flag(a0)	; is ledge collapsing?
0000AF1E 6700                       		beq.s	@slope		; if not, branch
0000AF20 4A28 0038                  		tst.b	ledge_timedelay(a0)	; has time reached zero?
0000AF24 6700 0000                  		beq.w	Ledge_Fragment	; if yes, branch
0000AF28 5328 0038                  		subq.b	#1,ledge_timedelay(a0) ; subtract 1 from time
0000AF2C                            
0000AF2C                            	@slope:
0000AF2C 323C 0030                  		move.w	#$30,d1
0000AF30 45F9 0000 0000             		lea	(Ledge_SlopeData).l,a2
0000AF36 6100 F008                  		bsr.w	SlopeObject
0000AF3A 6000 0000                  		bra.w	RememberState
0000AF3E                            ; ===========================================================================
0000AF3E                            
0000AF3E                            Ledge_Collapse:	; Routine 4
0000AF3E 4A28 0038                  		tst.b	ledge_timedelay(a0)
0000AF42 6700 0000                  		beq.w	loc_847A
0000AF46 117C 0001 003A             		move.b	#1,ledge_collapse_flag(a0)	; set collapse flag
0000AF4C 5328 0038                  		subq.b	#1,ledge_timedelay(a0)
0000AF50                            
0000AF50                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
0000AF50                            
0000AF50                            
0000AF50                            Ledge_WalkOff:	; Routine $A
0000AF50 323C 0030                  		move.w	#$30,d1
0000AF54 6100 F08A                  		bsr.w	ExitPlatform
0000AF58 323C 0030                  		move.w	#$30,d1
0000AF5C 45F9 0000 0000             		lea	(Ledge_SlopeData).l,a2
0000AF62 3428 0008                  		move.w	obX(a0),d2
0000AF66 6100 0000                  		bsr.w	SlopeObject2
0000AF6A 6000 0000                  		bra.w	RememberState
0000AF6E                            ; End of function Ledge_WalkOff
0000AF6E                            
0000AF6E                            ; ===========================================================================
0000AF6E                            
0000AF6E                            Ledge_Display:	; Routine 6
0000AF6E 4A28 0038                  		tst.b	ledge_timedelay(a0)	; has time delay reached zero?
0000AF72 6700                       		beq.s	Ledge_TimeZero	; if yes, branch
0000AF74 4A28 003A                  		tst.b	ledge_collapse_flag(a0)	; is ledge collapsing?
0000AF78 6600 0000                  		bne.w	loc_82D0	; if yes, branch
0000AF7C 5328 0038                  		subq.b	#1,ledge_timedelay(a0) ; subtract 1 from time
0000AF80 6000 0000                  		bra.w	DisplaySprite
0000AF84                            ; ===========================================================================
0000AF84                            
0000AF84                            loc_82D0:
0000AF84 5328 0038                  		subq.b	#1,ledge_timedelay(a0)
0000AF88 6100 FFC6                  		bsr.w	Ledge_WalkOff
0000AF8C 43F8 D000                  		lea	(v_player).w,a1
0000AF90 0829 0003 0022             		btst	#3,obStatus(a1)
0000AF96 6700                       		beq.s	loc_82FC
0000AF98 4A28 0038                  		tst.b	ledge_timedelay(a0)
0000AF9C 6600                       		bne.s	locret_8308
0000AF9E 08A9 0003 0022             		bclr	#3,obStatus(a1)
0000AFA4 08A9 0005 0022             		bclr	#5,obStatus(a1)
0000AFAA 137C 0001 001D             		move.b	#1,obNextAni(a1)
0000AFB0                            
0000AFB0                            loc_82FC:
0000AFB0 117C 0000 003A             		move.b	#0,ledge_collapse_flag(a0)
0000AFB6 117C 0006 0024             		move.b	#6,obRoutine(a0) ; run "Ledge_Display" routine
0000AFBC                            
0000AFBC                            locret_8308:
0000AFBC 4E75                       		rts	
0000AFBE                            ; ===========================================================================
0000AFBE                            
0000AFBE                            Ledge_TimeZero:
0000AFBE 6100 0000                  		bsr.w	ObjectFall
0000AFC2 6100 0000                  		bsr.w	DisplaySprite
0000AFC6 4A28 0001                  		tst.b	obRender(a0)
0000AFCA 6A00                       		bpl.s	Ledge_Delete
0000AFCC 4E75                       		rts	
0000AFCE                            ; ===========================================================================
0000AFCE                            
0000AFCE                            Ledge_Delete:	; Routine 8
0000AFCE 6100 0000                  		bsr.w	DeleteObject
0000AFD2 4E75                       		rts	
0000AFD2 4E75                       		rts	
0000AFD4                            		include	"_incObj\53 Collapsing Floors.asm"
0000AFD4                            ; ---------------------------------------------------------------------------
0000AFD4                            ; Object 53 - collapsing floors	(MZ, SLZ, SBZ)
0000AFD4                            ; ---------------------------------------------------------------------------
0000AFD4                            
0000AFD4                            CollapseFloor:
0000AFD4 7000                       		moveq	#0,d0
0000AFD6 1028 0024                  		move.b	obRoutine(a0),d0
0000AFDA 323B 0000                  		move.w	CFlo_Index(pc,d0.w),d1
0000AFDE 4EFB 1000                  		jmp	CFlo_Index(pc,d1.w)
0000AFE2                            ; ===========================================================================
0000AFE2 0000 0000                  CFlo_Index:	dc.w CFlo_Main-CFlo_Index, CFlo_Touch-CFlo_Index
0000AFE6 0000 0000                  		dc.w CFlo_Collapse-CFlo_Index, CFlo_Display-CFlo_Index
0000AFEA 0000 0000                  		dc.w CFlo_Delete-CFlo_Index, CFlo_WalkOff-CFlo_Index
0000AFEE                            
0000AFEE =00000038                  cflo_timedelay:		equ $38
0000AFEE =0000003A                  cflo_collapse_flag:	equ $3A
0000AFEE                            ; ===========================================================================
0000AFEE                            
0000AFEE                            CFlo_Main:	; Routine 0
0000AFEE 5428 0024                  		addq.b	#2,obRoutine(a0)
0000AFF2 217C 0000 0000 0004        		move.l	#Map_CFlo,obMap(a0)
0000AFFA 317C 42B8 0002             		move.w	#$42B8,obGfx(a0)
0000B000 0C38 0003 FE10             		cmpi.b	#id_SLZ,(v_zone).w ; check if level is SLZ
0000B006 6600                       		bne.s	@notSLZ
0000B008                            
0000B008 317C 44E0 0002             		move.w	#$44E0,obGfx(a0) ; SLZ specific code
0000B00E 5428 001A                  		addq.b	#2,obFrame(a0)
0000B012                            
0000B012                            	@notSLZ:
0000B012 0C38 0005 FE10             		cmpi.b	#id_CWZ,(v_zone).w ; check if level is SBZ
0000B018 6600                       		bne.s	@notSBZ
0000B01A 317C 43F5 0002             		move.w	#$43F5,obGfx(a0) ; SBZ specific code
0000B020                            
0000B020                            	@notSBZ:
0000B020 0028 0004 0001             		ori.b	#4,obRender(a0)
0000B026 117C 0004 0018             		move.b	#4,obPriority(a0)
0000B02C 117C 0007 0038             		move.b	#7,cflo_timedelay(a0)
0000B032 117C 0044 0019             		move.b	#$44,obActWid(a0)
0000B038                            
0000B038                            CFlo_Touch:	; Routine 2
0000B038 4A28 003A                  		tst.b	cflo_collapse_flag(a0)	; has Sonic touched the	object?
0000B03C 6700                       		beq.s	@solid		; if not, branch
0000B03E 4A28 0038                  		tst.b	cflo_timedelay(a0)	; has time delay reached zero?
0000B042 6700 0000                  		beq.w	CFlo_Fragment	; if yes, branch
0000B046 5328 0038                  		subq.b	#1,cflo_timedelay(a0) ; subtract 1 from time
0000B04A                            
0000B04A                            	@solid:
0000B04A 323C 0020                  		move.w	#$20,d1
0000B04E 6100 EE1C                  		bsr.w	PlatformObject
0000B052 4A28 0028                  		tst.b	obSubtype(a0)
0000B056 6A00                       		bpl.s	@remstate
0000B058 0829 0003 0022             		btst	#3,obStatus(a1)
0000B05E 6700                       		beq.s	@remstate
0000B060 08A8 0000 0001             		bclr	#0,obRender(a0)
0000B066 3029 0008                  		move.w	obX(a1),d0
0000B06A 9068 0008                  		sub.w	obX(a0),d0
0000B06E 6400                       		bcc.s	@remstate
0000B070 08E8 0000 0001             		bset	#0,obRender(a0)
0000B076                            
0000B076                            	@remstate:
0000B076 6000 0000                  		bra.w	RememberState
0000B07A                            ; ===========================================================================
0000B07A                            
0000B07A                            CFlo_Collapse:	; Routine 4
0000B07A 4A28 0038                  		tst.b	cflo_timedelay(a0)
0000B07E 6700 0000                  		beq.w	loc_8458
0000B082 117C 0001 003A             		move.b	#1,cflo_collapse_flag(a0)	; set object as	"touched"
0000B088 5328 0038                  		subq.b	#1,cflo_timedelay(a0)
0000B08C                            
0000B08C                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
0000B08C                            
0000B08C                            
0000B08C                            CFlo_WalkOff:	; Routine $A
0000B08C 323C 0020                  		move.w	#$20,d1
0000B090 6100 EF4E                  		bsr.w	ExitPlatform
0000B094 3428 0008                  		move.w	obX(a0),d2
0000B098 6100 F4B4                  		bsr.w	MvSonicOnPtfm2
0000B09C 6000 0000                  		bra.w	RememberState
0000B0A0                            ; End of function CFlo_WalkOff
0000B0A0                            
0000B0A0                            ; ===========================================================================
0000B0A0                            
0000B0A0                            CFlo_Display:	; Routine 6
0000B0A0 4A28 0038                  		tst.b	cflo_timedelay(a0)	; has time delay reached zero?
0000B0A4 6700                       		beq.s	CFlo_TimeZero	; if yes, branch
0000B0A6 4A28 003A                  		tst.b	cflo_collapse_flag(a0)	; has Sonic touched the	object?
0000B0AA 6600 0000                  		bne.w	loc_8402	; if yes, branch
0000B0AE 5328 0038                  		subq.b	#1,cflo_timedelay(a0); subtract 1 from time
0000B0B2 6000 0000                  		bra.w	DisplaySprite
0000B0B6                            ; ===========================================================================
0000B0B6                            
0000B0B6                            loc_8402:
0000B0B6 5328 0038                  		subq.b	#1,cflo_timedelay(a0)
0000B0BA 6100 FFD0                  		bsr.w	CFlo_WalkOff
0000B0BE 43F8 D000                  		lea	(v_player).w,a1
0000B0C2 0829 0003 0022             		btst	#3,obStatus(a1)
0000B0C8 6700                       		beq.s	loc_842E
0000B0CA 4A28 0038                  		tst.b	cflo_timedelay(a0)
0000B0CE 6600                       		bne.s	locret_843A
0000B0D0 08A9 0003 0022             		bclr	#3,obStatus(a1)
0000B0D6 08A9 0005 0022             		bclr	#5,obStatus(a1)
0000B0DC 137C 0001 001D             		move.b	#1,obNextAni(a1)
0000B0E2                            
0000B0E2                            loc_842E:
0000B0E2 117C 0000 003A             		move.b	#0,cflo_collapse_flag(a0)
0000B0E8 117C 0006 0024             		move.b	#6,obRoutine(a0) ; run "CFlo_Display" routine
0000B0EE                            
0000B0EE                            locret_843A:
0000B0EE 4E75                       		rts	
0000B0F0                            ; ===========================================================================
0000B0F0                            
0000B0F0                            CFlo_TimeZero:
0000B0F0 6100 0000                  		bsr.w	ObjectFall
0000B0F4 6100 0000                  		bsr.w	DisplaySprite
0000B0F8 4A28 0001                  		tst.b	obRender(a0)
0000B0FC 6A00                       		bpl.s	CFlo_Delete
0000B0FE 4E75                       		rts	
0000B100                            ; ===========================================================================
0000B100                            
0000B100                            CFlo_Delete:	; Routine 8
0000B100 6100 0000                  		bsr.w	DeleteObject
0000B104 4E75                       		rts	
0000B106                            ; ===========================================================================
0000B106                            
0000B106                            CFlo_Fragment:
0000B106 117C 0000 003A             		move.b	#0,cflo_collapse_flag(a0)
0000B10C                            
0000B10C                            loc_8458:
0000B10C 49F9 0000 0000             		lea	(CFlo_Data2).l,a4
0000B112 0828 0000 0028             		btst	#0,obSubtype(a0)
0000B118 6700                       		beq.s	loc_846C
0000B11A 49F9 0000 0000             		lea	(CFlo_Data3).l,a4
0000B120                            
0000B120                            loc_846C:
0000B120 7207                       		moveq	#7,d1
0000B122 5228 001A                  		addq.b	#1,obFrame(a0)
0000B126 6000                       		bra.s	loc_8486
0000B126 6000                       		bra.s	loc_8486
0000B128                            
0000B128                            ; ===========================================================================
0000B128                            
0000B128                            Ledge_Fragment:
0000B128 117C 0000 003A             		move.b	#0,ledge_collapse_flag(a0)
0000B12E                            
0000B12E                            loc_847A:
0000B12E 49F9 0000 0000             		lea	(CFlo_Data1).l,a4
0000B134 7218                       		moveq	#$18,d1
0000B136 5428 001A                  		addq.b	#2,obFrame(a0)
0000B13A                            
0000B13A                            loc_8486:
0000B13A 7000                       		moveq	#0,d0
0000B13C 1028 001A                  		move.b	obFrame(a0),d0
0000B140 D040                       		add.w	d0,d0
0000B142 2668 0004                  		movea.l	obMap(a0),a3
0000B146 D6F3 0000                  		adda.w	(a3,d0.w),a3
0000B14A 524B                       		addq.w	#1,a3
0000B14C 08E8 0005 0001             		bset	#5,obRender(a0)
0000B152 1828 0000                  		move.b	0(a0),d4
0000B156 1A28 0001                  		move.b	obRender(a0),d5
0000B15A 2248                       		movea.l	a0,a1
0000B15C 6000                       		bra.s	loc_84B2
0000B15E                            ; ===========================================================================
0000B15E                            
0000B15E                            loc_84AA:
0000B15E 6100 0000                  		bsr.w	FindFreeObj
0000B162 6600                       		bne.s	loc_84F2
0000B164 5A4B                       		addq.w	#5,a3
0000B166                            
0000B166                            loc_84B2:
0000B166 137C 0006 0024             		move.b	#6,obRoutine(a1)
0000B16C 1344 0000                  		move.b	d4,0(a1)
0000B170 234B 0004                  		move.l	a3,obMap(a1)
0000B174 1345 0001                  		move.b	d5,obRender(a1)
0000B178 3368 0008 0008             		move.w	obX(a0),obX(a1)
0000B17E 3368 000C 000C             		move.w	obY(a0),obY(a1)
0000B184 3368 0002 0002             		move.w	obGfx(a0),obGfx(a1)
0000B18A 1368 0018 0018             		move.b	obPriority(a0),obPriority(a1)
0000B190 1368 0019 0019             		move.b	obActWid(a0),obActWid(a1)
0000B196 135C 0038                  		move.b	(a4)+,ledge_timedelay(a1)
0000B19A B3C8                       		cmpa.l	a0,a1
0000B19C 6400                       		bhs.s	loc_84EE
0000B19E 6100 0000                  		bsr.w	DisplaySprite1
0000B1A2                            
0000B1A2                            loc_84EE:
0000B1A2 51C9 FFBA                  		dbf	d1,loc_84AA
0000B1A6                            
0000B1A6                            loc_84F2:
0000B1A6 6100 0000                  		bsr.w	DisplaySprite
0000B1B4                            ; ===========================================================================
0000B1B4                            ; ---------------------------------------------------------------------------
0000B1B4                            ; Disintegration data for collapsing ledges (MZ, SLZ, SBZ)
0000B1B4                            ; ---------------------------------------------------------------------------
0000B1B4 1C18 1410 1A16 120E 0A06+  CFlo_Data1:	dc.b $1C, $18, $14, $10, $1A, $16, $12,	$E, $A,	6, $18,	$14, $10, $C, 8, 4
0000B1C4 1612 0E0A 0602 1410 0C00   		dc.b $16, $12, $E, $A, 6, 2, $14, $10, $C, 0
0000B1CE 1E16 0E06 1A12 0A02        CFlo_Data2:	dc.b $1E, $16, $E, 6, $1A, $12,	$A, 2
0000B1D6 161E 1A12 060E 0A02        CFlo_Data3:	dc.b $16, $1E, $1A, $12, 6, $E,	$A, 2
0000B1DE                            
0000B1DE                            ; ---------------------------------------------------------------------------
0000B1DE                            ; Sloped platform subroutine (GHZ collapsing ledges and	MZ platforms)
0000B1DE                            ; ---------------------------------------------------------------------------
0000B1DE                            
0000B1DE                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
0000B1DE                            
0000B1DE                            
0000B1DE                            SlopeObject2:
0000B1DE 43F8 D000                  		lea	(v_player).w,a1
0000B1E2 0829 0003 0022             		btst	#3,obStatus(a1)
0000B1E8 6700                       		beq.s	locret_856E
0000B1EA 3029 0008                  		move.w	obX(a1),d0
0000B1EE 9068 0008                  		sub.w	obX(a0),d0
0000B1F2 D041                       		add.w	d1,d0
0000B1F4 E248                       		lsr.w	#1,d0
0000B1F6 0828 0000 0001             		btst	#0,obRender(a0)
0000B1FC 6700                       		beq.s	loc_854E
0000B1FE 4640                       		not.w	d0
0000B200 D041                       		add.w	d1,d0
0000B202                            
0000B202                            loc_854E:
0000B202 7200                       		moveq	#0,d1
0000B204 1232 0000                  		move.b	(a2,d0.w),d1
0000B208 3028 000C                  		move.w	obY(a0),d0
0000B20C 9041                       		sub.w	d1,d0
0000B20E 7200                       		moveq	#0,d1
0000B210 1229 0016                  		move.b	obHeight(a1),d1
0000B214 9041                       		sub.w	d1,d0
0000B216 3340 000C                  		move.w	d0,obY(a1)
0000B21A 9468 0008                  		sub.w	obX(a0),d2
0000B21E 9569 0008                  		sub.w	d2,obX(a1)
0000B222                            
0000B222                            locret_856E:
0000B222 4E75                       		rts	
0000B224                            ; End of function SlopeObject2
0000B224                            
0000B224                            ; ===========================================================================
0000B224                            ; ---------------------------------------------------------------------------
0000B224                            ; Collision data for GHZ collapsing ledge
0000B224                            ; ---------------------------------------------------------------------------
0000B224                            Ledge_SlopeData:
0000B224                            		incbin	"misc\GHZ Collapsing Ledge Heightmap.bin"
0000B254                            		even
0000B254                            
0000B254                            Map_Ledge:	include	"_maps\Collapsing Ledge.asm"
0000B254                            ; ---------------------------------------------------------------------------
0000B254                            ; Sprite mappings - GHZ	collapsing ledge
0000B254                            ; ---------------------------------------------------------------------------
0000B254                            Map_Ledge_internal:
0000B254 0000                       		dc.w @left-Map_Ledge_internal
0000B256 0000                       		dc.w @right-Map_Ledge_internal
0000B258 0000                       		dc.w @leftsmash-Map_Ledge_internal
0000B25A 0000                       		dc.w @rightsmash-Map_Ledge_internal
0000B25C 10                         @left:		dc.b $10
0000B25D C80E 0057 10               		dc.b $C8, $E, 0, $57, $10 ; ledge facing left
0000B262 D00D 0063 F0               		dc.b $D0, $D, 0, $63, $F0
0000B267 E00D 006B 10               		dc.b $E0, $D, 0, $6B, $10
0000B26C E00D 0073 F0               		dc.b $E0, $D, 0, $73, $F0
0000B271 D806 007B E0               		dc.b $D8, 6, 0,	$7B, $E0
0000B276 D806 0081 D0               		dc.b $D8, 6, 0,	$81, $D0
0000B27B F00D 0087 10               		dc.b $F0, $D, 0, $87, $10
0000B280 F00D 008F F0               		dc.b $F0, $D, 0, $8F, $F0
0000B285 F005 0097 E0               		dc.b $F0, 5, 0,	$97, $E0
0000B28A F005 009B D0               		dc.b $F0, 5, 0,	$9B, $D0
0000B28F 000D 009F 10               		dc.b 0,	$D, 0, $9F, $10
0000B294 0005 00A7 00               		dc.b 0,	5, 0, $A7, 0
0000B299 000D 00AB E0               		dc.b 0,	$D, 0, $AB, $E0
0000B29E 0005 00B3 D0               		dc.b 0,	5, 0, $B3, $D0
0000B2A3 100D 00AB 10               		dc.b $10, $D, 0, $AB, $10
0000B2A8 1005 00B7 00               		dc.b $10, 5, 0,	$B7, 0
0000B2AD 10                         @right:		dc.b $10
0000B2AE C80E 0057 10               		dc.b $C8, $E, 0, $57, $10 ; ledge facing right
0000B2B3 D00D 0063 F0               		dc.b $D0, $D, 0, $63, $F0
0000B2B8 E00D 006B 10               		dc.b $E0, $D, 0, $6B, $10
0000B2BD E00D 0073 F0               		dc.b $E0, $D, 0, $73, $F0
0000B2C2 D806 007B E0               		dc.b $D8, 6, 0,	$7B, $E0
0000B2C7 D806 00BB D0               		dc.b $D8, 6, 0,	$BB, $D0
0000B2CC F00D 0087 10               		dc.b $F0, $D, 0, $87, $10
0000B2D1 F00D 008F F0               		dc.b $F0, $D, 0, $8F, $F0
0000B2D6 F005 0097 E0               		dc.b $F0, 5, 0,	$97, $E0
0000B2DB F005 00C1 D0               		dc.b $F0, 5, 0,	$C1, $D0
0000B2E0 000D 009F 10               		dc.b 0,	$D, 0, $9F, $10
0000B2E5 0005 00A7 00               		dc.b 0,	5, 0, $A7, 0
0000B2EA 000D 00AB E0               		dc.b 0,	$D, 0, $AB, $E0
0000B2EF 0005 00B7 D0               		dc.b 0,	5, 0, $B7, $D0
0000B2F4 100D 00AB 10               		dc.b $10, $D, 0, $AB, $10
0000B2F9 1005 00B7 00               		dc.b $10, 5, 0,	$B7, 0
0000B2FE 19                         @leftsmash:	dc.b $19
0000B2FF C806 005D 20               		dc.b $C8, 6, 0,	$5D, $20 ; ledge facing	left in	pieces
0000B304 C806 0057 10               		dc.b $C8, 6, 0,	$57, $10
0000B309 D005 0067 00               		dc.b $D0, 5, 0,	$67, 0
0000B30E D005 0063 F0               		dc.b $D0, 5, 0,	$63, $F0
0000B313 E005 006F 20               		dc.b $E0, 5, 0,	$6F, $20
0000B318 E005 006B 10               		dc.b $E0, 5, 0,	$6B, $10
0000B31D E005 0077 00               		dc.b $E0, 5, 0,	$77, 0
0000B322 E005 0073 F0               		dc.b $E0, 5, 0,	$73, $F0
0000B327 D806 007B E0               		dc.b $D8, 6, 0,	$7B, $E0
0000B32C D806 0081 D0               		dc.b $D8, 6, 0,	$81, $D0
0000B331 F005 008B 20               		dc.b $F0, 5, 0,	$8B, $20
0000B336 F005 0087 10               		dc.b $F0, 5, 0,	$87, $10
0000B33B F005 0093 00               		dc.b $F0, 5, 0,	$93, 0
0000B340 F005 008F F0               		dc.b $F0, 5, 0,	$8F, $F0
0000B345 F005 0097 E0               		dc.b $F0, 5, 0,	$97, $E0
0000B34A F005 009B D0               		dc.b $F0, 5, 0,	$9B, $D0
0000B34F 0005 008B 20               		dc.b 0,	5, 0, $8B, $20
0000B354 0005 008B 10               		dc.b 0,	5, 0, $8B, $10
0000B359 0005 00A7 00               		dc.b 0,	5, 0, $A7, 0
0000B35E 0005 00AB F0               		dc.b 0,	5, 0, $AB, $F0
0000B363 0005 00AB E0               		dc.b 0,	5, 0, $AB, $E0
0000B368 0005 00B3 D0               		dc.b 0,	5, 0, $B3, $D0
0000B36D 1005 00AB 20               		dc.b $10, 5, 0,	$AB, $20
0000B372 1005 00AB 10               		dc.b $10, 5, 0,	$AB, $10
0000B377 1005 00B7 00               		dc.b $10, 5, 0,	$B7, 0
0000B37C 19                         @rightsmash:	dc.b $19
0000B37D C806 005D 20               		dc.b $C8, 6, 0,	$5D, $20 ; ledge facing	right in pieces
0000B382 C806 0057 10               		dc.b $C8, 6, 0,	$57, $10
0000B387 D005 0067 00               		dc.b $D0, 5, 0,	$67, 0
0000B38C D005 0063 F0               		dc.b $D0, 5, 0,	$63, $F0
0000B391 E005 006F 20               		dc.b $E0, 5, 0,	$6F, $20
0000B396 E005 006B 10               		dc.b $E0, 5, 0,	$6B, $10
0000B39B E005 0077 00               		dc.b $E0, 5, 0,	$77, 0
0000B3A0 E005 0073 F0               		dc.b $E0, 5, 0,	$73, $F0
0000B3A5 D806 007B E0               		dc.b $D8, 6, 0,	$7B, $E0
0000B3AA D806 00BB D0               		dc.b $D8, 6, 0,	$BB, $D0
0000B3AF F005 008B 20               		dc.b $F0, 5, 0,	$8B, $20
0000B3B4 F005 0087 10               		dc.b $F0, 5, 0,	$87, $10
0000B3B9 F005 0093 00               		dc.b $F0, 5, 0,	$93, 0
0000B3BE F005 008F F0               		dc.b $F0, 5, 0,	$8F, $F0
0000B3C3 F005 0097 E0               		dc.b $F0, 5, 0,	$97, $E0
0000B3C8 F005 00C1 D0               		dc.b $F0, 5, 0,	$C1, $D0
0000B3CD 0005 008B 20               		dc.b 0,	5, 0, $8B, $20
0000B3D2 0005 008B 10               		dc.b 0,	5, 0, $8B, $10
0000B3D7 0005 00A7 00               		dc.b 0,	5, 0, $A7, 0
0000B3DC 0005 00AB F0               		dc.b 0,	5, 0, $AB, $F0
0000B3E1 0005 00AB E0               		dc.b 0,	5, 0, $AB, $E0
0000B3E6 0005 00B7 D0               		dc.b 0,	5, 0, $B7, $D0
0000B3EB 1005 00AB 20               		dc.b $10, 5, 0,	$AB, $20
0000B3F0 1005 00AB 10               		dc.b $10, 5, 0,	$AB, $10
0000B3F5 1005 00B7 00               		dc.b $10, 5, 0,	$B7, 0
0000B3FA                            		even
0000B3FA                            		even
0000B3FA                            Map_CFlo:	include	"_maps\Collapsing Floors.asm"
0000B3FA                            ; ---------------------------------------------------------------------------
0000B3FA                            ; Sprite mappings - collapsing floors (MZ, SLZ,	SBZ)
0000B3FA                            ; ---------------------------------------------------------------------------
0000B3FA                            Map_CFlo_internal:
0000B3FA 0000                       		dc.w byte_874E-Map_CFlo_internal
0000B3FC 0000                       		dc.w byte_8763-Map_CFlo_internal
0000B3FE 0000                       		dc.w byte_878C-Map_CFlo_internal
0000B400 0000                       		dc.w byte_87A1-Map_CFlo_internal
0000B402 04                         byte_874E:	dc.b 4
0000B403 F80D 0000 E0               		dc.b $F8, $D, 0, 0, $E0	; MZ and SBZ blocks
0000B408 080D 0000 E0               		dc.b 8,	$D, 0, 0, $E0
0000B40D F80D 0000 00               		dc.b $F8, $D, 0, 0, 0
0000B412 080D 0000 00               		dc.b 8,	$D, 0, 0, 0
0000B417 08                         byte_8763:	dc.b 8
0000B418 F805 0000 E0               		dc.b $F8, 5, 0,	0, $E0
0000B41D F805 0000 F0               		dc.b $F8, 5, 0,	0, $F0
0000B422 F805 0000 00               		dc.b $F8, 5, 0,	0, 0
0000B427 F805 0000 10               		dc.b $F8, 5, 0,	0, $10
0000B42C 0805 0000 E0               		dc.b 8,	5, 0, 0, $E0
0000B431 0805 0000 F0               		dc.b 8,	5, 0, 0, $F0
0000B436 0805 0000 00               		dc.b 8,	5, 0, 0, 0
0000B43B 0805 0000 10               		dc.b 8,	5, 0, 0, $10
0000B440 04                         byte_878C:	dc.b 4
0000B441 F80D 0000 E0               		dc.b $F8, $D, 0, 0, $E0	; SLZ blocks
0000B446 080D 0008 E0               		dc.b 8,	$D, 0, 8, $E0
0000B44B F80D 0000 00               		dc.b $F8, $D, 0, 0, 0
0000B450 080D 0008 00               		dc.b 8,	$D, 0, 8, 0
0000B455 08                         byte_87A1:	dc.b 8
0000B456 F805 0000 E0               		dc.b $F8, 5, 0,	0, $E0
0000B45B F805 0004 F0               		dc.b $F8, 5, 0,	4, $F0
0000B460 F805 0000 00               		dc.b $F8, 5, 0,	0, 0
0000B465 F805 0004 10               		dc.b $F8, 5, 0,	4, $10
0000B46A 0805 0008 E0               		dc.b 8,	5, 0, 8, $E0
0000B46F 0805 000C F0               		dc.b 8,	5, 0, $C, $F0
0000B474 0805 0008 00               		dc.b 8,	5, 0, 8, 0
0000B479 0805 000C 10               		dc.b 8,	5, 0, $C, $10
0000B47E                            		even
0000B47E                            		even
0000B47E                            
0000B47E                            		include	"_incObj\1C Scenery.asm"
0000B47E                            ; ---------------------------------------------------------------------------
0000B47E                            ; Object 1C - scenery (GHZ bridge stump, SLZ lava thrower)
0000B47E                            ; ---------------------------------------------------------------------------
0000B47E                            
0000B47E                            Scenery:
0000B47E 7000                       		moveq	#0,d0
0000B480 1028 0024                  		move.b	obRoutine(a0),d0
0000B484 323B 0000                  		move.w	Scen_Index(pc,d0.w),d1
0000B488 4EFB 1000                  		jmp	Scen_Index(pc,d1.w)
0000B48C                            ; ===========================================================================
0000B48C 0000                       Scen_Index:	dc.w Scen_Main-Scen_Index
0000B48E 0000                       		dc.w Scen_ChkDel-Scen_Index
0000B490                            ; ===========================================================================
0000B490                            
0000B490                            Scen_Main:	; Routine 0
0000B490 5428 0024                  		addq.b	#2,obRoutine(a0)
0000B494 7000                       		moveq	#0,d0
0000B496 1028 0028                  		move.b	obSubtype(a0),d0 ; copy object subtype to d0
0000B49A C0FC 000A                  		mulu.w	#$A,d0		; multiply by $A
0000B49E 43FB 0000                  		lea	Scen_Values(pc,d0.w),a1
0000B4A2 2159 0004                  		move.l	(a1)+,obMap(a0)
0000B4A6 3159 0002                  		move.w	(a1)+,obGfx(a0)
0000B4AA 0028 0004 0001             		ori.b	#4,obRender(a0)
0000B4B0 1159 001A                  		move.b	(a1)+,obFrame(a0)
0000B4B4 1159 0019                  		move.b	(a1)+,obActWid(a0)
0000B4B8 1159 0018                  		move.b	(a1)+,obPriority(a0)
0000B4BC 1159 0020                  		move.b	(a1)+,obColType(a0)
0000B4C0                            
0000B4C0                            Scen_ChkDel:	; Routine 2
0000B4DE 6000 0000                  		bra.w	DisplaySprite
0000B4E2                            ; ===========================================================================
0000B4E2                            ; ---------------------------------------------------------------------------
0000B4E2                            ; Variables for	object $1C are stored in an array
0000B4E2                            ; ---------------------------------------------------------------------------
0000B4E2 0000 0000                  Scen_Values:	dc.l Map_Scen		; mappings address
0000B4E6 44D8                       		dc.w $44D8		; VRAM setting
0000B4E8 0008 0200                  		dc.b 0,	8, 2, 0		; frame, width,	priority, collision response
0000B4EC 0000 0000                  		dc.l Map_Scen
0000B4F0 44D8                       		dc.w $44D8
0000B4F2 0008 0200                  		dc.b 0,	8, 2, 0
0000B4F6 0000 0000                  		dc.l Map_Scen
0000B4FA 44D8                       		dc.w $44D8
0000B4FC 0008 0200                  		dc.b 0,	8, 2, 0
0000B500 0000 A354                  		dc.l Map_Bri
0000B504 438E                       		dc.w $438E
0000B506 0110 0100                  		dc.b 1,	$10, 1,	0
0000B50A                            		even
0000B50A                            		even
0000B50A                            Map_Scen:	include	"_maps\Scenery.asm"
0000B50A                            ; ---------------------------------------------------------------------------
0000B50A                            ; Sprite mappings - SLZ	lava thrower
0000B50A                            ; ---------------------------------------------------------------------------
0000B50A                            Map_Scen_internal:
0000B50A 0000                       		dc.w byte_8858-Map_Scen_internal
0000B50C 01                         byte_8858:	dc.b 1
0000B50D F007 0000 F8               		dc.b $F0, 7, 0,	0, $F8
0000B512                            		even
0000B512                            		even
0000B512                            
0000B512                            		include	"_incObj\1D Unused Switch.asm"
0000B512                            ; ---------------------------------------------------------------------------
0000B512                            ; Object 1D - switch that activates when Sonic touches it
0000B512                            ; (this	is not used anywhere in	the game)
0000B512                            ; ---------------------------------------------------------------------------
0000B512                            
0000B512                            MagicSwitch:
0000B512 7000                       		moveq	#0,d0
0000B514 1028 0024                  		move.b	obRoutine(a0),d0
0000B518 323B 0000                  		move.w	Swi_Index(pc,d0.w),d1
0000B51C 4EFB 1000                  		jmp	Swi_Index(pc,d1.w)
0000B520                            ; ===========================================================================
0000B520 0000                       Swi_Index:	dc.w Swi_Main-Swi_Index
0000B522 0000                       		dc.w Swi_Action-Swi_Index
0000B524 0000                       		dc.w Swi_Delete-Swi_Index
0000B526                            
0000B526 =00000030                  swi_origY:	equ $30		; original y-axis position
0000B526                            ; ===========================================================================
0000B526                            
0000B526                            Swi_Main:	; Routine 0
0000B526 5428 0024                  		addq.b	#2,obRoutine(a0)
0000B52A 217C 0000 0000 0004        		move.l	#Map_Swi,obMap(a0)
0000B532 317C 4000 0002             		move.w	#$4000,obGfx(a0)
0000B538 117C 0004 0001             		move.b	#4,obRender(a0)
0000B53E 3168 000C 0030             		move.w	obY(a0),swi_origY(a0) ; save position on y-axis
0000B544 117C 0010 0019             		move.b	#$10,obActWid(a0)
0000B54A 117C 0005 0018             		move.b	#5,obPriority(a0)
0000B550                            
0000B550                            Swi_Action:	; Routine 2
0000B550 3168 0030 000C             		move.w	swi_origY(a0),obY(a0) ; restore position on y-axis
0000B556 323C 0010                  		move.w	#$10,d1
0000B55A 6100 0000                  		bsr.w	Swi_ChkTouch	; check if Sonic touches the switch
0000B55E 6700                       		beq.s	Swi_ChkDel	; if not, branch
0000B560                            
0000B560 5468 000C                  		addq.w	#2,obY(a0)	; move object 2	pixels
0000B564 7001                       		moveq	#1,d0
0000B566 31C0 F7E0                  		move.w	d0,(f_switch).w	; set switch 0 as "pressed"
0000B56A                            
0000B56A                            Swi_ChkDel:
0000B56A 6100 0000                  		bsr.w	DisplaySprite
0000B58C 4E75                       		rts	
0000B58E                            ; ===========================================================================
0000B58E                            
0000B58E                            Swi_Delete:	; Routine 4
0000B58E 6100 0000                  		bsr.w	DeleteObject
0000B592 4E75                       		rts	
0000B594                            
0000B594                            ; ---------------------------------------------------------------------------
0000B594                            ; Subroutine to	check if Sonic touches the object
0000B594                            ; ---------------------------------------------------------------------------
0000B594                            
0000B594                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
0000B594                            
0000B594                            
0000B594                            Swi_ChkTouch:
0000B594 43F8 D000                  		lea	(v_player).w,a1
0000B598 3029 0008                  		move.w	obX(a1),d0
0000B59C 9068 0008                  		sub.w	obX(a0),d0
0000B5A0 D041                       		add.w	d1,d0
0000B5A2 6B00                       		bmi.s	Swi_NoTouch
0000B5A4 D241                       		add.w	d1,d1
0000B5A6 B041                       		cmp.w	d1,d0
0000B5A8 6400                       		bcc.s	Swi_NoTouch
0000B5AA 3429 000C                  		move.w	obY(a1),d2
0000B5AE 1229 0016                  		move.b	obHeight(a1),d1
0000B5B2 4881                       		ext.w	d1
0000B5B4 D242                       		add.w	d2,d1
0000B5B6 3028 000C                  		move.w	obY(a0),d0
0000B5BA 0440 0010                  		subi.w	#$10,d0
0000B5BE 9041                       		sub.w	d1,d0
0000B5C0 6200                       		bhi.s	Swi_NoTouch
0000B5C2 0C40 FFF0                  		cmpi.w	#-$10,d0
0000B5C6 6500                       		bcs.s	Swi_NoTouch
0000B5C8 70FF                       		moveq	#-1,d0		; Sonic has touched it
0000B5CA 4E75                       		rts	
0000B5CC                            ; ===========================================================================
0000B5CC                            
0000B5CC                            Swi_NoTouch:
0000B5CC 7000                       		moveq	#0,d0		; Sonic hasn't touched it
0000B5CE 4E75                       		rts	
0000B5D0                            ; End of function Swi_ChkTouch
0000B5D0                            ; End of function Swi_ChkTouch
0000B5D0                            Map_Swi:	include	"_maps\Unused Switch.asm"
0000B5D0                            ; ---------------------------------------------------------------------------
0000B5D0                            ; Sprite mappings - Unused switch thingy
0000B5D0                            ; ---------------------------------------------------------------------------
0000B5D0                            Map_Swi_internal:
0000B5D0 0000                       		dc.w byte_891E-Map_Swi_internal
0000B5D2 04                         byte_891E:	dc.b 4
0000B5D3 E807 0054 F0               		dc.b $E8, 7, 0,	$54, $F0
0000B5D8 0805 005C F0               		dc.b 8,	5, 0, $5C, $F0
0000B5DD E807 0054 00               		dc.b $E8, 7, 0,	$54, 0
0000B5E2 0805 005C 00               		dc.b 8,	5, 0, $5C, 0
0000B5E8 00                         		even
0000B5E8 00                         		even
0000B5E8                            
0000B5E8                            		include	"_incObj\2A SBZ Small Door.asm"
0000B5E8                            ; ---------------------------------------------------------------------------
0000B5E8                            ; Object 2A - small vertical door (SBZ)
0000B5E8                            ; ---------------------------------------------------------------------------
0000B5E8                            
0000B5E8                            AutoDoor:
0000B5E8 7000                       		moveq	#0,d0
0000B5EA 1028 0024                  		move.b	obRoutine(a0),d0
0000B5EE 323B 0000                  		move.w	ADoor_Index(pc,d0.w),d1
0000B5F2 4EFB 1000                  		jmp	ADoor_Index(pc,d1.w)
0000B5F6                            ; ===========================================================================
0000B5F6 0000                       ADoor_Index:	dc.w ADoor_Main-ADoor_Index
0000B5F8 0000                       		dc.w ADoor_OpenShut-ADoor_Index
0000B5FA                            ; ===========================================================================
0000B5FA                            
0000B5FA                            ADoor_Main:	; Routine 0
0000B5FA 5428 0024                  		addq.b	#2,obRoutine(a0)
0000B5FE 217C 0000 0000 0004        		move.l	#Map_ADoor,obMap(a0)
0000B606 317C 42E8 0002             		move.w	#$42E8,obGfx(a0)
0000B60C 0028 0004 0001             		ori.b	#4,obRender(a0)
0000B612 117C 0008 0019             		move.b	#8,obActWid(a0)
0000B618 117C 0004 0018             		move.b	#4,obPriority(a0)
0000B61E                            
0000B61E                            ADoor_OpenShut:	; Routine 2
0000B61E 323C 0040                  		move.w	#$40,d1		; set range for door detection
0000B622 4228 001C                  		clr.b	obAnim(a0)	; use "closing"	animation
0000B626 3038 D008                  		move.w	(v_player+obX).w,d0
0000B62A D041                       		add.w	d1,d0
0000B62C B068 0008                  		cmp.w	obX(a0),d0
0000B630 6500                       		bcs.s	ADoor_Animate
0000B632 9041                       		sub.w	d1,d0
0000B634 9041                       		sub.w	d1,d0
0000B636 B068 0008                  		cmp.w	obX(a0),d0	; is Sonic > $40 pixels from door?
0000B63A 6400                       		bcc.s	ADoor_Animate	; close door
0000B63C D041                       		add.w	d1,d0
0000B63E B068 0008                  		cmp.w	obX(a0),d0	; is Sonic left of the door?
0000B642 6400                       		bcc.s	loc_899A	; if yes, branch
0000B644 0828 0000 0022             		btst	#0,obStatus(a0)
0000B64A 6600                       		bne.s	ADoor_Animate
0000B64C 6000                       		bra.s	ADoor_Open
0000B64E                            ; ===========================================================================
0000B64E                            
0000B64E                            loc_899A:
0000B64E 0828 0000 0022             		btst	#0,obStatus(a0)
0000B654 6700                       		beq.s	ADoor_Animate
0000B656                            
0000B656                            ADoor_Open:
0000B656 117C 0001 001C             		move.b	#1,obAnim(a0)	; use "opening"	animation
0000B65C                            
0000B65C                            ADoor_Animate:
0000B65C 43F9 0000 0000             		lea	(Ani_ADoor).l,a1
0000B662 6100 0000                  		bsr.w	AnimateSprite
0000B666 4A28 001A                  		tst.b	obFrame(a0)	; is the door open?
0000B66A 6600                       		bne.s	@remember	; if yes, branch
0000B66C 323C 0011                  		move.w	#$11,d1
0000B670 343C 0020                  		move.w	#$20,d2
0000B674 3602                       		move.w	d2,d3
0000B676 5243                       		addq.w	#1,d3
0000B678 3828 0008                  		move.w	obX(a0),d4
0000B67C 6100 0000                  		bsr.w	SolidObject
0000B680                            
0000B680                            	@remember:
0000B680 6000 0000                  		bra.w	RememberState
0000B680 6000 0000                  		bra.w	RememberState
0000B684                            		include	"_anim\SBZ Small Door.asm"
0000B684                            ; ---------------------------------------------------------------------------
0000B684                            ; Animation script - doors (SBZ)
0000B684                            ; ---------------------------------------------------------------------------
0000B684 0000                       Ani_ADoor:	dc.w @close-Ani_ADoor
0000B686 0000                       		dc.w @open-Ani_ADoor
0000B688 0008 0706 0504 0302 0100+  @close:		dc.b 0,	8, 7, 6, 5, 4, 3, 2, 1,	0, afBack, 1
0000B694 0000 0102 0304 0506 0708+  @open:		dc.b 0,	0, 1, 2, 3, 4, 5, 6, 7,	8, afBack, 1
0000B6A0                            		even
0000B6A0                            		even
0000B6A0                            Map_ADoor:	include	"_maps\SBZ Small Door.asm"
0000B6A0                            ; ---------------------------------------------------------------------------
0000B6A0                            ; Sprite mappings - doors (SBZ)
0000B6A0                            ; ---------------------------------------------------------------------------
0000B6A0                            Map_ADoor_internal:
0000B6A0 0000                       		dc.w @closed-Map_ADoor_internal
0000B6A2 0000                       		dc.w @01-Map_ADoor_internal
0000B6A4 0000                       		dc.w @02-Map_ADoor_internal
0000B6A6 0000                       		dc.w @03-Map_ADoor_internal
0000B6A8 0000                       		dc.w @04-Map_ADoor_internal
0000B6AA 0000                       		dc.w @05-Map_ADoor_internal
0000B6AC 0000                       		dc.w @06-Map_ADoor_internal
0000B6AE 0000                       		dc.w @07-Map_ADoor_internal
0000B6B0 0000                       		dc.w @open-Map_ADoor_internal
0000B6B2 02                         @closed:	dc.b 2
0000B6B3 E007 0800 F8               		dc.b $E0, 7, 8,	0, $F8	; door closed
0000B6B8 0007 0800 F8               		dc.b 0,	7, 8, 0, $F8
0000B6BD 02                         @01:		dc.b 2
0000B6BE DC07 0800 F8               		dc.b $DC, 7, 8,	0, $F8
0000B6C3 0407 0800 F8               		dc.b 4,	7, 8, 0, $F8
0000B6C8 02                         @02:		dc.b 2
0000B6C9 D807 0800 F8               		dc.b $D8, 7, 8,	0, $F8
0000B6CE 0807 0800 F8               		dc.b 8,	7, 8, 0, $F8
0000B6D3 02                         @03:		dc.b 2
0000B6D4 D407 0800 F8               		dc.b $D4, 7, 8,	0, $F8
0000B6D9 0C07 0800 F8               		dc.b $C, 7, 8, 0, $F8
0000B6DE 02                         @04:		dc.b 2
0000B6DF D007 0800 F8               		dc.b $D0, 7, 8,	0, $F8
0000B6E4 1007 0800 F8               		dc.b $10, 7, 8,	0, $F8
0000B6E9 02                         @05:		dc.b 2
0000B6EA CC07 0800 F8               		dc.b $CC, 7, 8,	0, $F8
0000B6EF 1407 0800 F8               		dc.b $14, 7, 8,	0, $F8
0000B6F4 02                         @06:		dc.b 2
0000B6F5 C807 0800 F8               		dc.b $C8, 7, 8,	0, $F8
0000B6FA 1807 0800 F8               		dc.b $18, 7, 8,	0, $F8
0000B6FF 02                         @07:		dc.b 2
0000B700 C407 0800 F8               		dc.b $C4, 7, 8,	0, $F8
0000B705 1C07 0800 F8               		dc.b $1C, 7, 8,	0, $F8
0000B70A 02                         @open:		dc.b 2
0000B70B C007 0800 F8               		dc.b $C0, 7, 8,	0, $F8	; door fully open
0000B710 2007 0800 F8               		dc.b $20, 7, 8,	0, $F8
0000B716 00                         		even
0000B716 00                         		even
0000B716                            
0000B716                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
0000B716                            
0000B716                            
0000B716                            Obj44_SolidWall:
0000B716 6100 0000                  		bsr.w	Obj44_SolidWall2
0000B71A 6700                       		beq.s	loc_8AA8
0000B71C 6B00 0000                  		bmi.w	loc_8AC4
0000B720 4A40                       		tst.w	d0
0000B722 6700 0000                  		beq.w	loc_8A92
0000B726 6B00                       		bmi.s	loc_8A7C
0000B728 4A69 0010                  		tst.w	obVelX(a1)
0000B72C 6B00                       		bmi.s	loc_8A92
0000B72E 6000                       		bra.s	loc_8A82
0000B730                            ; ===========================================================================
0000B730                            
0000B730                            loc_8A7C:
0000B730 4A69 0010                  		tst.w	obVelX(a1)
0000B734 6A00                       		bpl.s	loc_8A92
0000B736                            
0000B736                            loc_8A82:
0000B736 9169 0008                  		sub.w	d0,obX(a1)
0000B73A 337C 0000 0014             		move.w	#0,obInertia(a1)
0000B740 337C 0000 0010             		move.w	#0,obVelX(a1)
0000B746                            
0000B746                            loc_8A92:
0000B746 0829 0001 0022             		btst	#1,obStatus(a1)
0000B74C 6600                       		bne.s	loc_8AB6
0000B74E 08E9 0005 0022             		bset	#5,obStatus(a1)
0000B754 08E8 0005 0022             		bset	#5,obStatus(a0)
0000B75A 4E75                       		rts	
0000B75C                            ; ===========================================================================
0000B75C                            
0000B75C                            loc_8AA8:
0000B75C 0828 0005 0022             		btst	#5,obStatus(a0)
0000B762 6700                       		beq.s	locret_8AC2
0000B764 337C 0000 001C             		move.w	#id_Run,obAnim(a1)
0000B76A                            
0000B76A                            loc_8AB6:
0000B76A 08A8 0005 0022             		bclr	#5,obStatus(a0)
0000B770 08A9 0005 0022             		bclr	#5,obStatus(a1)
0000B776                            
0000B776                            locret_8AC2:
0000B776 4E75                       		rts	
0000B778                            ; ===========================================================================
0000B778                            
0000B778                            loc_8AC4:
0000B778 4A69 0012                  		tst.w	obVelY(a1)
0000B77C 6A00                       		bpl.s	locret_8AD8
0000B77E 4A43                       		tst.w	d3
0000B780 6A00                       		bpl.s	locret_8AD8
0000B782 9769 000C                  		sub.w	d3,obY(a1)
0000B786 337C 0000 0012             		move.w	#0,obVelY(a1)
0000B78C                            
0000B78C                            locret_8AD8:
0000B78C 4E75                       		rts	
0000B78E                            ; End of function Obj44_SolidWall
0000B78E                            
0000B78E                            
0000B78E                            ; ||||||||||||||| S U B	R O U T	I N E |||||||||||||||||||||||||||||||||||||||
0000B78E                            
0000B78E                            
0000B78E                            Obj44_SolidWall2:
0000B78E 43F8 D000                  		lea	(v_player).w,a1
0000B792 3029 0008                  		move.w	obX(a1),d0
0000B796 9068 0008                  		sub.w	obX(a0),d0
0000B79A D041                       		add.w	d1,d0
0000B79C 6B00                       		bmi.s	loc_8B48
0000B79E 3601                       		move.w	d1,d3
0000B7A0 D643                       		add.w	d3,d3
0000B7A2 B043                       		cmp.w	d3,d0
0000B7A4 6200                       		bhi.s	loc_8B48
0000B7A6 1629 0016                  		move.b	obHeight(a1),d3
0000B7AA 4883                       		ext.w	d3
0000B7AC D443                       		add.w	d3,d2
0000B7AE 3629 000C                  		move.w	obY(a1),d3
0000B7B2 9668 000C                  		sub.w	obY(a0),d3
0000B7B6 D642                       		add.w	d2,d3
0000B7B8 6B00                       		bmi.s	loc_8B48
0000B7BA 3802                       		move.w	d2,d4
0000B7BC D844                       		add.w	d4,d4
0000B7BE B644                       		cmp.w	d4,d3
0000B7C0 6400                       		bhs.s	loc_8B48
0000B7C2 4A38 F7C8                  		tst.b	(f_lockmulti).w
0000B7C6 6B00                       		bmi.s	loc_8B48
0000B7C8 0C38 0006 D024             		cmpi.b	#6,(v_player+obRoutine).w
0000B7CE 6400                       		bhs.s	loc_8B48
0000B7D0 4A78 FE08                  		tst.w	(v_debuguse).w
0000B7D4 6600                       		bne.s	loc_8B48
0000B7D6 3A00                       		move.w	d0,d5
0000B7D8 B240                       		cmp.w	d0,d1
0000B7DA 6400                       		bhs.s	loc_8B30
0000B7DC D241                       		add.w	d1,d1
0000B7DE 9041                       		sub.w	d1,d0
0000B7E0 3A00                       		move.w	d0,d5
0000B7E2 4445                       		neg.w	d5
0000B7E4                            
0000B7E4                            loc_8B30:
0000B7E4 3203                       		move.w	d3,d1
0000B7E6 B443                       		cmp.w	d3,d2
0000B7E8 6400                       		bhs.s	loc_8B3C
0000B7EA 9644                       		sub.w	d4,d3
0000B7EC 3203                       		move.w	d3,d1
0000B7EE 4441                       		neg.w	d1
0000B7F0                            
0000B7F0                            loc_8B3C:
0000B7F0 BA41                       		cmp.w	d1,d5
0000B7F2 6200                       		bhi.s	loc_8B44
0000B7F4 7801                       		moveq	#1,d4
0000B7F6 4E75                       		rts	
0000B7F8                            ; ===========================================================================
0000B7F8                            
0000B7F8                            loc_8B44:
0000B7F8 78FF                       		moveq	#-1,d4
0000B7FA 4E75                       		rts	
0000B7FC                            ; ===========================================================================
0000B7FC                            
0000B7FC                            loc_8B48:
0000B7FC 7800                       		moveq	#0,d4
0000B7FE 4E75                       		rts	
0000B800                            ; End of function Obj44_SolidWall2
0000B800                            
0000B800                            ; ===========================================================================
0000B800                            
0000B800                            		include	"_incObj\1E Ball Hog.asm"
0000B800                            ; ---------------------------------------------------------------------------
0000B800                            ; Object 1E - Ball Hog enemy (SBZ)
0000B800                            ; ---------------------------------------------------------------------------
0000B800                            
0000B800                            Ballhog:
0000B800 7000                                       moveq   #0,d0
0000B802 1028 0024                                  move.b  $24(a0),d0
0000B806 323B 0000                                  move.w  Ballhog_Index(pc,d0.w),d1
0000B80A 4EFB 1000                                  jmp     Ballhog_Index(pc,d1.w)
0000B80E                            ; ---------------------------------------------------------------------------
0000B80E 0000                       Ballhog_Index:dc.w Ballhog_Init-*
0000B810 0000                                       dc.w Ballhog_Action-Ballhog_Index
0000B812 0000                                       dc.w Ballhog_Display-Ballhog_Index
0000B814 0000                                       dc.w Ballhog_Delete-Ballhog_Index
0000B816                            ; ---------------------------------------------------------------------------
0000B816                            
0000B816                            Ballhog_Init:
0000B816 117C 0013 0016                             move.b  #$13,$16(a0)
0000B81C 117C 0008 0017                             move.b  #8,$17(a0)
0000B822 217C 0000 0000 0004                        move.l  #Map_Hog,4(a0)
0000B82A 317C 2400 0002                             move.w  #$2400,2(a0)
0000B830 117C 0004 0001                             move.b  #4,1(a0)
0000B836 117C 0004 0019                             move.b  #4,$19(a0)
0000B83C 117C 0005 0020                             move.b  #5,$20(a0)
0000B842 117C 000C 0018                             move.b  #$C,$18(a0)
0000B848 6100 0000                                  bsr.w   ObjectFall
0000B84C 4EB9 0000 0000                             jsr     (ObjFloorDist).l
0000B852 4A41                                       tst.w   d1
0000B854 6A00                                       bpl.s   Ballhog_Return
0000B856 D368 000C                                  add.w   d1,$C(a0)
0000B85A 317C 0000 0012                             move.w  #0,$12(a0)
0000B860 5428 0024                                  addq.b  #2,$24(a0)
0000B864                            
0000B864                            Ballhog_Return:
0000B864 4E75                                       rts
0000B866                            ; ---------------------------------------------------------------------------
0000B866                            
0000B866                            Ballhog_Action:
0000B866 7000                                       moveq   #0,d0
0000B868 1028 0025                                  move.b  $25(a0),d0
0000B86C 323B 0000                                  move.w  Ballhog_Index2(pc,d0.w),d1
0000B870 4EBB 1000                                  jsr     Ballhog_Index2(pc,d1.w)
0000B874 43F9 0000 0000                             lea     (unk_7244).l,a1
0000B87A 6100 0000                                  bsr.w   AnimateSprite
0000B87E 6000 0000                                  bra.w   RememberState
0000B882                            ; ---------------------------------------------------------------------------
0000B882 0000                       Ballhog_Index2:dc.w loc_6FB6-*
0000B884 0000                                       dc.w loc_701C-Ballhog_Index2
0000B886                            ; ---------------------------------------------------------------------------
0000B886                            
0000B886                            loc_6FB6:
0000B886 5368 0030                                  subq.w  #1,$30(a0)
0000B88A 6A00                                       bpl.s   loc_6FE6
0000B88C 5428 0025                                  addq.b  #2,$25(a0)
0000B890 317C 00FF 0030                             move.w  #$FF,$30(a0)
0000B896 317C 0040 0010                             move.w  #$40,$10(a0) ; '@'
0000B89C 117C 0001 001C                             move.b  #1,$1C(a0)
0000B8A2 0868 0000 0022                             bchg    #0,$22(a0)
0000B8A8 6600                                       bne.s   loc_6FDE
0000B8AA 4468 0010                                  neg.w   $10(a0)
0000B8AE                            
0000B8AE                            loc_6FDE:
0000B8AE 117C 0000 0032                             move.b  #0,$32(a0)
0000B8B4 4E75                                       rts
0000B8B6                            ; ---------------------------------------------------------------------------
0000B8B6                            
0000B8B6                            loc_6FE6:
0000B8B6 4A28 0032                                  tst.b   $32(a0)
0000B8BA 6600                                       bne.s   locret_6FF4
0000B8BC 0C28 0002 001A                             cmpi.b  #2,$1A(a0)
0000B8C2 6700                                       beq.s   Ballhog_MakeBall
0000B8C4                            
0000B8C4                            locret_6FF4:
0000B8C4 4E75                                       rts
0000B8C6                            ; ---------------------------------------------------------------------------
0000B8C6                            
0000B8C6                            Ballhog_MakeBall:
0000B8C6 117C 0001 0032                             move.b  #1,$32(a0)
0000B8CC 6100 0000                                  bsr.w   FindFreeObj
0000B8D0 6600                                       bne.s   Ballhog_MakeFail
0000B8D2 137C 0020 0000                             move.b  #$20,0(a1) ; ' '
0000B8D8 3368 0008 0008                             move.w  8(a0),8(a1)
0000B8DE 3368 000C 000C                             move.w  $C(a0),$C(a1)
0000B8E4 0669 0010 000C                             addi.w  #$10,$C(a1)
0000B8EA                            
0000B8EA                            Ballhog_MakeFail:
0000B8EA 4E75                                       rts
0000B8EC                            ; ---------------------------------------------------------------------------
0000B8EC                            
0000B8EC                            loc_701C:
0000B8EC 5368 0030                                  subq.w  #1,$30(a0)
0000B8F0 6B00                                       bmi.s   loc_7032
0000B8F2 6100 0000                                  bsr.w   SpeedToPos
0000B8F6 4EB9 0000 0000                             jsr     (ObjFloorDist).l
0000B8FC D368 000C                                  add.w   d1,$C(a0)
0000B900 4E75                                       rts
0000B902                            ; ---------------------------------------------------------------------------
0000B902                            
0000B902                            loc_7032:
0000B902 5528 0025                                  subq.b  #2,$25(a0)
0000B906 317C 003B 0030                             move.w  #$3B,$30(a0) ; ';'
0000B90C 317C 0000 0010                             move.w  #0,$10(a0)
0000B912 117C 0000 001C                             move.b  #0,$1C(a0)
0000B918 4A28 0001                                  tst.b   1(a0)
0000B91C 6A00                                       bpl.s   locret_7054
0000B91E 117C 0002 001C                             move.b  #2,$1C(a0)
0000B924                            
0000B924                            locret_7054:
0000B924 4E75                                       rts
0000B926                            ; ---------------------------------------------------------------------------
0000B926                            
0000B926                            Ballhog_Display:
0000B926 6100 0000                                  bsr.w   DisplaySprite
0000B92A 4E75                                       rts
0000B92C                            ; ---------------------------------------------------------------------------
0000B92C                            
0000B92C                            Ballhog_Delete:
0000B92C 6100 0000                                  bsr.w   DeleteObject
0000B930 4E75                                       rts
0000B932 00                         unk_7244:       dc.b   0
0000B933 06                                         dc.b   6
0000B934 00                                         dc.b   0
0000B935 0A                                         dc.b  $A
0000B936 00                                         dc.b   0
0000B937 10                                         dc.b $10
0000B938 0F                                         dc.b  $F
0000B939 00                                         dc.b   0
0000B93A FF                                         dc.b $FF
0000B93B 00                                         dc.b   0
0000B93C 0B                                         dc.b  $B
0000B93D 01                                         dc.b   1
0000B93E 00                                         dc.b   0
0000B93F 21                                         dc.b $21 ; !
0000B940 00                                         dc.b   0
0000B941 FF                                         dc.b $FF
0000B942 14                                         dc.b $14
0000B943 00                                         dc.b   0
0000B944 02                                         dc.b   2
0000B945 00                                         dc.b   0
0000B946 FE                                         dc.b $FE
0000B947 01                                         dc.b   1
0000B947 01                                         dc.b   1
0000B948                            		include	"_incObj\20 Cannonball.asm"
0000B948                            ; ---------------------------------------------------------------------------
0000B948                            ; Object 20 - cannonball that Ball Hog throws (SBZ)
0000B948                            ; ---------------------------------------------------------------------------
0000B948                            
0000B948                            Cannonball:
0000B948 7000                                       moveq   #0,d0
0000B94A 1028 0024                                  move.b  $24(a0),d0
0000B94E 323B 0000                                  move.w  Cannonball_Index(pc,d0.w),d1
0000B952 4EFB 1000                                  jmp     Cannonball_Index(pc,d1.w)
0000B956                            ; End of function Cannonball
0000B956                            
0000B956                            ; ---------------------------------------------------------------------------
0000B956 0000                       Cannonball_Index:dc.w Cannonball_Init-*
0000B958 0000                                       dc.w Cannonball_ChkFloor-Cannonball_Index
0000B95A 0000                                       dc.w Cannonball_Delete-Cannonball_Index
0000B95C                            ; ---------------------------------------------------------------------------
0000B95C                            
0000B95C                            Cannonball_Init:
0000B95C 5428 0024                                  addq.b  #2,$24(a0)
0000B960 217C 0000 0000 0004                        move.l  #unk_729A,4(a0)
0000B968 317C 2418 0002                             move.w  #$2418,2(a0)
0000B96E 117C 0004 0001                             move.b  #4,1(a0)
0000B974 117C 0003 0019                             move.b  #3,$19(a0)
0000B97A 117C 0087 0020                             move.b  #$87,$20(a0)
0000B980 117C 0008 0018                             move.b  #8,$18(a0)
0000B986 317C 0018 0030                             move.w  #$18,$30(a0)
0000B98C                            
0000B98C                            Cannonball_ChkFloor:
0000B98C 0828 0007 0022                             btst    #7,$22(a0)
0000B992 6600                                       bne.s   Cannonball_Explode
0000B994 4A68 0030                                  tst.w   $30(a0)
0000B998 6600                                       bne.s   loc_70D2
0000B99A 4EB9 0000 0000                             jsr     (ObjFloorDist).l
0000B9A0 4A41                                       tst.w   d1
0000B9A2 6A00                                       bpl.s   loc_70D6
0000B9A4 D368 000C                                  add.w   d1,$C(a0)
0000B9A8                            
0000B9A8                            Cannonball_Explode:
0000B9A8 117C 0024 0000                             move.b  #$24,0(a0) ; '$'
0000B9AE 117C 0000 0024                             move.b  #0,$24(a0)
0000B9B4 6000 0000                                  bra.w   MissileDissolve
0000B9B8                            ; ---------------------------------------------------------------------------
0000B9B8                            
0000B9B8                            loc_70D2:
0000B9B8 5368 0030                                  subq.w  #1,$30(a0)
0000B9BC                            
0000B9BC                            loc_70D6:
0000B9BC 6100 0000                                  bsr.w   ObjectFall
0000B9C0 6100 0000                                  bsr.w   DisplaySprite
0000B9C4 3038 F72E                                  move.w  ($FFFFF72E).w,d0
0000B9C8 0640 00E0                                  addi.w  #$E0,d0
0000B9CC B068 000C                                  cmp.w   $C(a0),d0
0000B9D0 6500                                       bcs.s   Cannonball_Delete
0000B9D2 4E75                                       rts
0000B9D4                            ; ---------------------------------------------------------------------------
0000B9D4                            
0000B9D4                            Cannonball_Delete:
0000B9D4 6100 0000                                  bsr.w   DeleteObject
0000B9D8 4E75                                       rts
0000B9DA                            ; ---------------------------------------------------------------------------
0000B9DA                            
0000B9DA                            
0000B9DA                            		include	"_incObj\24, 27 & 3F Explosions.asm"
0000B9DA                            ; ---------------------------------------------------------------------------
0000B9DA                            ; Object 24 - buzz bomber missile vanishing (unused?)
0000B9DA                            ; ---------------------------------------------------------------------------
0000B9DA                            
0000B9DA                            MissileDissolve:
0000B9DA 7000                       		moveq	#0,d0
0000B9DC 1028 0024                  		move.b	obRoutine(a0),d0
0000B9E0 323B 0000                  		move.w	MDis_Index(pc,d0.w),d1
0000B9E4 4EFB 1000                  		jmp	MDis_Index(pc,d1.w)
0000B9E8                            ; ===========================================================================
0000B9E8 0000                       MDis_Index:	dc.w MDis_Main-MDis_Index
0000B9EA 0000                       		dc.w MDis_Animate-MDis_Index
0000B9EC                            ; ===========================================================================
0000B9EC                            
0000B9EC                            MDis_Main:	; Routine 0
0000B9EC 5428 0024                  		addq.b	#2,obRoutine(a0)
0000B9F0 217C 0000 0000 0004        		move.l	#Map_MisDissolve,obMap(a0)
0000B9F8 317C 041C 0002             		move.w	#$41C,obGfx(a0)
0000B9FE 117C 0004 0001             		move.b	#4,obRender(a0)
0000BA04 117C 0001 0018             		move.b	#1,obPriority(a0)
0000BA0A 117C 0000 0020             		move.b	#0,obColType(a0)
0000BA10 117C 000C 0019             		move.b	#$C,obActWid(a0)
0000BA16 117C 0009 001E             		move.b	#9,obTimeFrame(a0)
0000BA1C 117C 0000 001A             		move.b	#0,obFrame(a0)
0000BA2C                            
0000BA2C                            MDis_Animate:	; Routine 2
0000BA2C 5328 001E                  		subq.b	#1,obTimeFrame(a0) ; subtract 1 from frame duration
0000BA30 6A00                       		bpl.s	@display
0000BA32 117C 0009 001E             		move.b	#9,obTimeFrame(a0) ; set frame duration to 9 frames
0000BA38 5228 001A                  		addq.b	#1,obFrame(a0)	; next frame
0000BA3C 0C28 0004 001A             		cmpi.b	#4,obFrame(a0)	; has animation completed?
0000BA42 6700 0000                  		beq.w	DeleteObject	; if yes, branch
0000BA46                            
0000BA46                            	@display:
0000BA46 6000 0000                  		bra.w	DisplaySprite
0000BA4A                            ; ===========================================================================
0000BA4A                            
0000BA4A                            ; ---------------------------------------------------------------------------
0000BA4A                            ; Object 27 - explosion	from a destroyed enemy or monitor
0000BA4A                            ; ---------------------------------------------------------------------------
0000BA4A                            
0000BA4A                            ExplosionItem:
0000BA4A 7000                       		moveq	#0,d0
0000BA4C 1028 0024                  		move.b	obRoutine(a0),d0
0000BA50 323B 0000                  		move.w	ExItem_Index(pc,d0.w),d1
0000BA54 4EFB 1000                  		jmp	ExItem_Index(pc,d1.w)
0000BA58                            ; ===========================================================================
0000BA58 0000                       ExItem_Index:	dc.w ExItem_Animal-ExItem_Index
0000BA5A 0000                       		dc.w ExItem_Main-ExItem_Index
0000BA5C 0000                       		dc.w ExItem_Animate-ExItem_Index
0000BA5E                            ; ===========================================================================
0000BA5E                            
0000BA5E                            ExItem_Animal:	; Routine 0
0000BA5E 5428 0024                  		addq.b	#2,obRoutine(a0)
0000BA62 6100 0000                  		bsr.w	FindFreeObj
0000BA66 6600                       		bne.s	ExItem_Main
0000BA68 137C 0000 0000             		move.b	#id_Animals,0(a1) ; load animal object
0000BA6E 3368 0008 0008             		move.w	obX(a0),obX(a1)
0000BA74 3368 000C 000C             		move.w	obY(a0),obY(a1)
0000BA7A 3368 003E 003E             		move.w	$3E(a0),$3E(a1)
0000BA80                            
0000BA80                            ExItem_Main:	; Routine 2
0000BA80 5428 0024                  		addq.b	#2,obRoutine(a0)
0000BA84 217C 0000 0000 0004        		move.l	#Map_ExplodeItem,obMap(a0)
0000BA8C 317C 05A0 0002             		move.w	#$5A0,obGfx(a0)
0000BA92 117C 0004 0001             		move.b	#4,obRender(a0)
0000BA98 117C 0001 0018             		move.b	#1,obPriority(a0)
0000BA9E 117C 0000 0020             		move.b	#0,obColType(a0)
0000BAA4 117C 000C 0019             		move.b	#$C,obActWid(a0)
0000BAAA 117C 0007 001E             		move.b	#7,obTimeFrame(a0) ; set frame duration to 7 frames
0000BAB0 117C 0000 001A             		move.b	#0,obFrame(a0)
0000BAC0                            
0000BAC0                            ExItem_Animate:	; Routine 4 (2 for ExplosionBomb)
0000BAC0 5328 001E                  		subq.b	#1,obTimeFrame(a0) ; subtract 1 from frame duration
0000BAC4 6A00                       		bpl.s	@display
0000BAC6 117C 0007 001E             		move.b	#7,obTimeFrame(a0) ; set frame duration to 7 frames
0000BACC 5228 001A                  		addq.b	#1,obFrame(a0)	; next frame
0000BAD0 0C28 0005 001A             		cmpi.b	#5,obFrame(a0)	; is the final frame (05) displayed?
0000BAD6 6700 0000                  		beq.w	DeleteObject	; if yes, branch
0000BADA                            
0000BADA                            	@display:
0000BADA 6000 0000                  		bra.w	DisplaySprite
0000BADE                            ; ===========================================================================
0000BADE                            ; ---------------------------------------------------------------------------
0000BADE                            ; Object 3F - explosion	from a destroyed boss, bomb or cannonball
0000BADE                            ; ---------------------------------------------------------------------------
0000BADE                            
0000BADE                            ExplosionBomb:
0000BADE 7000                       		moveq	#0,d0
0000BAE0 1028 0024                  		move.b	obRoutine(a0),d0
0000BAE4 323B 0000                  		move.w	ExBom_Index(pc,d0.w),d1
0000BAE8 4EFB 1000                  		jmp	ExBom_Index(pc,d1.w)
0000BAEC                            ; ===========================================================================
0000BAEC 0000                       ExBom_Index:	dc.w ExBom_Main-ExBom_Index
0000BAEE FFD4                       		dc.w ExItem_Animate-ExBom_Index
0000BAF0                            ; ===========================================================================
0000BAF0                            
0000BAF0                            ExBom_Main:	; Routine 0
0000BAF0 5428 0024                  		addq.b	#2,obRoutine(a0)
0000BAF4 217C 0000 0000 0004        		move.l	#Map_ExplodeBomb,obMap(a0)
0000BAFC 317C 05A0 0002             		move.w	#$5A0,obGfx(a0)
0000BB02 117C 0004 0001             		move.b	#4,obRender(a0)
0000BB08 117C 0001 0018             		move.b	#1,obPriority(a0)
0000BB0E 117C 0000 0020             		move.b	#0,obColType(a0)
0000BB14 117C 000C 0019             		move.b	#$C,obActWid(a0)
0000BB1A 117C 0007 001E             		move.b	#7,obTimeFrame(a0)
0000BB20 117C 0000 001A             		move.b	#0,obFrame(a0)
0000BB30                            		include	"_anim\Ball Hog.asm"
0000BB30                            ; ---------------------------------------------------------------------------
0000BB30                            ; Animation script - doors (SBZ)
0000BB30                            ; ---------------------------------------------------------------------------
0000BB30 0000                       Ani_Hog:	dc.w @hog-Ani_Hog
0000BB32 0900 0002 0203 0200 0002+  @hog:		dc.b 9,	0, 0, 2, 2, 3, 2, 0, 0,	2, 2, 3, 2, 0, 0, 2, 2, 3, 2, 0, 0, 1, afEnd
0000BB4A 00                         		even
0000BB4A 00                         		even
0000BB4A                            Map_Hog:	include	"_maps\Ball Hog.asm"
0000BB4A                            ; ---------------------------------------------------------------------------
0000BB4A                            ; Sprite mappings - Ball Hog enemy (SBZ)
0000BB4A                            ; ---------------------------------------------------------------------------
0000BB4A 0000                       Map_BallHog:    dc.w unk_7260-*
0000BB4C 0000                                       dc.w unk_7275-Map_BallHog
0000BB4E 0000                                       dc.w unk_7285-Map_BallHog
0000BB50 04                         unk_7260:       dc.b   4
0000BB51 ED07 0000 F0ED 0708 0000+                  dc.b $ED, 7, 0, 0, $F0, $ED, 7, 8, 0, 0, $D, 4, 0
0000BB5E 08F0 0D04 0808 00                          dc.b 8, $F0, $D, 4, 8, 8, 0
0000BB65 03                         unk_7275:       dc.b   3
0000BB66 EC07 0000 EEEC 0708 00FE+                  dc.b $EC, 7, 0, 0, $EE, $EC, 7, 8, 0, $FE, $C, $C
0000BB72 000A EE                                    dc.b 0, $A, $EE
0000BB75 04                         unk_7285:       dc.b   4
0000BB76 ED                                         dc.b $ED
0000BB77 07                                         dc.b   7
0000BB78 00                                         dc.b   0
0000BB79 0E                                         dc.b  $E
0000BB7A F0                                         dc.b $F0
0000BB7B ED                                         dc.b $ED
0000BB7C 07                                         dc.b   7
0000BB7D 08                                         dc.b   8
0000BB7E 0E                                         dc.b  $E
0000BB7F 00                                         dc.b   0
0000BB80 0D                                         dc.b  $D
0000BB81 04                                         dc.b   4
0000BB82 00                                         dc.b   0
0000BB83 16                                         dc.b $16
0000BB84 F0                                         dc.b $F0
0000BB85 0D                                         dc.b  $D
0000BB86 04                                         dc.b   4
0000BB87 08                                         dc.b   8
0000BB88 16                                         dc.b $16
0000BB89 00                                         dc.b   0
0000BB8A 00                         unk_729A:       dc.b   0
0000BB8B 02                                         dc.b   2
0000BB8C 01                                         dc.b   1
0000BB8D F8                                         dc.b $F8
0000BB8E 05                                         dc.b   5
0000BB8F 00                                         dc.b   0
0000BB90 00                                         dc.b   0
0000BB91 F8                                         dc.b $F8
0000BB92 00                         unk_72A2:       dc.b   0
0000BB93 08                                         dc.b   8
0000BB94 00                                         dc.b   0
0000BB95 0E                                         dc.b  $E
0000BB96 00                                         dc.b   0
0000BB97 14                                         dc.b $14
0000BB98 00                                         dc.b   0
0000BB99 1A                                         dc.b $1A
0000BB9A 01                                         dc.b   1
0000BB9B F4                                         dc.b $F4
0000BB9C 0A                                         dc.b  $A
0000BB9D 00                                         dc.b   0
0000BB9E 00                                         dc.b   0
0000BB9F F4                                         dc.b $F4
0000BBA0 01                                         dc.b   1
0000BBA1 F4                                         dc.b $F4
0000BBA2 0A                                         dc.b  $A
0000BBA3 00                                         dc.b   0
0000BBA4 09                                         dc.b   9
0000BBA5 F4                                         dc.b $F4
0000BBA6 01                                         dc.b   1
0000BBA7 F4                                         dc.b $F4
0000BBA8 0A                                         dc.b  $A
0000BBA9 00                                         dc.b   0
0000BBAA 12                                         dc.b $12
0000BBAB F4                                         dc.b $F4
0000BBAC 01                                         dc.b   1
0000BBAD F4                                         dc.b $F4
0000BBAE 0A                                         dc.b  $A
0000BBAF 00                                         dc.b   0
0000BBB0 1B                                         dc.b $1B
0000BBB1 F4                                         dc.b $F4
0000BBB2 00                         unk_72C2:       dc.b   0
0000BBB3 0A                                         dc.b  $A
0000BBB4 00                                         dc.b   0
0000BBB5 10                                         dc.b $10
0000BBB6 00                                         dc.b   0
0000BBB7 16                                         dc.b $16
0000BBB8 00                                         dc.b   0
0000BBB9 1C                                         dc.b $1C
0000BBBA 00                                         dc.b   0
0000BBBB 31                                         dc.b $31 ; 1
0000BBBC 01                                         dc.b   1
0000BBBD F8                                         dc.b $F8
0000BBBE 09                                         dc.b   9
0000BBBF 00                                         dc.b   0
0000BBC0 00                                         dc.b   0
0000BBC1 F4                                         dc.b $F4
0000BBC2 01                                         dc.b   1
0000BBC3 F0                                         dc.b $F0
0000BBC4 0F                                         dc.b  $F
0000BBC5 00                                         dc.b   0
0000BBC6 06                                         dc.b   6
0000BBC7 F0                                         dc.b $F0
0000BBC8 01                                         dc.b   1
0000BBC9 F0                                         dc.b $F0
0000BBCA 0F                                         dc.b  $F
0000BBCB 00                                         dc.b   0
0000BBCC 16                                         dc.b $16
0000BBCD F0                                         dc.b $F0
0000BBCE 04                                         dc.b   4
0000BBCF EC                                         dc.b $EC
0000BBD0 0A                                         dc.b  $A
0000BBD1 00                                         dc.b   0
0000BBD2 26                                         dc.b $26 ; &
0000BBD3 EC                                         dc.b $EC
0000BBD4 EC                                         dc.b $EC
0000BBD5 05                                         dc.b   5
0000BBD6 00                                         dc.b   0
0000BBD7 2F                                         dc.b $2F ; /
0000BBD8 04                                         dc.b   4
0000BBD9 04                                         dc.b   4
0000BBDA 05                                         dc.b   5
0000BBDB 18                                         dc.b $18
0000BBDC 2F                                         dc.b $2F ; /
0000BBDD EC                                         dc.b $EC
0000BBDE FC                                         dc.b $FC
0000BBDF 0A                                         dc.b  $A
0000BBE0 18                                         dc.b $18
0000BBE1 26                                         dc.b $26 ; &
0000BBE2 FC                                         dc.b $FC
0000BBE3 04                                         dc.b   4
0000BBE4 EC                                         dc.b $EC
0000BBE5 0A                                         dc.b  $A
0000BBE6 00                                         dc.b   0
0000BBE7 33                                         dc.b $33 ; 3
0000BBE8 EC                                         dc.b $EC
0000BBE9 EC                                         dc.b $EC
0000BBEA 05                                         dc.b   5
0000BBEB 00                                         dc.b   0
0000BBEC 3C                                         dc.b $3C ; <
0000BBED 04                                         dc.b   4
0000BBEE 04                                         dc.b   4
0000BBEF 05                                         dc.b   5
0000BBF0 18                                         dc.b $18
0000BBF1 3C                                         dc.b $3C ; <
0000BBF2 EC                                         dc.b $EC
0000BBF3 FC                                         dc.b $FC
0000BBF4 0A                                         dc.b  $A
0000BBF5 18                                         dc.b $18
0000BBF6 33                                         dc.b $33 ; 3
0000BBF7 FC                                         dc.b $FC
0000BBF8 FF                         unk_7308:       dc.b $FF
0000BBF9 C4                                         dc.b $C4
0000BBFA 00                                         dc.b   0
0000BBFB 0A                                         dc.b  $A
0000BBFC 00                                         dc.b   0
0000BBFD 10                                         dc.b $10
0000BBFE FF                                         dc.b $FF
0000BBFF D6                                         dc.b $D6
0000BC00 FF                                         dc.b $FF
0000BC01 EB                                         dc.b $EB
0000BC02 01                                         dc.b   1
0000BC03 F0                                         dc.b $F0
0000BC04 0F                                         dc.b  $F
0000BC05 00                                         dc.b   0
0000BC06 40                                         dc.b $40 ; @
0000BC07 F0                                         dc.b $F0
0000BC08 01                                         dc.b   1
0000BC09 F0                                         dc.b $F0
0000BC0A 0F                                         dc.b  $F
0000BC0B 00                                         dc.b   0
0000BC0C 50                                         dc.b $50 ; P
0000BC0D F0                                         dc.b $F0
0000BC0E                            		even
0000BC0E                            		even
0000BC0E                            Map_MisDissolve:include	"_maps\Buzz Bomber Missile Dissolve.asm"
0000BC0E                            ; ---------------------------------------------------------------------------
0000BC0E                            ; Sprite mappings - buzz bomber missile vanishing
0000BC0E                            ; ---------------------------------------------------------------------------
0000BC0E                            Map_MisDissolve_internal:
0000BC0E 0000                       		dc.w byte_8EAE-Map_MisDissolve_internal
0000BC10 0000                       		dc.w byte_8EB4-Map_MisDissolve_internal
0000BC12 0000                       		dc.w byte_8EBA-Map_MisDissolve_internal
0000BC14 0000                       		dc.w byte_8EC0-Map_MisDissolve_internal
0000BC16 01                         byte_8EAE:	dc.b 1
0000BC17 F40A 0000 F4               		dc.b $F4, $A, 0, 0, $F4
0000BC1C 01                         byte_8EB4:	dc.b 1
0000BC1D F40A 0009 F4               		dc.b $F4, $A, 0, 9, $F4
0000BC22 01                         byte_8EBA:	dc.b 1
0000BC23 F40A 0012 F4               		dc.b $F4, $A, 0, $12, $F4
0000BC28 01                         byte_8EC0:	dc.b 1
0000BC29 F40A 001B F4               		dc.b $F4, $A, 0, $1B, $F4
0000BC2E                            		even
0000BC2E                            		even
0000BC2E                            		include	"_maps\Explosions.asm"
0000BC2E                            ; ---------------------------------------------------------------------------
0000BC2E                            ; Sprite mappings - explosion from a badnik or monitor
0000BC2E                            ; ---------------------------------------------------------------------------
0000BC2E 0000 0000                  Map_ExplodeItem:dc.w byte_8ED0-Map_ExplodeItem, byte_8ED6-Map_ExplodeItem
0000BC32 0000 0000                  		dc.w byte_8EDC-Map_ExplodeItem, byte_8EE2-Map_ExplodeItem
0000BC36 0000                       		dc.w byte_8EF7-Map_ExplodeItem
0000BC38 01                         byte_8ED0:	dc.b 1
0000BC39 F809 0000 F4               		dc.b $F8, 9, 0,	0, $F4
0000BC3E 01                         byte_8ED6:	dc.b 1
0000BC3F F00F 0006 F0               		dc.b $F0, $F, 0, 6, $F0
0000BC44 01                         byte_8EDC:	dc.b 1
0000BC45 F00F 0016 F0               		dc.b $F0, $F, 0, $16, $F0
0000BC4A 04                         byte_8EE2:	dc.b 4
0000BC4B EC0A 0026 EC               		dc.b $EC, $A, 0, $26, $EC
0000BC50 EC05 002F 04               		dc.b $EC, 5, 0,	$2F, 4
0000BC55 0405 182F EC               		dc.b 4,	5, $18,	$2F, $EC
0000BC5A FC0A 1826 FC               		dc.b $FC, $A, $18, $26,	$FC
0000BC5F 04                         byte_8EF7:	dc.b 4
0000BC60 EC0A 0033 EC               		dc.b $EC, $A, 0, $33, $EC
0000BC65 EC05 003C 04               		dc.b $EC, 5, 0,	$3C, 4
0000BC6A 0405 183C EC               		dc.b 4,	5, $18,	$3C, $EC
0000BC6F FC0A 1833 FC               		dc.b $FC, $A, $18, $33,	$FC
0000BC74                            		even
0000BC74                            ; ---------------------------------------------------------------------------
0000BC74                            ; Sprite mappings - explosion from when	a boss is destroyed
0000BC74                            ; ---------------------------------------------------------------------------
0000BC74 FFC4                       Map_ExplodeBomb:dc.w byte_8ED0-Map_ExplodeBomb
0000BC76 0000                       		dc.w byte_8F16-Map_ExplodeBomb
0000BC78 0000                       		dc.w byte_8F1C-Map_ExplodeBomb
0000BC7A FFD6                       		dc.w byte_8EE2-Map_ExplodeBomb
0000BC7C FFEB                       		dc.w byte_8EF7-Map_ExplodeBomb
0000BC7E 01                         byte_8F16:	dc.b 1
0000BC7F F00F 0040 F0               		dc.b $F0, $F, 0, $40, $F0
0000BC84 01                         byte_8F1C:	dc.b 1
0000BC85 F00F 0050 F0               		dc.b $F0, $F, 0, $50, $F0
0000BC8A                            		even
0000BC8A                            		even
0000BC8A                            
0000BC8A                            		include	"_incObj\28 Animals.asm"
0000BC8A                            ; ---------------------------------------------------------------------------
0000BC8A                            ; Object 28 - animals
0000BC8A                            ; ---------------------------------------------------------------------------
0000BC8A                            
0000BC8A                            Animals:
0000BC8A 7000                       		moveq	#0,d0
0000BC8C 1028 0024                  		move.b	obRoutine(a0),d0
0000BC90 323B 0000                  		move.w	Anml_Index(pc,d0.w),d1
0000BC94 4EFB 1000                  		jmp	Anml_Index(pc,d1.w)
0000BC98                            ; ===========================================================================
0000BC98 0000 0000                  Anml_Index:	dc.w Anml_Ending-Anml_Index, loc_912A-Anml_Index
0000BC9C 0000 0000                  		dc.w loc_9184-Anml_Index, loc_91C0-Anml_Index
0000BCA0 0000 0000                  		dc.w loc_9184-Anml_Index, loc_9184-Anml_Index
0000BCA4 0000 0000                  		dc.w loc_9184-Anml_Index, loc_91C0-Anml_Index
0000BCA8 0000 0000                  		dc.w loc_9184-Anml_Index, loc_9240-Anml_Index
0000BCAC 0000 0000                  		dc.w loc_9260-Anml_Index, loc_9260-Anml_Index
0000BCB0 0000 0000                  		dc.w loc_9280-Anml_Index, loc_92BA-Anml_Index
0000BCB4 0000 0000                  		dc.w loc_9314-Anml_Index, loc_9332-Anml_Index
0000BCB8 0000 0000                  		dc.w loc_9314-Anml_Index, loc_9332-Anml_Index
0000BCBC 0000 0000                  		dc.w loc_9314-Anml_Index, loc_9370-Anml_Index
0000BCC0 0000                       		dc.w loc_92D6-Anml_Index
0000BCC2                            
0000BCC2 0005 0203 0603 0405 0401+  Anml_VarIndex:	dc.b 0,	5, 2, 3, 6, 3, 4, 5, 4,	1, 0, 1
0000BCCE                            
0000BCCE FE00 FC00                  Anml_Variables:	dc.w $FE00, $FC00
0000BCD2 0000 0000                  		dc.l Map_Animal1
0000BCD6 FE00 FD00                  		dc.w $FE00, $FD00	; horizontal speed, vertical speed
0000BCDA 0000 0000                  		dc.l Map_Animal2	; mappings address
0000BCDE FE80 FD00                  		dc.w $FE80, $FD00
0000BCE2 0000 0000                  		dc.l Map_Animal1
0000BCE6 FEC0 FE80                  		dc.w $FEC0, $FE80
0000BCEA 0000 0000                  		dc.l Map_Animal2
0000BCEE FE40 FD00                  		dc.w $FE40, $FD00
0000BCF2 0000 0000                  		dc.l Map_Animal3
0000BCF6 FD00 FC00                  		dc.w $FD00, $FC00
0000BCFA 0000 0000                  		dc.l Map_Animal2
0000BCFE FD80 FC80                  		dc.w $FD80, $FC80
0000BD02 0000 0000                  		dc.l Map_Animal3
0000BD06                            
0000BD06 FBC0 FC00 FBC0 FC00 FBC0+  Anml_EndSpeed:	dc.w $FBC0, $FC00, $FBC0, $FC00, $FBC0,	$FC00, $FD00, $FC00
0000BD16 FD00 FC00 FE80 FD00 FE80+  		dc.w $FD00, $FC00, $FE80, $FD00, $FE80,	$FD00, $FEC0, $FE80
0000BD26 FE40 FD00 FE00 FD00 FD80+  		dc.w $FE40, $FD00, $FE00, $FD00, $FD80,	$FC80
0000BD32                            
0000BD32 0000 0000 0000 0000 0000+  Anml_EndMap:	dc.l Map_Animal2, Map_Animal2, Map_Animal2, Map_Animal1, Map_Animal1
0000BD46 0000 0000 0000 0000 0000+  		dc.l Map_Animal1, Map_Animal1, Map_Animal2, Map_Animal3, Map_Animal2
0000BD5A 0000 0000                  		dc.l Map_Animal3
0000BD5E                            
0000BD5E 05A5 05A5 05A5 0553 0553+  Anml_EndVram:	dc.w $5A5, $5A5, $5A5, $553, $553, $573, $573, $585, $593
0000BD70 0565 05B3                  		dc.w $565, $5B3
0000BD74                            ; ===========================================================================
0000BD74                            
0000BD74                            Anml_Ending:	; Routine 0
0000BD74 4A28 0028                  		tst.b	obSubtype(a0)	; did animal come from a destroyed enemy?
0000BD78 6700 0000                  		beq.w	Anml_FromEnemy	; if yes, branch
0000BD7C 7000                       		moveq	#0,d0
0000BD7E 1028 0028                  		move.b	obSubtype(a0),d0 ; move object type to d0
0000BD82 D040                       		add.w	d0,d0		; multiply d0 by 2
0000BD84 1140 0024                  		move.b	d0,obRoutine(a0) ; move d0 to routine counter
0000BD88 0440 0014                  		subi.w	#$14,d0
0000BD8C 317B 00D0 0002             		move.w	Anml_EndVram(pc,d0.w),obGfx(a0)
0000BD92 D040                       		add.w	d0,d0
0000BD94 217B 009C 0004             		move.l	Anml_EndMap(pc,d0.w),obMap(a0)
0000BD9A 43FA FF6A                  		lea	Anml_EndSpeed(pc),a1
0000BD9E 3171 0000 0032             		move.w	(a1,d0.w),$32(a0) ; load horizontal speed
0000BDA4 3171 0000 0010             		move.w	(a1,d0.w),obVelX(a0)
0000BDAA 3171 0002 0034             		move.w	2(a1,d0.w),$34(a0) ; load vertical speed
0000BDB0 3171 0002 0012             		move.w	2(a1,d0.w),obVelY(a0)
0000BDB6 117C 000C 0016             		move.b	#$C,obHeight(a0)
0000BDBC 117C 0004 0001             		move.b	#4,obRender(a0)
0000BDC2 08E8 0000 0001             		bset	#0,obRender(a0)
0000BDC8 117C 0006 0018             		move.b	#6,obPriority(a0)
0000BDCE 117C 0008 0019             		move.b	#8,obActWid(a0)
0000BDD4 117C 0007 001E             		move.b	#7,obTimeFrame(a0)
0000BDDA 6000 0000                  		bra.w	DisplaySprite
0000BDDE                            ; ===========================================================================
0000BDDE                            
0000BDDE                            Anml_FromEnemy:
0000BDDE 5428 0024                  		addq.b	#2,obRoutine(a0)
0000BDE2 6100 8E46                  		bsr.w	RandomNumber
0000BDE6 0240 0001                  		andi.w	#1,d0
0000BDEA 7200                       		moveq	#0,d1
0000BDEC 1238 FE10                  		move.b	(v_zone).w,d1
0000BDF0 D241                       		add.w	d1,d1
0000BDF2 D240                       		add.w	d0,d1
0000BDF4 43FA FECC                  		lea	Anml_VarIndex(pc),a1
0000BDF8 1031 1000                  		move.b	(a1,d1.w),d0
0000BDFC 1140 0030                  		move.b	d0,$30(a0)
0000BE00 E748                       		lsl.w	#3,d0
0000BE02 43FA FECA                  		lea	Anml_Variables(pc),a1
0000BE06 D2C0                       		adda.w	d0,a1
0000BE08 3159 0032                  		move.w	(a1)+,$32(a0)	; load horizontal speed
0000BE0C 3159 0034                  		move.w	(a1)+,$34(a0)	; load vertical	speed
0000BE10 2159 0004                  		move.l	(a1)+,obMap(a0)	; load mappings
0000BE14 317C 0580 0002             		move.w	#$580,obGfx(a0)	; VRAM setting for 1st animal
0000BE1A 0828 0000 0030             		btst	#0,$30(a0)	; is 1st animal	used?
0000BE20 6700                       		beq.s	loc_90C0	; if yes, branch
0000BE22 317C 0592 0002             		move.w	#$592,obGfx(a0)	; VRAM setting for 2nd animal
0000BE28                            
0000BE28                            loc_90C0:
0000BE28 117C 000C 0016             		move.b	#$C,obHeight(a0)
0000BE2E 117C 0004 0001             		move.b	#4,obRender(a0)
0000BE34 08E8 0000 0001             		bset	#0,obRender(a0)
0000BE3A 117C 0006 0018             		move.b	#6,obPriority(a0)
0000BE40 117C 0008 0019             		move.b	#8,obActWid(a0)
0000BE46 117C 0007 001E             		move.b	#7,obTimeFrame(a0)
0000BE4C 117C 0002 001A             		move.b	#2,obFrame(a0)
0000BE52 317C FC00 0012             		move.w	#-$400,obVelY(a0)
0000BE58 4A38 F7A7                  		tst.b	(v_bossstatus).w
0000BE5C 6600                       		bne.s	loc_911C
0000BE5E 6100 0000                  		bsr.w	FindFreeObj
0000BE62 6600                       		bne.s	Anml_Display
0000BE64 137C 0000 0000             		move.b	#id_Points,0(a1) ; load points object
0000BE6A 3368 0008 0008             		move.w	obX(a0),obX(a1)
0000BE70 3368 000C 000C             		move.w	obY(a0),obY(a1)
0000BE76 3028 003E                  		move.w	$3E(a0),d0
0000BE7A E248                       		lsr.w	#1,d0
0000BE7C 1340 001A                  		move.b	d0,obFrame(a1)
0000BE80                            
0000BE80                            Anml_Display:
0000BE80 6000 0000                  		bra.w	DisplaySprite
0000BE84                            ; ===========================================================================
0000BE84                            
0000BE84                            loc_911C:
0000BE84 117C 0012 0024             		move.b	#$12,obRoutine(a0)
0000BE8A 4268 0010                  		clr.w	obVelX(a0)
0000BE8E 6000 0000                  		bra.w	DisplaySprite
0000BE92                            ; ===========================================================================
0000BE92                            
0000BE92                            loc_912A:
0000BE92 4A28 0001                  		tst.b	obRender(a0)
0000BE96 6A00 0000                  		bpl.w	DeleteObject
0000BE9A 6100 0000                  		bsr.w	ObjectFall
0000BE9E 4A68 0012                  		tst.w	obVelY(a0)
0000BEA2 6B00                       		bmi.s	loc_9180
0000BEA4 4EB9 0000 0000             		jsr	(ObjFloorDist).l
0000BEAA 4A41                       		tst.w	d1
0000BEAC 6A00                       		bpl.s	loc_9180
0000BEAE D368 000C                  		add.w	d1,obY(a0)
0000BEB2 3168 0032 0010             		move.w	$32(a0),obVelX(a0)
0000BEB8 3168 0034 0012             		move.w	$34(a0),obVelY(a0)
0000BEBE 117C 0001 001A             		move.b	#1,obFrame(a0)
0000BEC4 1028 0030                  		move.b	$30(a0),d0
0000BEC8 D000                       		add.b	d0,d0
0000BECA 5800                       		addq.b	#4,d0
0000BECC 1140 0024                  		move.b	d0,obRoutine(a0)
0000BED0 4A38 F7A7                  		tst.b	(v_bossstatus).w
0000BED4 6700                       		beq.s	loc_9180
0000BED6 0838 0004 FE0F             		btst	#4,(v_vbla_byte).w
0000BEDC 6700                       		beq.s	loc_9180
0000BEDE 4468 0010                  		neg.w	obVelX(a0)
0000BEE2 0868 0000 0001             		bchg	#0,obRender(a0)
0000BEE8                            
0000BEE8                            loc_9180:
0000BEE8 6000 0000                  		bra.w	DisplaySprite
0000BEEC                            ; ===========================================================================
0000BEEC                            
0000BEEC                            loc_9184:
0000BEEC 6100 0000                  		bsr.w	ObjectFall
0000BEF0 117C 0001 001A             		move.b	#1,obFrame(a0)
0000BEF6 4A68 0012                  		tst.w	obVelY(a0)
0000BEFA 6B00                       		bmi.s	loc_91AE
0000BEFC 117C 0000 001A             		move.b	#0,obFrame(a0)
0000BF02 4EB9 0000 0000             		jsr	(ObjFloorDist).l
0000BF08 4A41                       		tst.w	d1
0000BF0A 6A00                       		bpl.s	loc_91AE
0000BF0C D368 000C                  		add.w	d1,obY(a0)
0000BF10 3168 0034 0012             		move.w	$34(a0),obVelY(a0)
0000BF16                            
0000BF16                            loc_91AE:
0000BF16 4A28 0028                  		tst.b	obSubtype(a0)
0000BF1A 6600                       		bne.s	loc_9224
0000BF1C 4A28 0001                  		tst.b	obRender(a0)
0000BF20 6A00 0000                  		bpl.w	DeleteObject
0000BF24 6000 0000                  		bra.w	DisplaySprite
0000BF28                            ; ===========================================================================
0000BF28                            
0000BF28                            loc_91C0:
0000BF28 6100 0000                  		bsr.w	SpeedToPos
0000BF2C 0668 0018 0012             		addi.w	#$18,obVelY(a0)
0000BF32 4A68 0012                  		tst.w	obVelY(a0)
0000BF36 6B00                       		bmi.s	loc_91FC
0000BF38 4EB9 0000 0000             		jsr	(ObjFloorDist).l
0000BF3E 4A41                       		tst.w	d1
0000BF40 6A00                       		bpl.s	loc_91FC
0000BF42 D368 000C                  		add.w	d1,obY(a0)
0000BF46 3168 0034 0012             		move.w	$34(a0),obVelY(a0)
0000BF4C 4A28 0028                  		tst.b	obSubtype(a0)
0000BF50 6700                       		beq.s	loc_91FC
0000BF52 0C28 000A 0028             		cmpi.b	#$A,obSubtype(a0)
0000BF58 6700                       		beq.s	loc_91FC
0000BF5A 4468 0010                  		neg.w	obVelX(a0)
0000BF5E 0868 0000 0001             		bchg	#0,obRender(a0)
0000BF64                            
0000BF64                            loc_91FC:
0000BF64 5328 001E                  		subq.b	#1,obTimeFrame(a0)
0000BF68 6A00                       		bpl.s	loc_9212
0000BF6A 117C 0001 001E             		move.b	#1,obTimeFrame(a0)
0000BF70 5228 001A                  		addq.b	#1,obFrame(a0)
0000BF74 0228 0001 001A             		andi.b	#1,obFrame(a0)
0000BF7A                            
0000BF7A                            loc_9212:
0000BF7A 4A28 0028                  		tst.b	obSubtype(a0)
0000BF7E 6600                       		bne.s	loc_9224
0000BF80 4A28 0001                  		tst.b	obRender(a0)
0000BF84 6A00 0000                  		bpl.w	DeleteObject
0000BF88 6000 0000                  		bra.w	DisplaySprite
0000BF8C                            ; ===========================================================================
0000BF8C                            
0000BF8C                            loc_9224:
0000BF8C 3028 0008                  		move.w	obX(a0),d0
0000BF90 9078 D008                  		sub.w	(v_player+obX).w,d0
0000BF94 6500                       		bcs.s	loc_923C
0000BF96 0440 0180                  		subi.w	#$180,d0
0000BF9A 6A00                       		bpl.s	loc_923C
0000BF9C 4A28 0001                  		tst.b	obRender(a0)
0000BFA0 6A00 0000                  		bpl.w	DeleteObject
0000BFA4                            
0000BFA4                            loc_923C:
0000BFA4 6000 0000                  		bra.w	DisplaySprite
0000BFA8                            ; ===========================================================================
0000BFA8                            
0000BFA8                            loc_9240:
0000BFA8 4A28 0001                  		tst.b	obRender(a0)
0000BFAC 6A00 0000                  		bpl.w	DeleteObject
0000BFB0 5368 0036                  		subq.w	#1,$36(a0)
0000BFB4 6600 0000                  		bne.w	loc_925C
0000BFB8 117C 0002 0024             		move.b	#2,obRoutine(a0)
0000BFBE 117C 0003 0018             		move.b	#3,obPriority(a0)
0000BFC4                            
0000BFC4                            loc_925C:
0000BFC4 6000 0000                  		bra.w	DisplaySprite
0000BFC8                            ; ===========================================================================
0000BFC8                            
0000BFC8                            loc_9260:
0000BFC8 6100 0000                  		bsr.w	sub_9404
0000BFCC 6400                       		bcc.s	loc_927C
0000BFCE 3168 0032 0010             		move.w	$32(a0),obVelX(a0)
0000BFD4 3168 0034 0012             		move.w	$34(a0),obVelY(a0)
0000BFDA 117C 000E 0024             		move.b	#$E,obRoutine(a0)
0000BFE0 6000 FF46                  		bra.w	loc_91C0
0000BFE4                            ; ===========================================================================
0000BFE4                            
0000BFE4                            loc_927C:
0000BFE4 6000 FFA6                  		bra.w	loc_9224
0000BFE8                            ; ===========================================================================
0000BFE8                            
0000BFE8                            loc_9280:
0000BFE8 6100 0000                  		bsr.w	sub_9404
0000BFEC 6A00                       		bpl.s	loc_92B6
0000BFEE 4268 0010                  		clr.w	obVelX(a0)
0000BFF2 4268 0032                  		clr.w	$32(a0)
0000BFF6 6100 0000                  		bsr.w	SpeedToPos
0000BFFA 0668 0018 0012             		addi.w	#$18,obVelY(a0)
0000C000 6100 0000                  		bsr.w	loc_93C4
0000C004 6100 0000                  		bsr.w	loc_93EC
0000C008 5328 001E                  		subq.b	#1,obTimeFrame(a0)
0000C00C 6A00                       		bpl.s	loc_92B6
0000C00E 117C 0001 001E             		move.b	#1,obTimeFrame(a0)
0000C014 5228 001A                  		addq.b	#1,obFrame(a0)
0000C018 0228 0001 001A             		andi.b	#1,obFrame(a0)
0000C01E                            
0000C01E                            loc_92B6:
0000C01E 6000 FF6C                  		bra.w	loc_9224
0000C022                            ; ===========================================================================
0000C022                            
0000C022                            loc_92BA:
0000C022 6100 0000                  		bsr.w	sub_9404
0000C026 6A00                       		bpl.s	loc_9310
0000C028 3168 0032 0010             		move.w	$32(a0),obVelX(a0)
0000C02E 3168 0034 0012             		move.w	$34(a0),obVelY(a0)
0000C034 117C 0004 0024             		move.b	#4,obRoutine(a0)
0000C03A 6000 FEB0                  		bra.w	loc_9184
0000C03E                            ; ===========================================================================
0000C03E                            
0000C03E                            loc_92D6:
0000C03E 6100 0000                  		bsr.w	ObjectFall
0000C042 117C 0001 001A             		move.b	#1,obFrame(a0)
0000C048 4A68 0012                  		tst.w	obVelY(a0)
0000C04C 6B00                       		bmi.s	loc_9310
0000C04E 117C 0000 001A             		move.b	#0,obFrame(a0)
0000C054 4EB9 0000 0000             		jsr	(ObjFloorDist).l
0000C05A 4A41                       		tst.w	d1
0000C05C 6A00                       		bpl.s	loc_9310
0000C05E 4628 0029                  		not.b	$29(a0)
0000C062 6600                       		bne.s	loc_9306
0000C064 4468 0010                  		neg.w	obVelX(a0)
0000C068 0868 0000 0001             		bchg	#0,obRender(a0)
0000C06E                            
0000C06E                            loc_9306:
0000C06E D368 000C                  		add.w	d1,obY(a0)
0000C072 3168 0034 0012             		move.w	$34(a0),obVelY(a0)
0000C078                            
0000C078                            loc_9310:
0000C078 6000 FF12                  		bra.w	loc_9224
0000C07C                            ; ===========================================================================
0000C07C                            
0000C07C                            loc_9314:
0000C07C 6100 0000                  		bsr.w	sub_9404
0000C080 6A00                       		bpl.s	loc_932E
0000C082 4268 0010                  		clr.w	obVelX(a0)
0000C086 4268 0032                  		clr.w	$32(a0)
0000C08A 6100 0000                  		bsr.w	ObjectFall
0000C08E 6100 0000                  		bsr.w	loc_93C4
0000C092 6100 0000                  		bsr.w	loc_93EC
0000C096                            
0000C096                            loc_932E:
0000C096 6000 FEF4                  		bra.w	loc_9224
0000C09A                            ; ===========================================================================
0000C09A                            
0000C09A                            loc_9332:
0000C09A 6100 0000                  		bsr.w	sub_9404
0000C09E 6A00                       		bpl.s	loc_936C
0000C0A0 6100 0000                  		bsr.w	ObjectFall
0000C0A4 117C 0001 001A             		move.b	#1,obFrame(a0)
0000C0AA 4A68 0012                  		tst.w	obVelY(a0)
0000C0AE 6B00                       		bmi.s	loc_936C
0000C0B0 117C 0000 001A             		move.b	#0,obFrame(a0)
0000C0B6 4EB9 0000 0000             		jsr	(ObjFloorDist).l
0000C0BC 4A41                       		tst.w	d1
0000C0BE 6A00                       		bpl.s	loc_936C
0000C0C0 4468 0010                  		neg.w	obVelX(a0)
0000C0C4 0868 0000 0001             		bchg	#0,obRender(a0)
0000C0CA D368 000C                  		add.w	d1,obY(a0)
0000C0CE 3168 0034 0012             		move.w	$34(a0),obVelY(a0)
0000C0D4                            
0000C0D4                            loc_936C:
0000C0D4 6000 FEB6                  		bra.w	loc_9224
0000C0D8                            ; ===========================================================================
0000C0D8                            
0000C0D8                            loc_9370:
0000C0D8 6100 0000                  		bsr.w	sub_9404
0000C0DC 6A00                       		bpl.s	loc_93C0
0000C0DE 6100 0000                  		bsr.w	SpeedToPos
0000C0E2 0668 0018 0012             		addi.w	#$18,obVelY(a0)
0000C0E8 4A68 0012                  		tst.w	obVelY(a0)
0000C0EC 6B00                       		bmi.s	loc_93AA
0000C0EE 4EB9 0000 0000             		jsr	(ObjFloorDist).l
0000C0F4 4A41                       		tst.w	d1
0000C0F6 6A00                       		bpl.s	loc_93AA
0000C0F8 4628 0029                  		not.b	$29(a0)
0000C0FC 6600                       		bne.s	loc_93A0
0000C0FE 4468 0010                  		neg.w	obVelX(a0)
0000C102 0868 0000 0001             		bchg	#0,obRender(a0)
0000C108                            
0000C108                            loc_93A0:
0000C108 D368 000C                  		add.w	d1,obY(a0)
0000C10C 3168 0034 0012             		move.w	$34(a0),obVelY(a0)
0000C112                            
0000C112                            loc_93AA:
0000C112 5328 001E                  		subq.b	#1,obTimeFrame(a0)
0000C116 6A00                       		bpl.s	loc_93C0
0000C118 117C 0001 001E             		move.b	#1,obTimeFrame(a0)
0000C11E 5228 001A                  		addq.b	#1,obFrame(a0)
0000C122 0228 0001 001A             		andi.b	#1,obFrame(a0)
0000C128                            
0000C128                            loc_93C0:
0000C128 6000 FE62                  		bra.w	loc_9224
0000C12C                            ; ===========================================================================
0000C12C                            
0000C12C                            loc_93C4:
0000C12C 117C 0001 001A             		move.b	#1,obFrame(a0)
0000C132 4A68 0012                  		tst.w	obVelY(a0)
0000C136 6B00                       		bmi.s	locret_93EA
0000C138 117C 0000 001A             		move.b	#0,obFrame(a0)
0000C13E 4EB9 0000 0000             		jsr	(ObjFloorDist).l
0000C144 4A41                       		tst.w	d1
0000C146 6A00                       		bpl.s	locret_93EA
0000C148 D368 000C                  		add.w	d1,obY(a0)
0000C14C 3168 0034 0012             		move.w	$34(a0),obVelY(a0)
0000C152                            
0000C152                            locret_93EA:
0000C152 4E75                       		rts	
0000C154                            ; ===========================================================================
0000C154                            
0000C154                            loc_93EC:
0000C154 08E8 0000 0001             		bset	#0,obRender(a0)
0000C15A 3028 0008                  		m